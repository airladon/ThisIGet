!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Fig",[],e):"object"==typeof exports?exports.Fig=e():t.Fig=e()}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"round",function(){return h}),n.d(i,"roundNum",function(){return c}),n.d(i,"decelerate",function(){return p}),n.d(i,"easeinout",function(){return m}),n.d(i,"easeout",function(){return y}),n.d(i,"easein",function(){return g}),n.d(i,"sinusoid",function(){return b}),n.d(i,"linear",function(){return v}),n.d(i,"clipMag",function(){return f}),n.d(i,"clipValue",function(){return d}),n.d(i,"range",function(){return w}),n.d(i,"randInt",function(){return _}),n.d(i,"rand",function(){return T}),n.d(i,"randElement",function(){return k}),n.d(i,"removeRandElement",function(){return O}),n.d(i,"randElements",function(){return S}),n.d(i,"rand2D",function(){return P}),n.d(i,"randSign",function(){return x});var r={};n.r(r),n.d(r,"point",function(){return K}),n.d(r,"Point",function(){return X}),n.d(r,"line",function(){return at}),n.d(r,"Line",function(){return ot}),n.d(r,"distance",function(){return J}),n.d(r,"minAngleDiff",function(){return et}),n.d(r,"deg",function(){return tt}),n.d(r,"normAngle",function(){return nt}),n.d(r,"Transform",function(){return ht}),n.d(r,"TransformLimit",function(){return ct}),n.d(r,"Rect",function(){return U}),n.d(r,"Translation",function(){return lt}),n.d(r,"Scale",function(){return ut}),n.d(r,"Rotation",function(){return st}),n.d(r,"spaceToSpaceTransform",function(){return ft}),n.d(r,"getBoundingRect",function(){return yt}),n.d(r,"linearPath",function(){return Y}),n.d(r,"curvedPath",function(){return Q}),n.d(r,"quadraticBezier",function(){return V}),n.d(r,"translationPath",function(){return Z}),n.d(r,"polarToRect",function(){return vt}),n.d(r,"rectToPolar",function(){return mt}),n.d(r,"getDeltaAngle",function(){return rt}),n.d(r,"normAngleTo90",function(){return it}),n.d(r,"threePointAngle",function(){return bt}),n.d(r,"threePointAngleMin",function(){return gt}),n.d(r,"randomPoint",function(){return wt}),n.d(r,"getMaxTimeFromVelocity",function(){return xt}),n.d(r,"getMoveTime",function(){return _t}),n.d(r,"parsePoint",function(){return Tt}),n.d(r,"clipAngle",function(){return W}),n.d(r,"spaceToSpaceScale",function(){return dt}),n.d(r,"getPoint",function(){return kt});var o={};n.r(o),n.d(o,"divide",function(){return Dt}),n.d(o,"mulToString",function(){return Bt}),n.d(o,"add",function(){return Ft}),n.d(o,"Console",function(){return Ct}),n.d(o,"classify",function(){return It}),n.d(o,"extractFrom",function(){return Ht}),n.d(o,"ObjectKeyPointer",function(){return qt}),n.d(o,"getElement",function(){return Nt}),n.d(o,"addToObject",function(){return zt}),n.d(o,"duplicateFromTo",function(){return Gt}),n.d(o,"isTouchDevice",function(){return Ut}),n.d(o,"generateUniqueId",function(){return Wt}),n.d(o,"joinObjects",function(){return Vt}),n.d(o,"cleanUIDs",function(){return Qt}),n.d(o,"loadRemote",function(){return Xt}),n.d(o,"loadRemoteCSS",function(){return Yt}),n.d(o,"deleteKeys",function(){return Zt}),n.d(o,"copyKeysFromTo",function(){return Kt}),n.d(o,"generateRandomString",function(){return $t});var a={};n.r(a),n.d(a,"RGBToArray",function(){return Me}),n.d(a,"HexToArray",function(){return Re}),n.d(a,"cssColorToArray",function(){return Ce}),n.d(a,"colorArrayToRGB",function(){return Be}),n.d(a,"colorArrayToRGBA",function(){return Fe}),n.d(a,"getCSSColors",function(){return je});var s={};n.r(s),n.d(s,"PositionAnimationStep",function(){return Qe}),n.d(s,"AnimationBuilder",function(){return Ri}),n.d(s,"ParallelAnimationStep",function(){return si}),n.d(s,"SerialAnimationStep",function(){return vi}),n.d(s,"TransformAnimationStep",function(){return _n}),n.d(s,"AnimationStep",function(){return Ie}),n.d(s,"DelayStep",function(){return _i}),n.d(s,"TriggerStep",function(){return Un}),n.d(s,"inParallel",function(){return li}),n.d(s,"inSerial",function(){return mi}),n.d(s,"trigger",function(){return Xn}),n.d(s,"delay",function(){return Ti}),n.d(s,"ColorAnimationStep",function(){return en}),n.d(s,"DissolveInAnimationStep",function(){return dn}),n.d(s,"dissolveIn",function(){return pn}),n.d(s,"DissolveOutAnimationStep",function(){return vn}),n.d(s,"dissolveOut",function(){return mn}),n.d(s,"CustomAnimationStep",function(){return Jn}),n.d(s,"custom",function(){return ti}),n.d(s,"AnimationManager",function(){return Oi}),n.d(s,"RotationAnimationStep",function(){return An}),n.d(s,"ScaleAnimationStep",function(){return Cn}),n.d(s,"PulseAnimationStep",function(){return Hn}),n.d(s,"OpacityAnimationStep",function(){return fn});var l={};n.r(l),n.d(l,"actionWord",function(){return pr}),n.d(l,"click",function(){return fr}),n.d(l,"highlight",function(){return sr}),n.d(l,"addClass",function(){return cr}),n.d(l,"addId",function(){return hr}),n.d(l,"onClickId",function(){return vr}),n.d(l,"highlightWord",function(){return ur}),n.d(l,"centerV",function(){return tr}),n.d(l,"centerH",function(){return nr}),n.d(l,"centerVH",function(){return er}),n.d(l,"toHTML",function(){return ar}),n.d(l,"itemSelector",function(){return rr}),n.d(l,"unit",function(){return or}),n.d(l,"applyModifiers",function(){return mr}),n.d(l,"setOnClicks",function(){return yr}),n.d(l,"setHTML",function(){return gr}),n.d(l,"withClass",function(){return Ji}),n.d(l,"style",function(){return ir}),n.d(l,"clickW",function(){return dr}),n.d(l,"link",function(){return lr});var u={};n.r(u),n.d(u,"getCSSVariables",function(){return Pe}),n.d(u,"getDefinedCSSVariables",function(){return Se}),n.d(u,"searchObject",function(){return ke}),n.d(u,"getCSSColors",function(){return je});var c=function(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5,i=Math.pow(10,n),r=Math.round(t*i)/i;return((e=r)===-0?0!==e||1/e==-1/0:e!=e&&!1)&&(r=0),r};function h(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5,n=0;return Array.isArray(t)&&(n=t.map(function(t){return h(t,e)})),"number"==typeof t&&(n=c(t,e)),n}function f(t,e,n){var i=t,r=e,o=n;return null===r&&(r=0),r<0&&(r=-r),null===o||(o<0&&(o=-o),-r<=t&&t<=r&&(i=0),o<t&&(i=o),t<-o&&(i=-o)),i}function d(t,e,n){var i=t;return null!==e&&t<e&&(i=e),null!==n&&n<t&&(i=n),i}var p=function(t,e,n,i,r){var o=0;null!==r&&(o=r);var a=0;if(null!==n&&(a=n),0===f(e,o,e))return{p:t,v:0};var s=a;a<0&&(s=-s);var l=e/Math.abs(e),u=e-l*s*i,c=i;if(0===(u=u/Math.abs(u)!==l?0:f(u,o,u))){var h=o;h/Math.abs(h)!==l&&(h=-h),c=Math.abs((h-e)/s)}return{p:t+e*c-.5*l*s*c*c,v:u}},v=function(t){return 1<arguments.length&&void 0!==arguments[1]&&arguments[1],t},m=function(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var e=t;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)}var n=t;return Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))};function y(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var e=t;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)}var n=.5+t/2;return 2*(Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))-.5)}function g(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var e=t;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)}var n=t/2;return Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))*2}function b(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;return n+i*Math.sin(t*e*2*Math.PI+r)}function w(t,e){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=[],r=t;r<=e+.5*n;r+=n)i.push(r);return i}function x(){return.5<Math.random()?1:-1}function _(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=0;if(null!=e){var r=t;i=Math.floor(Math.random()*Math.floor(e-r)+Math.floor(r))}else i=Math.floor(Math.random()*Math.floor(t));return n&&(i*=x()),i}function T(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=0;if(null!=e){var r=t;i=Math.random()*(e-r)+r}else i=Math.random()*t;return n&&(i*=x()),i}function k(t){return t[_(t.length)]}function O(t){var e=T(t.length);return t.splice(e,1)[0]}function S(t,e){for(var n=w(0,e.length-1,1),i=[],r=0;r<t;r+=1){var o=O(n);i.push(e[o])}return i}function P(t,e,n,i){return{x:T(t,n),y:T(e,i)}}function A(t,e){return[t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]]}function E(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}function L(t,e){return[1,0,t,0,1,e,0,0,1]}function j(t,e,n){return A(t,L(e,n))}function M(t){var e=Math.cos(t),n=Math.sin(t);return[e,-n,0,n,e,0,0,0,1]}function R(t,e){return A(t,M(e))}function C(t,e){return[t,0,0,0,e,0,0,0,1]}function F(t,e,n){return A(t,C(e,n))}function B(t){var e=1/(t[0]*(t[4]*t[8]-t[7]*t[5])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]));return[(t[4]*t[8]-t[7]*t[5])*e,(t[2]*t[7]-t[1]*t[8])*e,(t[1]*t[5]-t[2]*t[4])*e,(t[5]*t[6]-t[3]*t[8])*e,(t[0]*t[8]-t[2]*t[6])*e,(t[3]*t[2]-t[0]*t[5])*e,(t[3]*t[7]-t[6]*t[4])*e,(t[6]*t[1]-t[0]*t[7])*e,(t[0]*t[4]-t[3]*t[1])*e]}function D(t){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function I(t,e){return!e||"object"!==D(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function N(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function G(t,e,n){return e&&z(t.prototype,e),n&&z(t,n),t}function V(t,e,n,i){return(1-i)*((1-i)*t+i*e)+i*((1-i)*e+i*n)}function W(t,e){var n=t;return"0to360"===e&&(n<0&&(n+=2*Math.PI),n>=2*Math.PI&&(n-=2*Math.PI)),"-180to180"===e&&(n<-Math.PI&&(n+=2*Math.PI),n>=Math.PI&&(n-=2*Math.PI)),n}var U=function(){function t(e,n,i,r){N(this,t),this.left=e,this.width=i,this.height=r,this.bottom=n,this.top=n+r,this.right=e+i}return G(t,[{key:"_dup",value:function(){return new t(this.left,this.bottom,this.width,this.height)}}]),t}(),X=function(){function t(e,n){N(this,t),this.x=e,this.y=n,this._type="point"}return G(t,null,[{key:"zero",value:function(){return new t(0,0)}},{key:"Unity",value:function(){return new t(1,1)}}]),G(t,[{key:"_dup",value:function(){return new t(this.x,this.y)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"sub",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e instanceof t?new t(this.x-e.x,this.y-e.y):new t(this.x-e,this.y-n)}},{key:"add",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e instanceof t?new t(this.x+e.x,this.y+e.y):new t(this.x+e,this.y+n)}},{key:"distance",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"round",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;return new t(c(this.x,e),c(this.y,e))}},{key:"clip",value:function(e,n){var i,r,o,a;return r=e instanceof t?(i=e.x,e.y):i=e,a=n instanceof t?(o=n.x,n.y):o=n,new t(d(this.x,i,o),d(this.y,r,a))}},{key:"transformBy",value:function(e){var n,i,r,o=(n=e,i=this.x,r=this.y,[n[0]*i+n[1]*r+n[2],n[3]*i+n[4]*r+n[5]]);return new t(o[0],o[1])}},{key:"quadraticBezier",value:function(e,n,i){return new t(V(this.x,e.x,n.x,i),V(this.y,e.y,n.y,i))}},{key:"rotate",value:function(e,n){var i=Math.cos(e),r=Math.sin(e),o=[i,-r,r,i],a=n||new t(0,0),s=this.sub(a);return new t(o[0]*s.x+o[1]*s.y+a.x,o[2]*s.x+o[3]*s.y+a.y)}},{key:"isEqualTo",value:function(t,e){var n=this,i=t;return"number"==typeof e&&(n=this.round(e),i=i.round(e)),n.x===i.x&&n.y===i.y}},{key:"isNotEqualTo",value:function(t,e){return!this.isEqualTo(t,e)}},{key:"isOnLine",value:function(t,e){return t.hasPointOn(this,e)}},{key:"getShaddowOnLine",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=new ot(this,1,t.angle()+Math.PI/2).intersectsWith(t).intersect;return null!=n&&n.isOnLine(t,e)?n:null}},{key:"shaddowIsOnLine",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8;return null!=this.getShaddowOnLine(t,e)}},{key:"isOnUnboundLine",value:function(t,e){return t.hasPointAlong(this,e)}},{key:"isInPolygon",value:function(e){var n=0,i=e.length-1,r=e.slice(),o=this,a=!1;r[0].isNotEqualTo(r[i])&&(r.push(r[0]),a=!0,i+=1);for(var s=0;s<i;s+=1)r[s].y<=o.y?r[s+1].y>o.y&&0<t.isLeft(r[s],r[s+1],o)&&(n+=1):r[s+1].y<=o.y&&t.isLeft(r[s],r[s+1],o)<0&&(n-=1);return a&&r.pop(),0!==n}},{key:"isOnPolygon",value:function(t){var e=!1,n=t.length-1,i=t.slice();i[0].isNotEqualTo(i[n])&&(i.push(i[0]),e=!0,n+=1);for(var r=0;r<n;r+=1){var o=at(i[r],i[r+1]);if(this.isOnLine(o))return e&&i.pop(),!0}return this.isInPolygon(t)?(e&&i.pop(),!0):(e&&i.pop(),!1)}},{key:"toPolar",value:function(){return{mag:Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)),angle:Math.atan2(this.y,this.x)}}},{key:"toDelta",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"linear",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""};return Z(n,this._dup(),t,e,i)}}],[{key:"isLeft",value:function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}}]),t}();function Y(t,e,n){return t.add(e.x*n,e.y*n)}function Q(t,e,n,i){var r=i,o=Math.atan2(e.y,e.x),a=t.add(new X(e.x*r.offset,e.y*r.offset)),s=e.toPolar().mag*r.magnitude,l=i.controlPoint;if(null==l){var u=i.direction,c=Math.cos(o+r.rot*Math.PI/2),h=Math.sin(o+r.rot*Math.PI/2);"up"===u?h<0&&(h=Math.sin(o+r.rot*Math.PI/2+Math.PI)):"down"===u?0<h&&(h=Math.sin(o+r.rot*Math.PI/2+Math.PI)):"left"===u?0<c&&(c=Math.cos(o+r.rot*Math.PI/2+Math.PI)):"right"===u&&c<0&&(c=Math.cos(o+r.rot*Math.PI/2+Math.PI)),l=new X(a.x+s*c,a.y+s*h)}var f=t,d=l,p=t.add(e),v=n,m=V(f.x,d.x,p.x,v),y=V(f.y,d.y,p.y,v);return new X(m,y)}function Z(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"linear",e=1<arguments.length?arguments[1]:void 0,n=2<arguments.length?arguments[2]:void 0,i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length?arguments[4]:void 0;return"linear"===t?Y(e,n,i):"curved"===t?Q(e,n,i,r):new X(0,0)}function K(t,e){return new X(t,e)}function $(t,e,n,i){if(null==i){if(t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x)&&t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y))return!0}else if(c(t.x,i)>=c(Math.min(e.x,n.x),i)&&c(t.x,i)<=c(Math.max(e.x,n.x),i)&&c(t.y,i)>=c(Math.min(e.y,n.y),i)&&c(t.y,i)<=c(Math.max(e.y,n.y),i))return!0;return!1}function J(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function tt(t){return 180*t/Math.PI}function et(t,e){return t===e?0:Math.atan2(Math.sin(t-e),Math.cos(t-e))}function nt(t){for(var e=t;e>=2*Math.PI;)e-=2*Math.PI;for(;e<0;)e+=2*Math.PI;return e}function it(t){var e=nt(t);return e>Math.PI/2&&e<Math.PI&&(e+=Math.PI),e===Math.PI&&(e=0),e>Math.PI&&e<3*Math.PI/2&&(e-=Math.PI),e}function rt(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=nt(t),r=nt(e);return i===r?0:(2===n&&(r<i?-1:1),0===n?et(r,i):1===n&&r<i?2*Math.PI-i+r:-1===n&&i<r?-i-(2*Math.PI-r):r-i)}var ot=function(){function t(e,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;N(this,t),this.p1=e._dup(),this.ang=n instanceof X?(this.p2=n._dup(),Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x)):(this.p2=this.p1.add(n*Math.cos(i),n*Math.sin(i)),i),this.A=this.p2.y-this.p1.y,this.B=this.p1.x-this.p2.x,this.C=this.A*this.p1.x+this.B*this.p1.y,this.distance=J(this.p1,this.p2)}return G(t,[{key:"_dup",value:function(){return new t(this.p1,this.p2)}},{key:"getPoint",value:function(){return 2===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)?this.p2:this.p1}},{key:"getYFromX",value:function(t){return 0!==this.B?(this.C-this.A*t)/this.B:null}},{key:"getXFromY",value:function(t){return 0!==this.A?(this.C-this.B*t)/this.A:null}},{key:"angle",value:function(){return this.ang}},{key:"round",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8,n=new t(this.p1,this.p2);return n.A=c(n.A,e),n.B=c(n.B,e),n.C=c(n.C,e),n.ang=c(n.ang,e),n.distance=c(n.distance,e),n}},{key:"length",value:function(){return this.distance}},{key:"midPoint",value:function(){return this.pointAtPercent(.5)}},{key:"pointAtPercent",value:function(t){var e=this.length(),n=this.p2.sub(this.p1),i=Math.atan2(n.y,n.x);return K(this.p1.x+e*t*Math.cos(i),this.p1.y+e*t*Math.sin(i))}},{key:"pointAtLength",value:function(t){var e=this.p2.sub(this.p1),n=Math.atan2(e.y,e.x);return K(this.p1.x+t*Math.cos(n),this.p1.y+t*Math.sin(n))}},{key:"hasPointAlong",value:function(t,e){if(null==e){if(this.C===this.A*t.x+this.B*t.y)return!0}else if(c(this.C,e)===c(this.A*t.x+this.B*t.y,e))return!0;return!1}},{key:"distanceToPoint",value:function(t,e){return c(Math.abs(this.A*t.x+this.B*t.y-this.C)/Math.sqrt(Math.pow(this.A,2)+Math.pow(this.B,2)),e)}},{key:"hasPointOn",value:function(t,e){return!(!this.hasPointAlong(t,e)||!$(t,this.p1,this.p2,e))}},{key:"isEqualTo",value:function(t,e){var n=this,i=t;return"number"==typeof e&&(n=n.round(e),i=i.round(e),n.p1=n.p1.round(e),n.p2=n.p2.round(e),i.p1=i.p1.round(e),i.p2=i.p2.round(e)),!(n.A!==i.A||n.B!==i.B||n.C!==i.C||n.p1.isNotEqualTo(i.p1)&&n.p1.isNotEqualTo(i.p2)||n.p2.isNotEqualTo(i.p1)&&n.p2.isNotEqualTo(i.p2))}},{key:"isOnSameLineAs",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=this.round(e),i=t.round(e);if(0===n.A&&0===n.B||0===i.A&&0===i.B)return!1;if(0!==n.A){var r=i.A/n.A;return n.B*r===i.B&&n.C*r===i.C}if(0!==i.A){var o=n.A/i.A;return i.B*o===n.B&&i.C*o===n.C}if(0!==n.B){var a=i.B/n.B;return n.A*a===i.A&&n.C*a===i.C}if(0===i.B)return!0;var s=n.B/i.B;return i.A*s===n.A&&i.C*s===n.C}},{key:"intersectsWith",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,i=e,r=this,o=r.A*i.B-i.A*r.B;if(0!==c(o,n)){var a=K(0,0);return a.x=(i.B*r.C-r.B*i.C)/o,a.y=(r.A*i.C-i.A*r.C)/o,$(a,r.p1,r.p2,n)&&$(a,i.p1,i.p2,n)?{onLine:!0,inLine:!0,intersect:a}:{onLine:!0,inLine:!1,intersect:a}}if(0===o&&r.isOnSameLineAs(i,n)){if(r.p1.isOnLine(i,n)||r.p2.isOnLine(i,n)||i.p1.isOnLine(r,n)||i.p2.isOnLine(r,n))return r.p1.isOnLine(i,n)&&r.p2.isOnLine(i,n)&&(!i.p1.isOnLine(r,n)||!i.p2.isOnLine(r,n))||i.p1.isOnLine(r,n)&&i.p2.isOnLine(r,n)&&(!r.p1.isOnLine(i,n)||!r.p2.isOnLine(i,n))?{onLine:!0,inLine:!0,intersect:new t(r.midPoint(),i.midPoint()).midPoint()}:(r.p1.isOnLine(i,n)&&!r.p2.isOnLine(i,n)&&i.p1.isOnLine(r,n)&&!i.p2.isOnLine(r,n)&&(s=new t(r.p1,i.p1)),r.p1.isOnLine(i,n)&&!r.p2.isOnLine(i,n)&&!i.p1.isOnLine(r,n)&&i.p2.isOnLine(r,n)&&(s=new t(r.p1,i.p2)),!r.p1.isOnLine(i,n)&&r.p2.isOnLine(i,n)&&i.p1.isOnLine(r,n)&&!i.p2.isOnLine(r,n)&&(s=new t(r.p2,i.p1)),!r.p1.isOnLine(i,n)&&r.p2.isOnLine(i,n)&&!i.p1.isOnLine(r,n)&&i.p2.isOnLine(r,n)&&(s=new t(r.p2,i.p2)),s instanceof t&&(l=s.midPoint()),{onLine:!0,inLine:!0,intersect:l});var s,l,u=new t(r.p1,i.p1),h=new t(r.p1,i.p2),f=new t(r.p2,i.p1),d=new t(r.p2,i.p2),p=u.midPoint(),v=u.length();return h.length()<v&&(p=h.midPoint(),v=h.length()),f.length()<v&&(p=f.midPoint(),v=f.length()),d.length()<v&&(p=d.midPoint(),v=d.length()),{onLine:!0,inLine:!1,intersect:p}}return{onLine:!1,inLine:!1,intersect:void 0}}}]),t}();function at(t,e){return new ot(t,e)}var st=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";N(this,t),this.r=e,this.name=n}return G(t,[{key:"matrix",value:function(){return M(this.r)}},{key:"sub",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t(0,this.name);return new t(this.r-e.r,this.name)}},{key:"round",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;return new t(c(this.r,e),this.name)}},{key:"add",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t(0,this.name);return new t(this.r+e.r,this.name)}},{key:"mul",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t(1,this.name);return new t(this.r*e.r,this.name)}},{key:"_dup",value:function(){return new t(this.r,this.name)}}]),t}(),lt=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return N(this,e),(n=I(this,t instanceof X?q(e).call(this,t.x,t.y):q(e).call(this,t,i))).name=r,I(n)}return H(e,X),G(e,[{key:"matrix",value:function(){return L(this.x,this.y)}},{key:"sub",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new X(0,0);return i="number"==typeof t?new e(t,n):t,new e(this.x-i.x,this.y-i.y,this.name)}},{key:"add",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new X(0,0);return i="number"==typeof t?new e(t,n):t,new e(this.x+i.x,this.y+i.y,this.name)}},{key:"mul",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(1,1);return new e(this.x*t.x,this.y*t.y,this.name)}},{key:"round",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;return new e(c(this.x,t),c(this.y,t),this.name)}},{key:"_dup",value:function(){return new e(this.x,this.y,this.name)}}]),e}(),ut=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return N(this,e),(i=I(this,t instanceof X?q(e).call(this,t.x,t.y):q(e).call(this,t,n))).name=r,I(i)}return H(e,X),G(e,[{key:"matrix",value:function(){return C(this.x,this.y)}},{key:"sub",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new X(0,0);return i="number"==typeof t?new e(t,n):t,new e(this.x-i.x,this.y-i.y,this.name)}},{key:"round",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;return new e(c(this.x,t),c(this.y,t),this.name)}},{key:"add",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new X(0,0);return i="number"==typeof t?new e(t,n):t,new e(this.x+i.x,this.y+i.y,this.name)}},{key:"mul",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(1,1);return t instanceof e||t instanceof X?new e(this.x*t.x,this.y*t.y):new e(this.x*t,this.y*t,this.name)}},{key:"_dup",value:function(){return new e(this.x,this.y,this.name)}}]),e}(),ct=function(){function t(e,n,i){N(this,t),this.scale=e,this.rotation=n,this.translation=i}return G(t,[{key:"_dup",value:function(){return new t(this.scale,this.rotation,this.translation)}}]),t}(),ht=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";N(this,t),this.name="string"==typeof e?(this.order=[],e):(this.order=e.map(function(t){return t._dup()}),n),this.index=this.order.length,this._type="transform",this.calcMatrix()}return G(t,[{key:"standard",value:function(){return this.scale(1,1).rotate(0).translate(0,0)}},{key:"translate",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new lt(e,n,this.name),r=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=i,this.index+=1,this.calcMatrix(),this):(r.push(i),new t(r,this.name))}},{key:"rotate",value:function(e){var n=new st(e,this.name);n.name=this.name;var i=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=n,this.index+=1,this.calcMatrix(),this):(i.push(n),new t(i,this.name))}},{key:"scale",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new ut(e,n,this.name),r=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=i,this.index+=1,this.calcMatrix(),this):(r.push(i),new t(r,this.name))}},{key:"calcMatrix",value:function(){for(var t=[1,0,0,0,1,0,0,0,1],e=this.order.length-1;0<=e;e-=1)t=A(t,this.order[e].matrix());this.mat=t}},{key:"update",value:function(t){return t<this.order.length&&(this.index=t),this}},{key:"t",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=0;n<this.order.length;n+=1){var i=this.order[n];if(i instanceof lt){if(e===t)return new X(i.x,i.y);e+=1}}return null}},{key:"clipRotation",value:function(t){for(var e=0;e<this.order.length;e+=1){var n=this.order[e];n instanceof st&&(n.r=W(n.r,t))}}},{key:"updateTranslation",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t instanceof X&&(i=e);for(var r=0;r<this.order.length;r+=1)if(this.order[r]instanceof lt){if(n===i)return this.order[r]=new lt(t,e,this.name),void this.calcMatrix();n+=1}}},{key:"s",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=0;n<this.order.length;n+=1){var i=this.order[n];if(i instanceof ut){if(e===t)return new X(i.x,i.y);e+=1}}return null}},{key:"toDelta",value:function(t,e,n,i){for(var r=this._dup(),o=0;o<this.order.length;o+=1){var a=this.order[o],s=t.order[o];a instanceof ut&&s instanceof ut&&(r.order[o]=a.add(s.mul(e))),a instanceof st&&s instanceof st&&(r.order[o]=new st(a.r+s.r*e)),a instanceof lt&&s instanceof lt&&(r.order[o]=new lt(Z(n,a,s,e,i)))}return r}},{key:"updateScale",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t instanceof X&&(i=e);for(var r=0;r<this.order.length;r+=1)if(this.order[r]instanceof ut){if(n===i)return this.order[r]=new ut(t,e,this.name),void this.calcMatrix();n+=1}}},{key:"r",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=0;n<this.order.length;n+=1){var i=this.order[n];if(i instanceof st){if(e===t)return i.r;e+=1}}return null}},{key:"updateRotation",value:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0,i=0;i<this.order.length;i+=1)if(this.order[i]instanceof st){if(n===e)return this.order[i]=new st(t,this.name),void this.calcMatrix();n+=1}}},{key:"m",value:function(){return this.mat}},{key:"matrix",value:function(){return this.mat}},{key:"isSimilarTo",value:function(t){if(t.order.length!==this.order.length)return!1;for(var e=0;e<this.order.length;e+=1)if(this.order[e].constructor.name!==t.order[e].constructor.name)return!1;return!0}},{key:"isEqualTo",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8;if(!this.isSimilarTo(t))return!1;for(var n=0;n<this.order.length;n+=1){var i=t.order[n],r=this.order[n];if(r.constructor.name!==i.constructor.name)return!1;if((r instanceof lt&&i instanceof lt||r instanceof ut&&i instanceof ut)&&i.isNotEqualTo(r,e))return!1;if(r instanceof st&&i.r!==r.r)return!1}return!0}},{key:"sub",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t;if(!this.isSimilarTo(e))return new t(this.order,this.name);for(var n=[],i=0;i<this.order.length;i+=1)n.push(this.order[i].sub(e.order[i]));return new t(n,this.name)}},{key:"add",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t;if(!this.isSimilarTo(e))return new t(this.order,this.name);for(var n=[],i=0;i<this.order.length;i+=1)n.push(this.order[i].add(e.order[i]));return new t(n,this.name)}},{key:"mul",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t;if(!this.isSimilarTo(e))return new t(this.order,this.name);for(var n=[],i=0;i<this.order.length;i+=1)n.push(this.order[i].mul(e.order[i]));return new t(n,this.name)}},{key:"transform",value:function(e){var n=new t([],this.name);return n.order=e.order.concat(this.order),n.mat=A(this.matrix(),e.matrix()),n}},{key:"transformBy",value:function(e){var n=new t([],this.name);return n.order=this.order.concat(e.order),n.mat=A(e.matrix(),this.matrix()),n}},{key:"round",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8,n=[],i=0;i<this.order.length;i+=1)n.push(this.order[i].round(e));return new t(n,this.name)}},{key:"clip",value:function(e,n,i){if(!this.isSimilarTo(e)||!this.isSimilarTo(n))return this._dup();for(var r=[],o=0;o<this.order.length;o+=1){var a=this.order[o],s=e.order[o],l=n.order[o];if(a instanceof lt&&s instanceof lt&&l instanceof lt){var u=d(a.x,s.x,l.x),c=d(a.y,s.y,l.y);r.push(new lt(u,c,this.name))}else if(a instanceof st&&s instanceof st&&l instanceof st)r.push(new st(d(a.r,s.r,l.r),this.name));else if(a instanceof ut&&s instanceof ut&&l instanceof ut){var h=d(a.x,s.x,l.x),f=d(a.y,s.y,l.y);r.push(new ut(h,f,this.name))}}var p=new t(r,this.name);if(null!=i){var v=p.t();if(null!=v){var m=new ot(v,1,i.angle()+Math.PI/2).intersectsWith(i).intersect;m&&(m.isOnLine(i,4)?p.updateTranslation(m):J(m,i.p1)<J(m,i.p2)?p.updateTranslation(i.p1):p.updateTranslation(i.p2))}}return p}},{key:"clipMag",value:function(e,n){for(var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=[],o=e,a=n,s=0;s<this.order.length;s+=1){var l=this.order[s];if(l instanceof lt)if(i){var u=l.toPolar(),c=u.mag,h=u.angle,d=f(c,o.translation,a.translation);r.push(new lt(d*Math.cos(h),d*Math.sin(h),this.name))}else{var p=f(l.x,o.translation,a.translation),v=f(l.y,o.translation,a.translation);r.push(new lt(p,v,this.name))}else if(l instanceof st){var m=f(l.r,o.rotation,a.rotation);r.push(new st(m,this.name))}else if(l instanceof ut)if(i){var y=l.toPolar(),g=y.mag,b=y.angle,w=f(g,o.scale,a.scale);r.push(new ut(w*Math.cos(b),w*Math.sin(b),this.name))}else{var x=f(l.x,o.scale,a.scale),_=f(l.y,o.scale,a.scale);r.push(new ut(x,_,this.name))}}return new t(r,this.name)}},{key:"constant",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=[],i=0;i<this.order.length;i+=1){var r=this.order[i];r instanceof lt?n.push(new lt(e,e,this.name)):r instanceof st?n.push(new st(e,this.name)):r instanceof ut&&n.push(new ut(e,e,this.name))}return new t(n,this.name)}},{key:"zero",value:function(){return this.constant(0)}},{key:"isZero",value:function(){for(var t=0;t<this.order.length;t+=1){var e=this.order[t];if(e instanceof lt||e instanceof ut){if(0!==e.x||0!==e.y)return!1}else if(e instanceof st&&0!==e.r)return!1}return!0}},{key:"_dup",value:function(){var e=new t(this.order,this.name);return e.index=this.index,e}},{key:"decelerate",value:function(e,n,i,r){for(var o=new t,a=new t,s=r,l=n,u=0;u<this.order.length;u+=1){var c=this.order[u],h=e.order[u];if(c instanceof lt&&h instanceof lt){var f=h.toPolar(),d=f.mag,v=f.angle,m=p(0,d,l.translation,i,s.translation);o=o.translate(m.v*Math.cos(v),m.v*Math.sin(v)),a=a.translate(c.x+m.p*Math.cos(v),c.y+m.p*Math.sin(v))}else if(c instanceof st&&h instanceof st){var y=p(c.r,h.r,l.rotation,i,s.rotation);o=o.rotate(y.v),a=a.rotate(y.p)}else{if(!(c instanceof ut&&h instanceof ut))return{v:new t,t:new t};var g=h.toPolar(),b=g.mag,w=g.angle,x=p(0,b,l.scale,i,s.scale);o=o.scale(x.v*Math.cos(w),x.v*Math.sin(w)),a=a.scale(c.x+x.p*Math.cos(w),c.y+x.p*Math.sin(w))}}return{v:o,t:a}}},{key:"velocity",value:function(e,n,i,r){var o=[];if(!this.isSimilarTo(e))return this.zero();for(var a=this.sub(e),s=0;s<a.order.length;s+=1){var l=a.order[s];l instanceof lt?o.push(new lt(l.x/n,l.y/n)):l instanceof st?o.push(new st(l.r/n)):l instanceof ut&&o.push(new ut(l.x/n,l.y/n))}return new t(o).clipMag(i,r)}}]),t}();function ft(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=e.x.width/t.x.width,r=e.y.height/t.y.height;return new ht(n).scale(i,r).translate(e.x.bottomLeft-t.x.bottomLeft*i,e.y.bottomLeft-t.y.bottomLeft*r)}function dt(t,e){var n=e.x.width/t.x.width,i=e.y.height/t.y.height;return new X(n,i)}function pt(t,e,n,i){var r=new X(0,0),o=new X(0,0);return o.y=i?(r.x=t.x,r.y=t.y,o.x=t.x,t.y):(r.x=t.x<e.x?t.x:e.x,r.y=t.y<e.y?t.y:e.y,o.x=t.x>n.x?t.x:n.x,t.y>n.y?t.y:n.y),{min:r,max:o}}function vt(t,e){return new X(t*Math.cos(e),t*Math.sin(e))}function mt(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=(e="number"==typeof t?new X(t,n):t).distance(),r=Math.atan2(e.y,e.x);return r<0&&(r+=2*Math.PI),{mag:i,angle:r}}function yt(t){var e=!0,n={min:new X(0,0),max:new X(0,0)};return t.forEach(function(t){Array.isArray(t)?t.forEach(function(t){n=pt(t,n.min,n.max,e),e=!1}):n=pt(t,n.min,n.max,e),e=!1}),new U(n.min.x,n.min.y,n.max.x-n.min.x,n.max.y-n.min.y)}function gt(t,e,n){var i=J(e,t),r=J(e,n),o=J(t,n);return Math.acos((Math.pow(i,2)+Math.pow(r,2)-Math.pow(o,2))/(2*i*r))}function bt(t,e,n){var i=t.sub(e),r=n.sub(e),o=i.toPolar().angle,a=r.toPolar().angle;return a-=o,o=0,W(a,"0to360")}function wt(t){var e=P(t.left,t.bottom,t.right,t.top);return new X(e.x,e.y)}function xt(t,e,n){var i,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=e.sub(t),a=0;return i="number"==typeof n?t._dup().constant(n):n,o.order.forEach(function(n,o){if(n instanceof lt||n instanceof ut){var s=i.order[o];if((s instanceof lt||s instanceof ut)&&0!==s.x&&0!==s.y){var l=Math.abs(n.x)/s.x,u=Math.abs(n.y)/s.y;a=(a=a<l?l:a)<u?u:a}}var c=t.order[o],h=e.order[o];if(n instanceof st&&c instanceof st&&h instanceof st){var f=rt(c.r,h.r,r);n.r=f;var d=i.order[o];if(d instanceof st&&0!==d){var p=Math.abs(n.r/d.r);a=a<p?p:a}}}),a}function _t(t,e){var n,i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new X(.25,.25),a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2*Math.PI/6,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new X(1,1);if(n=t instanceof ht?[t]:t,(i=e instanceof ht?[e]:e).length!==n.length)return 0;var l=0;return n.forEach(function(t,e){for(var n=i[e],u=t._dup(),c=0;c<u.order.length;c+=1){var h=u.order[c];h instanceof lt?(h.x=o.x,h.y=o.y):h instanceof st?h.r=a:(h.x=s.x,h.y=s.y)}var f=xt(t,n,u,r);l<f&&(l=f)}),l}function Tt(t,e){if(t instanceof X)return t;var n=e;if(null==n&&(n=null),Array.isArray(t))return 2===t.length?new X(t[0],t[1]):n;if("number"==typeof t)return new X(t,t);if("object"===D(t)){var i=Object.keys(t);if(-1<i.indexOf("x")&&-1<i.indexOf("y"))return new X(t.x,t.y)}return n}function kt(t){var e=Tt(t);return null==e&&(e=new X(0,0)),e}var Ot={simple:{source:"attribute vec2 a_position;uniform mat3 u_matrix;uniform float u_z;void main() {gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);}",varNames:["a_position","u_matrix","u_z"]},withTexture:{source:"attribute vec2 a_position;attribute vec2 a_texcoord;uniform mat3 u_matrix;uniform float u_z;varying vec2 v_texcoord;void main() {gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);v_texcoord = a_texcoord;}",varNames:["a_position","a_texcoord","u_matrix","u_z"]}},St={simple:{source:"precision mediump float;uniform vec4 u_color;void main() {gl_FragColor = u_color;}",varNames:["u_color"]},withTexture:{source:"precision mediump float;uniform vec4 u_color;uniform int u_use_texture;uniform sampler2D u_texture;varying vec2 v_texcoord;void main() {if ( u_use_texture == 1) {gl_FragColor = texture2D(u_texture, v_texcoord);} else {gl_FragColor = u_color;}}",varNames:["u_color","u_use_texture","u_texture"]},text:{source:"precision mediump float;uniform vec4 u_color;uniform sampler2D u_texture;varying vec2 v_texcoord;void main() {vec4 c = texture2D(u_texture, v_texcoord);gl_FragColor = vec4(c.a * u_color.rgb, c.a * u_color.a);}",varNames:["u_color","u_texture"]}};function Pt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function At(t,e,n){return e&&Pt(t.prototype,e),n&&Pt(t,n),t}var Et={TRIANGLES:1,TRIANGLE_STRIP:2,TRIANGLE_FAN:3,LINES:4,LINK_STATUS:1,VERTEX_SHADER:1,COMPILE_STATUS:1,FRAGMENT_SHADER:1,SRC_ALPHA:1,ONE_MINUS_SRC_ALPHA:1,BLEND:1,COLOR_BUFFER_BIT:1,TEXTURE_2D:1,RGBA:1,UNSIGNED_BYTE:1,TEXTURE_WRAP_S:1,CLAMP_TO_EDGE:1,TEXTURE_WRAP_T:1,TEXTURE_MIN_FILTER:1,LINEAR:1,ARRAY_BUFFER:1,STATIC_DRAW:1,FLOAT:1,UNPACK_PREMULTIPLY_ALPHA_WEBGL:1,createBuffer:function(){},bindBuffer:function(){},bufferData:function(){},enableVertexAttribArray:function(){},vertexAttribPointer:function(){},disableVertexAttribArray:function(){},uniformMatrix3fv:function(){},uniform4f:function(){},uniform1f:function(){},uniform1i:function(){},texParameteri:function(){},drawArrays:function(){},clearColor:function(){},clear:function(){},createTexture:function(){},activeTexture:function(){},bindTexture:function(){},pixelStorei:function(){},texImage2D:function(){},blendFunc:function(){},attachShader:function(){},linkProgram:function(){},getProgramParameter:function(){},createProgram:function(){},deleteProgram:function(){},createShader:function(){},shaderSource:function(){},compileShader:function(){},getShaderParameter:function(){},getAttribLocation:function(){},getUniformLocation:function(){},enable:function(){},map:function(){},getExtension:function(){return{loseContext:function(){}}},disable:function(){},deleteShader:function(){},useProgram:function(){},viewport:function(){},canvas:{toDataURL:function(){return""},width:100,clientHeight:100,height:100,style:{top:0,visibility:"visible"}}};function Lt(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(t.deleteShader(i),null)}var jt=function(){function t(e,n){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var i=e.getContext("webgl",{antialias:!0});null==i&&(i=Et),this.programs=[],this.lastUsedProgram=null,this.textures={},null!=i&&(this.gl=i,this.resize(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.disable(this.gl.DEPTH_TEST),this.gl.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.gl.enable(i.BLEND))}return At(t,[{key:"addTexture",value:function(t,e,n){if(this.textures[t]&&null!=this.textures[t].glTexture)return this.textures[t].index;var i;return i=this.textures[t]?this.textures[t].index:Object.keys(this.textures).length,this.textures[t]={glTexture:e,index:i,type:n,state:"loaded",onLoad:[]},i}},{key:"onLoad",value:function(t){this.textures[t].onLoad.forEach(function(t){return t()}),this.textures[t].onLoad=[]}},{key:"getProgram",value:function(t,e){for(var n=0;n<this.programs.length;n+=1){var i=this.programs[n];if(i.vertexShader===t&&i.fragmentShader===e)return n}var r,o,a,s,l,u,c,h,f,d=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"simple",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"simple";return Object.hasOwnProperty.call(Ot,t)&&Object.hasOwnProperty.call(St,e)?{vertexSource:Ot[t].source,fragmentSource:St[e].source,varNames:Ot[t].varNames.concat(St[e].varNames)}:{vertexSource:"",fragmentSource:"",varNames:[]}}(t,e),p=(r=this.gl,o=d.vertexSource,a=d.fragmentSource,h=Lt(r,r.VERTEX_SHADER,o),f=Lt(r,r.FRAGMENT_SHADER,a),h&&f?(l=h,u=f,c=(s=r).createProgram(),s.attachShader(c,l),s.attachShader(c,u),s.linkProgram(c),s.getProgramParameter(c,s.LINK_STATUS)?c:(s.deleteProgram(c),null)):null),v={vertexShader:t,fragmentShader:e,program:p,locations:function(t,e,n){var i,r,o={};for(i=0;i<n.length;i+=1)"a"===(r=n[i])[0]&&(o[r]=t.getAttribLocation(e,r)),"u"===r[0]&&(o[r]=t.getUniformLocation(e,r));return o}(this.gl,p,d.varNames)};return this.programs.push(v),this.programs.length-1}},{key:"useProgram",value:function(t){var e=this.programs[t];return this.lastUsedProgram!==e&&(this.gl.useProgram(e.program),this.lastUsedProgram=e.program),e.locations}}]),At(t,[{key:"resize",value:function(){var t=window.devicePixelRatio,e=Math.floor(this.gl.canvas.clientWidth*t),n=Math.floor(this.gl.canvas.clientHeight*t);this.gl.canvas.width===e&&this.gl.canvas.height===n||(this.gl.canvas.width=e,this.gl.canvas.height=n),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}}]),t}();function Mt(t){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ct=function(t){console.log(t)};function Ft(t,e){return t+e}function Bt(t,e){return(t*e).toString()}var Dt=function(t,e){return t/e},It=function(t,e){var n=e||t,i="-"===n[0]||n.startsWith("".concat(t,"-"))?"".concat(t," ").concat(n):n,r=" ".concat(t,"-");return"".concat(i.split(" -").join(r))},qt=function(){function t(e,n){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.object=e,this.key="",n in e&&(this.key=n)}var e,n;return e=t,(n=[{key:"setValue",value:function(t){this.key&&(this.object[this.key]=t)}},{key:"execute",value:function(){if(this.key){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.object[this.key].apply(null,e)}}},{key:"value",value:function(){if(this.key)return this.object[this.key]}}])&&Rt(e.prototype,n),t}();function Ht(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=[];if("string"!=typeof e)return Array.isArray(e)?e.forEach(function(e){var r=Ht(t,e,n);void 0!==r&&i.push(r)}):Object.keys(e).forEach(function(r){n+r in t&&i.push({obj:new qt(t,n+r),value:e[r]})}),i;if(n+e in t)return new qt(t,n+e);var r=e.split("_").filter(function(t){return 0<t.length});if(1<r.length){if(n+r[0]in t)return Ht(t[n+r[0]],r.slice(1).join("_"),n)}else if(1===r.length&&n+r[0]in t)return new qt(t,n+r[0])}function Nt(t,e){return Ht(t,e,"_")}function zt(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"-",r=e.split(i),o=t;r.forEach(function(t,e){e!==r.length-1?(Object.prototype.hasOwnProperty.call(o,t)||(o[t]={}),o=o[t]):o[t]=n})}function Gt(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];Object.keys(t).forEach(function(i){-1===n.indexOf(i)&&(e[i]=function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e||"function"==typeof e)return e;if("function"==typeof e._dup)return e._dup();if(Array.isArray(e)){var n=[];return e.forEach(function(e){return n.push(t(e))}),n}if("object"!==Mt(e))return e;var i={};return Object.keys(e).forEach(function(n){var r=t(e[n]);i[n]=r}),i}(t[i]))})}function Vt(){for(var t=function t(e,n){Object.keys(e).forEach(function(i){var r=e[i];if("number"==typeof r||"boolean"==typeof r||"string"==typeof r||null==r||"function"==typeof r||"function"==typeof r._dup||Array.isArray(r))void 0===r&&void 0!==n[i]||(n[i]=r);else{var o=n[i];("number"==typeof o||"boolean"==typeof o||"string"==typeof o||null==o||"function"==typeof o||Array.isArray(o))&&(n[i]={}),t(r,n[i])}})},e=arguments.length,n=arguments.length<=0?void 0:arguments[0],i=1;i<e;i+=1){var r=i<0||arguments.length<=i?void 0:arguments[i];null!=r&&t(r,n)}return n}function Wt(){var t=function(t){return"".concat(t).concat(Math.floor(1e6*Math.random()))},e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";0===e.length&&(e="id_random_");for(var n=!0,i=t(e);n;)i=t(e),null==document.getElementById(i)&&(n=!1);return i}function Ut(){var t,e=" -webkit- -moz- -o- -ms- ".split(" ");return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||(t=["(",e.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(t).matches)}function Xt(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(document.getElementById(t))null!=n&&n(t,e);else{var i=document.createElement("script");i.type="text/javascript",i.src=e,i.id=t,document.body&&document.body.appendChild(i),i.onload=function(){null!=n&&n(t,e)}}}function Yt(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(document.getElementById(t))null!=n&&n(t,e);else{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.id=t,document.body&&document.body.appendChild(i),i.onload=function(){null!=n&&n(t,e)}}}var Qt=function t(e){var n="0000000000";if(null!=e){if("uid"in e){if(e.uid===n)return;e.uid=n}for(var i=Object.keys(e),r=0;r<i.length;r+=1){var o=e[i[r]];"object"!==Mt(o)||Array.isArray(o)||null==o||"function"==typeof o||"number"==typeof o||"boolean"==typeof o||"string"==typeof o||t(o)}}};function Zt(t,e){e.forEach(function(e){void 0!==t[e]&&delete t[e]})}function Kt(t,e,n){n.forEach(function(n){void 0!==t[n]&&(e[n]=t[n])})}function $t(){return(1e18*Math.random()).toString(36)}function Jt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var te=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.location=new X(0,0),this.border=[[]],this.holeBorder=[[]],this.onLoad=null,this.type="drawingObject",this.state="loading"}var e,n;return e=t,(n=[{key:"_dup",value:function(){return this}},{key:"setText",value:function(t){}},{key:"getGLBoundaries",value:function(t){var e=[];return this.border.forEach(function(n){var i=[];n.forEach(function(e){i.push(e.transformBy(t))}),e.push(i)}),e}},{key:"getGLBoundaryHoles",value:function(t){var e=[];return this.holeBorder.forEach(function(n){var i=[];n.forEach(function(e){i.push(e.transformBy(t))}),e.push(i)}),e}},{key:"drawWithTransformMatrix",value:function(t,e,n,i){}},{key:"getGLBoundingRect",value:function(t){return yt(this.getGLBoundaries(t))}},{key:"getVertexSpaceBoundingRect",value:function(){return yt(this.border)}},{key:"getLocation",value:function(){return this.location}},{key:"getGLLocation",value:function(t){return this.getLocation().transformBy(t)}},{key:"getRelativeGLBoundingRect",value:function(t){var e=this.getGLLocation(t),n=this.getGLBoundingRect(t);return new U(n.left-e.x,n.bottom-e.y,n.width,n.height)}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){var t=this.getVertexSpaceBoundingRect();return new U(t.left-this.location.x,t.bottom-this.location.y,t.width,t.height)}},{key:"change",value:function(){}}])&&Jt(e.prototype,n),t}();function ee(t){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ne(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ie(t){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function re(t,e){return(re=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var oe=function(t){function e(t,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"middle",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"center";!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),r=function(t,e){return!e||"object"!==ee(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ie(e).call(this));var s=document.getElementById(n);return s&&(r.element=s),r.id=n,r.location=i,r.alignV=o,r.alignH=a,r.parentDiv=t,r.show=!0,r.setBorder(),r}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&re(t,e)}(e,te),n=e,(i=[{key:"_dup",value:function(){var t=new e(this.parentDiv,this.id,this.location._dup(),this.alignV,this.alignH);return t.show=this.show,t.border=this.border.map(function(t){return t.map(function(t){return t._dup()})}),t}},{key:"setBorder",value:function(){var t=this.parentDiv.getBoundingClientRect(),e=this.element.getBoundingClientRect(),n=e.left-t.left,i=n+e.width,r=e.top-t.top,o=r+e.height,a=[];a.push(new X(n,r)),a.push(new X(i,r)),a.push(new X(i,o)),a.push(new X(n,o)),this.border=[],this.border.push(a)}},{key:"getGLBoundaries",value:function(){var t=this.parentDiv.getBoundingClientRect(),e=ft({x:{bottomLeft:0,width:t.width},y:{bottomLeft:t.height,height:-t.height}},{x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}}),n=this.element.getBoundingClientRect(),i=n.left-t.left,r=i+n.width,o=n.top-t.top,a=o+n.height,s=[];return s.push(new X(i,o)),s.push(new X(r,o)),s.push(new X(r,a)),s.push(new X(i,a)),[s.map(function(t){return t.transformBy(e.matrix())})]}},{key:"glToPixelSpace",value:function(t){var e=(t.x- -1)/2*this.parentDiv.clientWidth,n=(1-t.y)/2*this.parentDiv.clientHeight;return new X(e,n)}},{key:"change",value:function(t,e){var n=t;"string"==typeof t&&((n=document.createElement("div")).innerHTML=t),n instanceof HTMLElement&&(this.element.innerHTML="",this.element.appendChild(n),this.transformHtml(e))}},{key:"transformHtml",value:function(t){if(this.show){var e=this.location.transformBy(t),n=this.glToPixelSpace(e),i=this.element.clientWidth,r=this.element.clientHeight,o=0,a=0;"center"===this.alignH?o=-i/2:"right"===this.alignH&&(o=-i),"middle"===this.alignV?a=-r/2:"bottom"===this.alignV&&(a=-r);var s=n.x+o,l=n.y+a;this.element.style.position="absolute",this.element.style.left="".concat(s,"px"),this.element.style.top="".concat(l,"px"),this.element.style.visibility="visible"}else this.element.style.position="absolute",this.element.style.left="-10000px",this.element.style.top="-10000px",this.element.style.visibility="hidden"}},{key:"drawWithTransformMatrix",value:function(t){this.transformHtml(t)}}])&&ne(n.prototype,i),e}();function ae(t){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function se(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function le(t){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ue(t,e){return(ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ce=function(t){function e(t){var n,i,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"simple",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"simple";return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==ae(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,le(e).call(this))).numPoints=0,i=Array.isArray(t)?t:[t],n.gl=i.map(function(t){return t.gl}),n.webgl=i,n.glPrimative=i[0].gl.TRIANGLES,n.points=[],n.z=0,n.buffer=i.map(function(){return null}),n.texture=null,n.programIndex=i.map(function(t){return t.getProgram(r,o)}),n.type="vertexPrimative",n}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ue(t,e)}(e,te),n=e,(i=[{key:"addTextureToBuffer",value:function(t,e,n){function i(t){return 0==(t&t-1)}var r=this.gl[t],o=this.webgl[t],a=this.texture;if(null!=a){var s=o.textures[a.id].index;r.activeTexture(r.TEXTURE0+s),r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),i(n.width)&&i(n.height)?r.generateMipmap(r.TEXTURE_2D):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR))}}},{key:"setupBuffer",value:function(){for(var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=function(n){var i=t.gl[n],r=t.webgl[n];t.state="loaded",t.numPoints=0===e?t.points.length/2:e;var o=t.texture;if(null!=o)if(null==o.points&&(o.points=[]),0===o.points.length&&t.createTextureMap(),null==o.buffer&&(o.buffer=t.gl.map(function(){return null})),o.buffer[n]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,o.buffer[n]),i.bufferData(i.ARRAY_BUFFER,new Float32Array(o.points),i.STATIC_DRAW),!(o.id in r.textures)||o.id in r.textures&&null==r.textures[o.id].glTexture){var a=i.createTexture();r.addTexture(o.id,a,o.type),i.activeTexture(i.TEXTURE0+r.textures[o.id].index),i.bindTexture(i.TEXTURE_2D,a);var s=o.src;if(s){i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,255,100]));var l=new Image;l.src=s,t.state="loading",r.textures[o.id].state="loading",r.textures[o.id].onLoad.push(t.executeOnLoad.bind(t)),l.addEventListener("load",function(){o.data=l,t.addTextureToBuffer(n,a,o.data),r.onLoad(o.id),t.state="loaded",r.textures[o.id].state="loaded"})}else null!=o.data&&t.addTextureToBuffer(n,a,o.data)}else o.id in r.textures&&("loading"===r.textures[o.id].state?(t.state="loading",r.textures[o.id].onLoad.push(t.executeOnLoad.bind(t))):t.state="loaded");t.buffer[n]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,t.buffer[n]),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t.points),i.STATIC_DRAW)},i=0;i<this.webgl.length;i+=1)n(i)}},{key:"executeOnLoad",value:function(){null!=this.onLoad&&this.onLoad()}},{key:"resetBuffer",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0;e<this.webgl.length;e+=1){var n=this.gl[e],i=this.webgl[e],r=this.texture;r&&(null!=i.textures[r.id].glTexture&&(n.deleteTexture(i.textures[r.id].glTexture),i.textures[r.id].glTexture=null),null!=r.buffer&&(n.deleteBuffer(r.buffer[e]),r.buffer[e]=null)),n.deleteBuffer(this.buffer[e]),this.setupBuffer(t)}}},{key:"change",value:function(t){this.resetBuffer()}},{key:"changeVertices",value:function(t){var e=this;this.points=[],this.border=[];var n=null,i=null,r=null,o=null;t.forEach(function(t){e.points.push(t.x),e.points.push(t.y),(null===n||t.x<n)&&(n=t.x),(null===i||t.y<i)&&(i=t.y),(null===o||t.y>o)&&(o=t.y),(null===r||t.x>r)&&(r=t.x)}),null!=n&&null!=i&&null!=r&&null!=o&&(this.border[0]=[new X(n,i),new X(n,o),new X(r,o),new X(r,i)]),this.resetBuffer()}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI;return this.numPoints*t/(2*Math.PI)}},{key:"getPointCountForLength",value:function(t){return this.numPoints}},{key:"createTextureMap",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=e-t,l=i-n,u=o-r,c=(7<arguments.length&&void 0!==arguments[7]?arguments[7]:1)-a,h=this.texture;if(null!=h){h.points=[];for(var f=0;f<this.points.length;f+=2){var d=(this.points[f]-t)/s,p=(this.points[f+1]-n)/l;h.points.push(d*u+r),h.points.push(p*c+a)}}}},{key:"draw",value:function(t,e,n,i,r){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,a=[1,0,0,0,1,0,0,0,1];a=F(a=R(a=j(a,t.x,t.y),e),n.x,n.y),this.drawWithTransformMatrix(E(a),r,o,i)}},{key:"drawWithTransformMatrix",value:function(t,e,n,i){var r=this.gl[n],o=this.webgl[n],a=r.FLOAT,s=o.useProgram(this.programIndex[n]);this.texture&&o.textures[this.texture.id].type,r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enableVertexAttribArray(s.a_position),r.bindBuffer(r.ARRAY_BUFFER,this.buffer[n]),r.vertexAttribPointer(s.a_position,2,a,!1,0,0),r.uniformMatrix3fv(s.u_matrix,!1,E(t)),r.uniform1f(s.u_z,this.z),r.uniform4f(s.u_color,e[0],e[1],e[2],e[3]);var l=this.texture;if(null!=l){var u=r.FLOAT;r.enableVertexAttribArray(s.a_texcoord),r.bindBuffer(r.ARRAY_BUFFER,l.buffer[n]),r.vertexAttribPointer(s.a_texcoord,2,u,!1,0,0)}if(l){r.uniform1i(s.u_use_texture,1);var c=o.textures[l.id].index;r.uniform1i(s.u_texture,c)}else r.uniform1i(s.u_use_texture,0);r.drawArrays(this.glPrimative,0,i),l&&r.disableVertexAttribArray(s.a_texcoord)}},{key:"transform",value:function(t){for(var e=0;e<this.points.length;e+=2){var n=new X(this.points[e],this.points[e+1]);n=n.transformBy(t),this.points[e]=n.x,this.points[e+1]=n.y}for(var i=0;i<this.border.length;i+=1)for(var r=0;r<this.border[i].length;r+=1)this.border[i][r]=this.border[i][r].transformBy(t)}}])&&se(n.prototype,i),e}();function he(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var fe=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.canvas=e,this.ctx=this.canvas.getContext("2d");var n=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,i=window.devicePixelRatio||1;1===i&&(i=2),this.ratio=i/n,this.resize()}var e,n;return e=t,(n=[{key:"resize",value:function(){this.ctx.setTransform(1,0,0,1,0,0),this.canvas.width=this.canvas.clientWidth*this.ratio,this.canvas.height=this.canvas.clientHeight*this.ratio,this.ctx.scale(this.ratio,this.ratio)}},{key:"_dup",value:function(){return this}}])&&he(e.prototype,n),t}();function de(t){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pe(t){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ve(t,e){return(ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ye(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ge(t,e,n){return e&&ye(t.prototype,e),n&&ye(t,n),t}var be=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Helvetica Neue",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"200",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"center",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"middle",s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;me(this,t),this.family=e,this.style=n,this.size=i,this.weight=r,this.alignH=o,this.alignV=a,this.opacity=1,this.setColor(s)}return ge(t,[{key:"setColor",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.color=t}},{key:"set",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;t.font="".concat(this.style," ").concat(this.weight," ").concat(this.size*e,"px ").concat(this.family),t.textAlign=this.alignH,t.textBaseline=this.alignV}},{key:"_dup",value:function(){return new t(this.family,this.style,this.size,this.weight,this.alignH,this.alignV,this.color)}}]),t}(),we=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new be;me(this,t),this.location=e._dup(),this.text=n.slice(),this.font=i._dup()}return ge(t,[{key:"_dup",value:function(){return new t(this.location._dup(),this.text,this.font._dup())}}]),t}(),xe=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(me(this,e),n=function(t,e){return!e||"object"!==de(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,pe(e).call(this)),Array.isArray(t)?n.drawContext2D=t:n.drawContext2D=[t],n.text=i,n.scalingFactor=1,n.lastDraw=[],n.lastDrawTransform=[],0<i.length){var r=n.text[0].font.size;if(n.text.forEach(function(t){0<t.font.size&&t.font.size<r&&(r=t.font.size)}),r<20&&(n.scalingFactor=50*r),r<1){var o=-Math.log(r)/Math.LN10+2;n.scalingFactor=Math.pow(10,o)}}return n.setBorder(),n.state="loaded",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ve(t,e)}(e,te),ge(e,[{key:"setText",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.text[e].text=t,this.setBorder()}},{key:"_dup",value:function(){var t=new e(this.drawContext2D,this.text);return Gt(this,t),t.scalingFactor=this.scalingFactor,t.border=this.border.map(function(t){return t.map(function(t){return t._dup()})}),t}},{key:"setFont",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.size=t;this.setBorder()}},{key:"setOpacity",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.opacity=t}},{key:"setColor",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.color=t}},{key:"draw",value:function(t,e,n,i,r){var o=[1,0,0,0,1,0,0,0,1];o=F(o=R(o=j(o,t.x,t.y),e),n.x,n.y),this.drawWithTransformMatrix(E(o),r)}},{key:"drawWithTransformMatrix",value:function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[1,1,1,1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=this.drawContext2D[i],o=this.drawContext2D[i].ctx,a=this.scalingFactor,s="rgba(\n      ".concat(Math.floor(255*n[0]),",\n      ").concat(Math.floor(255*n[1]),",\n      ").concat(Math.floor(255*n[2]),",\n      ").concat(Math.floor(255*n[3]),")");o.save();var l=r.canvas.offsetWidth/2/a,u=r.canvas.offsetHeight/2/a,c=t,h=A([l,0,r.canvas.offsetWidth/2,0,u,r.canvas.offsetHeight/2,0,0,1],[c[0],-c[1],c[2]*a,-c[3],c[4],c[5]*-a,0,0,1]);o.transform(h[0],h[3],h[1],h[4],h[2],h[5]),this.lastDrawTransform=h.slice(),this.text.forEach(function(t){if(t.font.set(o,a),null!=t.font.color){var n=[].concat(function(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(t.font.color.slice(0,3)),[t.font.color[3]*t.font.opacity]);o.fillStyle=(i=n,"rgba(".concat(Math.floor(255*i[0]),",").concat(Math.floor(255*i[1]),",").concat(Math.floor(255*i[2]),",").concat(i[3],")"))}else o.fillStyle=s;var i;e.recordLastDraw(o,t,a,t.location.x*a,t.location.y*-a),o.fillText(t.text,t.location.x*a,t.location.y*-a)}),o.restore()}},{key:"recordLastDraw",value:function(t,e,n,i,r){var o=1.2*t.measureText(e.text).width,a=e.font.size*n*1.2,s=r+.1*a,l=i-.1*o;"baseline"===e.font.alignV?s=r+.2*a:"top"===e.font.alignV?s=r+a:"middle"===e.font.alignV&&(s=r+a/2),"center"===e.font.alignH?l-=o/2:"right"===e.font.alignH&&(l-=o),this.lastDraw.push({width:o,height:-a,x:l,y:s})}},{key:"clear",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=this.lastDraw;if(0<e.length){var n=this.drawContext2D[t].ctx,i=this.lastDrawTransform;n.save(),n.transform(i[0],i[3],i[1],i[4],i[2],i[5]),e.forEach(function(t){var e=t.x-t.width,i=t.y-t.height;n.clearRect(e,i,3*t.width,3*t.height)}),n.restore()}this.lastDraw=[]}},{key:"getGLBoundaries",value:function(t){var e=this,n=[];return this.text.forEach(function(i){n.push(e.getGLBoundaryOfText(i,t))}),n}},{key:"setBorder",value:function(){var t=this;this.border=[],this.text.forEach(function(e){t.border.push(t.getBoundaryOfText(e))})}},{key:"measureText",value:function(t,e){var n=t.measureText("a").width,i=1.4*n,r=.08*n,o=e.text.match(/[acemnorsuvwxz*gyqp]/g);Array.isArray(o)&&o.length===e.text.length&&(i=.95*n);var a=e.text.match(/[;,$]/g);Array.isArray(a)&&0<a.length&&(r=.2*n);var s=e.text.match(/[gjyqp@Q(){}[\]|]/g);Array.isArray(s)&&0<s.length&&(r=.5*n);var l=i+r,u=t.measureText(e.text).width,c=0,h=0,f=0,d=0;return"left"===e.font.alignH&&(d=u),"center"===e.font.alignH&&(d=f=u/2),"right"===e.font.alignH&&(f=u),"alphabetic"===e.font.alignV&&(c=i,h=r),"top"===e.font.alignV&&(c=0,h=l),"bottom"===e.font.alignV&&(c=l,h=0),"middle"===e.font.alignV&&(h=c=l/2),{actualBoundingBoxLeft:f,actualBoundingBoxRight:d,fontBoundingBoxAscent:c,fontBoundingBoxDescent:h}}},{key:"getBoundaryOfText",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=[],i=this.scalingFactor;t.font.set(this.drawContext2D[e].ctx,i);var r=this.measureText(this.drawContext2D[e].ctx,t),o=t.location;return[new X(-r.actualBoundingBoxLeft/i,r.fontBoundingBoxAscent/i).add(o),new X(r.actualBoundingBoxRight/i,r.fontBoundingBoxAscent/i).add(o),new X(r.actualBoundingBoxRight/i,-r.fontBoundingBoxDescent/i).add(o),new X(-r.actualBoundingBoxLeft/i,-r.fontBoundingBoxDescent/i).add(o)].forEach(function(t){n.push(t)}),n}},{key:"getGLBoundaryOfText",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=[];return this.getBoundaryOfText(t,n).forEach(function(t){i.push(t.transformBy(e))}),i}}]),e}(),_e=function(){return{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}};function Te(t){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ke(t,e,n){var i=[];return Object.keys(t).forEach(function(r){var o="".concat(e,".").concat(r);if(r.includes(n))i.push(o);else if("object"===Te(t[r])){var a=ke(t[r],o,n);a&&(i=i.concat(a))}else"string"==typeof t[r]&&t[r].includes(n)&&i.push(o)}),i}function Oe(t,e){var n=new RegExp(e,"g"),i=function(t){return t[1].toUpperCase()};return t.replace(n,"").replace(/-[a-z]/g,i).replace(/_[a-z]/g,i).replace(/-/g,"")}function Se(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:function(t){return t},o={},a=t;if("string"==typeof t&&(a=document.getElementById(t)),a instanceof HTMLElement){var s=window.getComputedStyle(a);s&&e.forEach(function(t){var e=s.getPropertyValue(t);if(null!=e){e=e.trim();var a=parseFloat(e),l=e;if(Number.isNaN(a)||(l=a),l=r(l),i){var u=Oe(t,n);o[u]=l}else{var c=new RegExp(n,"g"),h=t.replace(c,"");zt(o,h,l,"-")}}})}return o}function Pe(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i={},r=t;if("string"==typeof t&&(r=document.getElementById(t)),r instanceof HTMLElement){var o=window.getComputedStyle(r);if(o)for(var a=o.length,s=0;s<a;s+=1){var l=o[s];if(""===e||l.startsWith(e)){var u=o.getPropertyValue(l);if(null!=u){u=u.trim();var c=parseFloat(u),h=u;if(Number.isNaN(c)||(h=c),n)i[Oe(l,e)]=h;else{var f=new RegExp(e,"g");zt(i,l.replace(f,""),h,"-")}}}}}return i}var Ae=["base","lighter","light","dark","darker","higher","high","low","lower"],Ee=[];["blue","red","yellow","green","cyan","brown","orange","violet","grey","black","white"].forEach(function(t){Ae.forEach(function(e){Ee.push("--palette-".concat(t,"-").concat(e))})});var Le=["--diagram-background","--diagram-primary","--diagram-warning","--diagram-safe","--diagram-passive","--diagram-construction1","--diagram-construction2","--diagram-construction3","--diagram-construction4","--diagram-construction5","--diagram-construction6","--diagram-construction7","--diagram-construction8","--diagram-construction9","--diagram-disabled","--diagram-disabledDark","--diagram-disabledDarker","--diagram-disabledDarkest","--diagram-push","--diagram-action","--diagram-text-base","--diagram-text-warning","--diagram-text-plot","--diagram-text-keyword","--diagram-text-keyword2","--diagram-text-latin","--diagram-text-greek","--diagram-text-english","--diagram-text-note","--diagram-qr-background"];function je(){var t={},e={},n={},i=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){return"--colors-".concat(t)}),r=document.body;return r&&(t=Se(r,i,"--colors-",!1,Ce),e=Se(r,Ee,"--palette-",!1,Ce),n=Se(r,Le,"--diagram-",!1,Ce)),t.palette=e,t.diagram=n,t}function Me(t){var e=t.replace(/.*\(/i,"").replace(/\)/i,"").split(",").map(function(t,e){return e<3?parseInt(t,10)/255:parseFloat(t)});return 3===e.length&&e.push(1),e}function Re(t){var e=t.slice(1);return e.length<6&&(e="".concat(e[0]).concat(e[0]).concat(e[1]).concat(e[1]).concat(e[2]).concat(e[2])),[parseInt(e.slice(0,2),16)/255,parseInt(e.slice(2,4),16)/255,parseInt(e.slice(4,6),16)/255,1]}function Ce(t){var e=_e(),n=t.slice(0);n in e&&(n=e[n]);var i=[];return n.toLowerCase().startsWith("rgb")?i=Me(n):n.startsWith("#")&&(i=Re(n)),0<i.length?i:null}function Fe(t){return"rgba(".concat(Math.floor(255*t[0]),",").concat(Math.floor(255*t[1]),",").concat(Math.floor(255*t[2]),",").concat(t[3],")")}function Be(t){return"rgb(".concat(Math.floor(255*t[0]),",").concat(Math.floor(255*t[1]),",").concat(Math.floor(255*t[2]),")")}function De(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ie=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var n=Vt({},{onFinish:null,completeOnCancel:null,removeOnFinish:!0,name:$t(),duration:0,delay:0,beforeFrame:null,afterFrame:null},e);return this.onFinish=n.onFinish,this.completeOnCancel=n.completeOnCancel,this.duration=n.duration,this.startTime=-1,this.state="idle",this.name=n.name,this.afterFrame=n.afterFrame,this.beforeFrame=n.beforeFrame,this.startDelay=n.delay,this.removeOnFinish=n.removeOnFinish,this.startTimeOffset=0,this}var e,n;return e=t,(n=[{key:"nextFrame",value:function(t){-1===this.startTime&&(this.startTime=t-this.startTimeOffset);var e=t-this.startTime,n=-(this.duration+this.startDelay-e);if(e>=this.startDelay){var i=e-this.startDelay;i>=this.duration&&(n=i-this.duration,i=this.duration),this.beforeFrame&&this.beforeFrame(i/this.duration),this.setFrame(i),this.afterFrame&&this.afterFrame(i/this.duration),0<=n&&this.finish()}return n}},{key:"setFrame",value:function(t){}},{key:"startWaiting",value:function(){this.state="waitingToStart"}},{key:"start",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;this.startTime=t,this.state="animating"}},{key:"finishIfZeroDuration",value:function(){0===this.duration&&this.finish()}},{key:"setToEnd",value:function(){}},{key:"finish",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if("idle"!==this.state&&"finished"!==this.state){var n=this.state;this.state="finished",t&&("complete"===e?("waitingToStart"===n&&this.start(),this.setToEnd()):null==e&&!0===this.completeOnCancel?("waitingToStart"===n&&this.start(),this.setToEnd()):"waitingToStart"===n&&this.cancelledWithNoComplete()),!1===t&&("waitingToStart"===n&&this.start(),this.setToEnd()),null!=this.onFinish&&this.onFinish(t)}}},{key:"cancelledWithNoComplete",value:function(){}},{key:"cancel",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.finish(!0,t)}},{key:"_dup",value:function(){var e=new t;return Gt(this,e),e}},{key:"whenFinished",value:function(t){return this.onFinish=t,this}},{key:"ifCanceledThenComplete",value:function(){return this.completeOnCancel=!0,this}},{key:"ifCanceledThenStop",value:function(){return this.completeOnCancel=!1,this}}])&&De(e.prototype,n),t}();function qe(t){return(qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function He(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ne(t){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ze(t,e){return(ze=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ge=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),t=function(t,e){return!e||"object"!==qe(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Ne(e).call(this,n));var i="easeinout";"color"!==n.type&&"custom"!==n.type||(i="linear");var r=Vt({},{element:null,type:"custom",progression:i,duration:0},n);return t.element=r.element,t.type=r.type,t.onFinish=r.onFinish,t.duration=r.duration,"linear"===r.progression?t.progression=v:"easein"===r.progression?t.progression=g:"easeout"===r.progression?t.progression=y:"easeinout"===r.progression?t.progression=m:t.progression=r.progression,t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ze(t,e)}(e,Ie),n=e,(i=[{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&He(n.prototype,i),e}();function Ve(t){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function We(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ue(t,e,n){return(Ue="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Xe(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Xe(t){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ye(t,e){return(Ye=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Qe=function(t){function e(){var t;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{},{type:"position"}].concat(i));Zt(o,["start","delta","target","translationStyle","translationOptions","velocity","maxTime"]);var a={start:null,target:null,delta:null,translationStyle:"linear",translationOptions:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:"",maxTime:null},velocity:null};if((t=function(t,e){return!e||"object"!==Ve(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Xe(e).call(this,o))).element&&t.element.animations.options.tranlsation){var s=t.element.animations.options.tranlsation;null!=s.style&&(a.style=s.style),Vt(a.translationOptions,s)}var l=Vt.apply(void 0,[{},a].concat(i));return null!=l.start&&(l.start=kt(l.start)),null!=l.target&&(l.target=kt(l.target)),null!=l.delta&&(l.delta=kt(l.delta)),t.position={translationOptions:{}},Kt(l,t.position,["start","delta","target","translationStyle","velocity","maxTime"]),Gt(l.translationOptions,t.position.translationOptions),t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ye(t,e)}(e,Ge),n=e,(i=[{key:"start",value:function(t){if(Ue(Xe(e.prototype),"start",this).call(this,t),null===this.position.start){if(null==this.element)return void(this.duration=0);this.position.start=this.element.getPosition()}if(null==this.position.delta&&null!=this.position.target&&null!=this.position.start){var n=this.position.target.sub(this.position.start);this.position.delta=n}else null!=this.position.delta&&null!=this.position.start?this.position.target=this.position.start.add(this.position.delta):this.duration=0;var i=this.position,r=i.target,o=i.start,a=i.velocity;if(null!=a&&null!=o&&null!=r){var s=kt(a);this.duration=xt((new ht).translate(o),(new ht).translate(r),(new ht).translate(s))}null!=this.position.maxTime&&this.duration>this.position.maxTime&&(this.duration=this.position.maxTime)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e);if(null!=this.position.delta&&null!=this.position.start){var i=this.position.start.toDelta(this.position.delta,n,this.position.translationStyle,this.position.translationOptions);null!=this.element&&this.element.setPosition(i)}}},{key:"setToEnd",value:function(){null!=this.element&&this.element.setPosition(this.position.target)}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&We(n.prototype,i),e}();function Ze(t){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ke(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function $e(t,e,n){return($e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Je(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Je(t){return(Je=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tn(t,e){return(tn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var en=function(t){function e(){var t;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{}].concat(i,[{type:"color"}]));Zt(o,["start","delta","target","dissolve"]),t=function(t,e){return!e||"object"!==Ze(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Je(e).call(this,o));var a=Vt.apply(void 0,[{},{start:null,target:null,delta:null,dissolve:null}].concat(i));return t.color={},Kt(a,t.color,["start","delta","target","dissolve"]),t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tn(t,e)}(e,Ge),n=e,(i=[{key:"start",value:function(t){var n,i,r,o,a=this.element;null!=a?($e(Je(e.prototype),"start",this).call(this,t),null==this.color.start&&(this.color.start=a.color.slice()),null==this.color.delta&&null==this.color.target?this.color.target=this.color.start.slice():null!=this.color.delta&&(this.color.target=(r=this.color.start,o=this.color.delta,r.map(function(t,e){return Math.min(t+o[e],1)}))),this.color.whenComplete=this.color.target.slice(),"out"===this.color.dissolve&&(this.color.target[3]=.001),"in"===this.color.dissolve&&(this.color.start[3]=.001,a.setColor(this.color.start),a.showAll()),this.color.delta=(n=this.color.target,i=this.color.start,n.map(function(t,e){return t-i[e]}))):this.duration=0}},{key:"setFrame",value:function(t){var e=this,n=t/this.duration,i=this.progression(n),r=this.color.start.map(function(t,n){var r=t+e.color.delta[n]*i;return 1<r&&(r=1),r<0&&(r=0),r});null!=this.element&&this.element.setColor(r)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.setColor(this.color.whenComplete),"out"===this.color.dissolve&&t.hide())}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&Ke(n.prototype,i),e}();function nn(t){return(nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rn(t,e,n){return(rn=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&hn(r,n.prototype),r}).apply(null,arguments)}function on(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function an(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function sn(t,e){return!e||"object"!==nn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ln(t,e,n){return(ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=un(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function un(t){return(un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function cn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hn(t,e)}function hn(t,e){return(hn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var fn=function(t){function e(){var t;on(this,e);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{}].concat(i,[{type:"color"}]));Zt(o,["start","delta","target","dissolve"]),t=sn(this,un(e).call(this,o));var a=Vt.apply(void 0,[{},{start:null,target:null,delta:null,dissolve:null}].concat(i));return t.opacity={},Kt(a,t.opacity,["start","delta","target","dissolve"]),t}var n,i;return cn(e,Ge),n=e,(i=[{key:"start",value:function(t){var n=this.element;null!=n?(ln(un(e.prototype),"start",this).call(this,t),null==this.opacity.start&&(this.opacity.start=n.opacity),null==this.opacity.delta&&null==this.opacity.target?this.opacity.target=this.opacity.start:null!=this.opacity.delta&&(this.opacity.target=this.opacity.start+this.opacity.delta),this.opacity.whenComplete=this.opacity.target,"out"===this.opacity.dissolve&&(this.opacity.target=.001,this.opacity.whenComplete=1,n.setOpacity(this.opacity.start)),"in"===this.opacity.dissolve&&(this.opacity.start=.001,this.opacity.target=1,this.opacity.whenComplete=1,n.showAll(),n.setOpacity(this.opacity.start)),this.opacity.delta=this.opacity.target-this.opacity.start):this.duration=0}},{key:"cancelledWithNoComplete",value:function(){var t=this.element;null!=t&&.001===t.opacity&&(t.hide(),t.opacity=1)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e),i=this.opacity.start+this.opacity.delta*n;1<i&&(i=1),i<0&&(i=0),null!=this.element&&this.element.setOpacity(i)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.setOpacity(this.opacity.whenComplete),"out"===this.opacity.dissolve&&t.hide())}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&an(n.prototype,i),e}(),dn=function(t){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};on(this,e);for(var n,i={duration:1,dissolve:"in",completeOnCancel:!0},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n=Vt.apply(void 0,"number"==typeof t?[{},i,{duration:t}].concat(o):[{},i,t].concat(o)),sn(this,un(e).call(this,n))}return cn(e,fn),e}();function pn(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return rn(dn,[t].concat(n))}var vn=function(t){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};on(this,e);for(var n,i={duration:1,dissolve:"out",completeOnCancel:!0},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n=Vt.apply(void 0,"number"==typeof t?[{},i,{duration:t}].concat(o):[{},i,t].concat(o)),sn(this,un(e).call(this,n))}return cn(e,fn),e}();function mn(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return rn(vn,[t].concat(n))}function yn(t){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function bn(t,e,n){return(bn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wn(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function wn(t){return(wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xn(t,e){return(xn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _n=function(t){function e(){var t;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{},{type:"transform"}].concat(i));Zt(o,["start","delta","target","rotDirection","translationStyle","translationOptions","velocity","clipRotationTo","maxTime"]);var a={start:null,target:null,delta:null,translationStyle:"linear",rotDirection:0,translationOptions:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""},velocity:null,clipRotationTo:null,maxTime:null};if((t=function(t,e){return!e||"object"!==yn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,wn(e).call(this,o))).element&&t.element.animations.options.translation){var s=t.element.animations.options.translation;null!=s.style&&(a.translationStyle=s.style),Vt(a.translationOptions,s)}var l=Vt.apply(void 0,[{},a].concat(i));return t.transform={translationOptions:{}},Kt(l,t.transform,["start","delta","target","translationStyle","velocity","rotDirection","clipRotationTo","maxTime"]),Gt(l.translationOptions,t.transform.translationOptions),t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xn(t,e)}(e,Ge),n=e,(i=[{key:"start",value:function(t){var n=this;if(bn(wn(e.prototype),"start",this).call(this,t),null===this.transform.start){if(null==this.element)return void(this.duration=0);this.transform.start=this.element.transform._dup()}if(null==this.transform.delta&&null!=this.transform.target){var i=this.transform.target.sub(this.transform.start);i.order.forEach(function(t,e){var i=n.transform.start.order[e],r=n.transform.target.order[e];if(t instanceof st&&i instanceof st&&r instanceof st){var o=rt(i.r,r.r,n.transform.rotDirection);t.r=o}}),this.transform.delta=i}else null!=this.transform.delta?this.transform.target=this.transform.start.add(this.transform.delta):this.duration=0;null!=this.transform.velocity&&(this.duration=xt(this.transform.start,this.transform.target,this.transform.velocity,this.transform.rotDirection)),null!=this.transform.maxTime&&this.duration>this.transform.maxTime&&(this.duration=this.transform.maxTime)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e),i=this.transform.start.toDelta(this.transform.delta,n,this.transform.translationStyle,this.transform.translationOptions);null!==this.transform.clipRotationTo&&i.clipRotation(this.transform.clipRotationTo),null!=this.element&&this.element.setTransform(i)}},{key:"setToEnd",value:function(){null!=this.element&&this.element.setTransform(this.transform.target)}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&gn(n.prototype,i),e}();function Tn(t){return(Tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function On(t,e,n){return(On="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Sn(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Sn(t){return(Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Pn(t,e){return(Pn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var An=function(t){function e(){var t;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{},{type:"rotation"}].concat(i));Zt(o,["start","delta","target","direction","velocity","clipTo","maxTime"]),t=function(t,e){return!e||"object"!==Tn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Sn(e).call(this,o));var a=Vt.apply(void 0,[{},{start:null,target:null,delta:null,direction:0,velocity:null,clipTo:null,maxTime:null}].concat(i));return t.rotation={},Kt(a,t.rotation,["start","delta","target","velocity","direction","clipTo","maxTime"]),t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pn(t,e)}(e,Ge),n=e,(i=[{key:"start",value:function(t){if(On(Sn(e.prototype),"start",this).call(this,t),null===this.rotation.start){if(null==this.element)return void(this.duration=0);this.rotation.start=this.element.transform.r()||0}if(null==this.rotation.delta&&null!=this.rotation.target){var n=rt(this.rotation.start,this.rotation.target,this.rotation.direction);this.rotation.delta=n}else null!=this.rotation.delta?this.rotation.target=this.rotation.start+this.rotation.delta:this.duration=0;var i=this.rotation.velocity;null!=i&&(this.duration=xt((new ht).rotate(this.rotation.start),(new ht).rotate(this.rotation.target),(new ht).rotate(i),this.rotation.direction)),null!=this.rotation.maxTime&&this.duration>this.rotation.maxTime&&(this.duration=this.rotation.maxTime)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e),i=this.rotation.start+this.rotation.delta*n;i=W(i,this.rotation.clipTo);var r=this.element;null!=r&&r.setRotation(i)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.transform.updateRotation(W(this.rotation.target,this.rotation.clipTo)),t.setTransformCallback(t.transform))}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&kn(n.prototype,i),e}();function En(t){return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ln(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function jn(t,e,n){return(jn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Mn(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Mn(t){return(Mn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Rn(t,e){return(Rn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Cn=function(t){function e(){var t;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{},{type:"position"}].concat(i));Zt(o,["start","delta","target","velocity","maxTime"]),t=function(t,e){return!e||"object"!==En(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Mn(e).call(this,o));var a=Vt.apply(void 0,[{},{start:null,target:null,delta:null,velocity:null,maxTime:null}].concat(i));return t.scale={},null!=a.start&&(a.start=kt(a.start)),null!=a.target&&(a.target=kt(a.target)),null!=a.delta&&(a.delta=kt(a.delta)),Kt(a,t.scale,["start","delta","target","translationStyle","velocity","maxTime"]),t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rn(t,e)}(e,Ge),n=e,(i=[{key:"start",value:function(t){if(jn(Mn(e.prototype),"start",this).call(this,t),null===this.scale.start){if(null==this.element)return void(this.duration=0);this.scale.start=this.element.getScale()}if(null==this.scale.delta&&null!=this.scale.target&&null!=this.scale.start){var n=this.scale.target.sub(this.scale.start);this.scale.delta=n}else null!=this.scale.delta&&null!=this.scale.start?this.scale.target=this.scale.start.add(this.scale.delta):this.duration=0;var i=this.scale,r=i.target,o=i.start,a=i.velocity;if(null!=a&&null!=r&&null!=o){var s=kt(a);this.duration=xt((new ht).scale(o),(new ht).scale(r),(new ht).scale(s))}null!=this.scale.maxTime&&this.duration>this.scale.maxTime&&(this.duration=this.scale.maxTime)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e);if(null!=this.scale.start&&null!=this.scale.delta){var i=this.scale.start.toDelta(this.scale.delta,n);null!=this.element&&this.element.setScale(i)}}},{key:"setToEnd",value:function(){null!=this.element&&this.element.setScale(this.scale.target)}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&Ln(n.prototype,i),e}();function Fn(t){return(Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Dn(t,e,n){return(Dn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=In(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function In(t){return(In=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qn(t,e){return(qn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Hn=function(t){function e(){var t;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{},{scale:1.5,numLines:1,type:"pulse",duration:1,frequency:0,stopAfterDuration:!0}].concat(i));return(t=function(t,e){return!e||"object"!==Fn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,In(e).call(this,o))).scale=o.scale,t.numLines=o.numLines,t.duration=o.duration,t.frequency=o.frequency,t.stopAfterDuration=o.stopAfterDuration,t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qn(t,e)}(e,Ge),n=e,(i=[{key:"start",value:function(t){Dn(In(e.prototype),"start",this).call(this,t);var n=this.element;null!=n&&(1===this.numLines?n.pulseScaleNow(this.duration,this.scale,this.frequency):n.pulseThickNow(this.duration,this.scale,this.numLines))}},{key:"setToEnd",value:function(){null!=this.element&&this.stopAfterDuration&&this.element.stopPulsing(!0)}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&Bn(n.prototype,i),e}();function Nn(t){return(Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zn(t,e,n){return(zn=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&Wn(r,n.prototype),r}).apply(null,arguments)}function Gn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Vn(t){return(Vn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Wn(t,e){return(Wn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Un=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var i,r={payload:null,duration:0},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return"function"==typeof n?(i=Vt.apply(void 0,[{},r].concat(a))).callback=n:i=Vt.apply(void 0,[{},r,n].concat(a)),(t=function(t,e){return!e||"object"!==Nn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Vn(e).call(this,i))).callback=i.callback,t.payload=i.payload,t.duration=i.duration,t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wn(t,e)}(e,Ie),n=e,(i=[{key:"setFrame",value:function(){null!=this.callback&&(this.callback(this.payload),this.callback=null)}},{key:"setToEnd",value:function(){null!=this.callback&&(this.callback(this.payload),this.callback=null)}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t}}])&&Gn(n.prototype,i),e}();function Xn(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return zn(Un,[t].concat(n))}function Yn(t){return(Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qn(t,e,n){return(Qn=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&$n(r,n.prototype),r}).apply(null,arguments)}function Zn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Kn(t){return(Kn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $n(t,e){return($n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Jn=function(t){function e(){var t;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{}].concat(i));t=function(t,e){return!e||"object"!==Yn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Kn(e).call(this,o));var a=Vt.apply(void 0,[{},{callback:null,startPercent:0,progression:"linear"}].concat(i));return"linear"===a.progression?t.progression=v:"easein"===a.progression?t.progression=g:"easeout"===a.progression?t.progression=y:"easeinout"===a.progression?t.progression=m:t.progression=a.progression,t.callback=a.callback,t.startPercent=a.startPercent,"function"==typeof t.progression&&(t.startTimeOffset=t.progression(a.startPercent,!0)*a.duration),t.duration=a.duration,t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$n(t,e)}(e,Ie),n=e,(i=[{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e);null!=this.callback&&this.callback(n)}},{key:"setToEnd",value:function(){null!=this.callback&&this.callback(1)}},{key:"_dup",value:function(){var t=new e;return Gt(this,t),t}}])&&Zn(n.prototype,i),e}();function ti(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Qn(Jn,e)}function ei(t){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ni(t,e,n){return(ni=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&ai(r,n.prototype),r}).apply(null,arguments)}function ii(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ri(t,e,n){return(ri="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=oi(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function oi(t){return(oi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ai(t,e){return(ai=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var si=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var i,r={steps:[]},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return Array.isArray(n)?(i=Vt.apply(void 0,[{},r].concat(a))).steps=n:i=Vt.apply(void 0,[{},r,n].concat(a)),(t=function(t,e){return!e||"object"!==ei(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,oi(e).call(this,i))).steps=[],Array.isArray(i.steps)||null==i.steps?null!=i.steps&&(t.steps=i.steps):t.steps=[i.steps],t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ai(t,e)}(e,Ie),n=e,(i=[{key:"with",value:function(t){return this.steps.push(t),this}},{key:"nextFrame",value:function(t){var e=null;return null!=this.beforeFrame&&this.beforeFrame(t-this.startTime),this.steps.forEach(function(n){if("animating"===n.state||"waitingToStart"===n.state){var i=n.nextFrame(t);null===e&&(e=i),i<e&&(e=i)}}),null!=this.afterFrame&&this.afterFrame(t-this.startTime),null===e&&(e=0),0<=e&&this.finish(),e}},{key:"finishIfZeroDuration",value:function(){var t="finished";this.steps.forEach(function(e){"finished"!==e.state&&(t="animating")}),"finished"===t&&this.finish()}},{key:"startWaiting",value:function(){ri(oi(e.prototype),"startWaiting",this).call(this),this.steps.forEach(function(t){t.startWaiting()})}},{key:"start",value:function(t){this.startWaiting(),ri(oi(e.prototype),"start",this).call(this,t),this.steps.forEach(function(e){e.start(t),e.finishIfZeroDuration()})}},{key:"finish",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if("idle"!==this.state&&"finished"!==this.state){this.state="finished";var n=null;!0===this.completeOnCancel&&(n="complete"),!1===this.completeOnCancel&&(n="noComplete"),null!=e&&(n=e),this.steps.forEach(function(e){"idle"!==e.state&&"finished"!==e.state&&e.finish(t,n)}),null!=this.onFinish&&this.onFinish(t)}}},{key:"_dup",value:function(){var t=new e;return Gt(this,t),t}}])&&ii(n.prototype,i),e}();function li(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return ni(si,[t].concat(n))}function ui(t){return(ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ci(t,e,n){return(ci=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&pi(r,n.prototype),r}).apply(null,arguments)}function hi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function fi(t,e,n){return(fi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=di(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function di(t){return(di=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pi(t,e){return(pi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var vi=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var i,r={steps:[]},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return Array.isArray(n)?(i=Vt.apply(void 0,[{},r].concat(a))).steps=n:i=Vt.apply(void 0,[{},r,n].concat(a)),(t=function(t,e){return!e||"object"!==ui(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,di(e).call(this,i))).index=0,t.steps=[],Array.isArray(i.steps)||null==i.steps?null!=i.steps&&(t.steps=i.steps):t.steps=[i.steps],t}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pi(t,e)}(e,Ie),n=e,(i=[{key:"then",value:function(t){return this.steps.push(t),this}},{key:"startWaiting",value:function(){fi(di(e.prototype),"startWaiting",this).call(this),this.steps.forEach(function(t){t.startWaiting()})}},{key:"start",value:function(t){"animating"!==this.state&&(this.startWaiting(),fi(di(e.prototype),"start",this).call(this,t),(this.index=0)<this.steps.length&&(this.steps[0].start(t),this.steps[0].finishIfZeroDuration())),this.finishIfZeroDuration()}},{key:"finishIfZeroDuration",value:function(){for(var t=0,e=this.steps[0];t<this.steps.length&&"finished"===e.state;)(t+=1)<this.steps.length&&(this.index=t,(e=this.steps[t]).start(this.steps[t-1].startTime),e.finishIfZeroDuration());t===this.steps.length&&this.finish()}},{key:"nextFrame",value:function(t){var e=-1;return null!=this.beforeFrame&&this.beforeFrame(t-this.startTime),this.index<=this.steps.length-1&&(e=this.steps[this.index].nextFrame(t),null!=this.afterFrame&&this.afterFrame(t-this.startTime),0<=e)?this.index===this.steps.length-1?(this.finish(),e):(this.index+=1,this.steps[this.index].start(t-e),this.nextFrame(t)):e}},{key:"finish",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if("idle"!==this.state&&"finished"!==this.state){this.state="finished";var n=null;!0===this.completeOnCancel&&(n="complete"),!1===this.completeOnCancel&&(n="noComplete"),null!=e&&(n=e),this.steps.forEach(function(e){"idle"!==e.state&&"finished"!==e.state&&e.finish(t,n)}),null!=this.onFinish&&this.onFinish(t)}}},{key:"_dup",value:function(){var t=new e;return Gt(this,t),t}}])&&hi(n.prototype,i),e}();function mi(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return ci(vi,[t].concat(n))}function yi(t){return(yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gi(t,e,n){return(gi=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&xi(r,n.prototype),r}).apply(null,arguments)}function bi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function wi(t){return(wi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xi(t,e){return(xi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _i=function(t){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var n,i={duration:0},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n=Vt.apply(void 0,"number"==typeof t?[{},i,{duration:t}].concat(o):[{},i,t].concat(o)),function(t,e){return!e||"object"!==yi(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,wi(e).call(this,n))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xi(t,e)}(e,Ie),n=e,(i=[{key:"_dup",value:function(){var t=new e;return Gt(this,t),t}}])&&bi(n.prototype,i),e}();function Ti(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return gi(_i,[t].concat(n))}function ki(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Oi=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);for(var n,i={},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return e instanceof Wi?(n=Vt.apply(void 0,[{},i].concat(o))).element=e:n=Vt.apply(void 0,[{},i,e].concat(o)),this.element=n.element,this.animations=[],this.state="idle",this.options={translation:{}},this}var e,n;return e=t,(n=[{key:"willStartAnimating",value:function(){if("animating"===this.state)return!0;var t=!1;return this.animations.forEach(function(e){"waitingToStart"!==e.state&&"animating"!==e.state||(t=!0)}),t}},{key:"nextFrame",value:function(t){var e=[],n=null,i=!1;this.animations.forEach(function(r,o){var a=!1;if("waitingToStart"===r.state||"animating"===r.state){var s=r.nextFrame(t);null===n&&(n=s),s<n&&(n=s),a=!0}"finished"===r.state&&r.removeOnFinish&&(a=!1,e.push(o)),a&&(i=!0)}),this.state=i?"animating":"idle";for(var r=e.length-1;0<=r;r-=1)this.animations.splice(e[r],1);return n}},{key:"cleanAnimations",value:function(){for(var t=[],e=!1,n=0;n<this.animations.length;n+=1){var i=this.animations[n];"finished"===i.state&&i.removeOnFinish?t.push(n):e=!0}for(var r=t.length-1;0<=r;r-=1)this.animations.splice(t[r],1);this.state=e?"animating":"idle"}},{key:"cancel",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null==t)this.cancelAll(e);else{for(var n=0;n<this.animations.length;n+=1){var i=this.animations[n];i.name===t&&i.cancel(e)}this.cleanAnimations()}}},{key:"cancelAll",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=0;e<this.animations.length;e+=1)this.animations[e].cancel(t);this.cleanAnimations()}},{key:"start",value:function(t){if(null==t)this.startAll();else for(var e=0;e<this.animations.length;e+=1){var n=this.animations[e];n.name===t&&"animating"!==n.state&&(n.start(),n.finishIfZeroDuration(),"animating"===n.state&&(this.state="animating"))}}},{key:"startAll",value:function(){for(var t=0;t<this.animations.length;t+=1){var e=this.animations[t];"animating"!==e.state&&(e.start(),e.finishIfZeroDuration(),"animating"===e.state&&(this.state="animating"))}}},{key:"addTo",value:function(t){for(var e=0;e<this.animations.length;e+=1){var n=this.animations[e];if(n.name===t)return n}return this.new(t)}},{key:"new",value:function(t){if("string"!=typeof t&&null!=t)return null!=t&&this.animations.push(t),t;var e={};null!=this.element&&(e.element=this.element),null!=t&&(e.name=t);var n=new Ri(e);return this.animations.push(n),n}},{key:"_dup",value:function(){var e=new t;return Gt(this,e,["element"]),e.element=this.element,e}}])&&ki(e.prototype,n),t}();function Si(t){return(Si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pi(t,e,n){return(Pi=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&ji(r,n.prototype),r}).apply(null,arguments)}function Ai(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ei(t,e){return!e||"object"!==Si(e)&&"function"!=typeof e?Mi(t):e}function Li(t){return(Li=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ji(t,e){return(ji=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Mi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var Ri=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);for(var i,r={},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n instanceof Wi?(i=Vt.apply(void 0,[{},r].concat(a))).element=n:i=Vt.apply(void 0,[{},r,n].concat(a)),(t=Ei(this,Li(e).call(this,i))).element=i.element,Ei(t,Mi(Mi(t)))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ji(t,e)}(e,vi),n=e,(i=[{key:"custom",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.then(Pi(Jn,e)),this}},{key:"rotation",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));this.then(new An(r))}return this}},{key:"position",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));this.then(new Qe(r))}return this}},{key:"scale",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));this.then(new Cn(r))}return this}},{key:"transform",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));this.then(new _n(r))}return this}},{key:"scenario",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));this.then(r.element.anim.scenario(r))}return this}},{key:"scenarios",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));this.then(r.element.anim.scenarios(r))}return this}},{key:"color",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));this.then(new en(r))}return this}},{key:"opacity",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));this.then(new fn(r))}return this}},{key:"dissolveOut",value:function(){for(var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n={element:this.element},i=arguments.length,r=new Array(1<i?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return t=Vt.apply(void 0,"number"==typeof e?[{},n,{duration:e}].concat(r):[{},n,e].concat(r)),this.then(mn(t)),this}},{key:"dissolveIn",value:function(){for(var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n={element:this.element},i=arguments.length,r=new Array(1<i?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return t=Vt.apply(void 0,"number"==typeof e?[{},n,{duration:e}].concat(r):[{},n,e].concat(r)),this.then(pn(t)),this}},{key:"delay",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.then(Ti.apply(s,[t].concat(n))),this}},{key:"trigger",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.then(Xn.apply(s,[t].concat(n))),this}},{key:"inParallel",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.then(li.apply(s,[t].concat(n))),this}},{key:"inSerial",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.then(mi.apply(s,[t].concat(n))),this}},{key:"pulse",value:function(){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));return this.then(new Hn(r)),this}},{key:"reset",value:function(){this.steps=[],this.state="idle"}},{key:"_dup",value:function(){var t=new e;return Gt(this,t,["element"]),t.element=this.element,t}}])&&Ai(n.prototype,i),e}();function Ci(t){return(Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fi(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Bi(t,e){return!e||"object"!==Ci(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Di(t,e,n){return(Di="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ii(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Ii(t){return(Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qi(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ni(t,e)}function Hi(t,e,n){return(Hi=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&Ni(r,n.prototype),r}).apply(null,arguments)}function Ni(t,e){return(Ni=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Vi(t,e,n){return e&&Gi(t.prototype,e),n&&Gi(t,n),t}var Wi=function(){function t(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ht,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U(-1,-1,2,2),r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;zi(this,t),this.name="",this.uid=(1e18*Math.random()).toString(36),this.isShown=!0,this.transform=n._dup(),this.isMovable=!1,this.isTouchable=!1,this.isInteractive=void 0,this.hasTouchableElements=!1,this.color=[1,1,1,1],this.opacity=1,this.setTransformCallback=function(){},this.lastDrawTransform=this.transform._dup(),this.onClick=null,this.lastDrawElementTransformPosition={parentCount:0,elementCount:0},this.parent=r,this.drawPriority=1,this.noRotationFromParent=!1,this.anim={rotation:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},{element:e}].concat(n));return new An(r)},scale:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},{element:e}].concat(n));return new Cn(r)},position:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},{element:e}].concat(n));return new Qe(r)},color:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},{elements:e}].concat(n));return new en(r)},opacity:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},{elements:e}].concat(n));return new fn(r)},transform:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},{element:e}].concat(n));return new _n(r)},pulse:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Vt.apply(void 0,[{},{element:this}].concat(e));return new Hn(i)},dissolveIn:function(){for(var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i={element:e},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return t=Vt.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(o):[{},i,n].concat(o)),new dn(t)},dissolveOut:function(){for(var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i={element:e},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return t=Vt.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(o):[{},i,n].concat(o)),new vn(t)},builder:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Hi(Ri,[e].concat(n))},scenario:function(){for(var t={element:e},n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Vt.apply(void 0,[{},t].concat(i));if(null!=o.target&&o.target in o.element.scenarios){var a=o.element.getScenarioTarget(o.target);o.target=a}if(null!=o.start&&o.start in o.element.scenarios){var s=o.element.getScenarioTarget(o.start);o.start=s}if(null!=o.delta&&o.delta in o.element.scenarios){var l=o.element.getScenarioTarget(o.delta);o.delta=l}return new _n(o)},scenarios:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},{}].concat(n)),o=e.getAllElementsWithScenario(r.target),a=[],s={};return Gt(r,s,["steps","element"]),o.forEach(function(t){a.push(t.anim.scenario(s))}),new si(s,{steps:a})}},this.diagramLimits=i,this.move={maxTransform:this.transform.constant(1e3),minTransform:this.transform.constant(-1e3),boundary:null,maxVelocity:new ct(5,5,5),freely:{zeroVelocityThreshold:new ct(.001,.001,.001),deceleration:new ct(5,5,5),callback:null},bounce:!0,canBeMovedAfterLoosingTouch:!1,type:"translation",element:null,limitLine:null},this.scenarios={},this.pulse={time:1,frequency:.5,A:1,B:.5,C:0,style:b,num:1,transformMethod:function(t){return(new ht).scale(t,t)},callback:function(){}},this.state={isBeingMoved:!1,isMovingFreely:!1,movement:{previousTime:-1,previousTransform:this.transform._dup(),velocity:this.transform.zero()},isPulsing:!1,pulse:{startTime:-1}},this.interactiveLocation=new X(0,0),this.animations=new Oi(this),this.tieToHTML={element:null,scale:"fit",window:this.diagramLimits,updateOnResize:!0},this.isRenderedAsImage=!1,this.unrenderNextDraw=!1,this.renderedOnNextDraw=!1}return Vi(t,[{key:"setProperties",value:function(t){Vt(this,t)}},{key:"updateHTMLElementTie",value:function(t){var e;if("string"==typeof this.tieToHTML.element&&(e=document.getElementById(this.tieToHTML.element)),null!=e){var n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),r=this.diagramLimits,o=this.tieToHTML.window,a=i.width/i.height,s=r.width/r.height,l=n.width/n.height,u=o.width/o.height,c=new X(n.left-i.left,n.top-i.top),h=c.add(new X(n.width,n.height)),f=this.diagramTransforms.pixelToDiagram,d=c.transformBy(f.m()),p=h.transformBy(f.m()),v=p.x-d.x,m=d.y-p.y,y=d.add(new X(v/2,-m/2)),g=this.tieToHTML.scale.trim().toLowerCase(),b=1,w=1,x=r.width/o.width,_=r.height/o.height;if(g.endsWith("em")){var T=parseFloat(g),k=parseFloat(getComputedStyle(e).fontSize),O=r.width/.2;b=T*k*O/i.width,w=T*k*O/s/i.height}if(g.endsWith("px")){var S=parseFloat(g);if(1<u){var P=S/i.width;b=P*x,w=P*a/s*x}else{var A=S/i.height;b=A/a*s*_,w=A*_}}if("stretch"===g&&(b=n.width/i.width*x,w=n.height/i.height*_),"max"===g||"fit"===g){var E=new X(n.height/i.height/a*s*_,n.height/i.height*_),L=new X(n.width/i.width*x,n.width/i.width*a/s*x);w="max"===g&&u<l||"fit"===g&&l<u?(b=L.x,L.y):(b=E.x,E.y)}this.setScale(b,w),this.setPosition(y.x-b*(this.tieToHTML.window.left+this.tieToHTML.window.width/2),y.y-w*(this.tieToHTML.window.bottom+this.tieToHTML.window.height/2)),this.setFirstTransform(this.getParentLastDrawTransform())}}},{key:"setFirstTransform",value:function(t){}},{key:"setPosition",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=kt(t);"number"==typeof t&&(n=new X(t,e));var i=this.transform._dup();i.updateTranslation(n),this.setTransform(i)}},{key:"setRotation",value:function(t){var e=this.transform._dup();e.updateRotation(t),this.setTransform(e)}},{key:"setScale",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=kt(t);"number"==typeof t&&(n=new X(t,null==e?t:e));var i=this.transform._dup();i.updateScale(n),this.setTransform(i)}},{key:"setTransform",value:function(t){this.transform=t._dup().clip(this.move.minTransform,this.move.maxTransform,this.move.limitLine),this.setTransformCallback&&this.setTransformCallback(this.transform)}},{key:"nextMovingFreelyFrame",value:function(t){if(this.state.isMovingFreely){if(this.state.movement.previousTime<0)return void(this.state.movement.previousTime=t);var e=t-this.state.movement.previousTime,n=this.decelerate(e);this.state.movement.velocity=n.velocity,this.state.movement.previousTime=t,this.state.movement.velocity.isZero()&&(this.state.movement.velocity=this.state.movement.velocity.zero(),this.stopMovingFreely(!1)),this.setTransform(n.transform)}}},{key:"clear",value:function(){}},{key:"willStartAnimating",value:function(){return!!this.animations.willStartAnimating()}},{key:"setColor",value:function(t){this.color=t.slice()}},{key:"setOpacity",value:function(t){this.opacity=t}},{key:"getScenarioTarget",value:function(t){var e=this.transform._dup();if(t in this.scenarios){var n=this.scenarios[t];null!=n.position&&e.updateTranslation(kt(n.position)),null!=n.rotation&&e.updateRotation(n.rotation),null!=n.scale&&e.updateScale(kt(n.scale))}return e}},{key:"setScenario",value:function(t){if(null!=this.scenarios[t]){var e=this.getScenarioTarget(t);this.setTransform(e._dup())}}},{key:"setScenarios",value:function(t){null!=this.scenarios[t]&&this.setScenario(t)}},{key:"getAllElementsWithScenario",value:function(t){return null!=this.scenarios[t]?[this]:[]}},{key:"getTimeToMoveToScenario",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.getScenarioTarget(t),i=this.transform.constant(0);return i.updateTranslation(new X(.5,.5)),i.updateRotation(2*Math.PI/6),i.updateScale(1,1),xt(this.transform._dup(),n,i,e)}},{key:"decelerate",value:function(t){var e=this.transform.decelerate(this.state.movement.velocity,this.move.freely.deceleration,t,this.move.freely.zeroVelocityThreshold);if(0<t){for(var n=0;n<e.t.order.length;n+=1){var i=e.t.order[n],r=this.move.minTransform.order[n],o=this.move.maxTransform.order[n],a=e.v.order[n];if(i instanceof lt&&a instanceof lt&&o instanceof lt&&r instanceof lt||i instanceof ut&&a instanceof ut&&o instanceof ut&&r instanceof ut){var s=!0;null!=this.move.limitLine&&(s=i.shaddowIsOnLine(this.move.limitLine,4)),(r.x>=i.x||o.x<=i.x||!s)&&(this.move.bounce?a.x=.5*-a.x:a.x=0),(r.y>=i.y||o.y<=i.y||!s)&&(this.move.bounce?a.y=.5*-a.y:a.y=0),e.v.order[n]=a}i instanceof st&&a instanceof st&&o instanceof st&&r instanceof st&&((r.r>=i.r||o.r<=i.r)&&(this.move.bounce?a.r=.5*-a.r:a.r=0),e.v.order[n]=a)}e.v.calcMatrix()}return{velocity:e.v,transform:e.t}}},{key:"updateLastDrawTransform",value:function(){var t=this,e=this.lastDrawElementTransformPosition.parentCount,n=this.lastDrawTransform.order.length;this.transform.order.forEach(function(i,r){t.lastDrawTransform.order[n-e-r-1]=i._dup()}),this.lastDrawTransform.calcMatrix()}},{key:"getParentLastDrawTransform",value:function(){var t=this.lastDrawElementTransformPosition.parentCount;return new ht(this.lastDrawTransform.order.slice(-t))}},{key:"startBeingMoved",value:function(){this.animations.cancelAll("noComplete"),this.stopMovingFreely(),this.state.movement.velocity=this.transform.zero(),this.state.movement.previousTransform=this.transform._dup(),this.state.movement.previousTime=Date.now()/1e3,this.state.isBeingMoved=!0,this.unrender()}},{key:"moved",value:function(t){this.calcVelocity(t),this.setTransform(t._dup())}},{key:"stopBeingMoved",value:function(){var t=Date.now()/1e3;-1!==this.state.movement.previousTime&&.05<t-this.state.movement.previousTime&&(this.state.movement.velocity=this.transform.zero()),this.state.isBeingMoved=!1,this.state.movement.previousTime=-1}},{key:"calcVelocity",value:function(t){var e=Date.now()/1e3;if(this.state.movement.previousTime<0)this.state.movement.previousTime=e;else{var n=e-this.state.movement.previousTime;n<1e-4||(this.state.movement.velocity=t.velocity(this.transform,n,this.move.freely.zeroVelocityThreshold,this.move.maxVelocity),this.state.movement.previousTime=e)}}},{key:"startMovingFreely",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.animations.cancelAll("noComplete"),this.stopBeingMoved(),t&&(this.move.freely.callback=t),this.state.isMovingFreely=!0,this.state.movement.previousTime=-1,this.state.movement.velocity=this.state.movement.velocity.clipMag(this.move.freely.zeroVelocityThreshold,this.move.maxVelocity)}},{key:"stopMovingFreely",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.state.isMovingFreely=!1,this.state.movement.previousTime=-1,this.move.freely.callback&&(this.move.freely.callback(t),this.move.freely.callback=null)}},{key:"transformWithPulse",value:function(t,e){var n=[];if(this.state.isPulsing){-1===this.state.pulse.startTime&&(this.state.pulse.startTime=t);var i=t-this.state.pulse.startTime;i>this.pulse.time&&0!==this.pulse.time&&(this.stopPulsing(!0),i=this.pulse.time);for(var r=0;r<this.pulse.num;r+=1){var o=this.pulse.style(i,this.pulse.frequency,this.pulse.A instanceof Array?this.pulse.A[r]:this.pulse.A,this.pulse.B instanceof Array?this.pulse.B[r]:this.pulse.B,this.pulse.C instanceof Array?this.pulse.C[r]:this.pulse.C),a=this.pulse.transformMethod(o);n.push(e.transform(a))}}else n.push(e._dup());return n}},{key:"pulseScaleNow",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.pulse.time=t,0===n&&0===t&&(this.pulse.frequency=1),0!==n&&(this.pulse.frequency=n),0!==t&&0===n&&(this.pulse.frequency=1/(2*t)),this.pulse.A=1,this.pulse.B=e-1,this.pulse.C=0,this.pulse.num=1,this.pulse.callback=i,this.pulseNow()}},{key:"pulseThickNow",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:3,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=[e];if(this.pulse.num=n,1<this.pulse.num){var o=Math.abs(1-e),a=o,s=(a- -o)/(this.pulse.num-1);r=[];for(var l=0;l<this.pulse.num;l+=1)r.push(a-l*s)}this.pulse.time=t,this.pulse.frequency=1/(2*t),this.pulse.A=1,this.pulse.B=r,this.pulse.C=0,this.pulse.callback=i,this.pulseNow()}},{key:"pulseNow",value:function(){this.state.isPulsing=!0,this.state.pulse.startTime=-1,this.unrender()}},{key:"stopPulsing",value:function(t){if(this.state.isPulsing=!1,this.pulse.callback){var e=this.pulse.callback;this.pulse.callback=null,e(t)}}},{key:"stop",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!0===e||"complete"===e?this.animations.cancelAll("complete"):!1===e||"noComplete"===e?this.animations.cancelAll("noComplete"):this.animations.cancelAll(null),this.stopMovingFreely(t),this.stopBeingMoved(),this.stopPulsing(t)}},{key:"cancel",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.stop(!0,t)}},{key:"updateLimits",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.diagramTransforms;this.diagramLimits=t,this.diagramTransforms=e}},{key:"resize",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;t&&this.tieToHTML.updateOnResize&&this.updateHTMLElementTie(t)}},{key:"getGLBoundingRect",value:function(){return new U(0,0,1,1)}},{key:"getDiagramBoundingRect",value:function(){var t=this.getGLBoundingRect(),e=new X(this.diagramLimits.width/2,this.diagramLimits.height/2);return new U(t.left*e.x,t.bottom*e.y,t.width*e.x,t.height*e.y)}},{key:"getRelativeGLBoundingRect",value:function(){return new U(0,0,1,1)}},{key:"getRelativeDiagramBoundingRect",value:function(){var t=this.getRelativeGLBoundingRect(),e=new X(this.diagramLimits.width/2,this.diagramLimits.height/2);return new U(t.left*e.x,t.bottom*e.y,t.width*e.x,t.height*e.y)}},{key:"getCenterDiagramPosition",value:function(){var t=this.getDiagramBoundingRect();return new X(t.left+t.width/2,t.bottom+t.height/2)}},{key:"getPosition",value:function(){var t=this.transform.t(),e=new X(0,0);return null!=t&&(e=t._dup()),e}},{key:"getScale",value:function(){var t=this.transform.s(),e=new X(0,0);return null!=t&&(e=t._dup()),e}},{key:"getRotation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=this.transform.r(),n=0;return null!=e&&(n=e),""!==t&&null!=e&&(n=W(e,t)),n}},{key:"getVertexSpaceDiagramPosition",value:function(t){var e=t.transformBy(this.lastDrawTransform.matrix()),n=ft({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}});return e.transformBy(n.matrix())}},{key:"getDiagramPosition",value:function(){return this.getVertexSpaceDiagramPosition(new X(0,0))}},{key:"getPixelToVertexSpaceScale",value:function(){var t=this.diagramTransforms.pixelToDiagram.matrix(),e=this.diagramSpaceToVertexSpaceTransformMatrix(),n=t[0]*e[0],i=t[4]*e[4];return new X(n,i)}},{key:"getVertexToPixelSpaceScale",value:function(){var t=this.getPixelToVertexSpaceScale();return new X(1/t.x,1/t.y)}},{key:"getDiagramPositionInVertexSpace",value:function(t){return t.transformBy(this.diagramSpaceToVertexSpaceTransformMatrix())}},{key:"diagramSpaceToVertexSpaceTransformMatrix",value:function(){return B(new ht(this.lastDrawTransform.order.slice(this.lastDrawElementTransformPosition.elementCount,this.lastDrawTransform.order.length-2)).matrix())}},{key:"vertexToDiagramSpaceTransformMatrix",value:function(){return new ht(this.lastDrawTransform.order.slice(0,this.lastDrawTransform.order.length-2)).matrix()}},{key:"setDiagramPosition",value:function(t){var e=ft({x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}},{x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}}),n=t.transformBy(e.matrix()),i=new ht(this.lastDrawTransform.order.slice(this.transform.order.length)),r=n.transformBy(B(i.matrix()));this.setPosition(r._dup())}},{key:"setDiagramPositionToElement",value:function(t){var e=t.getDiagramPosition();this.setDiagramPosition(e._dup())}},{key:"setPositionToElement",value:function(t){var e=t.transform.t();null!=e&&this.setPosition(e._dup())}},{key:"setMoveBoundaryToDiagram",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.move.boundary,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new X(1,1);if(this.isMovable&&(null!=t&&(this.move.boundary=t),null!=this.move.boundary)){var n;if(Array.isArray(this.move.boundary)){var i=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(this.move.boundary,4),r=i[0],o=i[1],a=i[2],s=i[3];n=new U(r,o,a,s)}else n="diagram"===this.move.boundary?this.diagramLimits:this.move.boundary;var l=ft({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}}),u=this.getRelativeGLBoundingRect(),c=[l.matrix()[0],0,0,0,l.matrix()[4],0,0,0,1],h=new X(u.left,u.bottom).transformBy(c),f=new X(u.right,u.top).transformBy(c),d=new X(0,0),p=new X(0,0);d.x=n.left-h.x*e.x,d.y=n.bottom-h.y*e.y,p.x=n.right-f.x*e.x,p.y=n.top-f.y*e.y,this.move.maxTransform.updateTranslation(p.x,p.y),this.move.minTransform.updateTranslation(d.x,d.y)}}},{key:"show",value:function(){this.isShown=!0,this.setOpacity(1),null!=this.parent&&(this.parent.isShown||this.parent.show())}},{key:"makeTouchable",value:function(){0<arguments.length&&void 0!==arguments[0]&&!arguments[0]?this.hasTouchableElements=!0:this.isTouchable=!0,null!=this.parent&&this.parent.makeTouchable(!1)}},{key:"setMovable",value:function(){0<arguments.length&&void 0!==arguments[0]&&!arguments[0]?(this.isMovable=!1,this.isTouchable=!1):(this.isMovable=!0,this.makeTouchable(!0))}},{key:"clearRender",value:function(){var t,e="";if("string"==typeof this.tieToHTML.element&&(e=this.tieToHTML.element,t=document.getElementById(this.tieToHTML.element)),t){var n=document.getElementById("".concat(e,"_webgl"));null!=n&&(n.style.display="none");var i=document.getElementById("".concat(e,"_2d"));null!=i&&(i.style.display="none")}}},{key:"setRenderedOnNextDraw",value:function(){this.renderedOnNextDraw=!0}},{key:"unrender",value:function(){this.isRenderedAsImage&&(this.unrenderNextDraw=!0,this.isRenderedAsImage=!1),null!=this.parent&&this.parent.unrender()}},{key:"showAll",value:function(){this.show()}},{key:"hide",value:function(){this.isShown=!1}},{key:"hideAll",value:function(){this.hide()}},{key:"toggleShow",value:function(){this.isShown?this.hide():this.show()}},{key:"click",value:function(){null!==this.onClick&&void 0!==this.onClick&&this.onClick(this)}}]),t}(),Ui=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ht,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[.5,.5,.5,1],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new U(-1,-1,2,2),a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return zi(this,e),(n=Bi(this,Ii(e).call(this,i,o,a))).drawingObject=t,n.color=r.slice(),n.pointsToDraw=-1,n.angleToDraw=-1,n.lengthToDraw=-1,n.cannotTouchHole=!1,n}return qi(e,Wi),Vi(e,[{key:"setAngleToDraw",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;this.angleToDraw=t}},{key:"isBeingTouched",value:function(t){if(!this.isTouchable)return!1;for(var e=this.drawingObject.getGLBoundaries(this.lastDrawTransform.matrix()),n=this.drawingObject.getGLBoundaryHoles(this.lastDrawTransform.matrix()),i=0;i<e.length;i+=1){var r=e[i];if(t.isInPolygon(r)){var o=!0;if(this.cannotTouchHole)for(var a=0;a<n.length;a+=1){var s=n[a];t.isInPolygon(s)&&(o=!1,a=n.length)}if(o)return!0}}return!1}},{key:"_dup",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=new e(this.drawingObject._dup());return Gt(this,n,["parent"]),null!=t&&(n.transform=t._dup()),n}},{key:"clear",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;this.drawingObject instanceof xe&&this.drawingObject.clear(t)}},{key:"resize",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(this.resizeHtmlObject(),Di(Ii(e.prototype),"resize",this).call(this,t),"vertexText"===this.drawingObject.type){var n=this.getPixelToVertexSpaceScale();this.drawingObject.drawTextIntoBuffer(new X(n.x,Math.abs(n.y)))}}},{key:"setColor",value:function(t){this.color=t.slice(),this instanceof e&&(this.drawingObject instanceof xe&&this.drawingObject.setColor(this.color),this.drawingObject instanceof oe&&(this.drawingObject.element.style.color=Fe(this.color)))}},{key:"setOpacity",value:function(t){this.opacity=t,this instanceof e&&(this.drawingObject instanceof xe&&this.drawingObject.setOpacity(t),this.drawingObject instanceof oe&&(this.drawingObject.element.style.opacity="".concat(t)))}},{key:"show",value:function(){Di(Ii(e.prototype),"show",this).call(this),this.drawingObject instanceof oe&&(this.drawingObject.show=!0,this.drawingObject.transformHtml(this.lastDrawTransform.matrix()))}},{key:"hide",value:function(){Di(Ii(e.prototype),"hide",this).call(this),this.drawingObject instanceof oe&&(this.drawingObject.show=!1,this.drawingObject.transformHtml(this.lastDrawTransform.matrix()))}},{key:"getTouched",value:function(t){return this.isTouchable&&this.isBeingTouched(t)?[this]:[]}},{key:"setFont",value:function(t){this.drawingObject instanceof xe&&this.drawingObject.setFont(t)}},{key:"resizeHtmlObject",value:function(){this.drawingObject instanceof oe&&this.drawingObject.transformHtml(this.lastDrawTransform.matrix())}},{key:"draw",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ht,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(this.isShown){if(!0===this.isRenderedAsImage){if(!this.willStartAnimating())return;this.unrender()}if(this.animations.nextFrame(n),this.nextMovingFreelyFrame(n),!this.isShown)return;this.lastDrawElementTransformPosition={parentCount:e.order.length,elementCount:this.transform.order.length};var r=e.transform(this.transform),o=this.transformWithPulse(n,r);this.lastDrawTransform=o[0];var a=-1;this.drawingObject instanceof ce&&(a=this.drawingObject.numPoints,-1!==this.angleToDraw&&(a=this.drawingObject.getPointCountForAngle(this.angleToDraw)),-1!==this.lengthToDraw&&(a=this.drawingObject.getPointCountForLength(this.lengthToDraw)),-1!==this.pointsToDraw&&(a=this.pointsToDraw));var s=[].concat(Fi(this.color.slice(0,3)),[this.color[3]*this.opacity]);o.forEach(function(e){t.drawingObject.drawWithTransformMatrix(e.matrix(),s,i,a)}),this.unrenderNextDraw&&(this.clearRender(),this.unrenderNextDraw=!1),this.renderedOnNextDraw&&(this.isRenderedAsImage=!0,this.renderedOnNextDraw=!1)}}},{key:"setFirstTransform",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ht;this.lastDrawElementTransformPosition={parentCount:t.order.length,elementCount:this.transform.order.length};var e=t.transform(this.transform);this.lastDrawTransform=e,this.drawingObject instanceof oe&&this.drawingObject.transformHtml(e.matrix()),this.setMoveBoundaryToDiagram()}},{key:"isMoving",value:function(){return!!(this.state.isMovingFreely||this.state.isBeingMoved||this.state.isPulsing||this.animations.willStartAnimating())}},{key:"getGLBoundaries",value:function(){return this.drawingObject.getGLBoundaries(this.lastDrawTransform.matrix())}},{key:"getVertexSpaceBoundaries",value:function(){return this.drawingObject.border}},{key:"getGLBoundingRect",value:function(){return this.drawingObject.getGLBoundingRect(this.lastDrawTransform.matrix())}},{key:"getVertexSpaceBoundingRect",value:function(){return this.drawingObject.getVertexSpaceBoundingRect()}},{key:"getRelativeGLBoundingRect",value:function(){return this.drawingObject.getRelativeGLBoundingRect(this.lastDrawTransform.matrix())}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){return this.drawingObject.getRelativeVertexSpaceBoundingRect()}},{key:"increaseBorderSize",value:function(){var t,e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(e=n instanceof X?(t=n.x,n.y):(t=n,null==i?t:i),this.drawingObject instanceof ce)for(var r=0;r<this.drawingObject.border[0].length;r+=1)this.drawingObject.border[0][r].x*=t,this.drawingObject.border[0][r].y*=e}}]),e}(),Xi=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ht,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U(-1,1,2,2),r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return zi(this,e),(t=Bi(this,Ii(e).call(this,n,i,r))).elements={},t.drawOrder=[],t.touchInBoundingRect=!1,t.eqns={},t}return qi(e,Wi),Vi(e,[{key:"_dup",value:function(){var t=new e,n=this.drawOrder.map(function(t){return"_".concat(t)});Gt(this,t,["elements","drawOrder","parent"].concat(Fi(n)));for(var i=0;i<this.drawOrder.length;i+=1){var r=this.drawOrder[i];t.add(r,this.elements[r]._dup())}return t}},{key:"isMoving",value:function(){if(!1===this.isShown)return!1;if(this.state.isMovingFreely||this.state.isBeingMoved||this.state.isPulsing||"animating"===this.animations.state)return!0;for(var t=0;t<this.drawOrder.length;t+=1){var n=this.elements[this.drawOrder[t]];if(n instanceof e){if(n.isMoving())return!0}else if(n.isShown&&0<n.color[3]&&n.isMoving())return!0}return!1}},{key:"add",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1;(e.parent=this).elements[t]=e,this.elements[t].name=t,this["_".concat(t)]=this.elements[t],-1!==n?this.drawOrder=[].concat(Fi(this.drawOrder.slice(0,n)),[t],Fi(this.drawOrder.slice(n))):this.drawOrder.push(t)}},{key:"willStartAnimating",value:function(){if(Di(Ii(e.prototype),"willStartAnimating",this).call(this))return!0;for(var t=0,n=this.drawOrder.length;t<n;t+=1)if(this.elements[this.drawOrder[t]].willStartAnimating())return!0;return!1}},{key:"draw",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ht,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(this.isShown){if(!0===this.isRenderedAsImage){if(!this.willStartAnimating())return;this.unrender()}if(this.animations.nextFrame(e),this.nextMovingFreelyFrame(e),!this.isShown)return;this.lastDrawElementTransformPosition={parentCount:t.order.length,elementCount:this.transform.order.length};var i=t.transform(this.transform),r=this.transformWithPulse(e,i);this.lastDrawTransform=r[0];for(var o=0;o<r.length;o+=1)for(var a=0,s=this.drawOrder.length;a<s;a+=1)this.elements[this.drawOrder[a]].draw(r[o],e,n);this.unrenderNextDraw&&(this.clearRender(),this.unrenderNextDraw=!1),this.renderedOnNextDraw&&(this.isRenderedAsImage=!0,this.renderedOnNextDraw=!1)}}},{key:"show",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];Di(Ii(e.prototype),"show",this).call(this),t.forEach(function(t){t instanceof e?t.showAll():t.show()})}},{key:"hide",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];Di(Ii(e.prototype),"hide",this).call(this),t.forEach(function(t){t instanceof e?t.hideAll():t.show()})}},{key:"showAll",value:function(){this.show();for(var t=0,e=this.drawOrder.length;t<e;t+=1){var n=this.elements[this.drawOrder[t]];n.show(),"function"==typeof n.hideAll&&n.showAll()}}},{key:"hideAll",value:function(){this.hide();for(var t=0,e=this.drawOrder.length;t<e;t+=1){var n=this.elements[this.drawOrder[t]];n.hide(),"function"==typeof n.hideAll&&n.hideAll()}}},{key:"showOnly",value:function(t){this.hideAll(),this.show();for(var e=0,n=t.length;e<n;e+=1){var i=t[e];if(!i)throw Error("Diagram Element Error: Element does not exist at position ".concat(e));i.show()}}},{key:"hideOnly",value:function(t){this.showAll();for(var e=0,n=t.length;e<n;e+=1)t[e].hide()}},{key:"isBeingTouched",value:function(t){if(!this.isTouchable)return!1;if(this.touchInBoundingRect){var e=this.getGLBoundingRect();if(t.x>=e.left&&t.x<=e.right&&t.y<=e.top&&t.y>=e.bottom)return!0}for(var n=0,i=this.drawOrder.length;n<i;n+=1){var r=this.elements[this.drawOrder[n]];if(!0===r.isShown&&r.isBeingTouched(t))return!0}return!1}},{key:"resizeHtmlObject",value:function(){for(var t=0;t<this.drawOrder.length;t+=1)this.elements[this.drawOrder[t]].resizeHtmlObject()}},{key:"resize",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;Di(Ii(e.prototype),"resize",this).call(this,t);for(var n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].resize(t)}},{key:"clear",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].clear(t)}},{key:"setFirstTransform",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ht).transform(this.transform);this.lastDrawTransform=t;for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setFirstTransform(t);this.setMoveBoundaryToDiagram()}},{key:"getGLBoundaries",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];if(n.isShown){var i=n.getGLBoundaries();t=t.concat(i)}}return t}},{key:"getVertexSpaceBoundaries",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];if(n.isShown){var i=n.getVertexSpaceBoundaries();t=t.concat(i)}}return t}},{key:"getGLBoundingRect",value:function(){return yt(this.getGLBoundaries())}},{key:"getVertexSpaceBoundingRect",value:function(){return yt(this.getVertexSpaceBoundaries())}},{key:"getRelativeGLBoundingRect",value:function(){var t=this.getGLBoundingRect(),e=new X(0,0).transformBy(this.lastDrawTransform.matrix());return new U(t.left-e.x,t.bottom-e.y,t.width,t.height)}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){var t=this.getVertexSpaceBoundingRect(),e=new X(0,0);return new U(t.left-e.x,t.bottom-e.y,t.width,t.height)}},{key:"updateLimits",value:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.diagramTransforms,n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].updateLimits(t,e);this.diagramLimits=t,this.diagramTransforms=e}},{key:"updateHTMLElementTie",value:function(t){Di(Ii(e.prototype),"updateHTMLElementTie",this).call(this,t);for(var n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].updateHTMLElementTie(t)}},{key:"getTouched",value:function(t){if(!this.isTouchable&&!this.hasTouchableElements)return[];var e=[];(this.touchInBoundingRect||this.isTouchable)&&this.isBeingTouched(t)&&e.push(this);for(var n=this.drawOrder.length-1;0<=n;n-=1){var i=this.elements[this.drawOrder[n]];!0===i.isShown&&(e=e.concat(i.getTouched(t)))}return e}},{key:"stop",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Di(Ii(e.prototype),"stop",this).call(this,t,n);for(var i=0;i<this.drawOrder.length;i+=1)this.elements[this.drawOrder[i]].stop(t,n)}},{key:"setFont",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setFont(t)}},{key:"setColor",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[0,0,0,1],e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setColor(t);this.color=t.slice()}},{key:"setOpacity",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setOpacity(t);this.opacity=t}},{key:"getElementTransforms",value:function(){for(var t={},e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];t[n.name]=n.transform._dup()}return t}},{key:"setElementTransforms",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];n.name in t&&(n.transform=t[n.name])}}},{key:"reorder",value:function(){var t=this;this.drawOrder.sort(function(e,n){var i=t.elements[e];return t.elements[n].drawPriority-i.drawPriority});for(var n=0;n<this.drawOrder.length;n+=1){var i=this.elements[this.drawOrder[n]];i instanceof e&&i.reorder()}}},{key:"animateToTransforms",value:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:m,a=r,s=0,l=0;l<this.drawOrder.length;l+=1){var u=this.elements[this.drawOrder[l]];u.name in t&&(u.isShown?t[u.name].isEqualTo(u.transform)||(u.animations.new().delay(n).transform({target:t[u.name],duration:e,rotDirection:i,progression:o,onFinish:a}).start(),a=null,s=e+n):u.transform=t[u.name]._dup())}return 0===s&&null!=a&&a(!0),s}},{key:"getAllPrimatives",value:function(){for(var t=[],n=0;n<this.drawOrder.length;n+=1){var i=this.elements[this.drawOrder[n]];i instanceof e?t=[].concat(Fi(t),Fi(i.getAllElements())):t.push(i)}return t}},{key:"getAllElements",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];t.push(n)}return t}},{key:"getAllElementsWithScenario",value:function(t){for(var n=Di(Ii(e.prototype),"getAllElementsWithScenario",this).call(this,t),i=0;i<this.drawOrder.length;i+=1){var r=this.elements[this.drawOrder[i]];null!=r.scenarios[t]&&n.push(r),r instanceof e&&(n=[].concat(Fi(n),Fi(r.getAllElementsWithScenario(t))))}return n}},{key:"getAllPossiblyInteractiveElements",value:function(){for(var t=[],n=0;n<this.drawOrder.length;n+=1){var i=this.elements[this.drawOrder[n]];i instanceof e&&(i.isTouchable||i.isMovable||!i.hasTouchableElements||i.isInteractive&&null!=i.isInteractive||(t=[].concat(Fi(t),Fi(i.getAllPossiblyInteractiveElements())))),(void 0!==i.isInteractive||i.isTouchable||i.isMovable)&&t.push(i)}return t}},{key:"goToStep",value:function(t){var e=document.getElementById("id__figureone_item_selector_0"),n=[];if(null!=e&&0<e.children.length)for(var i=0;i<e.children.length;i+=1)n.push(e.children[i]);n.forEach(function(e,n){n===t?e.classList.add("figureone__item_selector_selected"):e.classList.remove("figureone__item_selector_selected")})}},{key:"setMovable",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Di(Ii(e.prototype),"setMovable",this).call(this,t),t&&(this.hasTouchableElements=!0)}},{key:"setupWebGLBuffers",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setupWebGLBuffers(t)}},{key:"changeWebGLInstance",value:function(t){for(var e,n=0;n<this.drawOrder.length;n+=1)e=this.elements[this.drawOrder[n]].changeWebGLInstance(t);return e}},{key:"getLoadingElements",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];n instanceof Ui?"loading"===n.drawingObject.state&&t.push(n):t=[].concat(Fi(t),Fi(n.getLoadingElements()))}return t}},{key:"unrenderAll",value:function(){this.unrender();for(var t=0;t<this.drawOrder.length;t+=1){var e=this.elements[this.drawOrder[t]];e instanceof Ui?e.unrender():e.unrenderAll()}}},{key:"setScenarios",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Di(Ii(e.prototype),"setScenarios",this).call(this,t);for(var i=0;i<this.drawOrder.length;i+=1){var r=this.elements[this.drawOrder[i]];(n&&r.isShown||!1===n)&&r.setScenarios(t,n)}}}]),e}();function Yi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Qi=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.instance||(this.requestNextAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,(t.instance=this).drawQueue=[],this.nextDrawQueue=[]),t.instance}var e,n;return e=t,(n=[{key:"draw",value:function(t){this.drawQueue=this.nextDrawQueue,this.nextDrawQueue=[];for(var e=.001*t,n=0;n<this.drawQueue.length;n+=1)this.drawQueue[n](e);this.drawQueue=[]}},{key:"queueNextFrame",value:function(t){this.nextDrawQueue.push(t),1===this.nextDrawQueue.length&&this.animateNextFrame()}},{key:"animateNextFrame",value:function(){cancelAnimationFrame(this.animationId);var t=this.requestNextAnimationFrame.call(window,this.draw.bind(this));this.animationId=t}}])&&Yi(e.prototype,n),t}();function Zi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ki=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.diagram=e,this.addEvent("mousedown",this.mouseDownHandler,!1),this.addEvent("mouseup",this.mouseUpHandler,!1),this.addEvent("mousemove",this.mouseMoveHandler,!1),this.addEvent("touchstart",this.touchStartHandler,!1),this.addEvent("touchend",this.touchEndHandler,!1),this.addEvent("touchmove",this.touchMoveHandler,!1),this.enable=!0,this.start=this.diagram.touchDownHandler.bind(this.diagram),this.end=this.diagram.touchUpHandler.bind(this.diagram),this.move=this.diagram.touchMoveHandler.bind(this.diagram)}var e,n;return e=t,(n=[{key:"addEvent",value:function(t,e,n){this.diagram.gestureCanvas.addEventListener(t,e.bind(this),n)}},{key:"removeEvent",value:function(t,e,n){this.diagram.gestureCanvas.removeEventListener(t,e.bind(this),n)}},{key:"startHandler",value:function(t){return!!this.enable&&(this.mouseDown=!0,this.previousPoint=t,this.start(t))}},{key:"endHandler",value:function(){this.mouseDown=!1,this.end()}},{key:"moveHandler",value:function(t,e){this.enable&&this.mouseDown&&(this.move(this.previousPoint,e)&&t.preventDefault(),this.previousPoint=e)}},{key:"touchStartHandler",value:function(t){var e=t.touches[0];this.startHandler(new X(e.clientX,e.clientY))&&t.preventDefault()}},{key:"mouseDownHandler",value:function(t){this.startHandler(new X(t.clientX,t.clientY))&&t.preventDefault()}},{key:"touchMoveHandler",value:function(t){var e=t.touches[0];this.moveHandler(t,new X(e.clientX,e.clientY))}},{key:"mouseMoveHandler",value:function(t){this.moveHandler(t,new X(t.clientX,t.clientY))}},{key:"mouseUpHandler",value:function(){this.endHandler()}},{key:"touchEndHandler",value:function(){this.endHandler()}},{key:"destroy",value:function(){this.removeEvent("mousedown",this.mouseDownHandler,!1),this.removeEvent("mouseup",this.mouseUpHandler,!1),this.removeEvent("mousemove",this.mouseMoveHandler,!1),this.removeEvent("touchstart",this.touchStartHandler,!1),this.removeEvent("touchend",this.touchEndHandler,!1),this.removeEvent("touchmove",this.touchMoveHandler,!1)}}])&&Zi(e.prototype,n),t}();function $i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n="",i="";return null!=e&&(i=' style="margin-top:'.concat(e,'%"')),Array.isArray(t)?t.forEach(function(t,e){t.startsWith("<")?n+=t:n+=0===e?'<p style="margin-top:'.concat(i,'">').concat(t,"</p>"):"<p>".concat(t,"</p>")}):n=t,n}function Ji(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length?arguments[1]:void 0,n=$i(t);return'<div class="'.concat(e,'">').concat(n,"</div>")}function tr(){var t=$i(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",0);return'<div style="display: table; height: 100%; width: 100%;">\n        <div style="display: table-cell; vertical-align: middle; height: 100%; width: 100%;">\n        '.concat(t,"</div></div>")}function er(){var t=$i(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",0);return'<div style="display: table; height: 100%; text-align:center; width:100%;">\n        <div style="display: table-cell; vertical-align: middle; height: 100%; width: 100%;">\n        '.concat(t,"</div></div>")}function nr(){var t=$i(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"");return'<div style="text-align:center;">\n        '.concat(t,"</div>")}function ir(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n="",i="",r="",o="",a="",s="",l="",u="";"number"==typeof t?r="margin-top:".concat(t,"%"):(null!=t.left&&(n="margin-left:".concat(t.left,"%;")),null!=t.right&&(i="margin-right:".concat(t.right,"%;")),t.centerV&&(r="margin-top:0;"),null!=t.top&&(r="margin-top:".concat(t.top,"%;")),null!=t.line&&(o="margin-top:".concat(t.line,"%;")),null!=t.size&&(a="font-size:".concat(t.size,"em;")),t.className&&(s='class="'.concat(t.className,'"')),t.color&&(l="color:".concat(Fe(t.color),";")),t.listStyleType&&(u="list-style-type:".concat(t.listStyleType,";")));var c,h='<p style="'.concat(n).concat(i).concat(o).concat(a).concat(l,'"').concat(s,">"),f='<p style="'.concat(n).concat(i).concat(r).concat(a).concat(l,'"').concat(s,">"),d='<li style="'.concat(n).concat(i).concat(o).concat(a).concat(l).concat(u,'"').concat(s,">"),p='<ul style="'.concat(n).concat(i).concat(r).concat(a).concat(l,'"').concat(s,">"),v='<ol style="'.concat(n).concat(i).concat(r).concat(a).concat(l,'"').concat(s,">");return c=null!=t.list?(c=Array.isArray(e)?e.join("</li>".concat(d)):e,"unordered"===t.list?"".concat(p).concat(d).concat(c,"</ul>"):"".concat(v).concat(d).concat(c,"</ol>")):(c=Array.isArray(e)?e.join("</p>".concat(h)):e,"".concat(f).concat(c,"</p>")),t.centerV&&(c=tr(c)),c}function rr(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[""],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i='<ul id="id__figureone_item_selector_'.concat(n,'" \n                    class=').concat(e,">");return t.forEach(function(t,e){i+='<li id="id__figureone_item_selector_'.concat(e,'">').concat(t,"</li>")}),i+="</ul>"}var or=function(t,e){return'<span class="figureone__unit_deg">'.concat(t,'</span><span class="figureone__unit_rad">').concat(e,"</span>\n  ")};function ar(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r="";e&&(r=' id="'.concat(e,'"'));var o="";n&&(o=' class="'.concat(n,'"'));var a="";return i&&(a=' style="color:'.concat(Fe(i),';"')),{replacementText:"<span".concat(r).concat(o,'"').concat(a,">").concat(t.replace(RegExp(/_/,"gi")," ").trim(),"</span>")}}function sr(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e="highlight_word";"string"==typeof t&&(e="".concat(t," ").concat(e));var n=null;return Array.isArray(t)&&(n=t),{replacementText:function(t){return ar(t,"",e,n)}}}function lr(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n="action_word interactive_word",i=null,r={color:null,id:"figureone__id_".concat(Wt()),interactive:!0,classes:"",text:null,newTab:!0},o=r;Array.isArray(e)?i=e:null!=e&&(o=Vt(r,e));var a=o,s=a.color,l=a.id,u=a.classes,c=a.text;null!=s&&(i=s),""!==u&&(n="".concat(n," ").concat(u));var h=o.newTab?' target="_blank"':"";return{replacementText:function(e){var r=l?' id="'.concat(l,'"'):"",o=i?' style="color:'.concat(Fe(i),';"'):"";return{replacementText:"<a href=".concat(t).concat(r,'class="').concat(n,'"').concat(o,' rel="noreferrer noopener"').concat(h,">").concat((c||e).trim(),"</a>")}},id:function(){return l}}}function ur(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n="highlight_word";"string"==typeof e&&(n="".concat(e," ").concat(n));var i=null;return Array.isArray(e)&&(i=e),{replacementText:ar(t,"",n,i).replacementText}}function cr(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return{replacementText:function(e){return ar(e,"",t)}}}function hr(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return{replacementText:function(e){return ar(e,t)}}}function fr(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i="action_word",r=null,o={color:null,id:"figureone__id_".concat(Wt()),interactive:!0,classes:"",text:null},a=o;Array.isArray(n)?r=n:null!=n&&(a=Vt(o,n));var s=a,l=s.interactive,u=s.color,c=s.id,h=s.classes,f=s.text;null!=u&&(r=u),l&&(i="".concat(i," interactive_word")),""!==h&&(i="".concat(i," ").concat(h));var d=function(){return c};return{replacementText:function(t){return ar(f||t,d(),i,r)},id:d,actionMethod:t,bind:e}}function dr(t,e,n){return fr(e,n,{color:3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,text:t})}function pr(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Wt(),n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i="action_word";(!(3<arguments.length&&void 0!==arguments[3])||arguments[3])&&(i="".concat(i," interactive_word")),"string"==typeof n&&(i="".concat(n," ").concat(i));var r=null;return Array.isArray(n)&&(r=n),{replacementText:ar(t,e,i,r).replacementText,id:e}}function vr(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",r=document.getElementById(t);r&&(r.classList.add("action_word_enabled"),i.split(" ").forEach(function(t){t&&r.classList.add(t)}),1===n.length&&(r.onclick=e.bind(n[0])),2===n.length&&(r.onclick=e.bind(n[0],n[1])),3===n.length&&(r.onclick=e.bind(n[0],n[1],n[2])),4===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3])),5===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4])),6===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5])),7===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6])),8===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7])),9===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])))}function mr(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"highlight_word",i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],r=t;Object.keys(e).forEach(function(t){var n,i,o,a,s,l=e[t];n=r,i=t,o=l,a=new RegExp("\\|".concat(i,"\\|"),"gi"),s="string"==typeof o?o:"string"==typeof o.replacementText?o.replacementText:o.replacementText(i).replacementText,r=n.replace(a,s)});var o=RegExp(/\|([^|]*)\|/gi);if(r=r.replace(o,'<span class="'.concat(n,'">$1</span>')),i){var a=RegExp(/style="color:rgba\([^)]*\);"/gi);r=r.replace(a,"");var s=RegExp(/highlight_word/gi);r=r.replace(s,"");var l=RegExp(/interactive_word/gi);r=r.replace(l,"");var u=RegExp(/id="[^"]*"/gi);r=r.replace(u,"")}return r}function yr(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";Object.keys(t).forEach(function(n){var i=t[n];"string"!=typeof i&&"actionMethod"in i&&vr(i.id(n),i.actionMethod,i.bind,e)})}function gr(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",r=mr(e,n);t.innerHTML=r,yr(n,i)}function br(t){return(br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function xr(t){return(xr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _r(t,e){return(_r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Tr=function(t){function e(t,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"never";return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(o=function(t,e){return!e||"object"!==br(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,xr(e).call(this,t))).width=r,o.close=i,o.borderToPoint=a,o.setupPoints(n),o.setupBuffer(),o}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_r(t,e)}(e,ce),n=e,(i=[{key:"change",value:function(t){this.setupPoints(t),this.resetBuffer()}},{key:"setupPoints",value:function(t){var e=function(t,e,n,i){var r=[],o=[],a=[];function s(e,r,s){var l=null==s?null:t[s],u=t[r],c=null==e?null:t[e],h=0,f=n/2,d=0,p=0;if(null!=c&&null!=l){var v=l.sub(u).toPolar(),m=c.sub(u).toPolar(),y=vt(1,v.angle),g=vt(1,m.angle);h=y.add(g).toPolar().angle||1e-5,p=et(y.toPolar().angle,g.toPolar().angle),f=Math.abs(n/2/Math.sin(h-v.angle)),d=Math.sin(v.angle-m.angle)}else if(null==c&&null!=l){var b=l.sub(u).toPolar();h=b.angle-Math.PI/2,f=Math.abs(n/2/Math.sin(h-b.angle)),d=1}else if(null==l&&null!=c){var w=c.sub(u).toPolar();h=w.angle-Math.PI/2+Math.PI,f=Math.abs(n/2/Math.sin(h-w.angle)),d=1}var x=Math.min(f,6*n),_=Math.min(f,2*n),T=x,k=_;if("alwaysOn"===i&&(T=x+_,k=0),"onSharpAnglesOnly"===i){T=x+_,k=0;var O=.9*Math.PI;if(Math.abs(p)>O){var S=Math.sin(Math.abs(p))/Math.sin(O);T=x+_*S,k=_*(1-S)}}var P=vt(T,h).add(u),A=vt(k,h+Math.PI).add(u);d<0&&(A=vt(T,h).add(u),P=vt(k,h+Math.PI).add(u)),o.push(P),a.push(A)}s(e?t.length-1:null,0,1);for(var l=1;l<t.length-1;l+=1)s(l-1,l,l+1);s(t.length-2,t.length-1,e?0:null);for(var u=function(t,e){r.push(o[t].x),r.push(o[t].y),r.push(a[t].x),r.push(a[t].y),r.push(a[e].x),r.push(a[e].y),r.push(o[t].x),r.push(o[t].y),r.push(a[e].x),r.push(a[e].y),r.push(o[e].x),r.push(o[e].y)},c=0;c<t.length-1;c+=1)u(c,c+1);e&&u(t.length-1,0);var h=[],f=[];if(e)f=o[0].isInPolygon(a)?(h=a,o):(h=o,a);else{h.push(o[0]);for(var d=0;d<a.length;d+=1)h.push(a[d]);for(var p=o.length-1;0<=p;p-=1)h.push(o[p])}return{points:r,border:h,holeBorder:f}}(t,this.close,this.width,this.borderToPoint);this.points=e.points,this.border[0]=e.border,this.holeBorder[0]=e.holeBorder}}])&&wr(n.prototype,i),e}();function kr(t,e,n,i){var r=new ot(t,e),o=new ot(n,i);return r.intersectsWith(o).intersect}var Or=function(t,e,n){var i,r,o,a,s=[],l=[],u=[],c=[],h=[],f=n/2;e&&t.push(t[0]);for(var d=1;d<t.length;d+=1){i=t[d-1],r=t[d];var p=Math.atan2(r.y-i.y,r.x-i.x),v=new X(f*Math.cos(p+Math.PI/2),f*Math.sin(p+Math.PI/2)),m=new X(f*Math.cos(p-Math.PI/2),f*Math.sin(p-Math.PI/2));c.push([i.add(v),r.add(v)]),h.push([i.add(m),r.add(m)])}r=e?(i=kr(c[0][0],c[0][1],c[c.length-1][0],c[c.length-1][1]),kr(h[0][0],h[0][1],h[c.length-1][0],h[h.length-1][1])):(i=c[0][0],h[0][0]),l.push(i._dup()),u.push(r._dup());for(var y=1;y<c.length;y+=1)s.push(i.x),s.push(i.y),s.push(r.x),s.push(r.y),i=kr(c[y-1][0],c[y-1][1],c[y][0],c[y][1]),r=kr(h[y-1][0],h[y-1][1],h[y][0],h[y][1]),l.push(i._dup()),u.push(r._dup()),s.push(r.x),s.push(r.y),s.push(s[s.length-6]),s.push(s[s.length-6]),s.push(r.x),s.push(r.y),s.push(i.x),s.push(i.y);a=e?(o=new X(s[0],s[1]),new X(s[2],s[3])):(o=c[c.length-1][1],h[h.length-1][1]),s.push(i.x),s.push(i.y),s.push(r.x),s.push(r.y),s.push(a.x),s.push(a.y),s.push(i.x),s.push(i.y),s.push(a.x),s.push(a.y),s.push(o.x),s.push(o.y),l.push(o._dup()),u.push(a._dup()),e&&t.pop();var g=[];if(e)g=l[0].isInPolygon(u)?u:l;else{g.push(l[0]);for(var b=0;b<u.length;b+=1)g.push(u[b]);for(var w=l.length-1;0<=w;w-=1)g.push(l[w])}return{points:s,border:g}};function Sr(t){return(Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pr(t){return(Pr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ar(t,e){return(Ar=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Er(t,e){for(var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=t[1],r=[t[0],t[2]],o=[],a=0;a<2;a+=1){var s=r[a].sub(i),l=Math.atan2(s.y,s.x),u=Math.sqrt(s.x*s.x+s.y*s.y);(e<u||n)&&(u=e),o.push(new X(u*Math.cos(l)+i.x,u*Math.sin(l)+i.y))}return o.push(o[1]._dup()),o[1]=i._dup(),o}var Lr=function(t){function e(t,n,i,r,o){var a;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),a=function(t,e){return!e||"object"!==Sr(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Pr(e).call(this,t));var s=n.slice();i&&(s.push(n[0]),s.push(n[1]));for(var l=1,u=s.length-1;l<u;l+=1){for(var c=Er([s[l-1],s[l],s[l+1]],r,!0),h=Or(c,!1,o),f=0,d=h.points.length;f<d;f+=1)a.points.push(h.points[f]);a.border[l-1]=[];for(var p=0,v=h.border.length;p<v;p+=1)a.border[l-1].push(h.border[p])}return a.setupBuffer(),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ar(t,e)}(e,ce),e}();function jr(t,e,n,i,r,o,a,s){var l=new Tr(t,e,n,i,o),u=new ht;return u=a instanceof X?u.translate(a.x,a.y):a._dup(),new Ui(l,u,r,s)}function Mr(t,e,n,i,r,o,a,s){var l=new Lr(t,e,n,i,r),u=new ht;return u=a instanceof X?u.translate(a.x,a.y):a._dup(),new Ui(l,u,o,s)}function Rr(t){return(Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cr(t){return(Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fr(t,e){return(Fr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Br=function(t){function e(t,n){var i;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==Rr(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Cr(e).call(this,t))).glPrimative=t[0].gl.TRIANGLE_FAN,i.points=[],n.forEach(function(t){i.points.push(t.x),i.points.push(t.y),i.border[0].push(t)}),i.setupBuffer(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fr(t,e)}(e,ce),e}();function Dr(t){return(Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ir(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function qr(t){return(qr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Hr(t,e){return(Hr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Nr=function(t){function e(t,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new X(0,0),l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:n,u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1,c=8<arguments.length&&void 0!==arguments[8]&&arguments[8];!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(o=function(t,e){return!e||"object"!==Dr(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,qr(e).call(this,t))).glPrimative=c?t[0].gl.TRIANGLES:t[0].gl.TRIANGLE_STRIP;var h=n,f=Math.floor(l);h<3&&(h=3),f<0?f=0:h<f&&(f=h);var d,p=(o.radius=i)-r;o.center=s,o.dAngle=2*Math.PI/h;var v=0;for(d=0;d<=f;d+=1){var m=d*o.dAngle*u+a*u,y=(d-1)*o.dAngle*u+a*u,g=new X(p*Math.cos(m),p*Math.sin(m)).add(s),b=new X(i*Math.cos(m),i*Math.sin(m)).add(s),w=new X(p*Math.cos(y),p*Math.sin(y)).add(s),x=new X(i*Math.cos(y),i*Math.sin(y)).add(s);c?0<d&&(o.points[v]=w.x,o.points[v+1]=w.y,o.points[v+2]=x.x,o.points[v+3]=x.y,o.points[v+4]=b.x,o.points[v+5]=b.y,o.points[v+6]=b.x,o.points[v+7]=b.y,o.points[v+8]=w.x,o.points[v+9]=w.y,o.points[v+10]=g.x,o.points[v+11]=g.y,v+=12):(o.points[v]=g.x,o.points[v+1]=g.y,o.points[v+2]=b.x,o.points[v+3]=b.y,v+=4)}if(f<h){for(d=0;d<=f;d+=1)o.border[0].push(new X(s.x+i*Math.cos(d*o.dAngle*u+a*u),s.y+i*Math.sin(d*o.dAngle*u+a*u)));for(d=f;0<=d;d-=1)o.border[0].push(new X(s.x+p*Math.cos(d*o.dAngle*u+a*u),s.y+p*Math.sin(d*o.dAngle*u+a*u)));o.border[0].push(o.border[0][0]._dup())}else for(d=0;d<=f;d+=1)o.border[0].push(new X(s.x+i*Math.cos(d*o.dAngle*u+a*u),s.y+i*Math.sin(d*o.dAngle*u+a*u)));return o.setupBuffer(),o}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Hr(t,e)}(e,ce),n=e,(i=[{key:"drawToAngle",value:function(t,e,n,i,r){var o=2*Math.floor(i/this.dAngle)+2;i>=2*Math.PI&&(o=this.numPoints),this.draw(t,e,n,o,r)}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI,e=2*Math.floor(t/this.dAngle)+2;return t>=2*Math.PI&&(e=this.numPoints),e}}])&&Ir(n.prototype,i),e}();function zr(t){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Vr(t,e){return!e||"object"!==zr(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Wr(t){return(Wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ur(t,e){return(Ur=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Xr=function(t){function e(t,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new X(0,0),s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:n,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"",u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:new U(0,0,1,1);!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(r=Vr(this,""!==l?Wr(e).call(this,t,"withTexture","withTexture"):Wr(e).call(this,t))).glPrimative=t[0].gl.TRIANGLE_FAN;var c,h=n,f=s;h<3&&(h=3),s<0?f=0:h<s&&(f=h),r.points=[a.x,a.y],r.dAngle=0,r.radius=i,r.center=a,r.dAngle=2*Math.PI/h;var d=2;for(f<h&&r.border[0].push(a._dup()),c=0;c<f+1;c+=1)r.points[d]=a.x+i*Math.cos(c*r.dAngle+o),r.points[d+1]=a.y+i*Math.sin(c*r.dAngle+o),r.border[0].push(new X(r.points[d],r.points[d+1])),d+=2;return f<h&&r.border[0].push(a._dup()),l&&(r.texture={id:l,src:l,type:"image",points:[]},r.createTextureMap(1.01*-r.radius+a.x,1.01*r.radius+a.x,1.01*-r.radius+a.y,1.01*r.radius+a.y,u.left,u.right,u.bottom,u.top)),r.setupBuffer(),Vr(r)}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ur(t,e)}(e,ce),n=e,(i=[{key:"drawToAngle",value:function(t,e,n,i,r){var o=2*Math.floor(i/this.dAngle)+2;i>=2*Math.PI&&(o=this.numPoints),this.draw(t,e,n,o,r)}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI,e=Math.floor(t/this.dAngle)+1;return t>=2*Math.PI&&(e=this.numPoints),e}}])&&Gr(n.prototype,i),e}();function Yr(t){return(Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zr(t){return(Zr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Kr(t,e){return(Kr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var $r=function(t){function e(t,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new X(0,0),s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:n,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1,u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(r=function(t,e){return!e||"object"!==Yr(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Zr(e).call(this,t))).glPrimative=t[0].gl.LINES;var c=n,h=Math.floor(s);c<3&&(c=3),h<0?h=0:c<h&&(h=c),r.radius=i,r.center=a,r.dAngle=2*Math.PI/c;for(var f=[],d=[],p=1;p<u;p+=1)d.push([]);for(var v=0;v<=h;v+=1){var m=v*r.dAngle*l+o*l;f.push(vt(i,m));for(var y=1;y<u;y+=1)d[y-1].push(vt(i*(1-.003*y),m))}for(var g=1;g<=h;g+=1){r.points.push(f[g-1].x),r.points.push(f[g-1].y),r.points.push(f[g].x),r.points.push(f[g].y);for(var b=1;b<u;b+=1)r.points.push(d[b-1][g-1].x),r.points.push(d[b-1][g-1].y),r.points.push(d[b-1][g].x),r.points.push(d[b-1][g].y)}return r.border[0]=f,h<c&&r.border[0].push(a),r.setupBuffer(),r}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Kr(t,e)}(e,ce),n=e,(i=[{key:"drawToAngle",value:function(t,e,n,i,r){var o=2*Math.floor(i/this.dAngle)+2;i>=2*Math.PI&&(o=this.numPoints),this.draw(t,e,n,o,r)}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI,e=2*Math.floor(t/this.dAngle)*2;return e>this.numPoints&&(e=this.numPoints),e}}])&&Qr(n.prototype,i),e}();function Jr(t,e,n,i,r,o,a,s,l,u){var c=new $r(t,e,n,i,new X(0,0),o,r,a),h=new ht;return h=l instanceof X?h.translate(l.x,l.y):l._dup(),new Ui(c,h,s,u)}function to(t){return(to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eo(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function no(t){return(no=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function io(t,e){return(io=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ro=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.05,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Math.PI/4,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==to(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,no(e).call(this,t))).innerRadius=i,n.outerRadius=r,n.dAngle=a,n.maxAngle=s;for(var l=0,u=-1,c=-1,h=[i,-o/2,r,-o/2,r,o/2,i,-o/2,r,o/2,i,o/2];l<=s;){for(var f=0;f<6;f+=1){var d=new X(h[2*f],h[2*f+1]).rotate(l);n.points[u+=1]=d.x,n.points[u+=1]=d.y}var p=[new X(n.points[u-11],n.points[u-10]),new X(n.points[u-9],n.points[u-8]),new X(n.points[u-7],n.points[u-6]),new X(n.points[u-1],n.points[u-0]),new X(n.points[u-11],n.points[u-10])];n.border[c+=1]=p,l+=a}return n.setupBuffer(),n}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&io(t,e)}(e,ce),n=e,(i=[{key:"drawToAngle",value:function(t,e,n,i,r){var o=6*Math.floor(i/this.dAngle)+6;i>=this.maxAngle&&(o=this.numPoints),this.draw(t,e,n,o,r)}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI,e=6*Math.floor(t/this.dAngle)+6;return t>=2*Math.PI&&(e=this.numPoints),e}}])&&eo(n.prototype,i),e}();function oo(t){return(oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ao(t){return(ao=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function so(t,e){return(so=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var lo=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new X(0,0),r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=0-o/2,l=[];(n=function(t,e){return!e||"object"!==oo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ao(e).call(this,t))).glPrimative=n.gl[0].TRIANGLE_STRIP,l.push(new X(0,s)),l.push(new X(0,s+o)),l.push(new X(0+r,s)),l.push(new X(0+r,s+o));var u=(new ht).rotate(a).translate(i.x,i.y),c=l.map(function(t){return t.transformBy(u.matrix())});return c.forEach(function(t){n.points.push(t.x),n.points.push(t.y)}),n.border[0]=[c[0],c[1],c[c.length-1],c[c.length-2]],n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&so(t,e)}(e,ce),e}();function uo(t){return(uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function co(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ho(t){return(ho=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fo(t,e){return(fo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var po=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new X(0,0),r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[1];!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==uo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ho(e).call(this,t))).glPrimative=n.gl[0].TRIANGLES,n.dashCumLength=[],n.maxLength=r;for(var l,u,c,h,f,d,p=[],v=0,m=new X(0,0-o/2),y=!1;v<r;)for(var g=0;g<s.length&&v<r;g+=1){var b=s[g];r<b+v&&(b=r-v),y||(u=b,c=o,h=(l=m)._dup(),f=l.add(new X(0,c)),d=l.add(new X(u,c)),[h,f,d,h,d,l.add(new X(u,0))]).forEach(function(t){p.push(t)}),v+=b,m.x+=b,y=!y,n.dashCumLength.push(v)}var w=(new ht).rotate(a).translate(i.x,i.y),x=p.map(function(t){return t.transformBy(w.matrix())});return x.forEach(function(t){n.points.push(t.x),n.points.push(t.y)}),n.border[0]=[x[0],x[1],x[x.length-2],x[x.length-1]],n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fo(t,e)}(e,ce),n=e,(i=[{key:"getPointCountForLength",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.maxLength;if(t>=this.maxLength)return this.numPoints;if(t<this.dashCumLength[0])return 0;for(var e=0;e<this.dashCumLength.length;e+=1)if(t<this.dashCumLength[e])return 6*(Math.floor((e-1)/2)+1);return this.numPoints}}])&&co(n.prototype,i),e}();function vo(t){return(vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mo(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function yo(t){return(yo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function go(t,e){return(go=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var bo=function(t){function e(t,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:20;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(r=function(t,e){return!e||"object"!==vo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,yo(e).call(this,t))).glPrimative=r.gl[0].TRIANGLE_FAN;var u=[];u.push(new X(0,0));var c=function(t,e,n,i){var r=[];if(0===t||0===e)r.push(i);else for(var o=Math.PI/2/e,a=0;a<e+1;a+=1)r.push(new X(t*Math.cos(a*o+n)+i.x,t*Math.sin(a*o+n)+i.y));return r},h=Math.min(s,o/2,a/2),f=l;return 0===f&&(h=0),u=[].concat(mo(u),mo(c(h,f,0,new X(o/2-h,a/2-h)))),u=[].concat(mo(u),mo(c(h,f,Math.PI/2,new X(-o/2+h,a/2-h)))),u=[].concat(mo(u),mo(c(h,f,Math.PI,new X(-o/2+h,-a/2+h)))),u=[].concat(mo(u),mo(c(h,f,Math.PI/2*3,new X(o/2-h,-a/2+h)))),u="top"===i?u.map(function(t){return t.add(0,-a/2)}):"bottom"===i?u.map(function(t){return t.add(0,a/2)}):"middle"===i?u.map(function(t){return t.add(0,0)}):u.map(function(t){return t.add(0,i)}),(u="left"===n?u.map(function(t){return t.add(o/2,0)}):"right"===n?u.map(function(t){return t.add(-o/2,0)}):"center"===n?u.map(function(t){return t.add(0,0)}):u.map(function(t){return t.add(n,n)})).forEach(function(t){r.points.push(t.x),r.points.push(t.y)}),r.points.push(r.points[2]),r.points.push(r.points[3]),r.border[0]=u.slice(1),r.setupBuffer(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&go(t,e)}(e,ce),e}();function wo(t){return(wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xo(t){return(xo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _o(t,e){return(_o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var To=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==wo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,xo(e).call(this,t))).glPrimative=i.gl[0].LINES,i.points=[],n.forEach(function(t){for(var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(t,2),n=e[0],o=e[1],a=new ot(n,o).angle()+Math.PI/2,s=-.003*(r-1)/2,l=0;l<r;l+=1){var u=s+.003*l;i.points.push(n.x+u*Math.cos(a)),i.points.push(n.y+u*Math.sin(a)),i.points.push(o.x+u*Math.cos(a)),i.points.push(o.y+u*Math.sin(a))}}),i.border=[],i.setupBuffer(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_o(t,e)}(e,ce),e}();function ko(t){return(ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Oo(t){return(Oo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function So(t,e){return(So=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Po=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new X(0,0),l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==ko(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Oo(e).call(this,t))).glPrimative=n.gl[0].TRIANGLE_FAN;var u=(n.height=o)-a,c=[];c.push(new X(0,0)),c.push(new X(-i/2,-u)),a&&(c.push(new X(-r/2,-u)),c.push(new X(-r/2,-o)),c.push(new X(+r/2,-o)),c.push(new X(+r/2,-u))),c.push(new X(+i/2,-u));var h=(new ht).rotate(l).translate(s);return c.map(function(t){return t.transformBy(h.matrix())}).forEach(function(t){n.points.push(t.x),n.points.push(t.y),n.border[0].push(t)}),n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&So(t,e)}(e,ce),e}();function Ao(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new X(0,0),a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[1,1,1,1],l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:new X(0,0),u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:new U(-1,-1,2,2),c=new Po(t,e,n,i,r,o,a),h=new ht;return h=l instanceof X?h.translate(l.x,l.y):l._dup(),new Ui(c,h,s,u)}function Eo(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Lo(t){return(Lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jo(t){return(jo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mo(t,e){return(Mo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ro(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Co=[.7,.7,.7,1],Fo=function t(){Ro(this,t),this.length=1,this.width=.01,this.color=Co,this.mode="on",this.offset=0},Bo=function(t){function e(){var t;return Ro(this,e),(t=function(t,e){return!e||"object"!==Lo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,jo(e).call(this))).start=0,t.step=.1,t.length=.05,t.width=.01,t.offset=0,t.labelOffset=new X(0,0),t.color=Co,t.labels=[],t.labelMode="auto",t.labelsHAlign="center",t.labelsVAlign="middle",t.mode="on",t.fontFamily="Helvetica Neue",t.fontWeight="400",t.fontSize=.1,t.fontColor=Co,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mo(t,e)}(e,Fo),e}(),Do=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Ro(this,t),this.name=e,this.start=new X(0,0),this.length=1,this.width=.01,this.rotation=n,this.color=[.5,.5,.5,1],this.title="",this.titleOffset=new X(this.length/2,-.1),this.titleRotation=0,this.limits={min:0,max:1},this.logarithmic=!1,this.majorTicks=new Bo,this.minorTicks=new Bo,this.minorTicks.labelMode="off",this.majorGrid=new Fo,this.minorGrid=new Fo,this.titleFontFamily="Helvetica Neue",this.titleFontWeight="400",this.titleFontSize=.13,this.titleFontColor=Co}var e,n;return e=t,(n=[{key:"getNum",value:function(t,e){return Math.floor((this.limits.max-t)/e)+1}},{key:"getMajorNum",value:function(){return this.getNum(this.majorTicks.start,this.majorTicks.step)}},{key:"getMinorNum",value:function(){return this.getNum(this.minorTicks.start,this.minorTicks.step)}},{key:"generateAuto",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10,e=(this.limits.max-this.limits.min)/t,n=c(Math.floor(Math.log10(e)),0);e=c(e,-n);var i=c(this.limits.min,-n);return i<this.limits.min&&(i+=Math.pow(10,n)),11<this.getNum(i,e)&&(e*=2),{start:i,step:e}}},{key:"generateAutoMajorTicks",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10,e=this.generateAuto(t),n=e.start,i=e.step;this.majorTicks.start=n,this.majorTicks.step=i}},{key:"generateAutoMinorTicks",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:50,e=this.generateAuto(t),n=e.start,i=e.step;this.minorTicks.start=n,this.minorTicks.step=i}},{key:"toClip",value:function(t){return t*(this.length/(this.limits.max-this.limits.min))}},{key:"valueToClip",value:function(t){return this.toClip(t-this.limits.min)+this.start.x}},{key:"getMajorLabels",value:function(){for(var t=[],e=0,n=this.getMajorNum();e<n;e+=1){var i=this.majorTicks.start+e*this.majorTicks.step;t.push(i.toString())}return t}},{key:"generateMajorLabels",value:function(){this.majorTicks.labels=this.getMajorLabels()}},{key:"getMinorLabels",value:function(){for(var t=[],e=0,n=this.getMinorNum();e<n;e+=1){var i=this.minorTicks.start+e*this.minorTicks.step;t.push(i.toString())}return t}},{key:"generateMinorLabels",value:function(){this.minorTicks.labels=this.getMinorLabels()}}])&&Eo(e.prototype,n),t}(),Io=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=(new ht).rotate(i).translate(t.x,t.y),o=[new X(0,0-n/2),new X(0+e,0-n/2),new X(0+e,0+n/2),new X(0,0-n/2),new X(0+e,0+n/2),new X(0,0+n/2)],a=o.map(function(t){return t.transformBy(r.matrix())}),s=[];a.map(function(t){return s.push(t.x),s.push(t.y),!0});var l=[o[0],o[1],o[2],o[5]];return{points:s,border:l}};function qo(t){return(qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ho(t){return(Ho=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function No(t,e){return(No=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var zo=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Do;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),n=function(t,e){return!e||"object"!==qo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Ho(e).call(this,t));var r=i,o=(new ht).rotate(r.rotation).translate(r.start.x,r.start.y).matrix();if(0<r.width){var a=Io(new X(0,0),r.length,r.width,0),s=a.points,l=a.border;n.points=s,n.border=[l]}return n.transform(o),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&No(t,e)}(e,ce),e}(),Go=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new X(0,0),i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.01,o=5<arguments.length&&void 0!==arguments[5]&&arguments[5],a=[],s=[],l=1;6<arguments.length&&void 0!==arguments[6]&&arguments[6]&&(l=-1);for(var u=n.y,c=0;c<t;c+=1){var h=void 0;h=o?n.x+e*Math.floor(c/10)+Math.log10(c%10)*e:n.x+e*c,h-=r/2,a.push(h,l*u),a.push(h+r,l*u),a.push(h+r,l*(u+i)),a.push(h,u),a.push(h+r,l*(u+i)),a.push(h,l*(u+i)),s.push([new X(h,l*u),new X(h+r,l*u),new X(h+r,l*(u+i)),new X(h,l*(u+i))])}return{points:a,border:s}};function Vo(t){return(Vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wo(t){return(Wo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Uo(t,e){return(Uo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Xo=function(t){function e(t,n,i,r,o,a,s,l){var u;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),u=function(t,e){return!e||"object"!==Vo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Wo(e).call(this,t));var c=(new ht).rotate(i).translate(0,0).matrix(),h=Go(r,o,new X(n.x,n.y+l),a,s,!1,!1),f=h.points,d=h.border;return u.points=f,u.border=d,u.transform(c),u.setupBuffer(),u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Uo(t,e)}(e,ce),e}();function Yo(t){return(Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qo(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zo(t){return(Zo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ko(t,e){return(Ko=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var $o=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Do,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new ht,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new U(-1,1,2,2);return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==Yo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Zo(e).call(this,o,a))).props=r,i.webgl=t,i.diagramLimits=a,i.drawContext2D=n,i.build(),i}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ko(t,e)}(e,Xi),n=e,(i=[{key:"rebuild",value:function(){this.drawOrder=[],this.build()}},{key:"build",value:function(){var t=this.props,e=t.minorTicks,n=t.majorTicks,i=t.minorGrid,r=t.majorGrid;"auto"===n.mode&&this.props.generateAutoMajorTicks(),"auto"===e.mode&&this.props.generateAutoMinorTicks();var o=2/this.diagramLimits.width,a=this.props.valueToClip(n.start),s=this.props.valueToClip(e.start),l=this.props.getMajorNum(),u=this.props.getMinorNum();this.addTicksOrGrid("minorGrid",this.webgl,i,u,e.step,s,o,this.diagramLimits),this.addTicksOrGrid("majorGrid",this.webgl,r,l,n.step,a,o,this.diagramLimits),this.addTicksOrGrid("minorTicks",this.webgl,e,u,e.step,s,o,this.diagramLimits),this.addTicksOrGrid("majorTicks",this.webgl,n,l,n.step,a,o,this.diagramLimits);var c=new zo(this.webgl,this.props);this.add("line",new Ui(c,new ht,this.props.color,this.diagramLimits));var h=new be(this.props.titleFontFamily,"normal",this.props.titleFontSize,this.props.titleFontWeight,"center","middle",this.props.titleFontColor),f=[new we(new X(0,0).transformBy((new ht).rotate(this.props.rotation).matrix()),this.props.title,h)],d=new xe(this.drawContext2D[0],f);this.add("title",new Ui(d,(new ht).rotate(this.props.rotation).translate(this.props.titleOffset.x,this.props.titleOffset.y),[.5,.5,.5,1],this.diagramLimits)),this.addTickLabels("major",this.drawContext2D[0],n,this.props.generateMajorLabels.bind(this.props),this.diagramLimits,this.props.majorTicks.labelOffset),this.addTickLabels("minor",this.drawContext2D[0],e,this.props.generateMinorLabels.bind(this.props),this.diagramLimits,this.props.minorTicks.labelOffset)}},{key:"toClip",value:function(t){return this.props.toClip(t)}},{key:"valueToClip",value:function(t){return this.props.valueToClip(t)}},{key:"addTicksOrGrid",value:function(t,e,n,i,r,o,a,s){if("off"!==n.mode){var l=new Xo(e,new X(o,this.props.start.y),this.props.rotation,i,this.toClip(r),n.length,n.width,n.offset);this.add(t,new Ui(l,(new ht).scale(1,1).rotate(0).translate(0,0),n.color,s))}}},{key:"addTickLabels",value:function(t,e,n,i,r,o){"auto"===n.labelMode&&i();var a=new be(n.fontFamily,"normal",n.fontSize,n.fontWeight,n.labelsHAlign,n.labelsVAlign,n.fontColor);this.props.rotation>Math.PI/2*.95&&(a.alignV="middle",a.alignH="right");for(var s=[],l=0;l<n.labels.length;l+=1)s.push(new we(new X(this.valueToClip(n.start+l*n.step),0).transformBy((new ht).rotate(this.props.rotation).matrix()),n.labels[l],a));var u=new xe(e,s);this.add("label_".concat(t),new Ui(u,(new ht).scale(1,1).rotate(0).translate(o.x,o.y),[.5,.5,.5,1],r))}}])&&Qo(n.prototype,i),e}();function Jo(t){return(Jo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ta(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ea(t){return(ea=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function na(t,e){return(na=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ia=function(t){function e(t,n){var i;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==Jo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ea(e).call(this,t,"withTexture","text"))).glPrimative=t[0].gl.TRIANGLE_FAN;var r=Vt({},{text:"DEFAULT_TEXT",size:"20px",family:"Helvetica",style:"normal",weight:400,alignH:"center",alignV:"alphabetic",id:Wt("vertexText")},n);return i.size=r.size,i.text=r.text,i.family=r.family,i.alignH=r.alignH,i.alignV=r.alignV,i.style=r.style,i.weight=r.weight,i.canvas=document.createElement("canvas"),i.canvas.id=r.id,i.ctx=i.canvas.getContext("2d"),i.texture={id:r.id,points:[],type:"canvasText"},i.type="vertexText",i.drawTextIntoBuffer(),i}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&na(t,e)}(e,ce),n=e,(i=[{key:"resizeText",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(1,1),n=this.canvas.width*e.x,i=this.canvas.height*e.y,r=new X(0,0);"center"===this.alignH?r.x=-n/2:"right"===this.alignH&&(r.x=-n),"baseline"===this.alignV?r.y=.25*-i:"top"===this.alignV?r.y=-i:"middle"===this.alignV&&(r.y=-i/2);var o=[r,new X(r.x,r.y+i),new X(r.x+n,r.y+i),new X(r.x+n,r.y)];this.width=n,this.height=i,this.calcAscentDescent(),this.points=[],o.forEach(function(e){t.points.push(e.x),t.points.push(e.y)}),this.border=[[new X(r.x,-this.descent),new X(r.x,this.ascent),new X(r.x+n,this.ascent),new X(r.x+n,-this.descent)]];var a=this.texture;null!=a&&(a.points=[0,0,0,1,1,1,1,0],a.data=this.ctx.canvas,a.buffer?this.resetBuffer():this.setupBuffer())}},{key:"calcAscentDescent",value:function(){var t=.75,e=0,n=this.text.match(/[,.]/g);Array.isArray(n)&&n.length===this.text.length&&(t=.1);var i=this.text.match(/[acemnorsuvwxz*gyq:><;p=]/g);Array.isArray(i)&&i.length===this.text.length&&(t=.5);var r=this.text.match(/[;,$]/g);Array.isArray(r)&&0<r.length&&(e=.1);var o=this.text.match(/[gjyqp@Q(){}[\]|]/g);Array.isArray(o)&&0<o.length&&(e=.25),this.ascent=t*this.height,this.descent=e*this.height}},{key:"drawTextIntoBuffer",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(1,1),e=20;(e="string"==typeof this.size&&this.size.endsWith("px")?parseInt(this.size,10):h(("string"==typeof this.size?parseFloat(this.size):this.size)/t.x,0))<1&&(e=1),this.ctx.font="".concat(this.style," ").concat(this.weight," ").concat(e,"px ").concat(this.family);var n=this.ctx.measureText(this.text).width+.3*e,i=1.15*e;this.canvas.width=Math.max(n,1),this.canvas.height=Math.max(i,1),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font="".concat(this.style," ").concat(this.weight," ").concat(e,"px ").concat(this.family),this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",this.ctx.fillStyle="white";var r=.3*e/2,o=.75*this.canvas.height;this.ctx.fillText(this.text,r,o),this.resizeText(t)}}])&&ta(n.prototype,i),e}();function ra(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var oa=function(){function t(e,n,i,r,o,a){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),Array.isArray(e)?this.webgl=e:this.webgl=[e],Array.isArray(n)?this.draw2D=n:this.draw2D=[n],this.htmlCanvas=i,this.limits=r,this.animateNextFrame=a,this.spaceTransforms=o}var e,n;return e=t,(n=[{key:"polyLineLegacy",value:function(t,e,n,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"never",o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new ht;return jr(this.webgl,t,e,n,i,r,o,this.limits)}},{key:"polyLineCornersLegacy",value:function(t,e,n,i,r){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new ht;return Mr(this.webgl,t,e,n,i,r,o,this.limits)}},{key:"polyLineCorners",value:function(){for(var t={color:[1,0,0,1],close:!0,width:.01,cornerLength:.1,transform:new ht("polyLineCorners").standard()},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Object.assign.apply(Object,[{},t].concat(n));if(null!=r.position){var o=kt(r.position);r.transform.updateTranslation(o)}var a=[];r.points&&(a=r.points.map(function(t){return kt(t)}));var s=Mr(this.webgl,a,r.close,r.cornerLength,r.width,r.color,r.transform,this.limits);return null!=r.mods&&r.mods!=={}&&s.setProperties(r.mods),s}},{key:"polyLine",value:function(){for(var t={color:[1,0,0,1],close:!0,width:.01,borderToPoint:"never",transform:new ht("polyLine").standard()},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Object.assign.apply(Object,[{},t].concat(n));if(null!=r.position){var o=kt(r.position);r.transform.updateTranslation(o)}var a=[];r.points&&(a=r.points.map(function(t){return kt(t)}));var s=jr(this.webgl,a,r.close,r.width,r.color,r.borderToPoint,r.transform,this.limits);return null!=r.mods&&r.mods!=={}&&s.setProperties(r.mods),s}},{key:"fan",value:function(){for(var t={points:[],color:[1,0,0,1],transform:new ht("fan").standard(),position:null},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Object.assign.apply(Object,[{},t].concat(n));if(null!=r.position){var o=kt(r.position);r.transform.updateTranslation(o)}var a=function(t,e,n,i,r){var o=new Br(t,e),a=new ht;return a=i instanceof X?a.translate(i.x,i.y):i._dup(),new Ui(o,a,n,r)}(this.webgl,r.points.map(function(t){return kt(t)}),r.color,r.transform,this.limits);return null!=r.mods&&r.mods!=={}&&a.setProperties(r.mods),a}},{key:"textGL",value:function(t){return function(t,e,n){var i=Vt({},{position:new X(0,0),color:[1,0,0,1]},n);null==i.transform&&(i.transform=new ht("Text").translate(0,0)),null!=i.position&&i.transform.updateTranslation(i.position);var r=new ia(t,i);return new Ui(r,i.transform,i.color,e)}(this.webgl,this.limits,t)}},{key:"text",value:function(t){for(var e,n={text:"",font:null,family:"Times New Roman",style:"italic",size:.2,weight:"200",hAlign:"center",vAlign:"middle",offset:new X(0,0),color:[1,0,0,1],transform:new ht("text").standard()},i=arguments.length,r=new Array(1<i?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];if(null!=(e=Vt.apply(void 0,"string"==typeof t?[{},n,{text:t}].concat(r):[{},n,t].concat(r))).position){var a=kt(e.position);e.transform.updateTranslation(a)}var s=e,l=s.text,u=s.font;null===u&&(u=new be(s.family,s.style,s.size,s.weight,s.hAlign,s.vAlign,s.color));var c=new we(s.offset,l,u),h=new xe(this.draw2D,[c]),f=new Ui(h,s.transform,s.color,this.limits);return null!=e.mods&&e.mods!=={}&&f.setProperties(e.mods),f}},{key:"arrow",value:function(){for(var t={width:.5,legWidth:0,height:.5,legHeight:0,color:[1,0,0,1],transform:new ht("arrow").standard(),tip:new X(0,0),rotation:0},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Object.assign.apply(Object,[{},t].concat(n));if(null!=r.position){var o=kt(r.position);r.transform.updateTranslation(o)}var a=new Ao(this.webgl,r.width,r.legWidth,r.height,r.legHeight,kt(r.tip),r.rotation,r.color,r.transform,this.limits);return null!=r.mods&&r.mods!=={}&&a.setProperties(r.mods),a}},{key:"htmlElement",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"id__temp_".concat(Math.round(1e4*Math.random())),n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new X(0,0),r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"middle",o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"left",a=document.createElement("div");n&&a&&n.split(" ").forEach(function(t){return a.classList.add(t.trim())}),Array.isArray(t)?t.forEach(function(t){return a.appendChild(t)}):a.appendChild(t),a.style.position="absolute",a.setAttribute("id",e),this.htmlCanvas.appendChild(a);var s=new oe(this.htmlCanvas,e,new X(0,0),r,o);return new Ui(s,(new ht).scale(1,1).translate(i.x,i.y),[1,1,1,1],this.limits)}},{key:"htmlText",value:function(){for(var t={text:"",id:Wt("id__html_text_"),classes:"",position:new X(0,0),alignV:"middle",alignH:"left"},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n)),o=document.createElement("div");gr(o,r.text,r.modifiers);var a=r.id,s=r.classes,l=r.position,u=r.alignV,c=r.alignH,h=this.htmlElement(o,a,s,kt(l),u,c);return null!=r.color&&h.setColor(r.color),h}},{key:"lines",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length?arguments[2]:void 0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new ht;return function(t,e,n,i,r,o){var a=new To(t,e,n),s=new ht;return s=r instanceof X?s.translate(r.x,r.y):r._dup(),new Ui(a,s,i,o)}(this.webgl,t,e,n,i,this.limits)}},{key:"grid",value:function(){for(var t={bounds:new U(-1,-1,2,2),xStep:.1,yStep:.1,xOffset:0,yOffset:0,numLinesThick:1,color:[1,0,0,1],position:null,transform:new ht("grid").standard()},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));if(null!=r.position){var o=kt(r.position);r.transform.updateTranslation(o)}var a=[],s=r.bounds,l=r.xStep,u=r.xOffset,h=r.yStep,f=r.yOffset,d=r.color,p=r.numLinesThick,v=r.transform;if(0!==r.xStep)for(var m=s.left+u;c(m,8)<=s.right;m+=l)a.push([new X(m,s.top),new X(m,s.bottom)]);if(0!==h)for(var y=s.bottom+f;c(y,8)<=s.top;y+=h)a.push([new X(s.left,y),new X(s.right,y)]);return this.lines(a,p,d,v)}},{key:"polygon",value:function(){for(var t={sides:4,radius:1,width:.01,rotation:0,clockwise:!1,sidesToDraw:null,color:[1,0,0,1],fill:!1,textureLocation:"",textureCoords:new U(0,0,1,1),onLoad:this.animateNextFrame,mods:{},transform:new ht("polygon").standard(),position:null,center:new X(0,0),trianglePrimitives:!1,linePrimitives:!1},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Object.assign.apply(Object,[{},t].concat(n));if(null!=r.position){var o=kt(r.position);r.transform.updateTranslation(o)}null!=r.center&&(r.center=kt(r.center)),null==r.sidesToDraw&&(r.sidesToDraw=r.sides);var a,s,l,u,c,h,f,d,p,v,m,y,g,b,w,x=1;return r.clockwise&&(x=-1),a=r.linePrimitives?Jr(this.webgl,r.sides,r.radius,r.rotation,x,r.sidesToDraw,r.width,r.color,r.transform,this.limits):r.fill?function(t,e,n,i,r,o,a,s,l){var u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:"",c=10<arguments.length&&void 0!==arguments[10]?arguments[10]:new U(0,0,1,1),h=11<arguments.length&&void 0!==arguments[11]?arguments[11]:null,f=new Xr(t,e,n,i,o,r,u,c);u&&(f.onLoad=h);var d=new ht;return d=s instanceof X?d.translate(s.x,s.y):s._dup(),new Ui(f,d,a,l)}(this.webgl,r.sides,r.radius,r.rotation,r.sidesToDraw,r.center,r.color,r.transform,this.limits,r.textureLocation,r.textureCoords,r.onLoad):(s=this.webgl,l=r.sides,u=r.radius,c=r.width,h=r.rotation,f=x,d=r.sidesToDraw,p=r.center,v=r.color,m=r.transform,y=this.limits,g=r.trianglePrimitives,b=new Nr(s,l,u,c,h,p,d,f,g),w=new ht,w=m instanceof X?w.translate(m.x,m.y):m._dup(),new Ui(b,w,v,y)),null!=r.mods&&r.mods!=={}&&a.setProperties(r.mods),a}},{key:"polygonLine",value:function(t,e,n,i,r,o,a){var s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:new ht;return Jr(this.webgl,t,e,n,i,r,o,a,s,this.limits)}},{key:"horizontalLine",value:function(t,e,n,i,r){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new ht;return function(t,e,n,i,r,o,a,s){var l=new lo(t,e,n,i,r),u=new ht;return u=a instanceof X?u.translate(a.x,a.y):a._dup(),new Ui(l,u,o,s)}(this.webgl,t,e,n,i,r,o,this.limits)}},{key:"dashedLine",value:function(){for(var t={start:[0,0],length:1,width:.01,rotation:0,dashStyle:[.1,.1],transform:new ht("dashedLine").scale(1,1).rotate(0).translate(0,0),position:null},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));return null!=r.position&&r.transform.updateTranslation(kt(r.position)),function(t,e,n,i,r,o,a,s,l){var u=new po(t,e,n,i,r,o),c=new ht;return c=s instanceof X?c.translate(s.x,s.y):s._dup(),new Ui(u,c,a,l)}(this.webgl,kt(r.start),r.length,r.width,r.rotation,r.dashStyle,r.color,r.transform,this.limits)}},{key:"rectangle",value:function(){for(var t={alignV:"middle",alignH:"center",width:1,height:1,corner:{radius:0,sides:1},fill:!1,color:[1,0,0,1],transform:(new ht).scale(1,1).rotate(0).translate(0,0),position:null},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r,o,a,s,l,u,c,h,f,d,p,v,m=Vt.apply(void 0,[{},t].concat(n));return null!=m.position&&m.transform.updateTranslation(kt(m.position)),"string"!=typeof m.reference&&(m.reference=kt(m.reference)),r=this.webgl,o=m.alignH,a=m.alignV,s=m.width,l=m.height,u=m.corner.radius,c=m.corner.sides,h=m.color,f=m.transform,d=this.limits,p=new bo(r,o,a,s,l,u,c),v=new ht,v=f instanceof X?v.translate(f.x,f.y):f._dup(),new Ui(p,v,h,d)}},{key:"radialLines",value:function(){for(var t={innerRadius:0,outerRadius:1,width:.05,dAngle:Math.PI/4,angle:2*Math.PI,transform:(new ht).standard()},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));return null!=r.position&&r.transform.updateTranslation(kt(r.position)),function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.05,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Math.PI/4,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI,a=6<arguments.length?arguments[6]:void 0,s=7<arguments.length?arguments[7]:void 0,l=8<arguments.length?arguments[8]:void 0,u=new ro(t,e,n,i,r,o),c=new ht;return c=s instanceof X?c.translate(s.x,s.y):s._dup(),new Ui(u,c,a,l)}(this.webgl,r.innerRadius,r.outerRadius,r.width,r.dAngle,r.angle,r.color,r.transform,this.limits)}},{key:"repeatPatternVertex",value:function(){for(var t={element:null,xNum:2,yNum:2,xStep:1,yStep:1,transform:new ht("repeatPattern").standard()},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));null!=r.position&&r.transform.updateTranslation(kt(r.position));var o=r.element,a=r.transform,s=r.xNum,l=r.yNum,u=r.xStep,c=r.yStep;if(null==o)return this.collection();var h=o._dup(),f=o.drawingObject;if(f instanceof ce){h.transform=a._dup();for(var d=[],p=f.points,v=0;v<s;v+=1)for(var m=0;m<l;m+=1)for(var y=0;y<p.length;y+=2)d.push(new X(p[y]+v*u,p[y+1]+m*c));h.drawingObject.changeVertices(d)}return h}},{key:"collection",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=new ht("collection").scale(1,1).rotate(0).translate(0,0);if(t instanceof X)e.updateTranslation(t);else if(t instanceof ht)e=t._dup();else{for(var n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=Vt.apply(void 0,[t].concat(i));null!=o.transform&&(e=o.transform),null!=o.position&&e.updateTranslation(kt(o.position))}return new Xi(e,this.limits)}},{key:"repeatPattern",value:function(t,e,n,i,r){var o,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new ht;o=a instanceof ht?this.collection({transform:a}):this.collection({transform:(new ht).translate(a)});var s=t.transform.t(),l=t.transform._dup();if(null===s&&(s=new X(0,0),l=l.translate(0,0)),s)for(var u=0;u<e;u+=1)for(var c=0;c<n;c+=1){var h=t._dup();h.transform=l._dup(),h.transform.updateTranslation(s.x+i*u,s.y+r*c),o.add("xy".concat(u).concat(c),h)}return o}},{key:"repeatPatternVertexLegacy",value:function(t,e,n,i,r){var o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new ht,a=t._dup(),s=t.drawingObject;if(s instanceof ce){a.transform=o._dup();for(var l=[],u=s.points,c=0;c<e;c+=1)for(var h=0;h<n;h+=1)for(var f=0;f<u.length;f+=2)l.push(new X(u[f]+c*i,u[f+1]+h*r));a.drawingObject.changeVertices(l)}return a}},{key:"axes",value:function(){for(var t={width:1,height:1,limits:new U(-1,-1,2,2),yAxisLocation:0,xAxisLocation:0,stepX:.1,stepY:.1,fontSize:.13,showGrid:!0,color:[1,1,1,0],location:new ht,decimalPlaces:1,lineWidth:.01},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Vt.apply(void 0,[{},t].concat(n));null==r.fontColor&&(r.fontColor=r.color.slice()),null==r.gridColor&&(r.gridColor=r.color.slice());var o=r.width,a=r.lineWidth,s=r.limits,l=r.color,u=r.stepX,h=r.decimalPlaces,f=r.yAxisLocation,d=r.xAxisLocation,p=r.fontSize,v=r.height,m=r.stepY,y=r.location,g=r.showGrid,b=r.gridColor,x=r.fontColor,_=new Do("x",0);_.minorTicks.mode="off",_.minorGrid.mode="off",_.majorGrid.mode="off",_.length=o,_.width=a,_.limits={min:s.left,max:s.right},_.color=l.slice(),_.title="",_.majorTicks.start=s.left,_.majorTicks.step=u,_.majorTicks.length=5*a,_.majorTicks.offset=-_.majorTicks.length/2,_.majorTicks.width=2*a,_.majorTicks.labelMode="off",_.majorTicks.color=l.slice(),_.majorTicks.labels=w(_.limits.min,_.limits.max,u).map(function(t){return t.toFixed(h)}).map(function(t){return t===f.toString()&&f===d?"".concat(t,"     "):t}),_.majorTicks.labelOffset=new X(0,_.majorTicks.offset-.1*p),_.majorTicks.labelsHAlign="center",_.majorTicks.labelsVAlign="top",_.majorTicks.fontColor=x.slice(),_.majorTicks.fontSize=p,_.majorTicks.fontWeight="400";var T=new $o(this.webgl,this.draw2D,_,(new ht).scale(1,1).rotate(0).translate(0,d-s.bottom*v/2),this.limits),k=new Do("x",0);k.minorTicks.mode="off",k.minorGrid.mode="off",k.majorGrid.mode="off",k.length=v,k.width=_.width,k.limits={min:s.bottom,max:s.top},k.color=_.color,k.title="",k.rotation=Math.PI/2,k.majorTicks.step=m,k.majorTicks.start=s.bottom,k.majorTicks.length=_.majorTicks.length,k.majorTicks.offset=-k.majorTicks.length/2,k.majorTicks.width=_.majorTicks.width,k.majorTicks.labelMode="off",k.majorTicks.color=l.slice(),k.majorTicks.labels=w(k.limits.min,k.limits.max,m).map(function(t){return t.toFixed(h)}).map(function(t){return t===d.toString()&&f===d?"":t}),k.majorTicks.labelOffset=new X(k.majorTicks.offset-.2*p,0),k.majorTicks.labelsHAlign="right",k.majorTicks.labelsVAlign="middle",k.majorTicks.fontColor=_.majorTicks.fontColor,k.majorTicks.fontSize=p,k.majorTicks.fontWeight=_.majorTicks.fontWeight;var O=new $o(this.webgl,this.draw2D,k,(new ht).scale(1,1).rotate(0).translate(f-s.left*o/2,0),this.limits),S=new ht;S=y instanceof X?S.translate(y.x,y.y):y._dup();var P=this.collection(S);if(g){var A=this.grid({bounds:new U(0,0,o,v),stepX:c(u*o/s.width,8),stepY:c(m*v/s.height,8),numThickLines:1,color:b,transform:(new ht).scale(1,1).rotate(0).translate(0,0)});P.add("grid",A)}return P.add("y",O),P.add("x",T),P}}])&&ra(e.prototype,n),t}();function aa(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function sa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function la(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ua(t,e,n){return e&&la(t.prototype,e),n&&la(t,n),t}var ca=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.03,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;sa(this,t),this.width=e,this.ascent=n,this.descent=i,this.height=this.ascent+this.descent}return ua(t,[{key:"_dup",value:function(){return new t(this.width,this.ascent,this.descent)}}]),t}(),ha=function(){function t(e){sa(this,t),this.content=e,this.ascent=0,this.descent=0,this.width=0,this.location=new X(0,0),this.height=0}return ua(t,[{key:"calcSize",value:function(t,e){var n=this.content;if(n instanceof ca&&(this.width=n.width*e,this.height=n.height*e,this.ascent=n.ascent*e,this.descent=n.descent*e,this.location=t._dup(),this.scale=e),n instanceof Xi||n instanceof Ui){n.transform.updateTranslation(t.x,t.y),n.transform.updateScale(e,e),n.updateLastDrawTransform();var i=n.getRelativeVertexSpaceBoundingRect();this.location=t._dup(),this.scale=e,this.ascent=i.top*e,this.descent=-i.bottom*e,this.height=i.height*e,this.width=i.width*e}}},{key:"_dup",value:function(e){var n;return(n=this.content instanceof ca?new t(this.content):new t(e?e[this.content.name]:this.content)).ascent=this.ascent,n.descent=this.descent,n.width=this.width,n.location=this.location._dup(),n.height=this.height,n.scale=this.scale,n}},{key:"getAllElements",value:function(){return this.content instanceof ca?[]:[this.content]}},{key:"setPositions",value:function(){var t=this.content;(t instanceof Xi||t instanceof Ui)&&(t.transform.updateTranslation(this.location.x,this.location.y),t.transform.updateScale(this.scale,this.scale),t.updateLastDrawTransform())}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0);this.location=this.location.add(t)}}]),t}(),fa=function(){function t(e){sa(this,t);var n=[];e.forEach(function(t){null!==t&&n.push(t)}),this.content=n,this.ascent=0,this.descent=0,this.width=0,this.location=new X(0,0),this.height=0}return ua(t,[{key:"_dup",value:function(e){var n=[];this.content.forEach(function(t){return n.push(t._dup(e))});var i=new t(n);return Gt(this,i,["content"]),i}},{key:"calcSize",value:function(t,e){var n=0,i=0,r=t._dup();this.content.forEach(function(t){t.calcSize(r,e),r.x+=t.width,t.descent>n&&(n=t.descent),t.ascent>i&&(i=t.ascent)}),this.width=r.x-t.x,this.ascent=i,this.descent=n,this.location=t._dup(),this.height=this.descent+this.ascent}},{key:"getAllElements",value:function(){var t=[];return this.content.forEach(function(e){t=[].concat(aa(t),aa(e.getAllElements()))}),t}},{key:"setPositions",value:function(){this.content.forEach(function(t){t.setPositions()})}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0);this.location=this.location.add(t),this.content.forEach(function(e){e.offsetLocation(t)})}}]),t}();function da(t){return(da="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pa(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function va(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ma(t,e){return!e||"object"!==da(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ya(t){return(ya=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ga(t,e){return(ga=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ba=function(t){function e(t,n,i){var r;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(r=ma(this,i?ya(e).call(this,[t,n,new ha(i)]):ya(e).call(this,[t,n]))).vinculum=i,r.numerator=t,r.denominator=n,r.vSpaceNum=0,r.vSpaceDenom=0,r.lineVAboveBaseline=0,r.lineWidth=0,r.scaleModifier=1,r.vinculumPosition=new X(0,0),r.vinculumScale=new X(1,.01),ma(r)}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ga(t,e)}(e,fa),n=e,(i=[{key:"_dup",value:function(t){var n=this.vinculum;null!=this.vinculum&&t&&(n=t[this.vinculum.name]);var i=new e(this.numerator._dup(t),this.denominator._dup(t),n);return Gt(this,i,["numerator","denominator","vinculum","content"]),i}},{key:"calcSize",value:function(t,e){var n=e*this.scaleModifier;this.location=t._dup(),this.numerator.calcSize(t,n),this.denominator.calcSize(t,n),this.width=1.3*Math.max(this.numerator.width,this.denominator.width);var i=(this.width-this.numerator.width)/2,r=(this.width-this.denominator.width)/2;this.vSpaceNum=.05*n,this.vSpaceDenom=.05*n,this.lineVAboveBaseline=.07*n/this.scaleModifier,this.lineWidth=Math.max(.01*n,.008);var o=this.numerator.descent+this.vSpaceNum+this.lineVAboveBaseline,a=this.denominator.ascent+this.vSpaceDenom-this.lineVAboveBaseline,s=this.location;this.numerator.calcSize(new X(s.x+i,s.y+1*o),n),this.denominator.calcSize(new X(s.x+r,s.y-1*a),n),this.descent=this.vSpaceNum+this.lineWidth/2-this.lineVAboveBaseline+this.denominator.ascent+this.denominator.descent,this.descent<0&&(this.descent=0),this.ascent=this.vSpaceNum+this.lineWidth/2+this.lineVAboveBaseline+this.numerator.ascent+this.numerator.descent,this.height=this.descent+this.ascent;var l=this.vinculum;l&&(this.vinculumPosition=new X(this.location.x,this.location.y+this.lineVAboveBaseline),this.vinculumScale=new X(this.width,this.lineWidth),l.transform.updateScale(this.vinculumScale),l.transform.updateTranslation(this.vinculumPosition),l.show())}},{key:"getAllElements",value:function(){var t=[];return this.numerator&&(t=[].concat(pa(t),pa(this.numerator.getAllElements()))),this.denominator&&(t=[].concat(pa(t),pa(this.denominator.getAllElements()))),this.vinculum&&(t=[].concat(pa(t),[this.vinculum])),t}},{key:"setPositions",value:function(){this.numerator.setPositions(),this.denominator.setPositions();var t=this.vinculum;t&&(t.transform.updateScale(this.vinculumScale),t.transform.updateTranslation(this.vinculumPosition))}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0);this.location=this.location.add(t),this.numerator.offsetLocation(t),this.denominator.offsetLocation(t),this.vinculumPosition=this.vinculumPosition.add(t)}}])&&va(n.prototype,i),e}();function wa(t){return(wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xa(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ta(t,e){return!e||"object"!==wa(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ka(t){return(ka=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Oa(t,e){return(Oa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Sa=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=Ta(this,n?ka(e).call(this,[t,new ha(n)]):ka(e).call(this,[t]))).strike=n,i.scaleModifier=1,i.lineWidth=.1,i.mainContent=t,i.strikeInSize=null!=r&&r,i.space=null==o?0:o,Ta(i)}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Oa(t,e)}(e,fa),n=e,(i=[{key:"_dup",value:function(t){var n;n=null!=this.strike&&t?t[this.strike.name]:this.strike;var i=new e(this.mainContent._dup(t),n);return Gt(this,i,["strike","mainContent"]),i}},{key:"calcSize",value:function(t,e){var n=e*this.scaleModifier;this.location=t._dup(),this.mainContent.calcSize(t,n),this.lineWidth=.02*n;var i=1*this.lineWidth,r=new X(t.x,t.y-this.mainContent.descent),o=new X(t.x+this.mainContent.width,t.y+.8*this.mainContent.ascent),a=new ot(r,o),s=new ot(r,i,a.angle()+Math.PI).getPoint(2),l=a.length()+2*i;if(this.strikeInSize){var u=new ot(o,i,a.angle()).getPoint(2);this.width=u.x-s.x,this.ascent=Math.max(this.mainContent.ascent,u.y-t.y)+this.space,this.descent=Math.max(this.mainContent.descent,t.y-s.y)+this.space;var c=this.mainContent.location.x-s.x;this.mainContent.offsetLocation(new X(c,0)),s.x+=c}else this.width=this.mainContent.width,this.ascent=this.mainContent.ascent+this.space,this.descent=this.mainContent.descent+this.space;this.height=this.descent+this.ascent;var h=this.strike;if(h)if(h instanceof Xi){this.strikePosition=s._dup(),this.strikeScale=new X(l,.8*this.lineWidth),this.strikeRotation=a.angle();var f=this.strikeScale.x*Math.cos(this.strikeRotation);h._s1.transform.updateScale(this.strikeScale),h._s1.transform.updateTranslation(this.strikePosition),h._s1.transform.updateRotation(this.strikeRotation),h._s2.transform.updateScale(this.strikeScale),h._s2.transform.updateTranslation(this.strikePosition.add(f,0)),h._s2.transform.updateRotation(Math.PI-this.strikeRotation),h.showAll()}else this.strikePosition=s._dup(),this.strikeScale=new X(l,this.lineWidth),this.strikeRotation=a.angle(),h.transform.updateScale(this.strikeScale),h.transform.updateTranslation(this.strikePosition),h.transform.updateRotation(this.strikeRotation),h.show()}},{key:"getAllElements",value:function(){var t=[];return this.mainContent&&(t=[].concat(xa(t),xa(this.mainContent.getAllElements()))),this.strike&&(t=[].concat(xa(t),[this.strike])),t}},{key:"setPositions",value:function(){this.mainContent.setPositions();var t=this.strike;if(t)if(t instanceof Xi){var e=this.strikeScale.x*Math.cos(this.strikeRotation);t._s1.transform.updateScale(this.strikeScale),t._s1.transform.updateTranslation(this.strikePosition),t._s1.transform.updateRotation(this.strikeRotation),t._s2.transform.updateScale(this.strikeScale),t._s2.transform.updateTranslation(this.strikePosition.add(e,0)),t._s2.transform.updateRotation(Math.PI-this.strikeRotation)}else t.transform.updateScale(this.strikeScale),t.transform.updateTranslation(this.strikePosition),t.transform.updateRotation(this.strikeRotation)}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0);this.location=this.location.add(t),this.mainContent.offsetLocation(t),this.strikePosition=this.strikePosition.add(t)}}])&&_a(n.prototype,i),e}();function Pa(t){return(Pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Aa(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ea(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function La(t){return(La=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ja(t,e){return(ja=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ma=function(t){function e(t,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(r=function(t,e){return!e||"object"!==Pa(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,La(e).call(this,[t,n,i]))).superscript=n,r.subscript=i,r.mainContent=t,r.scriptScale=null==o?.5:o,r.superBias=null==a?new X(0,0):a,r.subBias=null==s?new X(0,0):s,r}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ja(t,e)}(e,fa),n=e,(i=[{key:"_dup",value:function(t){var n=null==this.superscript?null:this.superscript._dup(t),i=null==this.subscript?null:this.subscript._dup(t),r=new e(this.mainContent._dup(t),n,i,this.scriptScale,this.superBias,this.subBias);return Gt(this,r,["mainContent","superscript","subscript","content"]),r}},{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup();this.mainContent.calcSize(n,e);var i=this.mainContent.width,r=this.mainContent.ascent,o=this.mainContent.descent,a=this.superscript;if(null!==a){var s=new X(this.location.x+this.mainContent.width+this.superBias.x,this.location.y+.7*this.mainContent.ascent+this.superBias.y);a.calcSize(s,this.scriptScale*e),i=Math.max(i,s.x-this.location.x+a.width),r=Math.max(r,a.ascent+s.y-this.location.y),o=Math.max(o,this.location.y-(s.y-a.descent))}var l=this.subscript;if(null!==l){l.calcSize(new X(0,0),this.scriptScale*e);var u=new X(this.location.x+this.mainContent.width+this.subBias.x,this.location.y-.7*l.ascent+this.subBias.y);l.calcSize(u,this.scriptScale*e),i=Math.max(i,u.x-this.location.x+l.width),r=Math.max(r,l.ascent+u.y-this.location.y),o=Math.max(o,l.descent+(this.location.y-u.y))}this.width=i,this.ascent=r,this.descent=o,this.height=this.descent+this.ascent}},{key:"getAllElements",value:function(){var t=[];return this.superscript&&(t=[].concat(Aa(t),Aa(this.superscript.getAllElements()))),this.subscript&&(t=[].concat(Aa(t),Aa(this.subscript.getAllElements()))),this.mainContent&&(t=[].concat(Aa(t),Aa(this.mainContent.getAllElements()))),t}},{key:"setPositions",value:function(){this.mainContent.setPositions(),this.superscript&&this.superscript.setPositions(),this.subscript&&this.subscript.setPositions()}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0);this.location=this.location.add(t),this.mainContent.offsetLocation(t),this.superscript&&this.superscript.offsetLocation(t),this.subscript&&this.subscript.offsetLocation(t)}}])&&Ea(n.prototype,i),e}(),Ra=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.width=0,this.height=0,this.ascent=0,this.descent=0};function Ca(t){return(Ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fa(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ba(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Da(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ia(t,e,n){return e&&Da(t.prototype,e),n&&Da(t,n),t}function qa(t,e){return!e||"object"!==Ca(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Ha(t){return(Ha=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Na(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}var za=function(t){function e(t,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.03,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.05,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1.2;Ba(this,e);var u=null!==n?new ha(n):null,c=null!==i?new ha(i):null;return(r=qa(this,Ha(e).call(this,[u,t,c]))).glyph=n,r.rightGlyph=i,r.mainContent=t,r.glyphLocation=new X(0,0),r.rightGlyphLocation=new X(0,0),r.glyphScale=1,r.insideSpace=o,r.outsideSpace=a,r.minLineHeight=s,r.heightScale=l,r}return Na(e,fa),Ia(e,[{key:"_dup",value:function(t){var n=null==this.mainContent?null:this.mainContent._dup(t),i=this.glyph;null!=this.glyph&&t&&(i=t[this.glyph.name]);var r=this.rightGlyph;null!=this.rightGlyph&&t&&(r=t[this.rightGlyph.name]);var o=new e(n,i,r,this.insideSpace,this.outsideSpace);return Gt(this,o,["content","glyph","rightGlyph"]),o}},{key:"getAllElements",value:function(){var t=[];return this.mainContent&&(t=[].concat(Fa(t),Fa(this.mainContent.getAllElements()))),this.glyph&&(t=[].concat(Fa(t),[this.glyph])),this.rightGlyph&&(t=[].concat(Fa(t),[this.rightGlyph])),t}},{key:"setPositions",value:function(){var t=this.glyph,e=this.rightGlyph;null!=t&&(t.transform.updateScale(this.glyphScale,this.glyphScale),t.transform.updateTranslation(this.glyphLocation.x,this.glyphLocation.y)),null!=e&&(e.transform.updateScale(this.glyphScale,this.glyphScale),e.transform.updateTranslation(this.rightGlyphLocation.x,this.rightGlyphLocation.y)),this.mainContent&&this.mainContent.setPositions()}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0);this.location=this.location.add(t);var e=this.glyph,n=this.rightGlyph;null!=e&&(this.glyphLocation=this.glyphLocation.add(t)),null!=n&&(this.rightGlyphLocation=this.rightGlyphLocation.add(t)),this.mainContent&&this.mainContent.offsetLocation(t)}},{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),i=new Ra,r=new Ra,o=new Ra,a=this.mainContent;a instanceof fa&&(a.calcSize(n._dup(),e),i.width=a.width,i.height=a.ascent+a.descent,i.ascent=a.ascent,i.descent=a.descent);var s=this.minLineHeight;null!=s&&(s.calcSize(n._dup(),e),i.height=Math.max(s.height,i.height),i.descent=Math.max(s.descent,i.descent));var l=this.heightScale,u=i.height*l,c=i.descent+i.height*(l-1)/2,h=new X(n.x+this.outsideSpace*e,n.y-c),f=this.glyph;if(f instanceof Ui){f.show(),f.transform.updateScale(u,u),f.transform.updateTranslation(h.x,h.y),this.glyphLocation=h,this.glyphScale=u;var d=f.drawingObject.getRelativeVertexSpaceBoundingRect();r.width=d.width*u,r.height=(-d.bottom+d.top)*u,r.ascent=d.top*u,r.descent=-d.bottom*u}var p=new X(n.x+i.width+r.width+(2*this.insideSpace+this.outsideSpace)*e,h.y),v=this.rightGlyph;if(v instanceof Ui){v.show(),v.transform.updateScale(u,u),v.transform.updateTranslation(p.x,p.y),this.rightGlyphLocation=p;var m=v.drawingObject.getRelativeVertexSpaceBoundingRect();o.width=m.width*u,o.height=(-m.bottom+m.top)*u,o.ascent=m.top*u,o.descent=-m.bottom*u}var y=new X(this.location.x+r.width+(this.insideSpace+this.outsideSpace)*e,this.location.y);a instanceof fa&&a.offsetLocation(y.sub(a.location)),this.width=r.width+i.width+o.width+this.insideSpace*e*2+this.outsideSpace*e*2,this.ascent=r.height-c,this.descent=c,this.height=this.descent+this.ascent}}]),e}(),Ga=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.03,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.03,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"top";return Ba(this,e),(i=qa(this,Ha(e).call(this,t,n,null,r,o))).barPosition=a,i}return Na(e,za),Ia(e,[{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),i=new Ra,r=new Ra,o=this.mainContent;o instanceof fa&&(o.calcSize(n._dup(),e),i.width=o.width,i.height=o.ascent+o.descent,i.ascent=o.ascent,i.descent=o.descent);var a=1*i.width,s=a,l=new X(n.x-0*a/2,n.y+i.ascent+this.insideSpace*e);"bottom"===this.barPosition&&(l.y=n.y-i.descent-this.insideSpace*e);var u=this.glyph;if(u instanceof Ui){u.show(),u.transform.updateScale(s,s),u.transform.updateTranslation(l.x,l.y),this.glyphLocation=l,this.glyphScale=s;var c=u.drawingObject.getRelativeVertexSpaceBoundingRect();r.width=c.width*s,r.height=(-c.bottom+c.top)*s,r.ascent=c.top*s,r.descent=-c.bottom*s}this.width=i.width,"top"===this.barPosition?(this.ascent=i.ascent+r.height+this.insideSpace*e+this.outsideSpace*e,this.descent=i.descent):(this.ascent=i.ascent,this.descent=i.descent+r.height+this.insideSpace*e+this.outsideSpace*e),this.height=this.descent+this.ascent}},{key:"_dup",value:function(t){var n=null==this.mainContent?null:this.mainContent._dup(t),i=this.glyph;null!=this.glyph&&t&&(i=t[this.glyph.name]);var r=new e(n,i,this.insideSpace,this.outsideSpace,this.barPosition);return Gt(this,r,["content","glyph"]),r}}]),e}();function Va(t){return(Va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wa(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ua(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Xa(t,e){return!e||"object"!==Va(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Ya(t){return(Ya=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qa(t,e){return(Qa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Za(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Ka=function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"right",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"top",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"left",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"bottom",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.5;Za(this,t),this.content=e,this.xPosition=null==n?"right":n,this.yPosition=null==i?"top":i,this.xAlign=null==r?"left":r,this.yAlign=null==o?"bottom":o,this.annotationScale=null==a?.5:a},$a=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"right",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"top",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"left",s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"bottom",l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:.5,u=7<arguments.length&&void 0!==arguments[7]&&arguments[7];if(Za(this,e),Array.isArray(n)){var c=[t];n.forEach(function(t){c.push(t.content)}),i=Xa(this,Ya(e).call(this,c))}else i=Xa(this,Ya(e).call(this,[t,n]));if(i.mainContent=t,i.annotations=[],Array.isArray(n))i.annotations=n,i.annotationInSize="boolean"==typeof r&&r;else{var h="right";"boolean"!=typeof r&&(h=r),i.annotations=[new Ka(n,h,o,a,s,l)],i.annotationInSize=u}return Xa(i)}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qa(t,e)}(e,fa),n=e,(i=[{key:"_dup",value:function(t){var n=this.annotations.map(function(e){return new Ka(e.content._dup(t),e.xPosition,e.yPosition,e.xAlign,e.yAlign,e.annotationScale)}),i=new e(this.mainContent._dup(t),n,this.annotationInSize);return Gt(this,i,["mainContent","annotations"]),i}},{key:"calcSize",value:function(t,e){var n=this;this.location=t._dup(),this.mainContent.calcSize(t,e);var i=this.mainContent.location.x,r=this.mainContent.location.y-this.mainContent.descent,o=this.mainContent.location.x+this.mainContent.width,a=this.mainContent.location.y+this.mainContent.ascent;if(this.annotations.forEach(function(s){var l=s.content,u=s.xPosition,c=s.yPosition,h=s.xAlign,f=s.yAlign,d=s.annotationScale;l.calcSize(t,e*d);var p=n.location._dup(),v=0,m=n.mainContent.descent/n.mainContent.height;"right"===u?v=1:"center"===u?v=.5:"number"==typeof u&&(v=u),p.x+=n.mainContent.width*v,"bottom"===c?m=0:"top"===c?m=1:"middle"===c?m=.5:"number"==typeof c&&(m=c),p.y+=-n.mainContent.descent+n.mainContent.height*m;var y=0,g=l.descent/l.height;"right"===h?y=1:"center"===h?y=.5:"number"==typeof h&&(y=h),"bottom"===f?g=0:"top"===f?g=1:"middle"===f?g=.5:"number"==typeof f&&(g=f);var b=new X(-y*l.width,l.descent-g*l.height);l.calcSize(p,e*d),l.offsetLocation(b);var w=l.location.x+l.width,x=l.location.y+l.ascent,_=l.location.x,T=l.location.y-l.descent;o=o<w?w:o,a=a<x?x:a,i=_<i?_:i,r=T<r?T:r}),this.annotationInSize){var s=new X(i,r),l=new X(o,a);this.width=l.x-s.x,this.ascent=l.y-this.mainContent.location.y,this.descent=this.mainContent.location.y-s.y;var u=this.mainContent.location.x-s.x;u&&(this.mainContent.offsetLocation(new X(u,0)),this.annotations.forEach(function(t){return t.content.offsetLocation(new X(u,0))}))}else this.width=this.mainContent.width,this.ascent=this.mainContent.ascent,this.descent=this.mainContent.descent;this.height=this.descent+this.ascent}},{key:"getAllElements",value:function(){var t=[];return this.mainContent&&(t=[].concat(Wa(t),Wa(this.mainContent.getAllElements()))),this.annotations.forEach(function(e){t=[].concat(Wa(t),Wa(e.content.getAllElements()))}),t}},{key:"setPositions",value:function(){this.mainContent.setPositions(),this.annotations.forEach(function(t){t.content.setPositions()})}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0);this.location=this.location.add(t),this.mainContent.offsetLocation(t),this.annotations.forEach(function(e){e.content.offsetLocation(t)})}}])&&Ua(n.prototype,i),e}();function Ja(t){return(Ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ts(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function es(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ns(t){return(ns=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function is(t,e){return(is=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var rs=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==Ja(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ns(e).call(this,[t]))).left=null==a?0:a,n.right=null==r?0:r,n.top=null==i?0:i,n.bottom=null==o?0:o,n.mainContent=t,n}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&is(t,e)}(e,fa),n=e,(i=[{key:"_dup",value:function(t){var n=new e(this.mainContent._dup(t),this.top,this.right,this.bottom,this.left);return Gt(this,n,["mainContent"]),n}},{key:"calcSize",value:function(t,e){this.location=t._dup(),this.mainContent.calcSize(t.add(this.left,0),e),this.descent=this.mainContent.descent+this.bottom,this.ascent=this.mainContent.ascent+this.top,this.width=this.mainContent.width+this.left+this.right}},{key:"getAllElements",value:function(){var t=[];return this.mainContent&&(t=[].concat(ts(t),ts(this.mainContent.getAllElements()))),t}},{key:"setPositions",value:function(){this.mainContent.setPositions()}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new X(0,0);this.location=this.location.add(t),this.mainContent.offsetLocation(t)}}])&&es(n.prototype,i),e}();function os(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function as(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ss(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ls(t,e){return"string"!=typeof e?e:t instanceof Xi?t&&"_".concat(e)in t?t["_".concat(e)]:null:t&&e in t?t[e]:null}var us=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.elements=e,this.phrases={},this.fullLineHeight=null}var e,n;return e=t,(n=[{key:"stringToElement",value:function(t){if(t.startsWith("space")){var e=parseFloat(t.replace(/space[_]*/,""))||.03;return new ha(new ca(e))}if(t.startsWith(" ")){var n=.03*t.length;return new ha(new ca(n))}var i=ls(this.elements,t);return i?new ha(i):t in this.phrases?this.parseContent(this.phrases[t]):null}},{key:"parseContent",value:function(t){var e=this;if(null==t)return null;if("number"==typeof t)return null;if(t instanceof fa)return t;if("string"==typeof t)return this.stringToElement(t);if(Array.isArray(t)){var n=[];return t.forEach(function(t){var i=e.parseContent(t);Array.isArray(i)?n=[].concat(as(n),as(i)):n.push(i)}),n}var i=os(Object.entries(t)[0],2),r=i[0],o=i[1];return this.eqnMethod(r,o)}},{key:"contentToElement",value:function(t){if(t instanceof fa)return t._dup();if(t instanceof Xi||t instanceof Ui)return new fa([new ha(t)]);var e=this.parseContent(t);return Array.isArray(e)||(e=[e]),new fa(e)}},{key:"eqnMethod",value:function(t,e){return"frac"===t?this.frac(e):"strike"===t?this.strike(e):"brac"===t?this.brac(e):"sub"===t?this.sub(e):"sup"===t?this.sup(e):"supSub"===t?this.supSub(e):"topBar"===t?this.topBar(e):"bottomBar"===t?this.bottomBar(e):"annotate"===t?this.annotate(e):"annotation"===t?this.annotation(e):"bottomComment"===t?this.bottomComment(e):"topComment"===t?this.topComment(e):"topStrike"===t?this.topStrike(e):"bottomStrike"===t?this.bottomStrike(e):"pad"===t?this.pad(e):null}},{key:"frac",value:function(t){var e,n,i,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(null!=o||null!=a||null!=s)e=t,n=o,i=a,r=s;else if(Array.isArray(t)){var l=os(t,4);e=l[0],n=l[1],i=l[2],r=l[3]}else e=t.numerator,n=t.denominator,i=t.symbol,r=t.scale;var u=new ba(this.contentToElement(e),this.contentToElement(n),ls(this.elements,i));return null!=r&&(u.scaleModifier=r),u}},{key:"supSub",value:function(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,s=null,l=null,u=null,c=null,h=null;if(null!=n||null!=i||null!=r)e=t,s=n,l=i,u=r,c=a,h=o;else if(Array.isArray(t)){var f=os(t,6);e=f[0],s=f[1],l=f[2],u=f[3],h=f[4],c=f[5]}else e=t.content,s=t.superscript,l=t.subscript,u=t.scale,h=t.superscriptBias,c=t.subscriptBias;return c=null==c?null:Tt(c,new X(0,0)),h=null==h?null:Tt(h,new X(0,0)),new Ma(this.contentToElement(e),this.contentToElement(s),this.contentToElement(l),u,h,c)}},{key:"sup",value:function(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=null,a=null,s=null;if(null!=n||null!=i||null!=r)e=t,o=n,a=i,s=r;else if(Array.isArray(t)){var l=os(t,4);e=l[0],o=l[1],a=l[2],s=l[3]}else e=t.content,o=t.superscript,a=t.scale,s=t.superscriptBias;return s=null==s?null:Tt(s,new X(0,0)),new Ma(this.contentToElement(e),this.contentToElement(o),null,a,s,null)}},{key:"sub",value:function(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=null,a=null,s=null;if(null!=n||null!=i||null!=r)e=t,o=n,a=i,s=r;else if(Array.isArray(t)){var l=os(t,4);e=l[0],o=l[1],a=l[2],s=l[3]}else e=t.content,o=t.subscript,a=t.scale,s=t.subscriptBias;return s=null==s?null:Tt(s,new X(0,0)),new Ma(this.contentToElement(e),null,this.contentToElement(o),a,null,s)}},{key:"strike",value:function(t){var e,n,i,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(null!=r||null!=o)e=t,n=r,i=o;else if(Array.isArray(t)){var a=os(t,3);e=a[0],n=a[1],i=a[2]}else e=t.content,n=t.symbol,i=t.strikeInSize;return new Sa(this.contentToElement(e),ls(this.elements,n),i)}},{key:"annotate",value:function(t){var e,n,i,r,o=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(null!=a||null!=s)e=t,n=a,i=s;else if(Array.isArray(t)){var l=os(t,3);e=l[0],n=l[1],i=l[2]}else e=t.content,n=t.withAnnotations,i=t.includeAnnotationInSize;if(Array.isArray(n))null===(r=n.map(function(t){if(t instanceof Ka)return t;var e=o.parseContent(t);if(e instanceof Ka)return e;if(Array.isArray(t)){var n=o.annotation(t);if(n instanceof Ka)return n}return null}))[0]&&(r=[this.annotation(n)]);else if(null!=n)if(n instanceof Ka)r=[n];else{var u=this.parseContent(n);r=u instanceof Ka?[u]:[this.annotation(n)]}var c=!0;return null!=i&&(c=i),new $a(this.contentToElement(e),r,c)}},{key:"annotation",value:function(t){var e,n,i,r,o,a,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,u=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,c=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;if(null!=s||null!=l||null!=u||null!=c||null!=h)e=t,n=s,i=l,r=u,o=c,a=h;else if(Array.isArray(t)){var f=os(t,6);e=f[0],n=f[1],i=f[2],r=f[3],o=f[4],a=f[5]}else{var d,p;e=t.annotation,d=t.relativeToContent,p=t.relativeToAnnotation,a=t.scale;var v=os(d,2);n=v[0],i=v[1];var m=os(p,2);r=m[0],o=m[1]}var y=.6;return null!=a&&(y=a),new Ka(this.contentToElement(e),n,i,r,o,y)}},{key:"pad",value:function(t){var e,n,i,r,o,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,u=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if(null!=a||null!=s||null!=u||null!=l)e=t,n=a,o=u,i=s,r=l;else if(Array.isArray(t)){var c=os(t,5);e=c[0],n=c[1],i=c[2],r=c[3],o=c[4]}else e=t.content,n=t.top,i=t.right,r=t.bottom,o=t.left;return new rs(this.contentToElement(e),n,i,r,o)}},{key:"brac",value:function(t){var e,n,i,r,o,a,s,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,f=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,d=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;if(null!=l||null!=u||null!=c||null!=h||null!=f)e=t,n=l,i=u,r=c,o=h,a=f,s=d;else if(Array.isArray(t)){var p=os(t,7);e=p[0],n=p[1],i=p[2],r=p[3],o=p[4],a=p[5],s=p[6]}else e=t.content,n=t.left,i=t.right,r=t.insideSpace,o=t.outsideSpace,a=t.useMinLineHeight,s=t.heightScale;var v=null;null!=n&&(v=ls(this.elements,n));var m,y,g=null;null!=i&&(g=ls(this.elements,i)),null!=r&&(m=r),null!=o&&(y=o);var b,w=this.fullLineHeight;return null!=a&&!1===a&&(w=null),null!=s&&(b=s),new za(this.contentToElement(e),v,g,m,y,w,b)}},{key:"processBar",value:function(t){var e,n,i,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(null!=r||null!=o)e=t,n=r,i=o;else if(Array.isArray(t)){var a=os(t,3);e=a[0],n=a[1],i=a[2]}else e=t.content,n=t.symbol,i=t.space;var s=.03;return null!=i&&(s=i),[e,n,s]}},{key:"topBar",value:function(){var t=os(this.processBar.apply(this,arguments),3),e=t[0],n=t[1],i=t[2];return new Ga(this.contentToElement(e),ls(this.elements,n),i,.03,"top")}},{key:"bottomBar",value:function(){var t=os(this.processBar.apply(this,arguments),3),e=t[0],n=t[1],i=t[2];return new Ga(this.contentToElement(e),ls(this.elements,n),i,.03,"bottom")}},{key:"processComment",value:function(t){var e,n,i,r,o,a,s,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,f=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,d=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;if(null!=l||null!=u||null!=c||null!=h||null!=f||null!=d)e=t,n=l,i=u,r=c,o=h,a=f,s=d;else if(Array.isArray(t)){var p=os(t,7);e=p[0],n=p[1],i=p[2],r=p[3],o=p[4],a=p[5],s=p[6]}else e=t.content,n=t.comment,i=t.symbol,r=t.contentSpace,o=t.commentSpace,a=t.scale,s=t.includeInSize;var v=.03;null!=r&&(v=r);var m=.03;null!=o&&(m=o);var y=.6;null!=a&&(y=a);var g=!0;return null!=s&&(g=s),[e,n,i,v,m,y,g]}},{key:"bottomComment",value:function(){var t,e=os(this.processComment.apply(this,arguments),7),n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6];return t=r?new Ga(this.contentToElement(n),ls(this.elements,r),o,a,"bottom"):this.pad(n,0,0,o+a),this.annotate({content:t,withAnnotations:[this.annotation({annotation:i,relativeToContent:["center","bottom"],relativeToAnnotation:["center","top"],scale:s})],includeAnnotationInSize:l})}},{key:"topComment",value:function(){var t,e=os(this.processComment.apply(this,arguments),7),n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6];return t=r?new Ga(this.contentToElement(n),ls(this.elements,r),o,a,"top"):this.pad(n,o+a),this.annotate({content:t,withAnnotations:[this.annotation({annotation:i,relativeToContent:["center","top"],relativeToAnnotation:["center","bottom"],scale:s})],includeAnnotationInSize:l})}},{key:"processStrike",value:function(t){var e,n,i,r,o,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,u=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if(null!=a||null!=s||null!=l||null!=u)e=t,n=a,i=s,r=l,o=u;else if(Array.isArray(t)){var c=os(t,5);e=c[0],n=c[1],i=c[2],r=c[3],o=c[4]}else e=t.content,n=t.comment,i=t.symbol,r=t.space,o=t.scale;var h=.1;null!=r&&(h=r);var f=.5;return null!=o&&(f=o),[e,n,i,h,f]}},{key:"topStrike",value:function(){var t,e=os(this.processStrike.apply(this,arguments),5),n=e[0],i=e[1],r=e[2],o=e[3],a=e[4];return t=r?new Sa(this.contentToElement(n),ls(this.elements,r),!1,o):n,this.annotate({content:t,withAnnotations:[this.annotation({annotation:i,relativeToContent:["center","top"],relativeToAnnotation:["center","bottom"],scale:a})]})}},{key:"bottomStrike",value:function(){var t,e=os(this.processStrike.apply(this,arguments),5),n=e[0],i=e[1],r=e[2],o=e[3],a=e[4];return t=r?new Sa(this.contentToElement(n),ls(this.elements,r),!1,o):n,this.annotate({content:t,withAnnotations:[this.annotation({annotation:i,relativeToContent:["center","bottom"],relativeToAnnotation:["center","top"],scale:a})]})}}])&&ss(e.prototype,n),t}();function cs(t){return(cs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function fs(t,e,n){return(fs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ds(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function ds(t){return(ds=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ps(t,e){return(ps=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var vs=function(t){function e(t,n){var i;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==cs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ds(e).call(this,[]))).elements=t,i.collectionMethods=n,i.description=null,i.modifiers={},i.elementMods={},i.translation={},i.subForm="",i}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ps(t,e)}(e,fa),n=e,(i=[{key:"getNamedElements",value:function(){var t={};return this.collectionMethods.getAllElements().forEach(function(e){t[e.name]=e}),t}},{key:"_dup",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.elements,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.collectionMethods,i=new e(t,n),r={};n.getAllElements().forEach(function(t){r[t.name]=t});var o=[];return this.content.forEach(function(t){o.push(t._dup(r))}),i.content=o,Gt(this,i,["content","collectionMethods","form","elements"]),i}},{key:"createEq",value:function(t){var e=this,n=[];t.forEach(function(t){if("string"==typeof t)if(t.startsWith("space")){var i=parseFloat(t.replace(/space[_]*/,""))||.03;n.push(new ha(new ca(i)))}else if(t.startsWith(" ")){var r=.03*t.length;n.push(new ha(new ca(r)))}else{var o=ls(e.elements,t);o&&n.push(new ha(o))}else n.push(t._dup());e.content=n})}},{key:"arrange",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"left",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"baseline",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new X(0,0),o=this.collectionMethods.getAllElements().filter(function(t){return t.isShown});this.collectionMethods.hideAll(),this.collectionMethods.show(),fs(ds(e.prototype),"calcSize",this).call(this,new X(0,0),t);var a=new X(0,0);if(r instanceof Ui||r instanceof Xi){var s=r.transform.t();null!=s&&(a=s._dup())}else a=new X(-r.x,-r.y);var l=this.width,u=this.height,c=this.ascent,h=this.descent,f=this.location._dup();if(r instanceof Ui||r instanceof Xi){var d=r.transform.t(),p=r.transform.s();if(null!=d&&null!=p){var v=r.getVertexSpaceBoundingRect();l=v.width*p.x,u=v.height*p.y,c=v.top*p.y-d.y,h=d.y-v.bottom*p.y,f=d._dup()}}"right"===n?a.x+=l:"center"===n&&(a.x+=l/2),"top"===i?a.y+=f.y+c:"bottom"===i?a.y+=f.y-h:"middle"===i&&(a.y+=f.y-h+u/2);var m=new X(0,0).sub(a);0===m.x&&0===m.y||(this.offsetLocation(m),this.setPositions()),this.collectionMethods.showOnly(o)}},{key:"dissolveElements",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"in",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.01,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if(0===t.length&&r)r(!1);else{var o=t.length,a=0,s=function(t){(a+=1)===o&&r&&r(t)};t.forEach(function(t){t.animations.addTo("Equation Color").opacity({dissolve:e,onFinish:s,duration:i,delay:n,completeOnCancel:!0}).start()})}}},{key:"getElementsToShowAndHide",value:function(){var t=this.collectionMethods.getAllElements().filter(function(t){return t.isShown}),e=this.getAllElements(),n=t.filter(function(t){return-1===e.indexOf(t)});return{show:e.filter(function(e){return-1===t.indexOf(e)}),hide:n}}},{key:"render",value:function(){this.hideShow(),this.setPositions()}},{key:"showHide",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;(!(3<arguments.length&&void 0!==arguments[3])||arguments[3])&&this.collectionMethods.stop(),this.collectionMethods.show();var i=this.getElementsToShowAndHide(),r=i.show,o=i.hide;0===t?r.forEach(function(t){t.showAll()}):this.dissolveElements(r,"in",.01,t,null),0===e?o.forEach(function(t){return t.hide()}):this.dissolveElements(o,"out",t,e,n)}},{key:"hideShow",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;(!(3<arguments.length&&void 0!==arguments[3])||arguments[3])&&this.collectionMethods.stop(),this.collectionMethods.show();var i=this.getElementsToShowAndHide(),r=i.show,o=i.hide;0===e?o.forEach(function(t){return t.hide()}):this.dissolveElements(o,"out",.01,e,null),0===t?(r.forEach(function(t){t.showAll()}),null!=n&&n()):this.dissolveElements(r,"in",e,t,n)}},{key:"allHideShow",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.5,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.5,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;this.collectionMethods.stop();var a=this.collectionMethods.getAllElements().filter(function(t){return t.isShown}),s=this.getAllElements(),l=s.filter(function(t){return!t.isShown}),u=s.filter(function(t){return t.isShown}),c=e;if(0!==s.length||0!==a.length||null==o){var h=function(){t.setPositions()};0===s.length&&(h=function(e){t.setPositions(),null!=o&&o(e)}),0<a.length?(this.dissolveElements(a,"out",e,n,h),c+=n):this.setPositions(),this.applyElementMods();var f=s.length,d=0,p=function(t){(d+=1)===f-1&&o&&o(t)};l.forEach(function(t){t.animations.addTo("Equation Color").dissolveIn({duration:r,onFinish:p,delay:c+i}).start()}),u.forEach(function(t){t.animations.addTo("Equation Color").dissolveIn({duration:r,onFinish:p,delay:i}).start()})}else o(!1)}},{key:"applyElementMods",value:function(){var t=this;Object.keys(this.elementMods).forEach(function(e){var n=t.elementMods[e],i=n.element,r=n.mods;null!=i&&null!=r&&(i.setProperties(r),null!=r.color&&i.setColor(r.color),null!=r.opacity&&i.setOpacity(r.opacity))})}},{key:"animatePositionsTo",value:function(t,e,n,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,a=this.collectionMethods.getAllElements();this.collectionMethods.stop();var s=this.getAllElements();s.forEach(function(t){.001===t.opacity&&t.hide(),t.setOpacity(1)});var l=a.filter(function(t){return t.isShown}),u=l.filter(function(t){return-1===s.indexOf(t)}),c=s.filter(function(t){return-1===l.indexOf(t)}),h=this.collectionMethods.getElementTransforms();this.setPositions();var f,d=this.collectionMethods.getElementTransforms(),p=[],v=[],m=[];Object.keys(d).forEach(function(t){var e=h[t],n=d[t];e.isEqualTo(n)||(p.push(t),v.push(e),m.push(n))}),f=null===n?_t(v,m,0,new X(.35,.35),2*Math.PI/6,new X(.4,.4)):n,this.collectionMethods.setElementTransforms(h);var y=t,g=null,b=null,w=null;0===p.length&&0===c.length?w=r:0===c.length?g=r:b=r,0<u.length&&(this.dissolveElements(u,"out",t,e,w),y+=e),this.applyElementMods();var x;x="fromPrev"===o&&null!=this.fromPrev?Vt({},this.translation,this.fromPrev):"fromNext"===o&&null!=this.fromNext?Vt({},this.translation,this.fromNext):Vt({},this.translation),Object.keys(x).forEach(function(t){var e=x[t],n=e.element,i=e.style,r=e.direction,o=e.mag;n&&(null!=i&&(n.animations.options.translation.style=i),null!=r&&(n.animations.options.translation.direction=r),null!=o&&(n.animations.options.translation.magnitude=o))});var _=this.collectionMethods.animateToTransforms(d,f,y,0,g);return 0<_&&(y=_),0<c.length&&(this.dissolveElements(c,"in",y,i,b),y+=i+.001),y}}])&&hs(n.prototype,i),e}();function ms(t){return(ms="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ys(t){return(ys=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function gs(t,e){return(gs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var bs=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==ms(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ys(e).call(this,t))).glPrimative=n.gl[0].TRIANGLE_STRIP;var o=.3;i<5&&(o=1-Math.log(i)/2);var a=.003*o,s=.01*o,l=function(t,e,n){for(var i=[],r=-.18;r<=.185;r+=.01)i.push(r);return i}(),u=l.map(function(t){return 1/(1+Math.exp(-20*t))}),c=l.map(function(t){return a/Math.sqrt(2*Math.PI*Math.pow(.07,2))*Math.exp(-Math.pow(t,2)/(2*Math.pow(.07,2)))}),h=l.map(function(t,e){return t-c[e]-s}),f=l.map(function(t,e){return t+c[e]+s}),d=.03*o,p=h.length,v=new X(h[p-1],u[p-1]),m=20*u[p-1]*(1-u[p-1]),y=Math.atan(m),g=Math.PI/2-y,b=v.add(new X(d*Math.cos(g),-d*Math.sin(g))),w=2*Math.PI/29,x=Math.PI/2+y,_=new X(-b.x,1-b.y),T=-g;if(r){n.border.push([]),n.border.push([]);for(var k=0;k<30;k+=1){n.points.push(_.x),n.points.push(_.y);var O=T+w*k,S=new X(_.x+d*Math.cos(O),_.y+d*Math.sin(O));n.points.push(S.x),n.points.push(S.y),n.border[1].push(S)}}var P=[],A=[];if(u.map(function(t,e){var i=new X(h[e],t),r=new X(f[e],t);n.points.push(r.x),n.points.push(r.y),n.points.push(i.x),n.points.push(i.y),P.push(i._dup()),A.push(r._dup())}),r)for(var E=0;E<30;E+=1){n.points.push(b.x),n.points.push(b.y);var L=x+w*E,j=new X(b.x+d*Math.cos(L),b.y+d*Math.sin(L));n.points.push(j.x),n.points.push(j.y),n.border[2].push(j)}n.border[0]=P.concat(A.reverse()),n.border[0].push(n.border[0][0]._dup());for(var M=n.getGLBoundingRect((new ht).matrix()),R=(new ht).translate(-M.left,-M.bottom).scale(1/M.height,1/M.height),C=0;C<n.border.length;C+=1)for(var F=n.border[C],B=0;B<F.length;B+=1)n.border[C][B]=n.border[C][B].transformBy(R.matrix());for(var D=0;D<n.points.length;D+=2){var I=new X(n.points[D],n.points[D+1]).transformBy(R.matrix());n.points[D]=I.x,n.points[D+1]=I.y}return n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gs(t,e)}(e,ce),e}();function ws(t,e,n,i,r){var o=new bs(t,n,!0),a=new ht;return a=i instanceof X?a.translate(i.x,i.y):i._dup(),new Ui(o,a,e,r)}function xs(t){return(xs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _s(t){return(_s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ts(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ks(t,e){return(ks=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Os=function(t){var e,n;function i(t,e){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;!function(t,e){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==xs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,_s(i).call(this,t))).glPrimative=n.gl[0].TRIANGLE_STRIP,n.numLines=r,n.mainHeight=1;var o,a,s=n.getPoints(),l=s.leftPoints,u=s.rightPoints,c=s.maxX,h=[];a="right"===e?(new ht).scale(-1,1).translate(c,0):"top"===e?(new ht).translate(0,-n.mainHeight/2).rotate(-Math.PI/2).translate(n.mainHeight/2,c):"bottom"===e?(new ht).translate(0,-n.mainHeight/2).rotate(Math.PI/2).translate(n.mainHeight/2,-c):new ht,h=l.map(function(t){return t.transformBy(a.m())}),o=u.map(function(t){return t.transformBy(a.m())}),n.points=[],h.forEach(function(t,e){var i=o[e];n.points.push(t.x),n.points.push(t.y),n.points.push(i.x),n.points.push(i.y)}),n.border[0]=[],h.forEach(function(t){n.border[0].push(t)});for(var f=o.length-1;0<=f;f-=1)n.border[0].push(o[f]);return n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ks(t,e)}(i,ce),e=i,(n=[{key:"getPoints",value:function(){for(var t=1/this.numLines/16,e=16*t*this.numLines,n=e*(1.4-.4*(1-1/this.numLines)),i=this.mainHeight,r=new X(e,i/2),o=new X(n+t,i/2),a=Math.asin(i/2/e),s=Math.asin(i/2/n),l=10*this.numLines,u=2*a/l,c=2*s/l,h=[],f=[],d=0;d<=l;d+=1)h.push(vt(e,Math.PI-a+d*u).add(r)),f.push(vt(n,Math.PI-s+d*c).add(o));return{leftPoints:h,rightPoints:f,maxX:vt(n,Math.PI-s).add(o).x}}}])&&Ts(e.prototype,n),i}();function Ss(t,e,n,i,r,o){var a=new Os(t,n,i),s=new ht;return s=r instanceof X?s.translate(r.x,r.y):r._dup(),new Ui(a,s,e,o)}function Ps(t){return(Ps="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function As(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Es(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ls(t){return(Ls=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function js(t,e){return(js=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ms=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==Ps(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Ls(e).apply(this,arguments))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&js(t,e)}(e,Os),n=e,(i=[{key:"getPoints",value:function(){var t=.05;1<this.numLines&&(t/=this.numLines);for(var e=3*t,n=1.3*e,i=new X(e,0),r=new X(t+n+t/4,0),o=Math.PI/2*.8,a=e*Math.sin(o),s=Math.asin(a/n),l=o/5,u=s/5,c=[],h=[],f=0;f<=5;f+=1)c.push(vt(e,Math.PI-f*l).add(i)),h.push(vt(n,Math.PI-f*u).add(r));var d=vt(n,Math.PI-s).add(r).x,p=a,v=(new ht).translate(0,this.mainHeight-p),m=(new ht).scale(1,-1).translate(0,p);return{leftPoints:[].concat(As(c.map(function(t){return t.transformBy(m.m())}).reverse()),As(c.map(function(t){return t.transformBy(v.m())}))),rightPoints:[].concat(As(h.map(function(t){return t.transformBy(m.m())}).reverse()),As(h.map(function(t){return t.transformBy(v.m())}))),maxX:d}}}])&&Es(n.prototype,i),e}();function Rs(t,e,n,i,r,o){var a=new Ms(t,n,i),s=new ht;return s=r instanceof X?s.translate(r.x,r.y):r._dup(),new Ui(a,s,e,o)}function Cs(t){return(Cs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Bs(t){return(Bs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ds(t,e){return(Ds=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Is=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==Cs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Bs(e).apply(this,arguments))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ds(t,e)}(e,Os),n=e,(i=[{key:"getPoints",value:function(){var t=1/15;return 1<this.numLines&&(t/=this.numLines),{leftPoints:[new X(0,0),new X(0,this.mainHeight)],rightPoints:[new X(t,0),new X(t,this.mainHeight)],maxX:t}}}])&&Fs(n.prototype,i),e}();function qs(t,e,n,i,r,o){var a=new Is(t,n,i),s=new ht;return s=r instanceof X?s.translate(r.x,r.y):r._dup(),new Ui(a,s,e,o)}function Hs(t){return(Hs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ns(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function zs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Gs(t){return(Gs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vs(t,e){return(Vs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ws=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==Hs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Gs(e).apply(this,arguments))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vs(t,e)}(e,Os),n=e,(i=[{key:"getPoints",value:function(){var t=.05;1<this.numLines&&(t/=this.numLines);for(var e=3*t,n=1.3*e,i=new X(e,0),r=new X(t+n+t/4,0),o=Math.PI/2*.8,a=e*Math.sin(o),s=Math.asin(a/n),l=o/5,u=s/5,c=[],h=[],f=0;f<=5;f+=1)c.push(vt(e,Math.PI-f*l).add(i)),h.push(vt(n,Math.PI-f*u).add(r));var d=vt(n,Math.PI-s).add(r).x,p=a,v=(new ht).translate(d-t,this.mainHeight-p),m=(new ht).scale(1,-1).translate(d-t,p),y=(new ht).scale(-1,1).translate(d,this.mainHeight/2-1*p),g=(new ht).scale(-1,-1).translate(d,this.mainHeight/2+1*p);return{leftPoints:[].concat(Ns(c.map(function(t){return t.transformBy(m.m())}).reverse()),Ns(h.map(function(t){return t.transformBy(y.m())})),Ns(h.map(function(t){return t.transformBy(g.m())}).reverse()),Ns(c.map(function(t){return t.transformBy(v.m())}))),rightPoints:[].concat(Ns(h.map(function(t){return t.transformBy(m.m())}).reverse()),Ns(c.map(function(t){return t.transformBy(y.m())})),Ns(c.map(function(t){return t.transformBy(g.m())}).reverse()),Ns(h.map(function(t){return t.transformBy(v.m())}))),maxX:2*d-t}}}])&&zs(n.prototype,i),e}();function Us(t,e,n,i,r,o){var a=new Ws(t,n,i),s=new ht;return s=r instanceof X?s.translate(r.x,r.y):r._dup(),new Ui(a,s,e,o)}function Xs(t){return(Xs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ys(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Qs(t){return(Qs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zs(t,e){return(Zs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ks=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==Xs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Qs(e).apply(this,arguments))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zs(t,e)}(e,Os),n=e,(i=[{key:"getPoints",value:function(){var t=1/30;1<this.numLines&&(t/=this.numLines);var e=4*t;return{leftPoints:[new X(e,0),new X(0,0),new X(0,this.mainHeight),new X(e,this.mainHeight)],rightPoints:[new X(e,t),new X(t,t),new X(t,this.mainHeight-t),new X(e,this.mainHeight-t)],maxX:e}}}])&&Ys(n.prototype,i),e}();function $s(t,e,n,i,r,o){var a=new Ks(t,n,i),s=new ht;return s=r instanceof X?s.translate(r.x,r.y):r._dup(),new Ui(a,s,e,o)}function Js(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var tl=function(){function t(e,n){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.shapes=e,this.defaultColor=n}var e,n;return e=t,(n=[{key:"get",value:function(t,e){return"vinculum"===t?this.vinculum(e):"strike"===t?this.strike(e):"xStrike"===t?this.xStrike(e):"integral"===t?this.integral(e):"bracket"===t?this.bracket(e):"squareBracket"===t?this.squareBracket(e):"brace"===t?this.brace(e):"bar"===t?this.bar(e):"roundedSquareBracket"===t?this.roundedSquareBracket(e):null}},{key:"vinculum",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).color;return null==t&&(t=this.defaultColor),this.shapes.horizontalLine(new X(0,0),1,1,0,t,new ht("vinculum").scale(1,1).translate(0,0))}},{key:"strike",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).color;return null==t&&(t=this.defaultColor),this.shapes.horizontalLine(new X(0,0),1,1,0,t,new ht("strike").scale(1,1).rotate(0).translate(0,0))}},{key:"xStrike",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).color;null==t&&(t=this.defaultColor);var e=this.shapes.collection(new ht("xStrike").scale(1,1).rotate(0).translate(0,0));e.color=t;var n=this.shapes.horizontalLine(new X(0,0),1,1,0,t,new ht("strikeLine").scale(1,1).rotate(0).translate(0,0)),i=n._dup();return e.add("s1",n),e.add("s2",i),e}},{key:"integral",value:function(t){var e=Vt({color:this.defaultColor,numLines:1},t);return new ws(this.shapes.webgl,e.color,e.numLines,new ht("integral").scale(1,1).translate(0,0),this.shapes.limits)}},{key:"bracket",value:function(t){var e=Vt({side:"left",numLines:1,color:this.defaultColor},t);return new Ss(this.shapes.webgl,e.color,e.side,e.numLines,new ht("bracket").scale(1,1).translate(0,0),this.shapes.limits)}},{key:"bar",value:function(t){var e=Vt({side:"top",numLines:1,color:this.defaultColor},t);return new qs(this.shapes.webgl,e.color,e.side,e.numLines,new ht("bar").scale(1,1).translate(0,0),this.shapes.limits)}},{key:"squareBracket",value:function(t){var e=Vt({side:"left",numLines:1,color:this.defaultColor},t);return new $s(this.shapes.webgl,e.color,e.side,e.numLines,new ht("bar").scale(1,1).translate(0,0),this.shapes.limits)}},{key:"brace",value:function(t){var e=Vt({side:"left",numLines:1,color:this.defaultColor},t);return new Us(this.shapes.webgl,e.color,e.side,e.numLines,new ht("bar").scale(1,1).translate(0,0),this.shapes.limits)}},{key:"roundedSquareBracket",value:function(t){var e=Vt({side:"left",numLines:1,color:this.defaultColor},t);return new Rs(this.shapes.webgl,e.color,e.side,e.numLines,new ht("bar").scale(1,1).translate(0,0),this.shapes.limits)}}])&&Js(e.prototype,n),t}();function el(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function nl(t){return(nl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function il(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function rl(t,e,n){return(rl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ol(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function ol(t){return(ol=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function al(t,e){return(al=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var sl=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var r=i.color;null==r&&(r=[.5,.5,.5,1]);var o=Vt({},{color:r,fontMath:new be("Times New Roman","normal",.2,"200","left","alphabetic",r),fontText:new be("Times New Roman","italic",.2,"200","left","alphabetic",r),position:new X(0,0),scale:.7,defaultFormAlignment:{fixTo:new X(0,0),alignH:"left",alignV:"baseline"},elements:{},forms:{},formSeries:{},formRestart:null},i);return o.position=Tt(o.position,new X(0,0)),o.defaultFormAlignment.fixTo=Tt(o.defaultFormAlignment.fixTo,o.defaultFormAlignment.fixTo),null!=o.formRestart&&null!=o.formRestart.pulse&&(o.formRestart.pulse=Vt({},{scale:1.1,duration:1},o.formRestart.pulse)),(n=function(t,e){return!e||"object"!==nl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ol(e).call(this,new ht("Equation").scale(1,1).rotate(0).translate(0,0),t.limits))).shapes=t,n.color=o.color,n.eqn={forms:{},currentForm:"",currentSubForm:"",subFormPriority:["base"],formSeries:{base:[]},currentFormSeries:[],currentFormSeriesName:"",scale:o.scale,defaultFormAlignment:o.defaultFormAlignment,functions:new us(n.elements),symbols:new tl(n.shapes,n.color),fontMath:o.fontMath,fontText:o.fontText,isAnimating:!1,descriptionElement:null,descriptionPosition:new X(0,0),formRestart:o.formRestart},n.setPosition(o.position),null!=o.elements&&n.addElements(o.elements),null!=o.forms&&n.addForms(o.forms),null!=o.formSeries&&(Array.isArray(o.formSeries)?(n.eqn.formSeries={base:o.formSeries},n.eqn.currentFormSeries=n.eqn.formSeries.base,n.eqn.currentFormSeriesName="base"):(n.eqn.formSeries=o.formSeries,null!=o.defaultFormSeries?n.setFormSeries(o.defaultFormSeries):n.setFormSeries(Object.keys(n.eqn.formSeries)[0]))),n}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&al(t,e)}(e,Xi),n=e,(i=[{key:"setFormSeries",value:function(t){null!=this.eqn.formSeries[t]&&(this.eqn.currentFormSeries=this.eqn.formSeries[t],this.eqn.currentFormSeriesName=t)}},{key:"getFormSeries",value:function(){return this.eqn.currentFormSeriesName}},{key:"addElements",value:function(t){var e=this,n=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";null!=t.text&&(n=t.text);var i=e.eqn.fontMath;n.match(/[A-Z,a-z]/)&&(i=e.eqn.fontText),null!=t.style&&("italic"===t.style&&(i=e.eqn.fontText),"normal"===t.style&&(i=e.eqn.fontMath)),null!=t.font&&(i=t.font);var r=e.shapes.text(n,{position:new X(0,0),font:i});return null!=t.color?r.setColor(t.color):r.setColor(r.drawingObject.text[0].font.color),r};Object.keys(t).forEach(function(i){var r,o,a=t[i];if("string"==typeof a)i.startsWith("space")&&i.startsWith(" ")||e.add(i,n({text:a}));else if(a instanceof Ui)e.add(i,a);else if(a instanceof Xi)e.add(i,a);else{var s;null!=(s=null!=a.symbol&&"string"==typeof a.symbol?(r=a,null==(o=e.eqn.symbols.get(r.symbol,r))&&(o=n({text:"Symbol ".concat(r.symbol," not valid")})),null==r.color&&o.setColor(e.color),o):n(a,i))&&(null!=a.mods&&s.setProperties(a.mods),e.add(i,s))}});var i=n({text:"gh"}),r=this.createForm({elem:i});r.content=[this.eqn.functions.contentToElement(i)],r.arrange(this.eqn.scale,"left","baseline",new X(0,0)),this.eqn.functions.fullLineHeight=r,this.setFirstTransform(this.transform)}},{key:"addDescriptionElement",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new X(0,0);this.eqn.descriptionElement=t,this.eqn.descriptionPosition=e,this.eqn.descriptionElement&&this.eqn.descriptionElement.setPosition(this.getDiagramPosition().add(e))}},{key:"setPosition",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;rl(ol(e.prototype),"setPosition",this).call(this,t,n);var i=this.getDiagramPosition();null!=this.eqn.descriptionElement&&this.eqn.descriptionElement.setPosition(i.add(this.eqn.descriptionPosition))}},{key:"addPhrases",value:function(t){var e=this;Object.keys(t).forEach(function(n){var i=t[n];e.eqn.functions.phrases[n]=i})}},{key:"addForms",value:function(t){var e=this,n=function(t){return"string"==typeof t},i=function(t){return Array.isArray(t)},r=function(t){if(n(t)||i(t))return!1;if(null!=t&&"object"===nl(t)){var r=Object.keys(t);if(1===r.length&&r[0]in e.eqn.functions)return!0}return!1},o=function(t){return t instanceof fa},a=function(t,n){var i=[e.eqn.functions.contentToElement(n.content)],r=n.subForm,o=n.elementMods,a=n.duration,s=n.alignment,l=n.scale,u=n.description,c=n.modifiers,h=n.fromPrev,f=n.fromNext,d={subForm:r,elementMods:o,duration:a,translation:n.translation,alignment:s,scale:l,description:u,modifiers:c,fromPrev:h,fromNext:f};e.addForm(t,i,d)};Object.keys(t).forEach(function(s){var l,u,c,h,f=t[s];n(f)||i(f)||r(f)||o(f)?(u=s,c=f,h=[e.eqn.functions.contentToElement(c)],e.addForm(u,h)):n(l=f)||i(l)||r(l)||o(l)||null==l||"object"!==nl(l)||null==l.content?Object.entries(f).forEach(function(t){var e=el(t,2),l=e[0],u=e[1];n(u)||i(u)||r(u)||o(u)?a(s,{content:u,subForm:l}):a(s,Vt(u,{subForm:l}))}):a(s,f)})}},{key:"checkFixTo",value:function(t){if("string"!=typeof t)return t instanceof Ui||t instanceof Xi||t instanceof X?t:new X(0,0);var e=ls(this,t);return null!=e?e:new X(0,0)}},{key:"createForm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.elements;return new vs(t,{getAllElements:this.getAllElements.bind(this),hideAll:this.hideAll.bind(this),show:this.show.bind(this),showOnly:this.showOnly.bind(this),stop:this.stop.bind(this),getElementTransforms:this.getElementTransforms.bind(this),setElementTransforms:this.setElementTransforms.bind(this),animateToTransforms:this.animateToTransforms.bind(this)})}},{key:"addForm",value:function(t,e){var n=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};t in this.eqn.forms||(this.eqn.forms[t]={});var r={subForm:"base",elementMods:{},duration:void 0,description:"",modifiers:{},scale:this.eqn.scale,alignment:this.eqn.defaultFormAlignment,translation:{},fromNext:void 0,fromPrev:void 0},o=r;i&&(o=Vt({},r,i));var a=o,s=a.subForm,l=a.description,u=a.modifiers,c=a.duration;this.eqn.forms[t].name=t;var h=this.eqn.forms[t];h[s]=this.createForm(),h[s].description=l,h[s].modifiers=u,h[s].name=t,h[s].subForm=s,h[s].duration=c,h[s].elementMods={},Object.keys(o.elementMods).forEach(function(t){var e=o.elementMods[t],i=ls(n,t);null!=i&&(h[s].elementMods[t]={element:i,mods:e})}),h[s].translation={},Object.keys(o.translation).forEach(function(t){var e,i,r,a=o.translation[t],l=ls(n,t);if(Array.isArray(a)){var u=el(a,3);i=u[0],e=u[1],r=u[2]}else i=a.style,e=a.direction,r=a.mag;null!=l&&(h[s].translation[t]={element:l,style:i,direction:e,mag:r})});var f=o.fromPrev;null!=f&&(h[s].fromPrev={},void 0!==f.duration&&(h[s].fromPrev.duration=f.duration),h[s].fromPrev.translation={},null!=f.translation&&Object.keys(f.translation).forEach(function(t){var e,i,r,o=f.translation[t],a=ls(n,t);if(Array.isArray(o)){var l=el(o,3);i=l[0],e=l[1],r=l[2]}else i=o.style,e=o.direction,r=o.mag;null!=a&&(h[s].fromPrev.translation[t]={element:a,style:i,direction:e,mag:r})}));var d=o.fromNext;if(null!=d&&(h[s].fromNext={},void 0!==d.duration&&(h[s].fromNext.duration=d.duration),h[s].fromNext.translation={},null!=d.translation&&Object.keys(d.translation).forEach(function(t){var e,i,r,o=d.translation[t],a=ls(n,t);if(Array.isArray(o)){var l=el(o,3);i=l[0],e=l[1],r=l[2]}else i=o.style,e=o.direction,r=o.mag;null!=a&&(h[s].fromNext.translation[t]={element:a,style:i,direction:e,mag:r})})),o.alignment.fixTo=this.checkFixTo(o.alignment.fixTo),h[s].content=e,h[s].arrange(o.scale,o.alignment.alignH,o.alignment.alignV,o.alignment.fixTo),void 0===this.eqn.forms[t].base){var p=Vt({},o);p.subForm="base",this.addForm(t,e,p)}""===this.eqn.currentForm&&(this.eqn.currentForm=t),""===this.eqn.currentSubForm&&(this.eqn.currentSubForm="base")}},{key:"getCurrentForm",value:function(){return null==this.eqn.forms[this.eqn.currentForm]?null:null==this.eqn.forms[this.eqn.currentForm][this.eqn.currentSubForm]?null:this.eqn.forms[this.eqn.currentForm][this.eqn.currentSubForm]}},{key:"render",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=this.getCurrentForm();null!=e&&(e.setPositions(),e.showHide(0,0,null,t),this.show(),e.applyElementMods())}},{key:"setCurrentForm",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"base";"string"==typeof t?(this.eqn.currentForm="",this.eqn.currentSubForm="",t in this.eqn.forms&&(this.eqn.currentForm=t,e in this.eqn.forms[t]&&(this.eqn.currentSubForm=e))):(this.eqn.currentForm=t.name,this.eqn.currentSubForm=t.subForm)}},{key:"showForm",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];this.show();var i=t;"string"==typeof t&&(i=this.getForm(t,e)),i&&(this.setCurrentForm(i),this.render(n))}},{key:"getForm",value:function(t,e){var n=this;if(t instanceof vs)return t;if(t in this.eqn.forms){var i=e;if(null==i){var r=this.eqn.subFormPriority.filter(function(e){return e in n.eqn.forms[t]});r.length&&(i=r[0])}if(null!=i)return this.eqn.forms[t][i]}return null}},{key:"goToForm",value:function(){var t,n=this,i=Vt({duration:null,prioritizeFormDuration:!0,delay:0,fromWhere:null,animate:"dissolve",callback:null,ifAnimating:{skipToTarget:!0,cancelGoTo:!0}},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{});if(this.eqn.isAnimating){if(i.ifAnimating.skipToTarget){this.stop(!0,!0);var r=this.getCurrentForm();null!=r&&this.showForm(r)}else this.stop(!0,!1);if(this.eqn.isAnimating=!1,i.ifAnimating.cancelGoTo)return}if(null!=i.name)t=this.eqn.forms[i.name];else if(null!=i.index)t=this.eqn.forms[this.eqn.currentFormSeries[i.index]];else if(0<this.eqn.currentFormSeries.length){var o=0,a=this.getCurrentForm();null!=a&&(o=this.eqn.currentFormSeries.indexOf(a.name))<0&&(o=0);var s=o+1;s===this.eqn.currentFormSeries.length&&(s=0),t=this.eqn.forms[this.eqn.currentFormSeries[s]]}if(null!=t){var l=null,u=null,c=this.eqn.subFormPriority.filter(function(e){return e in t});if(c.length&&(u=c[0]),null!=u){l=t[u];var h=i.duration;if(i.prioritizeFormDuration&&("fromPrev"===i.fromWhere&&null!=l.fromPrev&&void 0!==l.fromPrev.duration?h=l.fromPrev.duration:"fromNext"===i.fromWhere&&null!=l.fromNext&&void 0!==l.fromNext.duration?h=l.fromNext.duration:void 0!==l.duration&&(h=l.duration)),null!=h&&0<h&&"dissolve"===i.animate?(null==i.dissolveOutTime&&(i.dissolveOutTime=.4*h),null==i.dissolveInTime&&(i.dissolveInTime=.4*h),null==i.blankTime&&(i.blankTime=.2*h)):(null==i.dissolveOutTime&&(i.dissolveOutTime=.4),null==i.dissolveInTime&&(i.dissolveInTime=.4),null==i.blankTime&&(i.blankTime=.2)),0===h)this.showForm(l),null!=i.callback&&i.callback();else{this.eqn.isAnimating=!0;var f=function(){n.eqn.isAnimating=!1,null!=i.callback&&i.callback()};if("move"===i.animate)l.animatePositionsTo(i.delay,i.dissolveOutTime,h,i.dissolveInTime,f,i.fromWhere);else if("moveFrom"===i.animate&&null!=this.eqn.formRestart&&null!=this.eqn.formRestart.moveFrom){var d=this.eqn.formRestart.moveFrom,p=this.getPosition(),v=this.getPosition();d instanceof e&&d.showForm(l.name),v=d instanceof Xi?d.getPosition():kt(this.eqn.formRestart.moveFrom),this.animations.new().dissolveOut({duration:i.dissolveOutTime}).position({target:v,duration:0}).trigger({callback:function(){n.showForm(l.name,u,!1)},duration:.01}).position({target:p,duration:h}).whenFinished(f).start()}else if("pulse"===i.animate&&null!=this.eqn.formRestart&&null!=this.eqn.formRestart.pulse){var m=this.eqn.formRestart.pulse;l.allHideShow(i.delay,i.dissolveOutTime,i.blankTime,i.dissolveInTime,function(){n.pulseScaleNow(m.duration,m.scale,0,f),null!=m.element&&m.element instanceof e&&m.element.getCurrentForm().name===l.name&&m.element.pulseScaleNow(m.duration,m.scale)})}else l.allHideShow(i.delay,i.dissolveOutTime,i.blankTime,i.dissolveInTime,f);this.setCurrentForm(l)}}}}},{key:"getFormIndex",value:function(t){var e=this.getForm(t),n=-1;return null!=e&&(n=this.eqn.currentFormSeries.indexOf(e.name)),n}},{key:"prevForm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.getCurrentForm();if(null!=n){var i=this.getFormIndex(n);-1<i&&((i-=1)<0&&(i=this.eqn.currentFormSeries.length-1),this.goToForm({index:i,duration:t,delay:e,fromWhere:"fromNext"}))}}},{key:"nextForm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n="move",i=this.getCurrentForm();if(null!=i){var r=this.getFormIndex(i);if(-1<r){if((r+=1)>this.eqn.currentFormSeries.length-1){r=0;var o=this.eqn.formRestart;n=null!=o&&null!=o.moveFrom?"moveFrom":null!=o&&null!=o.pulse?"pulse":"dissolve"}this.goToForm({index:r,duration:t,delay:e,fromWhere:"fromPrev",animate:n})}}}},{key:"replayCurrentForm",value:function(t){if(this.eqn.isAnimating){this.stop(!0,!0),this.eqn.isAnimating=!1;var e=this.getCurrentForm();null!=e&&this.showForm(e)}else this.stop(),this.eqn.isAnimating=!1,this.prevForm(0),this.nextForm(t,.5)}},{key:"animateToForm",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.stop();var r=this.getForm(t);null!=r&&r.animatePositionsTo(n,.4,e,.4,i),this.setCurrentForm(t)}},{key:"changeDescription",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"base",r=this.getForm(t,i);null!=r&&(r.description="".concat(e),r.modifiers=n)}},{key:"getDescription",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"base",n=this.getForm(t,e);return null!=n&&null!=n.description?mr(n.description,n.modifiers):""}}])&&il(n.prototype,i),e}();function ll(t){return(ll="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ul(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function cl(t){return(cl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hl(t,e){return(hl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function fl(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dl(t,e,n,i){var r,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4],a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"",s=n;if(null!=s&&null!=(r=t.getCurrentForm()))if(null!=r.description){var l=!o;n&&(o?(n.innerHTML=mr("".concat(a).concat(r.description),r.modifiers),yr(r.modifiers)):n.innerHTML=mr("".concat(a).concat(r.description),r.modifiers,"",l))}else null!=s&&(s.innerHTML="")}function pl(t){t&&t.classList.remove("figureone__eqn_nav__not_touchable")}function vl(t){t&&t.classList.add("figureone__eqn_nav__not_touchable")}function ml(t){var e="",n="";1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&(e="NEXT: ",n="PREV: ");var i=t.eqn.getCurrentForm();if(null!=i){var r=t.eqn.getFormIndex(i);if(0===r?(vl(t.refresh),vl(t.prev),vl(t.prevDescription),vl(t.description)):(pl(t.refresh),pl(t.prev),pl(t.prevDescription),pl(t.description)),1<t.eqn.eqn.currentFormSeries.length)pl(t.next),pl(t.nextDescription),"1Button"===t.navType&&pl(t.description);else if(vl(t.next),vl(t.nextDescription),"1Button"===t.navType){var o=t.next;o&&(o.classList.remove("figureone__eqn_nav__next_form"),o.classList.remove("figureone__eqn_nav__reset"),o.classList.remove("interactive_top_right"))}var a=r+1;if(a>t.eqn.eqn.currentFormSeries.length-1){if(t.nextDescription&&(t.nextDescription.innerHTML="RESTART from begining"),"1Button"===t.navType&&1<t.eqn.eqn.currentFormSeries.length){var s=t.next;s&&(s.classList.add("figureone__eqn_nav__reset"),s.classList.remove("figureone__eqn_nav__next_form"))}}else if(dl(t.eqn,i.subForm,t.nextDescription,a,!1,e),"1Button"===t.navType&&1<t.eqn.eqn.currentFormSeries.length){var l=t.next;l&&(l.classList.add("figureone__eqn_nav__next_form"),l.classList.remove("figureone__eqn_nav__reset"))}dl(t.eqn,i.subForm,t.description,r,!0);var u=r-1;0<=u?dl(t.eqn,i.subForm,t.prevDescription,u,!1,n):t.prevDescription&&(t.prevDescription.innerHTML="")}}var yl=function(t){function e(t,n){var i,r,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=!(r=cl(e).call(this,new ht("Eqn Nav").scale(1,1).translate(0,0),t.limits))||"object"!==ll(r)&&"function"!=typeof r?fl(this):r).shapes=t,i.prev=null,i.next=null,i.refresh=null,i.description=null,i.nextDescription=null,i.prevDescription=null,i.table=null,i.prevGroup=null,i.currentGroup=null,i.nextGroup=null,i.animateNextFrame=n;var a=Vt({},{offset:new X(0,0),navType:"twoLine",navTypeOptions:{forceTwoLines:!1,arrows:!1},alignH:"center",alignV:"middle",interactive:!0,id:Wt("id_figureone__equation_navigator_")},o);null!=(i.options=a).equation&&i.connectToEquation(a.equation,a.interactive),i.navType=a.navType;var s,l,u,c,h,f,d,p,v,m,y,g,b,w,x,_,T,k,O,S,P,A,E,L=null;if("3Line"===i.navType&&(s=i.clickPrev.bind(fl(fl(i))),l=i.clickRefresh.bind(fl(fl(i))),u=i.clickNext.bind(fl(fl(i))),c=a.navTypeOptions,h=document.createElement("table"),f=document.createElement("tr"),d=document.createElement("tr"),p=document.createElement("tr"),v=document.createElement("td"),m=document.createElement("td"),y=document.createElement("td"),g=document.createElement("td"),b=document.createElement("td"),w=document.createElement("td"),f.appendChild(v),f.appendChild(g),p.appendChild(y),p.appendChild(w),d.appendChild(m),d.appendChild(b),h.appendChild(f),h.appendChild(d),h.appendChild(p),h.classList.add("figureone__eqn_nav__table"),f.classList.add("figureone__eqn_nav__3line__prevRow"),d.classList.add("figureone__eqn_nav__3line__currentRow"),p.classList.add("figureone__eqn_nav__3line__nextRow"),v.classList.add("figureone__eqn_nav__3line__prevRow__button"),m.classList.add("figureone__eqn_nav__3line__currentRow__button"),y.classList.add("figureone__eqn_nav__3line__nextRow__button"),g.classList.add("figureone__eqn_nav__3line__prevRow__description"),b.classList.add("figureone__eqn_nav__3line__currentRow__description"),b.classList.add("figureone__eqn_nav__description"),w.classList.add("figureone__eqn_nav__3line__nextRow__description"),Vt({},{forceTwoLines:!1,arrows:!1},c).forceTwoLines&&(f.classList.add("figureone__eqn_nav__3line__prev_twoLines"),d.classList.add("figureone__eqn_nav__3line__current_twoLines"),p.classList.add("figureone__eqn_nav__3line__next_twoLines")),f.onclick=s,d.onclick=l,p.onclick=u,y.innerHTML="Next",v.innerHTML="Prev",m.innerHTML="Refresh",L={table:h,prevGroup:f,currentGroup:d,nextGroup:p,prev:v,refresh:m,next:y,prevDescription:g,description:b,nextDescription:w}),"description"===i.navType&&(x=i.clickNext.bind(fl(fl(i))),_=document.createElement("table"),T=document.createElement("tr"),k=document.createElement("td"),T.appendChild(k),_.appendChild(T),_.classList.add("figureone__eqn_nav__table"),T.classList.add("figureone__eqn_nav__description_only__currentRow"),k.classList.add("figureone__eqn_nav__description_only__currentRow__description"),k.classList.add("figureone__eqn_nav__description"),T.onclick=x,L={table:_,currentGroup:T,description:k}),"1Line"===i.navType&&(L=function(t,e,n,i){var r=document.createElement("table"),o=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),l=document.createElement("td");o.appendChild(a),o.appendChild(l),o.appendChild(s),r.appendChild(o),r.classList.add("figureone__eqn_nav__table"),o.classList.add("figureone__eqn_nav__1line__currentRow"),a.classList.add("figureone__eqn_nav__1line__prev__button"),s.classList.add("figureone__eqn_nav__1line__next__button"),l.classList.add("figureone__eqn_nav__1line__currentRow__description"),l.classList.add("figureone__eqn_nav__description");var u=Vt({},{forceTwoLines:!1,arrows:!1},i);if(u.forceTwoLines&&o.classList.add("figureone__eqn_nav__1line__current_twoLines"),a.onclick=t,l.onclick=e,s.onclick=n,u.arrows){var c=document.createElement("div");c.classList.add("figureone__eqn_nav__arrow_right"),s.appendChild(c);var h=document.createElement("div");h.classList.add("figureone__eqn_nav__arrow_left"),a.appendChild(h)}else s.innerHTML="Next",a.innerHTML="Prev";return{table:r,currentGroup:o,prev:a,next:s,description:l}}(i.clickPrev.bind(fl(fl(i))),i.clickRefresh.bind(fl(fl(i))),i.clickNext.bind(fl(fl(i))),a.navTypeOptions)),"1Button"===i.navType&&(O=i.clickNext.bind(fl(fl(i))),S=document.createElement("table"),P=document.createElement("tr"),A=document.createElement("td"),E=document.createElement("td"),P.appendChild(A),P.appendChild(E),S.appendChild(P),S.classList.add("figureone__eqn_nav__table"),P.classList.add("figureone__eqn_nav__1button__currentRow"),A.classList.add("figureone__eqn_nav__1button__button"),E.classList.add("figureone__eqn_nav__1line__currentRow__description"),E.classList.add("figureone__eqn_nav__description"),A.classList.add("interactive_top_right"),A.onclick=O,E.onclick=O,A.classList.add("figureone__eqn_nav__next_form"),L={table:S,currentGroup:P,next:A,description:E}),"2Line"===i.navType&&(L=function(t,e,n,i){var r=document.createElement("table"),o=document.createElement("tr"),a=document.createElement("tr"),s=document.createElement("tr"),l=document.createElement("td"),u=document.createElement("td"),c=document.createElement("tr"),h=document.createElement("td"),f=document.createElement("td");s.appendChild(h),c.appendChild(f),a.appendChild(s),a.appendChild(c),o.appendChild(l),o.appendChild(a),o.appendChild(u),r.appendChild(o),r.classList.add("figureone__eqn_nav__table"),s.classList.add("figureone__eqn_nav__2lines__currentRow"),c.classList.add("figureone__eqn_nav__2lines__nextRow"),l.classList.add("figureone__eqn_nav__2lines__prev__button"),u.classList.add("figureone__eqn_nav__2lines__next__button"),h.classList.add("figureone__eqn_nav__2lines__currentRow__description"),h.classList.add("figureone__eqn_nav__description"),f.classList.add("figureone__eqn_nav__2lines__nextRow__description");var d=Vt({},{forceTwoLines:!1,arrows:!1},i);if(-1<d.forceTwoLines&&s.classList.add("figureone__eqn_nav__2lines__current_twoLines"),l.onclick=t,h.onclick=e,u.onclick=n,f.onclick=n,d.arrows){var p=document.createElement("div");p.classList.add("figureone__eqn_nav__arrow_right"),u.appendChild(p);var v=document.createElement("div");v.classList.add("figureone__eqn_nav__arrow_left"),l.appendChild(v)}else u.innerHTML="Next",l.innerHTML="Prev";return{table:r,currentGroup:s,nextGroup:c,prev:l,next:u,nextDescription:f,description:h}}(i.clickPrev.bind(fl(fl(i))),i.clickRefresh.bind(fl(fl(i))),i.clickNext.bind(fl(fl(i))),a.navTypeOptions)),null!=L){var j=Tt(a.offset,new X(0,0));Object.assign(fl(fl(i)),L);var M=i.shapes.htmlElement(L.table,"".concat(a.id,"_table"),"",j,a.alignV,a.alignH);i.add("table",M)}return i}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hl(t,e)}(e,Xi),n=e,(i=[{key:"connectToEquation",value:function(t,e){this.eqn=t,e&&(this.eqn.onClick=this.clickNext.bind(this),this.eqn.hasTouchableElements=!0,this.eqn.isTouchable=!0,this.eqn.touchInBoundingRect=!0)}},{key:"clickNext",value:function(){this.eqn.nextForm(1.5),this.updateButtons(),this.animateNextFrame()}},{key:"clickPrev",value:function(){this.eqn.prevForm(1.5),this.updateButtons(),this.animateNextFrame()}},{key:"clickRefresh",value:function(){var t=this.eqn.getCurrentForm();null!=t&&0<this.eqn.getFormIndex(t)&&(this.eqn.replayCurrentForm(1.5),this.animateNextFrame()),this.updateButtons()}},{key:"updateButtons",value:function(){"equationOnly"!==this.navType&&("description"===this.navType?function(t){var e=t.eqn.getCurrentForm();if(null!=e){var n=t.eqn.getFormIndex(e);pl(t.description),dl(t.eqn,e.subForm,t.description,n,!0)}}(this):"2Line"===this.navType?ml(this,!0):ml(this))}},{key:"showForm",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.show(),this.eqn.showForm(t,e),this._table&&(this._table.show(),this.updateButtons())}}])&&ul(n.prototype,i),e}();function gl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var bl=function(){function t(e,n){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.webgl=e.webgl,this.draw2D=e.draw2D,this.limits=e.limits,this.shapes=e,this.animateNextFrame=n}var e,n;return e=t,(n=[{key:"equation",value:function(t){return new sl(this.shapes,t)}},{key:"addEquation",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=new sl(this.shapes,n);return t.add(e,i),i}},{key:"addNavigator",value:function(t,e,n){var i=e,r=Vt({},n);if(null==r.equation){var o=this.addEquation(t,"".concat(e,"Eqn"),n);r.equation=o,i="".concat(e,"Nav")}else if(!(r.equation instanceof sl)){var a,s,l,u,c;if(Array.isArray(r.equation)){var h=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(r.equation,7);a=h[1],s=h[3],l=h[4],u=h[6]}else a=r.equation.name,s=r.equation.options,l=r.equation.mods,u=r.equation.scenario;c=Array.isArray(s)?this.addEquation.apply(this,[t,a].concat(function(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(s))):this.addEquation(t,a,s),null!=l&&l!=={}&&c.setProperties(l),null!=u&&u in c.scenarios&&c.setScenario(u),r.equation=c}var f=new yl(this.shapes,this.animateNextFrame,r);return t.add(i,f),f}}])&&gl(e.prototype,n),t}();function wl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var xl=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var i,r={label:"",color:[0,0,1,1],scale:.7,position:new X(0,0),form:"0",formType:"base",alignH:"center",alignV:"middle"},o=Object.assign({},r,n),a=o.label,s=o.color,l=o.scale,u=o.position,c=o.form,h=o.formType,f=o.alignV,d=o.alignH;if("string"==typeof a)(i=e.equation({elements:{base:a},color:s,defaultFormAlignment:{fixTo:new X(0,0),alignH:d,alignV:f},scale:l,forms:{base:["base"]},position:u})).setCurrentForm("base");else if(a instanceof sl)i=a;else if(Array.isArray(a)){var p={},v={};a.forEach(function(t,e){p["_".concat(e)]=t,v[e]=[t]}),(i=e.equation({elements:p,forms:v,color:s,position:u,defaultFormAlignment:{fixTo:new X(0,0),alignH:d,alignV:f},scale:l})).setCurrentForm(c,h)}else{var m={color:s};i=e.equation(Vt(m,a))}this.eqn=i}var e,n;return e=t,(n=[{key:"setText",value:function(t){var e=this.eqn.getCurrentForm();if(null!=e){var n=Object.keys(e.elements)[0],i=e.elements[n].drawingObject;null!=i&&i.setText(t),e.arrange(this.eqn.eqn.scale,this.eqn.eqn.defaultFormAlignment.alignH,this.eqn.eqn.defaultFormAlignment.alignV,this.eqn.eqn.defaultFormAlignment.fixTo)}}},{key:"getText",value:function(){var t="",e=this.eqn.getCurrentForm();if(null!=e){var n=Object.keys(e.elements)[0],i=e.elements[n].drawingObject;null!=i&&(t=i.text[0].text)}return t}},{key:"updateRotation",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;if(0!==n){var r=0,o=0,a=this.eqn.getCurrentForm();null!=a&&(r=a.width/2+.04,o=a.height/2+.04);var s=r+n,l=o+n,u=s*l/Math.sqrt(Math.pow(l*Math.cos(t-i),2)+Math.pow(s*Math.sin(t-i),2));this.eqn.setPosition(e.add(vt(u,i)))}else this.eqn.setPosition(e);this.eqn.transform.updateRotation(t)}}])&&wl(e.prototype,n),t}();function _l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Tl(t,e,n){return e&&_l(t.prototype,e),n&&_l(t,n),t}function kl(t){return(kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ol(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sl(t,e){return!e||"object"!==kl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Pl(t){return(Pl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Al(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}var El=function(t){function e(t,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"top",s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"left",l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"horizontal",u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:.5,c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:.7,h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:1;return Ol(this,e),(o=Sl(this,Pl(e).call(this,t,{label:n,color:i,scale:c}))).offset=r,o.location=a,o.subLocation=s,o.orientation=l,o.linePosition=u,o.precision=h,o}return Al(e,xl),e}();function Ll(t,e,n,i,r,o,a,s){var l=t.horizontalLine(i,e,n,0,r,(new ht).scale(1,1).translate(0,0));if(o&&(l=t.dashedLine({position:i,length:o.maxLength,width:n,rotation:0,dashStyle:o.style,color:r,transform:(new ht).scale(1,1).translate(0,0)})),a){var u=s?16:8;"number"==typeof a&&(u=a),function(t){for(var e=0;e<t.drawingObject.border[0].length;e+=1)t.drawingObject.border[0][e].y*=u}(l)}return l}var jl=function(t){function e(t,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};Ol(this,e);var s={position:new X(0,0),length:1,angle:0,width:.01,vertexSpaceStart:"start",color:[0,0,1,1],showLine:!0,largerTouchBorder:!0,offset:0,dashStyle:null,mods:{}},l=Object.assign({},s,a),u=l.dashStyle;if(u){var c=l.length;null!=l.p1&&null!=l.p2&&(l.p1=kt(l.p1),l.p2=kt(l.p2),c=J(l.p1,l.p2)),u=Object.assign({},{maxLength:c,dashStyle:[.1]},a.dashStyle)}if((o=Sl(this,Pl(e).call(this,new ht("Line").scale(1,1).rotate(0).translate(0,0),t.limits))).setColor(l.color),o.shapes=t,o.equation=n,o.largerTouchBorder=l.largerTouchBorder,o.isTouchDevice=i,o.animateNextFrame=r,o.dashStyle=u,o.offset=l.offset,o.width=l.width,o.position=kt(l.position),o.length=l.length,o.angle=l.angle,o.transform.updateTranslation(o.position),o.transform.updateRotation(o.angle),o.vertexSpaceLength=1,o.vertexSpaceStart=new X(0,0),"end"===l.vertexSpaceStart?o.vertexSpaceStart=new X(-1,0):"center"===l.vertexSpaceStart?o.vertexSpaceStart=new X(-.5,0):"number"==typeof l.vertexSpaceStart?o.vertexSpaceStart=new X(-l.vertexSpaceStart,0):l.vertexSpaceStart instanceof X&&(o.vertexSpaceStart=l.vertexSpaceStart),o.multiMove={vertexSpaceMidLength:0,bounds:new U(-1,-1,2,2)},o._midLine=null,o._line=null,l.showLine){var h=Ll(o.shapes,o.vertexSpaceLength,o.width,o.vertexSpaceStart,l.color,o.dashStyle,l.largerTouchBorder,i);o.add("line",h)}o.arrow1=null,o.arrow2=null,o._arrow1=null,o._arrow2=null,o.label=null,o._label=null,o.showRealLength=!1,o.setLength(o.length),null!=l.p1&&null!=l.p2&&o.setEndPoints(l.p1,l.p2);var f={width:4*o.width,height:4*o.width};if(l.arrowStart){var d=Object.assign({},f,l.arrowStart);o.addArrowStart(d.height,d.width)}if(l.arrowEnd){var p=Object.assign({},f,l.arrowEnd);o.addArrowEnd(p.height,p.width)}if(l.arrows){var v={};"object"===kl(l.arrows)&&(v=l.arrows);var m=Object.assign({},f,v);o.addArrows(m.height,m.width)}var y={text:null,offset:0,location:"top",subLocation:"left",orientation:"horizontal",linePosition:.5,scale:.7,color:l.color,precision:1};if(l.label){var g=Object.assign({},y,l.label);null===g.text&&(g.text="",o.showRealLength=!0),o.addLabel(g.text,g.offset,g.location,g.subLocation,g.orientation,g.linePosition,g.scale,g.color,g.precision)}var b={type:"rotation",middleLengthPercent:.22,translationBounds:o.diagramLimits};if(l.move){var w=Vt({},b,l.move);o.setMovable(!0,w.type,w.middleLengthPercent,w.translationBounds)}return null!=l.mods&&l.mods!=={}&&o.setProperties(l.mods),o}return Al(e,Xi),Tl(e,[{key:"calculateFromP1LengthAngle",value:function(t,e,n){var i=(new ht).scale(e,1).rotate(n),r=this.vertexSpaceStart.transformBy(i.matrix());return{length:e,angle:n,position:t.sub(r)}}},{key:"calculateFromP1P2",value:function(t,e){var n=new ot(t,e),i=n.length(),r=n.angle(),o=(new ht).scale(i,1).rotate(r),a=this.vertexSpaceStart.transformBy(o.matrix());return{length:i,angle:r,position:t.sub(a)}}}]),Tl(e,[{key:"pulseWidth",value:function(){var t=Vt({line:3,label:1.5,arrow:2,done:null},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}),e=t.done,n=this._line;if(null!=n){n.stopPulsing();var i=n.pulse.transformMethod,r=n.pulse.callback;n.pulse.callback=function(){n.pulse.transformMethod=i,n.pulse.callback=r},n.pulse.transformMethod=function(t){return(new ht).scale(1,t)},n.pulseScaleNow(1,t.line,0,e),e=null}var o=this._arrow1,a=this._arrow2;null!=o&&(o.pulseScaleNow(1,t.arrow,0,e),e=null),null!=a&&(a.pulseScaleNow(1,t.arrow,0,e),e=null);var s=this._label;null!=s&&(s.pulseScaleNow(1,t.label,0,e),e=null),null!=e&&e(),this.animateNextFrame()}},{key:"addArrow",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4*this.width,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e,i=Math.PI/2;2===t&&(i=Math.PI/2*3);var r=this.shapes.arrow({width:n,legWidth:0,height:e,legHeight:0,color:this.color,transform:(new ht).translate(this.vertexSpaceStart.x,0),tip:new X(0,0),rotation:i});this["arrow".concat(t)]={height:e},this.add("arrow".concat(t),r),this.setLength(this.currentLength)}},{key:"addArrows",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow1(t,e),this.addArrow2(t,e)}},{key:"addArrow1",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow(1,t,e)}},{key:"addArrow2",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow(2,t,e)}},{key:"addArrowStart",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow1(t,e)}},{key:"addArrowEnd",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow2(t,e)}},{key:"setMovable",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.move.type,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.333,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this.diagramLimits;t?"translation"===e||"rotation"===e||"scale"===e||"scaleX"===e||"scaleY"===e?(this.move.type=e,this.isTouchable=!0,this.isMovable=!0,this.hasTouchableElements=!0,null!=this._line&&(this._line.isTouchable=!0,this._line.isMovable=!1),this._midLine&&(this._midLine.isMovable=!1),this.multiMove.bounds=i):this.setMultiMovable(n,i):(this.isMovable=!1,this.isTouchable=!1,null!=this._line&&(this._line.isTouchable=!1,this._line.isMovable=!1))}},{key:"setMultiMovable",value:function(t,e){this.multiMove.vertexSpaceMidLength=t*this.vertexSpaceLength;var n=new X(this.vertexSpaceStart.x+this.vertexSpaceLength/2-this.multiMove.vertexSpaceMidLength/2,0),i=Ll(this.shapes,this.multiMove.vertexSpaceMidLength,this.width,n,this.color,null,this.largerTouchBorder,this.isTouchDevice);i.isTouchable=!0,i.move.type="translation",i.move.element=this,i.isMovable=!0,i.move.canBeMovedAfterLoosingTouch=!0,this.add("midLine",i),this._line&&(this._line.isTouchable=!0,this._line.move.type="rotation",(this._line.move.element=this)._line.isMovable=!0,this._line.move.canBeMovedAfterLoosingTouch=!0),this.hasTouchableElements=!0,this.isTouchable=!1,this.isMovable=!1,this.multiMove.bounds=e,this.setLength(this.currentLength)}},{key:"updateMoveTransform",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.transform._dup()).r(),e=this.multiMove.bounds;if(null!=t){var n=Math.abs(this.currentLength/2*Math.cos(t)),i=Math.abs(this.currentLength/2*Math.sin(t));this.move.maxTransform.updateTranslation(e.right-n,e.top-i),this.move.minTransform.updateTranslation(e.left+n,e.bottom+i),t>2*Math.PI&&this.transform.updateRotation(t-2*Math.PI),t<0&&this.transform.updateRotation(t+2*Math.PI)}}},{key:"addLabel",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"top",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"left",r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"horizontal",o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.5,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:.7,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:this.color,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:1;this.label=new El(this.equation,t,s,e,n,i,r,o,a,l),null!=this.label&&this.add("label",this.label.eqn),this.updateLabel()}},{key:"getLength",value:function(){return this.length}},{key:"getAngle",value:function(){return"deg"===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"rad")?180*this.angle/Math.PI:this.angle}},{key:"setLabel",value:function(t){this.showRealLength=!1,null!=this.label&&this.label.setText(t),this.updateLabel()}},{key:"setLabelToRealLength",value:function(){this.showRealLength=!0,this.updateLabel()}},{key:"updateLabel",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=this.label;if(null!=e){var n=nt(this.transform.r()||0),i=0;this.showRealLength&&this._label&&e.setText(c(this.currentLength,2).toFixed(e.precision));var r=new X(this.vertexSpaceStart.x*this.currentLength+e.linePosition*this.currentLength,0),o=Math.PI/2,a=e.offset;if("end1"===e.location||"end2"===e.location)"end1"===e.location&&(r.x=this.vertexSpaceStart.x*this.currentLength-e.offset,o=-Math.PI),"end2"===e.location&&(r.x=this.vertexSpaceStart.x*this.currentLength+this.currentLength+e.offset,o=0);else{var s=Math.cos(n)<0?-Math.PI/2:Math.PI/2,l=-s,u=0<Math.sin(n)?Math.PI/2:-Math.PI/2,h=-u;"top"===e.location&&(o=s),"bottom"===e.location&&(o=l),"right"===e.location&&(o=h),"left"===e.location&&(o=u),0!==c(Math.sin(n),4)||"left"!==e.location&&"right"!==e.location||("top"===e.subLocation&&(o=s),"bottom"===e.subLocation&&(o=l)),0!==c(Math.cos(n),4)||"top"!==e.location&&"bottom"!==e.location||("right"===e.subLocation&&(o=h),"left"===e.subLocation&&(o=u)),"inside"===e.location&&(o=-Math.PI/2),"outside"===e.location&&(o=Math.PI/2)}"horizontal"===e.orientation&&(i=-n),"baseToLine"===e.orientation&&r.y<0&&(i=Math.PI),"baseAway"===e.orientation&&0<r.y&&(i=Math.PI),"baseUpright"===e.orientation&&Math.cos(n)<0&&(i=Math.PI),e.updateRotation(i-t,r,a,o)}}},{key:"setLength",value:function(t){var e=this.vertexSpaceStart.x*t,n=t,i=n,r=0;this.arrow1&&this._arrow1&&(i-=this.arrow1.height,r=this.arrow1.height,this._arrow1.setPosition(e)),this.arrow2&&this._arrow2&&(i-=this.arrow2.height,this._arrow2.setPosition(e+n,0));var o=this._line;if(o)if(this.dashStyle)o.lengthToDraw=i,o.setPosition(e+r-this.vertexSpaceStart.x,0);else{o.transform.updateScale(i,1);var a=e+r-this.vertexSpaceStart.x*i;o.setPosition(a,0)}var s=this._midLine;s&&s.transform.updateScale(t,1),this.length=t,this.updateLineGeometry(),this.currentLength=t,this.updateLabel()}},{key:"updateLineGeometry",value:function(){var t=this.transform.t(),e=this.transform.r();if(null!=t&&null!=e){this.position=t,this.angle=e;var n=this.vertexSpaceStart.transformBy((new ht).scale(this.length).rotate(this.angle).translate(this.position).m()),i=new ot(n,this.length,this.angle);this.p1=i.getPoint(1),this.p2=i.getPoint(2),this.line=i}}},{key:"setLineDimensions",value:function(){var t=vt(this.offset,this.angle+Math.PI/2);this.transform.updateTranslation(this.position.add(t)),this.transform.updateRotation(this.angle),this.setLength(this.length),this.updateLabel()}},{key:"setEndPoints",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.offset;this.offset=n;var i=this.calculateFromP1P2(kt(t),kt(e)),r=i.length,o=i.angle,a=i.position;this.angle=o,this.length=r,this.position=a,this.setLineDimensions()}},{key:"animateLengthTo",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.stop();var o=this.currentLength,a=e-this.currentLength;this.animations.new("Line Length").custom({callback:function(e){t.setLength(o+a*e)},duration:n}).whenFinished(function(){i&&t.setLength(o+a),"function"==typeof r&&r&&r()}).start(),this.animateNextFrame()}},{key:"grow",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.stop();var r=this.currentLength;this.setLength(t),this.animateLengthTo(r,e,n,i)}},{key:"showLineOnly",value:function(){this.show(),this._line&&this._line.show(),this._arrow1&&this._arrow1.show(),this._arrow2&&this._arrow2.show(),this._label&&this._label.hideAll()}}]),e}();function Ml(t,e,n){return(Ml="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Il(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Rl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Cl(t,e,n){return e&&Rl(t.prototype,e),n&&Rl(t,n),t}function Fl(t){return(Fl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Dl(t,e){return!e||"object"!==Fl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Il(t){return(Il=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ql(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}var Hl=function(t){function e(t,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,s=5<arguments.length&&void 0!==arguments[5]&&arguments[5],l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"degrees",u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:null,h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:null,f=10<arguments.length&&void 0!==arguments[10]?arguments[10]:"horizontal",d=11<arguments.length&&void 0!==arguments[11]?arguments[11]:.7;return Bl(this,e),(o=Dl(this,Il(e).call(this,t,{label:n,color:i,scale:d}))).radius=r,o.curvePosition=a,o.showRealAngle=s,o.units=l,o.orientation=f,o.precision=u,o.autoHide=c,o.autoHideMax=h,o}return ql(e,xl),e}(),Nl=function(t){function e(t,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};Bl(this,e);var s=Vt({},{position:new X(0,0),rotation:0,angle:1,color:[0,1,0,1],direction:1,autoRightAngle:!1,rightAngleRange:.001,curve:null,sides:null,sideStart:null,sideStop:null,arrows:null,arrow1:null,arrow2:null,label:null,p1:null,p2:null,p3:null,mods:{}},a);if((o=Dl(this,Il(e).call(this,new ht("Line").scale(1,1).rotate(0).translate(0,0),t.limits))).setColor(s.color),o.shapes=t,o.equation=n,o.largerTouchBorder=s.largerTouchBorder,o.isTouchDevice=i,o.animateNextFrame=r,o.nextPosition=kt(s.position),o.nextRotation=s.rotation,o.direction=s.direction,o.angle=s.angle,o.lastLabelRotationOffset=0,o.autoRightAngle=s.autoRightAngle,o.rightAngleRange=s.rightAngleRange,null!=s.p1&&null!=s.p2&&null!=s.p3){var l=o.calculateFromP1P2P3(kt(s.p1),kt(s.p2),kt(s.p3),o.direction),u=l.position,c=l.rotation,h=l.angle;o.angle=h,o.nextRotation=c,o.nextPosition=kt(u)}o.setNextPositionAndRotation(),o.side1=null,o.side2=null,o.arrow1=null,o.arrow2=null,o.curve=null,o.label=null,o._curve=null,s.curve&&o.addCurve(s.curve),(s.arrow1||s.arrows)&&o.addArrow(1,Vt({},s.arrow1,s.arrows)),(s.arrow2||s.arrows)&&o.addArrow(2,Vt({},s.arrow2,s.arrows)),s.label&&o.addLabel(s.label);var f=.5;o.curve&&(f=2*o.curve.radius);var d=.01;o.curve&&(d=o.curve.width);var p={length:f,width:d,color:o.color};if(s.side1){var v=Vt({},p,s.side1);o.addSide(1,v.length,v.width,v.color)}if(s.side2){var m=Vt({},p,s.side2);o.addSide(2,m.length,m.width,m.color)}if(s.sides){var y={};"object"===Fl(s.sides)&&(y=s.sides);var g=Vt({},p,y);o.addSide(1,g.length,g.width,g.color),o.addSide(2,g.length,g.width,g.color)}return o.update(),null!=s.mods&&s.mods!=={}&&o.setProperties(s.mods),o}return ql(e,Xi),Cl(e,[{key:"calculateFromP1P2P3",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=e._dup(),o=bt(t,e,n);return 1===i?{position:r,rotation:new ot(e,t).angle(),angle:o}:{position:r,rotation:new ot(e,t).angle(),angle:W(2*Math.PI-o,"0to360")}}}]),Cl(e,[{key:"setNextPositionAndRotation",value:function(){null!=this.nextPosition&&this.transform.updateTranslation(this.nextPosition),null!=this.nextRotation&&this.transform.updateRotation(this.nextRotation),this.nextPosition=null,this.nextRotation=null}},{key:"setAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};null!=t.position&&(this.nextPosition=t.position),null!=t.rotation&&(this.nextRotation=t.rotation),null!=t.angle&&(this.angle=t.angle);var e=t.p1,n=t.p2,i=t.p3;if(null!=e&&null!=n&&null!=i){var r=this.calculateFromP1P2P3(kt(e),kt(n),kt(i),this.direction),o=r.position,a=r.rotation,s=r.angle;this.angle=s,this.nextRotation=a,this.nextPosition=kt(o)}null!=t.rotationOffset?this.update(t.rotationOffset):this.update()}},{key:"addSide",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this.color,r=this.shapes.horizontalLine(new X(0,0),1,n,0,i,(new ht).scale(1,1).rotate(0));this["side".concat(t)]={length:e,width:n},this.add("side".concat(t),r)}},{key:"addLabel",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e={text:null,radius:.4,curvePosition:.5,showRealAngle:!1,units:"degrees",precision:0,orientation:"horizontal",autoHide:null,autoHideMax:null,scale:.7,color:this.color};this.curve&&(e.radius=this.curve.radius);var n=Vt({},e,t);null===n.text&&(n.text="",n.showRealAngle=!0),this.label=new Hl(this.equation,n.text,n.color,n.radius,n.curvePosition,n.showRealAngle,n.units,n.precision,n.autoHide,n.autoHideMax,n.orientation,n.scale),null!=this.label&&this.add("label",this.label.eqn)}},{key:"addCurve",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},{width:.01,sides:50,radius:.5,num:1,step:0,autoHideMin:null,autoHideMax:null},t),n=0;n<e.num;n+=1){var i=this.shapes.polygon({sides:e.sides,radius:e.radius+n*e.step,width:e.width,color:this.color,fill:!1,transform:new ht("AngleCurve").rotate(0)});this.curve=e;var r="curve";0<n&&(r="".concat(r).concat(n)),this.add(r,i)}if(this.autoRightAngle){var o=this.shapes.collection(),a=.707*e.radius;o.add("line1",this.shapes.horizontalLine(new X(a,0),a+e.width/2,e.width,Math.PI/2,this.color)),o.add("line2",this.shapes.horizontalLine(new X(0,a),a-e.width/2,e.width,0,this.color)),this.add("curveRight",o)}}},{key:"addArrow",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=.04;this.curve&&(n=4*this.curve.width);var i=.1;this.curve&&(i=this.curve.radius);var r={};null!=e&&(r=e);var o=Vt({},{width:n,height:n,radius:i,autoHide:!0,curveOverlap:.3},r),a=o.width,s=o.height,l=Math.PI/2;2===t&&(l=Math.PI/2*3);var u=this.shapes.arrowLegacy(a,0,s,0,this.color,(new ht).rotate(0).translate(0,0),new X(0,0),l);this["arrow".concat(t)]=o,this.add("arrow".concat(t),u),this.update()}},{key:"updateCurve",value:function(t,e,n,i){var r=this.curve;if(r)for(var o=0;o<r.num;o+=1){var a="_curve";0<o&&(a="_curve".concat(o));var s=this[a];if(s)if(i)if(s.show(),0===o){var l=0;this.curve&&(l=t%(2*Math.PI/this.curve.sides)),s.angleToDraw=t,s.transform.updateRotation(n+l/2)}else{var u=0;this.curve&&(u=e%(2*Math.PI/this.curve.sides)),s.angleToDraw=e,s.transform.updateRotation(u/2)}else s.hide()}}},{key:"update",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=this._arrow1,n=this.arrow1,i=this._arrow2,r=this.arrow2,o=!1,a=!1,s=0,l=this.angle,u=this.angle,c=0,h=0;if(n&&this.arrow1&&(l-=c=n.height/n.radius*(1-this.arrow1.curveOverlap),u-=n.height/n.radius),r&&this.arrow2&&(l-=h=r.height/r.radius*(1-this.arrow2.curveOverlap),u-=r.height/r.radius),u<0&&(n&&n.autoHide&&(o=!0,u+=n.height/n.radius,l+=c),r&&r.autoHide&&(a=!0,u+=r.height/r.radius,l+=h)),e&&n)if(o)e.hide();else{e.show(),e.transform.updateTranslation(n.radius,0);var f=n.height/n.radius;e.transform.updateRotation(Math.PI/2+f),s=c}if(i&&r)if(a)i.hide();else{i.show(),i.transform.updateTranslation(vt(r.radius,this.angle));var d=r.height/r.radius;i.transform.updateRotation(this.angle+Math.PI/2-d)}null!=t&&(this.lastLabelRotationOffset=t),this.setNextPositionAndRotation();var p=this._curve,v=this.curve,m=this._curveRight;null!=p&&null!=v&&(null!=v.autoHideMin&&this.angle<v.autoHideMin||null!=v.autoHideMax&&this.angle>v.autoHideMax?(null!=m&&m.hide(),p.hide(),null!=e&&e.hide(),null!=i&&i.hide()):this.autoRightAngle&&this.angle>=Math.PI/2-this.rightAngleRange/2&&this.angle<=Math.PI/2+this.rightAngleRange/2?(null!=m&&m.showAll(),p.hide(),null!=e&&e.hide(),null!=i&&i.hide()):(null!=m&&m.hide(),null!=e&&!1===o&&e.show(),null!=i&&!1===a&&i.show(),l=Math.max(l,0),this.updateCurve(l,this.angle,s,!0))),this.updateLabel();var y=this._side1,g=this.side1;y&&g&&y.transform.updateScale(g.length,1);var b=this._side2,w=this.side2;b&&w&&(b.transform.updateRotation(this.angle),b.transform.updateScale(w.length,1))}},{key:"checkLabelForRightAngle",value:function(){if(!1!==this.autoRightAngle){var t=this.label,e=!1;if(null!=t&&90===parseFloat(t.getText())&&(e=!0),!1!==e){var n=this._curveRight,i=this._curve,r=this._arrow1,o=this._arrow2;null!=n&&n.showAll(),null!=i&&i.hide(),null!=r&&r.hide(),null!=o&&o.hide()}}}},{key:"getAngle",value:function(){return"deg"===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"rad")?180*this.angle/Math.PI:this.angle}},{key:"setLabel",value:function(t){var e=this.label;null!=e&&(e.setText(t),e.showRealAngle=!1),this.updateLabel()}},{key:"setLabelToRealAngle",value:function(){var t=this.label;null!=t&&(t.showRealAngle=!0),this.updateLabel()}},{key:"updateLabel",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;null!=t&&(this.lastLabelRotationOffset=t);var e=this._label,n=this.label;if(e&&n)if(null!=n.autoHide&&n.autoHide>this.angle||null!=n.autoHideMax&&this.angle>n.autoHideMax)e.hide();else{if(e.show(),n.showRealAngle){var i=c(this.angle,n.precision).toFixed(n.precision);if("degrees"===n.units){var r=c(180*this.angle/Math.PI,n.precision);360===r&&(r=0),i=r.toFixed(n.precision),i="".concat(i,"")}n.setText(i)}var o=vt(n.radius,this.angle*n.curvePosition);"horizontal"===n.orientation&&n.updateRotation(-this.getRotation()-this.lastLabelRotationOffset,o,n.radius/5,this.angle*n.curvePosition),"tangent"===n.orientation&&n.updateRotation(this.angle*n.curvePosition-Math.PI/2,o,n.radius/50,this.angle*n.curvePosition)}}},{key:"showAll",value:function(){Ml(Il(e.prototype),"showAll",this).call(this),this.update()}}]),e}();function zl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Gl(t){return(Gl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vl(t,e){return(Vl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wl(t){return(Wl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ul(t,e){if(Array.isArray(t)){if(e===t.length)return t;for(var n=[],i=0;i<e;i+=1)n.push(t[i%t.length]);return n}var r=[],o=[];if("object"===Wl(t)&&null!=t&&null!=t.label&&null!=t.label.text&&Array.isArray(t.label.text)){o=t.label.text.slice();for(var a=0;a<e;a+=1){var s={label:{text:o[a%o.length]}};r.push(Vt({},t,s))}return r}for(var l=0;l<e;l+=1)r.push(t);return r}var Xl=function(t){function e(t,n,i,r,o){var a,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var l={position:null,color:[0,1,0,1],points:[new X(1,0),new X(0,0),new X(0,1)],close:!1,showLine:!0,borderToPoint:"never",width:.01,reverse:!1,transform:new ht("PolyLine").scale(1,1).rotate(0).translate(0,0),makeValid:null};null!=s.makeValid&&null!=s.makeValid.shape&&"triangle"===s.makeValid.shape&&(l.makeValid={shape:"triangle",hide:{minAngle:null,maxAngle:null,minSide:null}});var u={showLine:!1,offset:0,width:.01,color:null==s.color?[0,1,0,1]:s.color},c={color:null==s.color?[0,1,0,1]:s.color,curve:{},autoRightAngle:!0},h={sides:20,radius:.1,color:null==s.color?[0,1,0,1]:s.color,fill:!0,isMovable:!1,boundary:"diagram",touchRadiusInBoundary:!1};null!=s.side&&(l.side=u,null!=s.side.label&&(l.side.label={offset:.1,text:null,location:"outside",subLocation:"top",orientation:"horizontal",linePosition:.5,scale:.7})),null!=s.angle&&(l.angle=c,null!=s.angle.label&&(l.angle.label={text:null})),null!=s.pad&&(l.pad=h);var f=Vt({},l,s);if(Array.isArray(s.side)&&(f.side=s.side.map(function(t){return Vt({},l.side,t)})),Array.isArray(s.angle)&&(f.angle=s.angle.map(function(t){return Vt({},l.angle,t)})),(a=function(t,e){return!e||"object"!==Wl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Gl(e).call(this,f.transform,t.limits))).setColor(f.color),a.shapes=t,a.equation=n,a.objects=i,a.largerTouchBorder=f.largerTouchBorder,a.isTouchDevice=r,a.animateNextFrame=o,(a.updatePointsCallback=null)!=f.position&&a.transform.updateTranslation(kt(f.position)),a.position=a.getPosition(),a.close=f.close,a.options=f,a.reverse=f.reverse,a.makeValid=f.makeValid,a.points=f.points.map(function(t){return kt(t)}),f.pad)for(var d=f.pad,p=a.points.length,v=Ul(d,p),m=function(e){var n="pad".concat(e),i=Vt({},{transform:(new ht).translate(a.points[e])},v[e]),r=a.shapes.polygon(i);if(v[e].isMovable){if(r.isMovable=!0,r.isTouchable=!0,null!=v[e].touchRadius){var o=v[e].touchRadius/v[e].radius;r.increaseBorderSize(o)}var s=v[e].boundary;if("diagram"===s)s=t.limits._dup();else if(Array.isArray(s)){var l=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(s,4),u=l[0],c=l[1],h=l[2],f=l[3];s=new U(u,c,h,f)}if(!1===v[e].touchRadiusInBoundary&&null!=v[e].touchRadius){var d=v[e].touchRadius-v[e].radius;s=new U(s.left-d,s.bottom-d,s.width+2*d,s.height+2*d)}r.setMoveBoundaryToDiagram(s),r.setTransformCallback=function(t){var e=parseInt(r.name.slice(3),10),n=t.t();null!=n&&(a.points[e]=n._dup(),a.updatePoints(a.points))}}a.add(n,r)},y=0;y<p;y+=1)m(y);if(f.angle){var g=f.angle,b=a.points.length;!1===f.close&&(b-=2);var w=Ul(g,b),x=0;for(!1===f.close&&(x=1),y=x;y<b+x;y+=1){var _=y+1,T=y-1;y===b-1&&f.close&&(_=0),0===y&&f.close&&(T=b-1);var k="angle".concat(y);if(a.reverse){var O=T;T=_,_=O}var S=Vt({},{p1:a.points[T],p2:a.points[y],p3:a.points[_]},w[y-x]),P=a.objects.angle(S);a.add(k,P)}}if(f.showLine){var A=a.shapes.polyLine({points:a.points,color:f.color,close:f.close,borderToPoint:f.borderToPoint,width:f.width});a.add("line",A)}if(f.side){var E=f.side,L=a.points.length-1;f.close&&(L+=1);for(var j=Ul(E,L),M=0;M<L;M+=1){var R=M+1;M===L-1&&f.close&&(R=0);var C="side".concat(M).concat(R),F=Vt({},{p1:a.points[M],p2:a.points[R]},j[M]);a.reverse&&(F=Vt({},{p1:a.points[R],p2:a.points[M]},j[M]));var B=a.objects.line(F);a.add(C,B)}}return a}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vl(t,e)}(e,Xi),n=e,(i=[{key:"updateSideLabels",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if(null!=this.options.side){var e=this.points.length-1;this.close&&(e+=1);for(var n=0;n<e;n+=1){var i=n+1;n===e-1&&this.close&&(i=0);var r="side".concat(n).concat(i);if(null!=this.elements[r]){var o=!this.elements[r].isShown;this.elements[r].updateLabel(t),o&&this.elements[r].hide()}}}}},{key:"updateAngleLabels",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if(null!=this.options.angle){var e=this.points.length;!1===this.close&&(e-=2);var n=0;!1===this.close&&(n=1);for(var i=n;i<e+n;i+=1){var r="angle".concat(i);if(null!=this.elements[r]){var o=!this.elements[r].isShown;this.elements[r].updateLabel(t),o&&this.elements[r].hide()}}}}},{key:"updatePoints",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=t.map(function(t){return kt(t)});null!=this._line&&this._line.drawingObject.change(n);var i=this.points.length;if(this.options.pad)for(var r=0;r<i;r+=1){var o="pad".concat(r);this.elements[o]&&this.elements[o].transform.updateTranslation(n[r])}if(null!=this.options.side){i=this.points.length-1,this.close&&(i+=1);for(var a=0;a<i;a+=1){var s=a+1;a===i-1&&this.close&&(s=0);var l="side".concat(a).concat(s);if(null!=this.elements[l]){var u=!this.elements[l].isShown;this.reverse?this.elements[l].setEndPoints(n[s],n[a]):this.elements[l].setEndPoints(n[a],n[s]),u&&this.elements[l].hide()}}}if(null!=this.options.angle){i=this.points.length,!1===this.close&&(i-=2);var c=0;!1===this.close&&(c=1);for(var h=c;h<i+c;h+=1){var f=h+1,d=h-1;h===i-1&&this.close&&(f=0),0===h&&this.close&&(d=i-1);var p="angle".concat(h);if(null!=this.elements[p]){var v=!this.elements[p].isShown;if(this.reverse){var m=d;d=f,f=m}this.elements[p].setAngle({p1:n[d],p2:n[h],p3:n[f]}),v&&this.elements[p].hide()}}}this.points=n,null==this.makeValid||"triangle"!==this.makeValid.shape||e||this.makeValidTriangle(),null==this.updatePointsCallback||e||this.updatePointsCallback()}},{key:"updateRotation",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=this["_angle".concat(e)];null!=n;)n.update(this.getRotation()+t),n=this["_angle".concat(e+=1)];for(var i=this["_side".concat(e=0).concat(e+1)];null!=i;)i.updateLabel(this.getRotation()+t),i=this["_side".concat(e+=1).concat(e+1)];null!=(i=this["_side".concat(e,0)])&&i.updateLabel(this.getRotation()+t)}},{key:"reversePoints",value:function(){for(var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=[],n=0;n<this.points.length;n+=1)e.push(this.points[this.points.length-1-n]);this.updatePoints(e,t)}},{key:"setPositionWithoutMoving",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=new X(0,0);"number"==typeof t?(n.x=t,n.y=e):n=t;var i=this.getPosition().sub(n);this.setPosition(n);var r=this.points.map(function(t){return t.add(i)});this.updatePoints(r)}},{key:"setRotationWithoutMoving",value:function(t){var e=this.getRotation()-t,n=(new ht).rotate(e).m();this.setRotation(t);var i=this.points.map(function(t){return t.transformBy(n)});this.updatePoints(i)}},{key:"setScaleWithoutMoving",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=new X(0,0);"number"==typeof t?(n.x=t,n.y=e):n=t;var i=this.getScale(),r=new X(i.x/n.x,i.y/n.y),o=(new ht).scale(r).m();this.setScale(n);var a=this.points.map(function(t){return t.transformBy(o)});this.updatePoints(a)}},{key:"setShow",value:function(t,e){for(var n=0;n<this.drawOrder.length;n+=1){var i=this.elements[this.drawOrder[n]];i.name.startsWith(t)&&(e?i.showAll():i.hide())}}},{key:"hideAngles",value:function(){this.setShow("angle",!1)}},{key:"hideSides",value:function(){this.setShow("side",!1)}},{key:"showAngles",value:function(){this.setShow("angle",!0)}},{key:"showSides",value:function(){this.setShow("side",!0)}},{key:"updateLabels",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getRotation();this.updateAngleLabels(t),this.updateSideLabels(t)}},{key:"makeValidTriangle",value:function(){var t=this._angle0,e=this._angle1,n=this._angle2,i=this._side01,r=this._side12,o=this._side20,a=t.label.precision,s=i.label.precision,l=180*W(t.getAngle(),"0to360")/Math.PI,u=180*W(e.getAngle(),"0to360")/Math.PI,c=180*W(n.getAngle(),"0to360")/Math.PI,f=h(l,a),d=h(u,a),p=h(c,a),v=h(i.getLength(),s),m=h(r.getLength(),s),y=h(o.getLength(),s);90<f&&90<d&&90<p&&(this.reverse=!this.reverse,this.updatePoints(this.points,!1),f=h(180*W(t.getAngle(),"0to360")/Math.PI,a),d=h(180*W(e.getAngle(),"0to360")/Math.PI,a),p=h(180*W(n.getAngle(),"0to360")/Math.PI,a)),180<f&&(f=360-t),180<d&&(d=360-e),180<p&&(p=360-n);var g=f+d+p,b=g-180,w=[h(l,a+1),h(u,a+1),h(c,a+1)].map(function(t){return t-Math.floor(t*Math.pow(10,a))/Math.pow(10,a)}),x=[f,d,p],_=0;if(180<g?_=w.reduce(function(t,e,n,i){return e>i[t]?n:t},0):g<180&&(_=w.reduce(function(t,e,n,i){return e<i[t]?n:t},1)),x[_]-=b,f=x[0],d=x[1],p=x[2],t.setLabel("".concat(f.toFixed(a),"")),e.setLabel("".concat(d.toFixed(a),"")),n.setLabel("".concat(p.toFixed(a),"")),t.checkLabelForRightAngle(),e.checkLabelForRightAngle(),n.checkLabelForRightAngle(),null!=this.makeValid){var T=this.makeValid.hide.minSide,k=this.makeValid.hide,O=k.minAngle,S=k.maxAngle,P=!1;null!=O&&(f<(O*=180/Math.PI)||d<O||p<O)&&(P=!0),null!=S&&((S*=180/Math.PI)<f||S<d||S<p)&&(P=!0),null!=T&&(v<T||m<T||y<T)&&(P=!0),P&&this.hideAngles()}if((i.isShown||r.isShown||o.isShown)&&0<f&&f<180&&0<d&&d<180&&0<p&&p<180){var A=1/Math.pow(10,s);60===f&&60===d&&60===p?y=m=v:f===d?v===(y=m)&&(h(i.getLength(),s+1)<v?v-=A:v+=A):f===p?y===(v=m)&&(h(o.getLength(),s+1)<y?y-=A:y+=A):d===p&&m===(y=v)&&(h(r.getLength(),s+1)<m?m-=A:m+=A)}i.setLabel("".concat(v.toFixed(s))),r.setLabel("".concat(m.toFixed(s))),o.setLabel("".concat(y.toFixed(s)))}}])&&zl(n.prototype,i),e}();function Yl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ql=function(){function t(e,n,i,r){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.webgl=e.webgl,this.draw2D=e.draw2D,this.limits=e.limits,this.shapes=e,this.isTouchDevice=i,this.animateNextFrame=r,this.equation=n}var e,n;return e=t,(n=[{key:"line",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Vt.apply(void 0,[{}].concat(e));return new jl(this.shapes,this.equation,this.isTouchDevice,this.animateNextFrame,i)}},{key:"angle",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Vt.apply(void 0,[{}].concat(e));return new Nl(this.shapes,this.equation,this.isTouchDevice,this.animateNextFrame,i)}},{key:"label",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Vt.apply(void 0,[{}].concat(e));return new xl(this.equation,i)}},{key:"polyLine",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Vt.apply(void 0,[{}].concat(e));return new Xl(this.shapes,this.equation,this,this.isTouchDevice,this.animateNextFrame,i)}}])&&Yl(e.prototype,n),t}();var Zl=function t(e,n,i,r,o,a){var s=function t(e,n){return n[0]in e?1===n.length?e[n[0]]:t(e[n[0]],n.slice(1)):null};Array.isArray(o)&&o.forEach(function(o,l){var u,c,h,f,d,p,v,m;if(Array.isArray(o)){var y=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(o,7);h=y[0],c=y[1],u=y[2],f=y[3],d=y[4],p=y[5],v=y[6]}else{if(null==o)throw Error("Add elements index ".concat(l," does not exist in layout"));c=o.name,h=o.path,f=o.options,p=o[a],u=o.method,d=o.mods,v=o.scenario}if(null==h||""===h)m=r;else{var g=h.split("/");m=s(r,g)}if(null==c||""===c)throw new Error("Diagram addElement ERROR  at index ".concat(l," in collection ").concat(r.name,": missing name property"));if(null==u||""===u)throw new Error("Diagram addElement ERROR  at index ".concat(l," in collection ").concat(r.name,": missing method property"));if(!(m instanceof Xi))throw new Error("Diagram addElement ERROR at index ".concat(l," in collection ").concat(r.name,": missing or incorrect path property"));var b=u.split("/"),w=function(t){var r={collection:e.collection.bind(e),polyLine:i.polyLine.bind(i),polyLineCorners:e.polyLineCorners.bind(e),polygon:e.polygon.bind(e),arrow:e.arrow.bind(e),fan:e.fan.bind(e),text:e.text.bind(e),textGL:e.textGL.bind(e),textHTML:e.htmlText.bind(e),axes:e.axes.bind(e),radialLines:e.radialLines.bind(e),rectangle:e.rectangle.bind(e),grid:e.grid.bind(e),dashedLine:e.dashedLine.bind(e),line:i.line.bind(i),angle:i.angle.bind(i),addEquation:n.addEquation.bind(n),addNavigator:n.addNavigator.bind(n)};if(t in r)return r[t];var o={shapes:e,objects:i,equation:n},a=t.split("/"),l=s(o,a);return null==l?null:l=l.bind(s(o,a.slice(0,-1)))}(u);if("function"==typeof w){if("function"!=typeof w)throw new Error("Layout addElement at index ".concat(l," in collection ").concat(r.name,": incorrect method property"));if(b.slice(-1)[0].startsWith("add")){var x=w(m,c,f);null!=d&&d!=={}&&x.setProperties(d),null!=v&&v in x.scenarios&&x.setScenario(v)}else{var _;if(null==(_=Array.isArray(f)?w.apply(void 0,function(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(f)):w(f)))return;null!=d&&d!=={}&&_.setProperties(d),m instanceof Xi&&m.add(c,_),null!=v&&v in _.scenarios&&_.setScenario(v)}"_".concat(c)in r&&null!=p&&p!=={}&&t(e,n,i,r["_".concat(c)],p,a)}})};function Kl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var $l=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var n={htmlId:"id_figureone_canvases",limits:new U(-1,-1,2,2),backgroundColor:[1,1,1,1],fontScale:1};this.scrolled=!1;var i=Vt({},n,e),r=i.htmlId,o=i.backgroundColor,a=i.limits;if("string"==typeof(this.htmlId=r)){var s=document.getElementById(r);if(s instanceof HTMLElement){for(var l=(this.container=s).children,u=0;u<l.length;u+=1){var c=l[u];c instanceof HTMLCanvasElement&&c.classList.contains("diagram__gl")&&(this.canvasLow=c),c instanceof HTMLCanvasElement&&c.classList.contains("diagram__gl__offscreen")&&(this.canvasOffscreen=c),c instanceof HTMLCanvasElement&&c.classList.contains("diagram__text")&&(this.textCanvasLow=c),c instanceof HTMLCanvasElement&&c.classList.contains("diagram__text__offscreen")&&(this.textCanvasOffscreen=c),c.classList.contains("diagram__html")&&(this.htmlCanvas=c)}this.backgroundColor=o;var h=new jt(this.canvasLow,this.backgroundColor);if(this.webglLow=h,this.canvasOffscreen){var f=new jt(this.canvasOffscreen,this.backgroundColor);this.webglOffscreen=f}if(this.draw2DLow=new fe(this.textCanvasLow),this.textCanvasOffscreen){var d=new fe(this.textCanvasOffscreen);this.draw2DOffscreen=d}}}if(null!=i.gestureCanvas){var p=document.getElementById(i.gestureCanvas);null!=p&&(this.gestureCanvas=p)}null==this.gestureCanvas&&(this.gestureCanvas=this.htmlCanvas),this instanceof t&&(this.gesture=new Ki(this)),this.fontScale=i.fontScale,this.updateLimits(a),this.drawQueued=!1,this.lastDrawTime=0,this.inTransition=!1,this.beingMovedElements=[],this.beingTouchedElements=[],this.moveTopElementOnly=!0,this.globalAnimation=new Qi,this.shapesLow=this.getShapes(),this.shapes=this.shapesLow,this.equationLow=this.getEquations(),this.equation=this.equationLow,this.objectsLow=this.getObjects(),this.objects=this.objectsLow,this.createDiagramElements(),""===this.elements.name&&(this.elements.name="diagramRoot"),window.addEventListener("resize",this.resize.bind(this)),this.sizeHtmlText(),this.initialize(),this.isTouchDevice=Ut(),this.animateNextFrame(!0,"first frame"),i.elements&&(this.elements=new i.elements(this),this.elements.diagramLimits=this.limits),this.waitForFrames=0,this.scrollingFast=!1,this.scrollTimeoutId=null,this.drawTimeoutId=null,this.oldScroll=window.pageYOffset,this.drawAnimationFrames=0}var e,n;return e=t,(n=[{key:"scrollEvent",value:function(){this.scrolled=!0,this.animateNextFrame(!1,"scroll event")}},{key:"enableScrolling",value:function(){document.addEventListener("scroll",this.scrollEvent.bind(this),!1)}},{key:"disableScrolling",value:function(){document.removeEventListener("scroll",this.scrollEvent.bind(this),!1)}},{key:"addElements",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"addElements";Zl(this.shapes,this.equation,this.objects,t,e,n)}},{key:"getShapes",value:function(){var t=[this.webglLow];this.webglOffscreen&&t.push(this.webglOffscreen);var e=[this.draw2DLow];return this.draw2DOffscreen&&e.push(this.draw2DOffscreen),new oa(t,e,this.htmlCanvas,this.limits,this.spaceTransforms,this.animateNextFrame.bind(this,!0,"getShapes"))}},{key:"getEquations",value:function(){var t=this.shapesLow;return new bl(t,this.animateNextFrame.bind(this,!0,"equations"))}},{key:"getObjects",value:function(){var t=this.shapesLow,e=this.equationLow;return new Ql(t,e,this.isTouchDevice,this.animateNextFrame.bind(this,!0,"objects"))}},{key:"sizeHtmlText",value:function(){var t=this.container.getBoundingClientRect(),e=t.width/35,n=document.getElementById("".concat(this.htmlId,"_measure"));if(null!=n){n.style.fontSize="".concat(e,"px");var i=(n.clientWidth+1)/t.width;e=t.width<500?Math.floor(.84/i*e*1e4)/1e4:Math.floor(.85/i*e*1e4)/1e4}this.htmlCanvas.style.fontSize="".concat(e,"px")}},{key:"destroy",value:function(){this.gesture.destroy(),this.webglLow.gl.getExtension("WEBGL_lose_context").loseContext()}},{key:"setSpaceTransforms",value:function(){var t={x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},e={x:{bottomLeft:this.limits.left,width:this.limits.width},y:{bottomLeft:this.limits.bottom,height:this.limits.height}},n=this.canvasLow.getBoundingClientRect(),i={x:{bottomLeft:0,width:n.width},y:{bottomLeft:n.height,height:-n.height}};this.spaceTransforms={diagramToGL:ft(e,t,"Diagram"),glToDiagram:ft(t,e),pixelToDiagram:ft(i,e),diagramToPixel:ft(e,i),pixelToGL:ft(i,t),glToPixel:ft(t,i),diagramToCSSPercent:ft(e,{x:{bottomLeft:0,width:1},y:{bottomLeft:1,height:-1}})}}},{key:"initialize",value:function(){this.setFirstTransform()}},{key:"setFirstTransform",value:function(){this.elements.setFirstTransform(this.spaceTransforms.diagramToGL)}},{key:"updateLimits",value:function(t){this.limits=t._dup(),this.setSpaceTransforms()}},{key:"renderAllElementsToTiedCanvases",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(null!=this.canvasOffscreen){var n=!1;Object.keys(this.elements.elements).forEach(function(i){var r=t.elements.elements[i];r.isShown&&(!1===r.isRenderedAsImage||e)&&null!=r.tieToHTML.element&&(r.isRenderedAsImage=!0,t.renderElementToTiedCanvas(i),n=!0)}),n&&(this.drawQueued=!0,this.clearContext(),this.draw2DLow.ctx.clearRect(0,0,this.textCanvasLow.width,this.textCanvasLow.height),this.draw(-1))}}},{key:"renderElementToTiedCanvas",value:function(t){var e=this,n={};Object.keys(this.elements.elements).forEach(function(t){var i=e.elements.elements[t];n[t]=i.isShown}),Object.keys(this.elements.elements).forEach(function(t){e.elements.elements[t].hide()});var i=this.elements.elements[t];i.show();var r=i.getPosition(),o=i.getScale(),a=document.getElementById(i.tieToHTML.element);a instanceof HTMLElement&&(this.canvasOffscreen.style.width="".concat(a.clientWidth,"px"),this.canvasOffscreen.style.height="".concat(a.clientHeight,"px"),this.textCanvasOffscreen.style.width="".concat(a.clientWidth,"px"),this.textCanvasOffscreen.style.height="".concat(a.clientHeight,"px"),this.webglOffscreen.resize(),this.draw2DOffscreen.resize()),i.updateHTMLElementTie(this.canvasOffscreen);var s=i.getScale();i.setPosition(0-s.x*(i.tieToHTML.window.left+i.tieToHTML.window.width/2),0-s.y*(i.tieToHTML.window.bottom+i.tieToHTML.window.height/2)),i.isRenderedAsImage=!1,i.stop(!0,!0),this.renderToCanvas(i.tieToHTML.element),i.isRenderedAsImage=!0,i.setPosition(r),i.setScale(o),Object.keys(this.elements.elements).forEach(function(t){var i=e.elements.elements[t];!0===n[t]?i.show():i.hide()})}},{key:"renderToCanvas",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=t;if("string"==typeof t&&(e=document.getElementById(t)),e instanceof HTMLElement){this.drawQueued=!0,this.draw(-1,1);var n=document.getElementById("".concat(t,"_webgl"));n instanceof HTMLImageElement&&(n.src=this.webglOffscreen.gl.canvas.toDataURL("image/png",.5),n.style.display="block");var i=document.getElementById("".concat(t,"_2d"));i instanceof HTMLImageElement&&(i.src=this.draw2DOffscreen.canvas.toDataURL("image/png",.5),i.style.display="block"),this.clearContext(1)}}},{key:"unrenderAll",value:function(){for(var t=0;t<this.elements.drawOrder.length;t+=1)this.elements.elements[this.elements.drawOrder[t]].unrender()}},{key:"resize",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.webglLow.resize(),this.draw2DLow.resize(),this.setSpaceTransforms(),null!=this.elements&&this.elements.updateLimits(this.limits,this.spaceTransforms),this.sizeHtmlText(),t?this.elements.resize():this.elements.resize(this.canvasLow),this.oldWidth!==this.canvasLow.clientWidth&&(this.renderAllElementsToTiedCanvases(),this.oldWidth=this.canvasLow.clientWidth),this.animateNextFrame(!0,"resize"),this.drawAnimationFrames=2}},{key:"updateHTMLElementTie",value:function(){null!=this.elements&&this.elements.updateHTMLElementTie(this.canvasLow)}},{key:"touchDownHandler",value:function(t){if(this.inTransition)return!1;var e=this.clientToPixel(t).transformBy(this.spaceTransforms.pixelToGL.matrix());this.beingTouchedElements=this.elements.getTouched(e),this.moveTopElementOnly?0<this.beingTouchedElements.length&&this.beingTouchedElements[0].click():this.beingTouchedElements.forEach(function(t){return t.click()}),this.beingMovedElements=[];for(var n=0;n<this.beingTouchedElements.length;n+=1){var i=this.beingTouchedElements[n];i.isMovable&&(this.beingMovedElements.push(i),i.startBeingMoved())}return 0<this.beingMovedElements.length&&this.animateNextFrame(!0,"touch down handler"),0<this.beingTouchedElements.length}},{key:"touchUpHandler",value:function(){for(var t=0;t<this.beingMovedElements.length;t+=1){var e=this.beingMovedElements[t];e.state.isBeingMoved&&(e.stopBeingMoved(),e.startMovingFreely())}this.beingMovedElements=[],this.beingTouchedElements=[]}},{key:"rotateElement",value:function(t,e,n){var i=t.getDiagramPosition();null==i&&(i=new X(0,0));var r=i.transformBy(this.spaceTransforms.diagramToPixel.matrix()),o=this.clientToPixel(e),a=this.clientToPixel(n),s=Math.atan2(a.y-r.y,a.x-r.x),l=-et(Math.atan2(o.y-r.y,o.x-r.x),s),u=t.transform._dup(),c=u.r();null==c&&(c=0);var h=c-l;u.updateRotation(h),t.moved(u._dup())}},{key:"translateElement",value:function(t,e,n){var i=this.clientToPixel(e),r=this.clientToPixel(n),o=i.transformBy(this.spaceTransforms.pixelToDiagram.matrix()),a=r.transformBy(this.spaceTransforms.pixelToDiagram.matrix()),s=t.diagramSpaceToVertexSpaceTransformMatrix(),l=a.transformBy(s),u=o.transformBy(s),c=l.sub(u),h=t.transform._dup(),f=h.t();if(null!=f){var d=f.add(c);h.updateTranslation(d),t.moved(h)}}},{key:"scaleElement",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",r=this.clientToPixel(e),o=this.clientToPixel(n),a=t.getDiagramPosition().transformBy(this.spaceTransforms.diagramToPixel.matrix()),s=r.sub(a).distance(),l=o.sub(a).distance(),u=t.transform.s();if(null!=u){var c=t.transform._dup(),h=u.x*l/s,f=u.y*l/s;"x"===i?c.updateScale(h,1):"y"===i?c.updateScale(1,f):c.updateScale(h,f),t.moved(c)}}},{key:"touchMoveHandler",value:function(t,e){if(this.inTransition)return!1;if(0===this.beingMovedElements.length)return!1;for(var n=this.clientToPixel(t).transformBy(this.spaceTransforms.pixelToGL.matrix()),i=0;i<this.beingMovedElements.length;i+=1){var r=this.beingMovedElements[i];if(r!==this.elements&&(r.isBeingTouched(n)||r.move.canBeMovedAfterLoosingTouch)){var o=null==r.move.element?r:r.move.element;!1===o.state.isBeingMoved&&o.startBeingMoved(),-1===this.beingMovedElements.indexOf(o)&&this.beingMovedElements.push(o),"rotation"===r.move.type?this.rotateElement(o,t,e):"scale"===r.move.type?this.scaleElement(o,t,e):"scaleX"===r.move.type?this.scaleElement(o,t,e,"x"):"scaleY"===r.move.type?this.scaleElement(o,t,e,"y"):this.translateElement(o,t,e)}this.moveTopElementOnly&&(i=this.beingMovedElements.length)}return this.animateNextFrame(!0,"touch move handler"),!0}},{key:"stop",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.elements.stop(t,e)}},{key:"createDiagramElements",value:function(){this.elements=new Xi,this.elements.diagramLimits=this.limits}},{key:"add",value:function(t,e){this.elements.add(t,e)}},{key:"setElementsToCollection",value:function(t){this.elements=t,this.setFirstTransform()}},{key:"clearContext",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;0===t?(this.webglLow.gl.clearColor(0,0,0,0),this.webglLow.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT)):(this.webglOffscreen.gl.clearColor(0,0,0,0),this.webglOffscreen.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT)),this.elements.clear(t)}},{key:"drawNow",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;this.drawQueued=!0,this.draw(t)}},{key:"draw",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=t;-1===t&&(n=this.lastDrawTime),this.lastDrawTime=n,!0===this.scrolled&&(this.scrolled=!1,Math.abs(window.pageYOffset-this.oldScroll)>this.webglLow.gl.canvas.clientHeight/4&&(this.renderAllElementsToTiedCanvases(),this.scrollingFast=!0,this.scrollTimeoutId&&(clearTimeout(this.scrollTimeoutId),this.scrollTimeoutId=null),this.scrollTimeoutId=setTimeout(this.centerDrawingLens.bind(this,!0),100))),!1!==this.drawQueued&&(this.drawQueued=!1,this.clearContext(e),this.elements.draw(this.spaceTransforms.diagramToGL,n,e),this.elements.isMoving()&&this.animateNextFrame(!0,"is moving"),0<this.drawAnimationFrames&&(this.drawAnimationFrames-=1,this.animateNextFrame(!0,"queued frames")))}},{key:"centerDrawingLens",value:function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0]&&(this.scrollingFast=!1);var t=window.innerHeight||0;null!=document.documentElement&&(t=Math.max(document.documentElement.clientHeight,window.innerHeight||0));var e=window.pageYOffset+t/2-this.webglLow.gl.canvas.clientHeight/2;e<0&&(e=0);var n="".concat(e,"px");this.webglLow.gl.canvas.style.top!==n&&(this.webglLow.gl.canvas.style.top="".concat(e,"px"),this.draw2DLow.canvas.style.top="".concat(e,"px"),this.updateHTMLElementTie()),this.oldScroll=window.pageYOffset}},{key:"animateNextFrame",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";this.fromWhere=e,this.drawQueued||(t&&(this.drawQueued=!0),this.globalAnimation.queueNextFrame(this.draw.bind(this)))}},{key:"isAnimating",value:function(){return this.elements.isMoving()}},{key:"clientToPixel",value:function(t){var e=this.canvasLow.getBoundingClientRect();return new X(t.x-e.left,t.y-e.top)}}])&&Kl(e.prototype,n),t}();function Jl(t){return(Jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tu(t,e){return!e||"object"!==Jl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function eu(t,e,n){return(eu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=nu(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function nu(t){return(nu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function iu(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function ru(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ou(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function au(t,e,n){return e&&ou(t.prototype,e),n&&ou(t,n),t}var su=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";ru(this,t),this.id=e,Array.isArray(n)?this.classes=n:0<n.length?this.classes=n.split(" "):this.classes=[]}return au(t,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=" ".repeat(i),o=t?' id="'.concat(t,'"'):"",a=e?" ".concat(e.join(" ")):"",s="".concat(r,"<div").concat(o,' class="equation_element').concat(a,'">\n');return(s+="".concat(n,"\n"))+"".concat(r,"</div>")}(this.id,this.classes,e,t)}}]),t}(),lu=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return ru(this,e),(n=tu(this,nu(e).call(this,i,r))).classes.push("equation_text"),n.text=t,n}return iu(e,su),au(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return eu(nu(e.prototype),"render",this).call(this,t,"".concat(" ".repeat(t+2)).concat(this.text))}}]),e}(),uu=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];ru(this,e),n=tu(this,nu(e).call(this,i,r));var o=[];return t.forEach(function(t){null!==t&&o.push(t)}),n.content=o,n}return iu(e,su),au(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return eu(nu(e.prototype),"render",this).call(this,t,this.content.map(function(e){return e.render(t+2)}).join("\n"))}}]),e}(),cu=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return ru(this,e),(i=tu(this,nu(e).call(this,r,o))).classes.push("fraction"),i.numerator=t,i.denominator=n,i}return iu(e,su),au(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=" ".repeat(t+2),i="";return i+="".concat(n,'<div class="numerator">\n'),i+=this.numerator.render(t+4),i+="\n".concat(n,"</div>\n"),i+="".concat(n,'<div class="fraction_line"> </div>\n'),i+="".concat(n,'<div class="denominator">\n'),i+=this.denominator.render(t+4),i+="\n".concat(n,"</div>"),eu(nu(e.prototype),"render",this).call(this,t,i)}}]),e}(),hu=function(t){function e(t,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"";return ru(this,e),(r=tu(this,nu(e).call(this,o,a))).classes.push("supersub"),r.superscript=n,r.subscript=i,r.content=t,r}return iu(e,su),au(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=" ".repeat(t+2),i="";return i+="".concat(n,'<div class="supsub_content element">\n'),i+=this.content.render(t+2),i+="\n".concat(n,"</div>\n"),i+="".concat(n,'<div class="super_sub element">\n'),i+="".concat(n,'<div class="super_sub_super superscript_text element">\n'),null!==this.superscript&&(i+=this.superscript.render(t+4)),i+="\n".concat(n,"</div>\n"),i+="".concat(n,'<div class="super_sub_sub subscript_text element">\n'),null!==this.subscript&&(i+=this.subscript.render(t+4)),i+="\n".concat(n,"</div>"),i+="\n".concat(n,"</div>\n"),eu(nu(e.prototype),"render",this).call(this,t,i)}}]),e}(),fu=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";ru(this,e);var a=(i=tu(this,nu(e).call(this,t,null,n,r,o))).classes.indexOf("supersub");return-1<a&&i.classes.splice(a,1),i.classes.push("subscript"),i}return iu(e,hu),e}(),du=function(t){function e(t,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";ru(this,e);var a=(i=tu(this,nu(e).call(this,t,n,null,r,o))).classes.indexOf("supersub");return-1<a&&i.classes.splice(a,1),i.classes.push("superscript"),i}return iu(e,hu),e}(),pu=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return ru(this,e),(n=tu(this,nu(e).call(this,i,r))).content=t,n}return iu(e,su),au(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=" ".repeat(t+2),i="";return i+="".concat(n,'<div class="square_root element">\n'),i+="".concat(n,'  <div class="equation_element radical element">\n'),i+="".concat(n,"    &radic;\n"),i+="".concat(n,"  </div>\n"),i+=this.content.render(t+4),i+="\n".concat(n,"</div>"),eu(nu(e.prototype),"render",this).call(this,t,i)}}]),e}();function vu(t){if(t instanceof uu)return t;if(t instanceof lu||t instanceof su)return new uu([t]);if("string"==typeof t)return new uu([new lu(t)]);var e=[];return t.forEach(function(t){"string"==typeof t?e.push(new lu(t)):e.push(t)}),new uu(e)}var mu={tools:{math:i,g2:r,color:a,css:u,html:l,misc:o},Diagram:$l,DiagramElement:Wi,DiagramElementCollection:Xi,DiagramElementPrimative:Ui,DrawContext2D:fe,WebGLInstance:jt,DrawingObject:te,VertexObject:ce,TextObject:xe,DiagramText:we,DiagramFont:be,HTMLObject:oe,DiagramObjectAngle:Nl,DiagramObjectLine:jl,DiagramObjectPolyLine:Xl,EqnNavigator:yl,EquationLabel:xl,EquationForm:vs,Equation:sl,HTMLEquation:function(t){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return ru(this,e),tu(this,nu(e).call(this,[],t,n))}return iu(e,uu),au(e,[{key:"createEq",value:function(t){var e=this,n=[];t.forEach(function(t){"string"==typeof t?n.push(new lu(t)):n.push(t),e.content=n})}},{key:"htmlElement",value:function(){var t=document.createElement("div");return t.setAttribute("id",this.id),t.innerHTML=this.render(),this.classes.forEach(function(e){e&&t.classList.add(e)}),t}},{key:"el",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return new lu(t,e,n)}},{key:"supsub",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[];return new hu(vu(t),vu(e),vu(n),i,r)}},{key:"sub",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return new fu(vu(t),vu(e),n,i)}},{key:"sup",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return new du(vu(t),vu(e),n,i)}},{key:"frac",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return new cu(vu(t),vu(e),n,i)}},{key:"sqrt",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return new pu(vu(t),e,n)}}]),e}(),Point:X,Line:ot,Rect:U,Transform:ht,TransformLimit:ct,Translation:lt,Scale:ut,Rotation:st,parsePoint:kt};e.default=mu}])});