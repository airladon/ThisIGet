!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Fig",[],e):"object"==typeof exports?exports.Fig=e():t.Fig=e()}(window,(function(){return n={},t.m=e=[function(t,e){t.exports=function(){return new Worker("/static/workers/b00a79eb7637fda1b1fa.worker.js")}},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"round",(function(){return f})),n.d(r,"roundNum",(function(){return h})),n.d(r,"decelerate",(function(){return y})),n.d(r,"easeinout",(function(){return g})),n.d(r,"easeout",(function(){return b})),n.d(r,"easein",(function(){return w})),n.d(r,"sinusoid",(function(){return S})),n.d(r,"linear",(function(){return v})),n.d(r,"triangle",(function(){return m})),n.d(r,"clipMag",(function(){return d})),n.d(r,"clipValue",(function(){return p})),n.d(r,"range",(function(){return x})),n.d(r,"randInt",(function(){return T})),n.d(r,"rand",(function(){return k})),n.d(r,"randElement",(function(){return O})),n.d(r,"removeRandElement",(function(){return P})),n.d(r,"randElements",(function(){return A})),n.d(r,"rand2D",(function(){return E})),n.d(r,"randSign",(function(){return _}));var i={};n.r(i),n.d(i,"diffPathsToObj",(function(){return Pt})),n.d(i,"diffObjToPaths",(function(){return At})),n.d(i,"Console",(function(){return Z})),n.d(i,"classify",(function(){return J})),n.d(i,"extractFrom",(function(){return et})),n.d(i,"ObjectKeyPointer",(function(){return tt})),n.d(i,"getElement",(function(){return nt})),n.d(i,"addToObject",(function(){return rt})),n.d(i,"duplicateFromTo",(function(){return lt})),n.d(i,"isTouchDevice",(function(){return ct})),n.d(i,"generateUniqueId",(function(){return ut})),n.d(i,"joinObjects",(function(){return st})),n.d(i,"cleanUIDs",(function(){return dt})),n.d(i,"loadRemote",(function(){return ht})),n.d(i,"loadRemoteCSS",(function(){return ft})),n.d(i,"deleteKeys",(function(){return pt})),n.d(i,"copyKeysFromTo",(function(){return yt})),n.d(i,"generateRandomString",(function(){return vt})),n.d(i,"duplicate",(function(){return it})),n.d(i,"assignObjectFromTo",(function(){return ot})),n.d(i,"joinObjectsWithOptions",(function(){return at})),n.d(i,"objectToPaths",(function(){return xt})),n.d(i,"getObjectDiff",(function(){return _t})),n.d(i,"updateObjFromPath",(function(){return Tt})),n.d(i,"pathsToObj",(function(){return kt})),n.d(i,"UniqueMap",(function(){return mt})),n.d(i,"compressObject",(function(){return gt})),n.d(i,"refAndDiffToObject",(function(){return Ot})),n.d(i,"uncompressObject",(function(){return bt})),n.d(i,"unminify",(function(){return St})),n.d(i,"minify",(function(){return wt})),n.d(i,"ObjectTracker",(function(){return Et})),n.d(i,"download",(function(){return Rt})),n.d(i,"Subscriber",(function(){return Mt})),n.d(i,"SubscriptionManager",(function(){return jt}));var o={};n.r(o),n.d(o,"point",(function(){return he})),n.d(o,"Point",(function(){return se})),n.d(o,"line",(function(){return we})),n.d(o,"Line",(function(){return ge})),n.d(o,"distance",(function(){return fe})),n.d(o,"minAngleDiff",(function(){return pe})),n.d(o,"deg",(function(){return de})),n.d(o,"normAngle",(function(){return ye})),n.d(o,"Transform",(function(){return ke})),n.d(o,"Rect",(function(){return oe})),n.d(o,"Translation",(function(){return _e})),n.d(o,"Scale",(function(){return Te})),n.d(o,"Rotation",(function(){return xe})),n.d(o,"spaceToSpaceTransform",(function(){return Pe})),n.d(o,"getBoundingRect",(function(){return Re})),n.d(o,"linearPath",(function(){return le})),n.d(o,"curvedPath",(function(){return ue})),n.d(o,"quadraticBezier",(function(){return Zt})),n.d(o,"translationPath",(function(){return ce})),n.d(o,"polarToRect",(function(){return Me})),n.d(o,"rectToPolar",(function(){return je})),n.d(o,"getDeltaAngle",(function(){return me})),n.d(o,"normAngleTo90",(function(){return ve})),n.d(o,"threePointAngle",(function(){return Ce})),n.d(o,"threePointAngleMin",(function(){return De})),n.d(o,"randomPoint",(function(){return Le})),n.d(o,"getMaxTimeFromVelocity",(function(){return Be})),n.d(o,"getMoveTime",(function(){return Ie})),n.d(o,"parsePoint",(function(){return ee})),n.d(o,"clipAngle",(function(){return Jt})),n.d(o,"spaceToSpaceScale",(function(){return Ae})),n.d(o,"getPoint",(function(){return ne})),n.d(o,"getScale",(function(){return ie})),n.d(o,"getPoints",(function(){return re})),n.d(o,"quadBezierPoints",(function(){return Fe})),n.d(o,"getRect",(function(){return ae})),n.d(o,"getTransform",(function(){return Oe})),n.d(o,"getLine",(function(){return Se})),n.d(o,"deceleratePoint",(function(){return Ge})),n.d(o,"decelerateValue",(function(){return Xe})),n.d(o,"decelerateTransform",(function(){return $e})),n.d(o,"RectBounds",(function(){return Ne})),n.d(o,"LineBounds",(function(){return ze})),n.d(o,"RangeBounds",(function(){return qe})),n.d(o,"TransformBounds",(function(){return Ue})),n.d(o,"Vector",(function(){return be})),n.d(o,"transformValueToArray",(function(){return Ve})),n.d(o,"getBounds",(function(){return He})),n.d(o,"Bounds",(function(){return We}));var a={};n.r(a),n.d(a,"RGBToArray",(function(){return Mn})),n.d(a,"HexToArray",(function(){return jn})),n.d(a,"cssColorToArray",(function(){return Rn})),n.d(a,"colorArrayToRGB",(function(){return Dn})),n.d(a,"colorArrayToRGBA",(function(){return Cn})),n.d(a,"getCSSColors",(function(){return En})),n.d(a,"areColorsSame",(function(){return Ln})),n.d(a,"areColorsWithinDelta",(function(){return Bn}));var s={};n.r(s),n.d(s,"PositionAnimationStep",(function(){return wn})),n.d(s,"AnimationBuilder",(function(){return Ko})),n.d(s,"ParallelAnimationStep",(function(){return Vn})),n.d(s,"SerialAnimationStep",(function(){return Mi})),n.d(s,"TransformAnimationStep",(function(){return Dr})),n.d(s,"AnimationStep",(function(){return ln})),n.d(s,"DelayStep",(function(){return Ii})),n.d(s,"TriggerStep",(function(){return fi})),n.d(s,"inParallel",(function(){return Un})),n.d(s,"inSerial",(function(){return ji})),n.d(s,"trigger",(function(){return di})),n.d(s,"delay",(function(){return Fi})),n.d(s,"ColorAnimationStep",(function(){return ur})),n.d(s,"DissolveInAnimationStep",(function(){return kr})),n.d(s,"dissolveIn",(function(){return Or})),n.d(s,"DissolveOutAnimationStep",(function(){return Pr})),n.d(s,"dissolveOut",(function(){return Ar})),n.d(s,"CustomAnimationStep",(function(){return Si})),n.d(s,"custom",(function(){return xi})),n.d(s,"AnimationManager",(function(){return No})),n.d(s,"RotationAnimationStep",(function(){return Gr})),n.d(s,"ScaleAnimationStep",(function(){return Zr})),n.d(s,"PulseAnimationStep",(function(){return ii})),n.d(s,"OpacityAnimationStep",(function(){return Tr})),n.d(s,"DimAnimationStep",(function(){return cr})),n.d(s,"dim",(function(){return hr})),n.d(s,"UndimAnimationStep",(function(){return fr})),n.d(s,"undim",(function(){return dr})),n.d(s,"ScenarioAnimationStep",(function(){return Zn})),n.d(s,"PulseTransformAnimationStep",(function(){return qr}));var l={};n.r(l),n.d(l,"actionWord",(function(){return ya})),n.d(l,"click",(function(){return da})),n.d(l,"highlight",(function(){return la})),n.d(l,"addClass",(function(){return ha})),n.d(l,"addId",(function(){return fa})),n.d(l,"onClickId",(function(){return va})),n.d(l,"highlightWord",(function(){return ca})),n.d(l,"centerV",(function(){return ea})),n.d(l,"centerH",(function(){return ra})),n.d(l,"centerVH",(function(){return na})),n.d(l,"toHTML",(function(){return sa})),n.d(l,"itemSelector",(function(){return oa})),n.d(l,"unit",(function(){return aa})),n.d(l,"applyModifiers",(function(){return ma})),n.d(l,"setOnClicks",(function(){return ga})),n.d(l,"setHTML",(function(){return ba})),n.d(l,"withClass",(function(){return ta})),n.d(l,"style",(function(){return ia})),n.d(l,"clickW",(function(){return pa})),n.d(l,"link",(function(){return ua}));var u={};n.r(u),n.d(u,"joinLinesInPoint",(function(){return tl})),n.d(u,"lineSegmentsToPoints",(function(){return Js})),n.d(u,"joinLinesInTangent",(function(){return el})),n.d(u,"makePolyLine",(function(){return ol})),n.d(u,"makePolyLineCorners",(function(){return al}));var c={};n.r(c),n.d(c,"getCSSVariables",(function(){return kn})),n.d(c,"getDefinedCSSVariables",(function(){return Tn})),n.d(c,"searchObject",(function(){return xn})),n.d(c,"getCSSColors",(function(){return En}));var h=function(t,e){var n=1<arguments.length&&void 0!==e?e:5,r=Math.pow(10,n),i=Math.round(t*r)/r;return-0!==i||0===i&&1/i!=-1/0||(i=0),i};function f(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5,n=0;return Array.isArray(t)?t.map((function(t){return f(t,e)})):("number"==typeof t?n=h(t,e):null!=t&&null!=t.round&&(n=t.round(e)),n)}function d(t,e,n){var r=t,i=e,o=n;return null===i&&(i=0),i<0&&(i=-i),null===o||(o<0&&(o=-o),-i<=t&&t<=i&&(r=0),o<t&&(r=o),t<-o&&(r=-o)),r}function p(t,e,n){var r=t;return null!==e&&t<e&&(r=e),null!==n&&n<t&&(r=n),r}var y=function(t,e,n,r,i){var o=0;null!==i&&(o=i);var a=0;if(null!==n&&(a=n),0===d(e,o,e))return{p:t,v:0};var s=a;a<0&&(s=-s);var l=e/Math.abs(e),u=e-l*s*r,c=r;if(0===(u=u/Math.abs(u)!=l?0:d(u,o,u))){var h=o;h/Math.abs(h)!=l&&(h=-h),c=Math.abs((h-e)/s)}return{p:t+e*c-.5*l*s*c*c,v:u}},v=function(t,e){return t};function m(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;return(2<arguments.length&&void 0!==arguments[2]?arguments[2]:0)+2*(3<arguments.length&&void 0!==arguments[3]?arguments[3]:1)/Math.PI*Math.asin(Math.sin(2*Math.PI*e*t+n))}var g=function(t,e){if(1<arguments.length&&void 0!==e&&e){if(.5===t)return.5;var n=t;return(2*n-Math.sqrt(-4*n*n+4*n))/(4*n-2)}var r=t;return Math.pow(r,2)/(Math.pow(r,2)+Math.pow(1-r,2))};function b(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){if(0===t)return 0;var e=t/2+.5;return 2*((2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)-.5)}var n=.5+t/2;return 2*(Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))-.5)}function w(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){if(1===t)return 1;var e=t/2;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)*2}var n=t/2;return Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))*2}function S(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;return(2<arguments.length&&void 0!==arguments[2]?arguments[2]:0)+(3<arguments.length&&void 0!==arguments[3]?arguments[3]:1)*Math.sin(t*e*2*Math.PI+n)}function x(t,e){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=[],i=t;i<=e+.5*n;i+=n)r.push(i);return r}function _(){return.5<Math.random()?1:-1}function T(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=0;if(null!=e){var i=t;r=Math.floor(Math.random()*Math.floor(e-i)+Math.floor(i))}else r=Math.floor(Math.random()*Math.floor(t));return n&&(r*=_()),r}function k(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=0;if(null!=e){var i=t;r=Math.random()*(e-i)+i}else r=Math.random()*t;return n&&(r*=_()),r}function O(t){return t[T(t.length)]}function P(t){var e=k(t.length);return t.splice(e,1)[0]}function A(t,e){for(var n=x(0,e.length-1,1),r=[],i=0;i<t;i+=1){var o=P(n);r.push(e[o])}return r}function E(t,e,n,r){return{x:k(t,n),y:k(e,r)}}function M(t,e,n){return(M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=B(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=B(t);if(e){var i=B(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return D(this,n)}}function D(t,e){return!e||"object"!==j(e)&&"function"!=typeof e?L(t):e}function L(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function I(t){return function(t){if(Array.isArray(t))return F(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return F(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?F(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e,n){return e&&q(t.prototype,e),n&&q(t,n),t}var z=function(){function t(){W(this,t),this.map={}}return N(t,[{key:"add",value:function(t,e){null==this.map&&(this.map={}),this.map[t]={fn:e}}},{key:"exec",value:function(t){if(null==t)return null;for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i;return"string"==typeof t&&null!=this.map[t]?0===n.length?this.map[t].fn():(i=this.map[t]).fn.apply(i,n):"function"==typeof t?t.apply(void 0,n):null}},{key:"execOnMaps",value:function(t,e){if(null==t)return null;for(var n=arguments.length,r=new Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if("string"==typeof t)for(var o=[this.map].concat(I(e)),a=0;a<o.length;a+=1){var s,l=o[a];if(null!=l[t])return 0===r.length?l[t].fn():(s=l[t]).fn.apply(s,r)}return"function"==typeof t?t.apply(void 0,r):null}}]),t}(),H=function(){R(e,z);var t=C(e);function e(){var n;return W(this,e),e.instance||(n=t.call(this),e.instance=L(n),n.map={}),D(n,e.instance)}return e}(),V=function(){R(e,z);var t=C(e);function e(){var n;return W(this,e),(n=t.call(this)).global=new H,n}return N(e,[{key:"exec",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this.execOnMaps.apply(this,[t,[this.global.map]].concat(n))}},{key:"execOnMaps",value:function(t,n){for(var r,i=arguments.length,o=new Array(2<i?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return(r=M(B(e.prototype),"execOnMaps",this)).call.apply(r,[this,t,[].concat(I(n),[this.global.map])].concat(o))}}]),e}();function U(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||G(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Y(t){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function K(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Q(t,e,n){return e&&K(t.prototype,e),n&&K(t,n),t}var Z=function(t){console.log(t)},J=function(t,e){var n=e||t,r="-"===n[0]||n.startsWith("".concat(t,"-"))?"".concat(t," ").concat(n):n,i=" ".concat(t,"-");return"".concat(r.split(" -").join(i))},tt=function(){function t(e,n){$(this,t),this.object=e,this.key="",n in e&&(this.key=n)}return Q(t,[{key:"setValue",value:function(t){this.key&&(this.object[this.key]=t)}},{key:"execute",value:function(){if(this.key){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.object[this.key].apply(null,e)}}},{key:"value",value:function(){if(this.key)return this.object[this.key]}}]),t}();function et(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=[];if("string"!=typeof e)return Array.isArray(e)?e.forEach((function(e){var i=et(t,e,n);void 0!==i&&r.push(i)})):Object.keys(e).forEach((function(i){n+i in t&&r.push({obj:new tt(t,n+i),value:e[i]})})),r;if(n+e in t)return new tt(t,n+e);var i=e.split("_").filter((function(t){return 0<t.length}));if(1<i.length){if(n+i[0]in t)return et(t[n+i[0]],i.slice(1).join("_"),n)}else if(1===i.length&&n+i[0]in t)return new tt(t,n+i[0])}function nt(t,e){return et(t,e,"_")}function rt(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"-",i=e.split(r),o=t;i.forEach((function(t,e){e!==i.length-1?(Object.prototype.hasOwnProperty.call(o,t)||(o[t]={}),o=o[t]):o[t]=n}))}function it(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t||NaN===t||"function"==typeof t)return t;if("function"==typeof t._dup)return t._dup();if(Array.isArray(t)){var e=[];return t.forEach((function(t){return e.push(it(t))})),e}var n={};return Object.keys(t).forEach((function(e){var r=it(t[e]);n[e]=r})),n}function ot(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"",o="string"==typeof n?[n]:n;Object.keys(t).forEach((function(n){var a=""!==i?"".concat(i,".").concat(n):n;if(-1===o.indexOf(a)){var s=t[n];if("object"===Y(s)&&null!=s&&s._assignAsLinkOnly)e[n]=t[n];else if("number"==typeof s||"boolean"==typeof s||"string"==typeof s||null==s||"function"==typeof s||"function"==typeof s._dup||Array.isArray(s))void 0===s&&void 0!==e[n]||(e[n]=r?it(s):s);else{var l=e[n];"number"!=typeof l&&"boolean"!=typeof l&&"string"!=typeof l&&null!=l&&"function"!=typeof l&&!Array.isArray(l)||(e[n]={}),ot(s,e[n],o,r,a)}}}))}function at(t){var e=t.except,n=t.duplicate;null==e&&(e=[]),null==n&&(n=!1);for(var r=arguments.length<=1?0:arguments.length-1,i=arguments.length<=1?void 0:arguments[1],o=1;o<r;o+=1){var a=o+1<1||arguments.length<=o+1?void 0:arguments[o+1];null!=a&&ot(a,i,e,n,"")}return i}function st(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return at.apply(void 0,[{}].concat(e))}function lt(t,e){at({except:2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],duplicate:!0},e,t)}function ut(){function t(t){return"".concat(t).concat(Math.floor(1e6*Math.random()))}var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";0===e.length&&(e="id_random_");for(var n=!0,r=t(e);n;)r=t(e),null==document.getElementById(r)&&(n=!1);return r}function ct(){var t=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;var e=["(",t.join("touch-enabled),("),"heartz",")"].join("");return window.matchMedia(e).matches}function ht(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(document.getElementById(t))null!=n&&n(t,e);else{var r=document.createElement("script");r.type="text/javascript",r.src=e,r.id=t,document.body&&document.body.appendChild(r),r.onload=function(){null!=n&&n(t,e)}}}function ft(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(document.getElementById(t))null!=n&&n(t,e);else{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,r.id=t,document.body&&document.body.appendChild(r),r.onload=function(){null!=n&&n(t,e)}}}var dt=function t(e){var n="0000000000";if(null!=e){if("uid"in e){if(e.uid===n)return;e.uid=n}for(var r=Object.keys(e),i=0;i<r.length;i+=1){var o=e[r[i]];"object"!==Y(o)||Array.isArray(o)||null==o||"function"==typeof o||"number"==typeof o||"boolean"==typeof o||"string"==typeof o||t(o)}}};function pt(t,e){e.forEach((function(e){void 0!==t[e]&&delete t[e]}))}function yt(t,e,n){n.forEach((function(n){void 0!==t[n]&&(e[n]=t[n])}))}function vt(){return(1e18*Math.random()).toString(36)}var mt=function(){function t(){$(this,t),this.map={},this.index=1,this.inverseMap={},this.letters="0abcdefghijklmnopqrstuvwxz",this.undefinedCode=".a"}return Q(t,[{key:"reset",value:function(){this.index=1,this.map={}}},{key:"add",value:function(t){if(null!=this.map[t])return this.map[t];var e=this.getNextUniqueString();return this.map[t]=e}},{key:"getNextUniqueString",value:function(){if(0===this.index)return"a";for(var t=Math.floor(Math.log(this.index)/Math.log(this.letters.length)),e=this.index,n="",r=t;0<=r;--r){var i=Math.floor(e/Math.pow(this.letters.length,r));e-=i*Math.pow(this.letters.length,r),n="".concat(n).concat(this.letters[i])}return this.index+=1,n}},{key:"makeInverseMap",value:function(){var t=this;this.inverseMap={},Object.keys(this.map).forEach((function(e){var n=t.map[e];t.inverseMap[n]=e}))}},{key:"get",value:function(t){if(t!==this.undefinedCode)return null!=this.inverseMap[t]?this.inverseMap[t]:t}}]),t}();function gt(t,e){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,o=5<arguments.length&&void 0!==arguments[5]&&arguments[5];if("string"==typeof t)return r&&o?e.get(t):r?e.add(t):t;if("number"==typeof t)return null===i||o?t:h(t,i);if("boolean"==typeof t||"function"==typeof t||null===t)return t;if(void 0===t)return e.undefinedCode;if(Array.isArray(t)){for(var a=0;a<t.length;a+=1)t[a]=gt(t[a],e,n,r,i,o);return t}if("object"!==Y(t))return t;for(var s=Object.keys(t),l={},u=0;u<s.length;u+=1){var c=s[u];if(t[c]=gt(t[c],e,n,r,i,o),n&&o){var f=e.get(c);null!=f&&(l[f]=t[c])}else n?l[e.add(c)]=t[c]:l[c]=t[c]}return l}function bt(t,e){return gt(t,e,!(2<arguments.length&&void 0!==arguments[2])||arguments[2],!(3<arguments.length&&void 0!==arguments[3])||arguments[3],null,!0)}function wt(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4,n=new mt;return{minified:gt(t,n,!0,!0,e),map:n}}function St(t){var e=t.map;if(!(e instanceof mt)){var n=new mt;n.map=e.map,n.index=e.index,n.letters=e.letters,e=n}return e.makeInverseMap(),bt(t.minified,e,!0,!0)}function xt(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return"string"==typeof t||"boolean"==typeof t||"function"==typeof t?n["".concat(e)]=t:"number"==typeof t?n["".concat(e)]=null!=r?h(t,r):t:null===t?n["".concat(e)]=null:void 0===t||(Array.isArray(t)?t.forEach((function(t,i){xt(t,"".concat(e,"[").concat(i,"]"),n,r)})):Object.keys(t).forEach((function(i){xt(t[i],"".concat(e,".").concat(i),n,r)}))),n}function _t(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],o=t;0<e.length&&(o=Ot.apply(void 0,[t].concat(U(e))));var a=xt(o,"",{},r),s=xt(n,"",{},r),l={},u={},c={};Object.keys(a).forEach((function(t){void 0!==s[t]?a[t]!==s[t]&&(u[t]=i?[a[t],s[t]]:s[t]):c[t]=a[t]})),Object.keys(s).forEach((function(t){void 0===a[t]&&(l[t]=s[t])}));var h={};return 0<Object.keys(u).length&&(h.diff=u),0<Object.keys(l).length&&(h.added=l),0<Object.keys(c).length&&(h.removed=c),h}function Tt(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=t[0];if(0!==i.length){var o=i.match(/\[[^\]]*\]/g),a=i.replace(/\[.*/,"");if(1!==t.length||!r||o){if(o){var s=o.map((function(t){return parseInt(t.replace(/\[|\]/g,""),10)}));null!=e[a]&&Array.isArray(e[a])||(e[a]=[]);for(var l=e[a],u=0,c=0;c<s.length;c+=1){if(u=s[c],l.length<=u)for(var h=l.length;h<u-l.length+1;h+=1)l.push(void 0);c<s.length-1&&(Array.isArray(l[u])||(l[u]=[]),l=l[u])}return 1===t.length&&r?void(l[u]=void 0):1===t.length?void(l[u]=n):(null!=l[u]&&"object"===Y(l[u])||(l[u]={}),void Tt(t.slice(1),l[u],n,r))}1!==t.length?(null==e[a]&&(e[a]={}),Tt(t.slice(1),e[a],n,r)):e[a]=n}else delete e[a]}}function kt(t){var e={};return Object.keys(t).forEach((function(n){var r=n.split(".").filter((function(t){return 0<t.length})),i=t[n];Array.isArray(i)?Tt(r,e,i.slice(-1)[0]):Tt(r,e,i)})),e}function Ot(t){for(var e=it(t),n=function(t,n){var r=1<arguments.length&&void 0!==n&&n;Object.keys(t).forEach((function(n){var i=n.split(".").filter((function(t){return 0<t.length})),o=t[n];Array.isArray(o)?Tt(i,e,o.slice(-1)[0],r):Tt(i,e,o,r)}))},r=arguments.length,i=new Array(1<r?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i.forEach((function(t){var e=t.added,r=t.removed,i=t.diff;null!=r&&n(r,!0),null!=e&&n(e),null!=i&&n(i)})),e}function Pt(t){var e={};return t.diff&&0<Object.keys(t.diff).length&&(e.diff=kt(t.diff)),t.added&&0<Object.keys(t.added).length&&(e.added=kt(t.added)),t.removed&&0<Object.keys(t.removed).length&&(e.removed=kt(t.removed)),e}function At(t){var e={};return t.diff&&0<Object.keys(t.diff).length&&(e.diff=xt(t.diff)),t.added&&0<Object.keys(t.added).length&&(e.added=xt(t.added)),t.removed&&0<Object.keys(t.removed).length&&(e.removed=xt(t.removed)),e}var Et=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;$(this,t),this.precision=e,this.reset()}return Q(t,[{key:"toObj",value:function(){var t=this,e={};Object.keys(this.references).forEach((function(n){e[n]={basedOn:t.references[n].basedOn,diff:Pt(t.references[n].diff)}}));var n=this.diffs.map((function(t){return[t[0],t[1],Pt(t[2]),t[3]]}));return{baseReference:it(this.baseReference),diffs:n,references:e,precision:this.precision,lastReferenceName:this.lastReferenceName}}},{key:"setFromObj",value:function(t){var e={};Object.keys(t.references).forEach((function(n){e[n]={basedOn:t.references[n].basedOn,diff:At(t.references[n].diff)}})),this.references=e,this.baseReference=it(t.baseReference),this.precision=t.precision,this.diffs=t.diffs.map((function(t){return[t[0],t[1],At(t[2]),t[3]]})),this.lastReferenceName=t.lastReferenceName}},{key:"reset",value:function(){this.baseReference=null,this.references={},this.diffs=[],this.lastReferenceName="__base"}},{key:"setBaseReference",value:function(t){this.baseReference=it(t),this.lastReferenceName="__base"}},{key:"addReference",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:"__base";null!=this.baseReference&&"__base"!==e||this.setBaseReference(t),"__base"!==e&&(this.references[e]={diff:this.getDiffToReference(t,r),basedOn:r},this.lastReferenceName=e)}},{key:"getReferenceChain",value:function(t,e){return"__base"===t||null==this.references[t]?e:this.getReferenceChain(this.references[t].basedOn,[this.references[t].diff].concat(U(e)))}},{key:"getReference",value:function(t){var e=this.getReferenceChain(t,[]);return Ot.apply(void 0,[this.baseReference].concat(U(e)))}},{key:"getDiffToReference",value:function(t,e){var n=this.getReferenceChain(e,[]);return _t(this.baseReference,n,t,this.precision)}},{key:"getObjFromDiffAndReference",value:function(t,e){var n=this.getReferenceChain(e,[]),r=[].concat(U(n),[t]);return Ot.apply(void 0,[this.baseReference].concat(U(r)))}},{key:"add",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:this.lastReferenceName,o=3<arguments.length&&void 0!==r?r:0;null==this.baseReference&&this.setBaseReference(e);var a=this.getDiffToReference(e,i);this.diffs.push([t,i,a,o])}},{key:"addWithWorker",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:this.lastReferenceName,o=3<arguments.length&&void 0!==r?r:0;null==this.baseReference&&this.setBaseReference(e),this.startWorker(),null!=this.worker&&this.worker.postMessage([t,i,e,o])}},{key:"startWorker",value:function(){null==this.worker&&(this.worker=new Worker)}},{key:"getFromIndex",value:function(t){if(t>this.diffs.length)return null;var e,n=function(t){if(Array.isArray(t))return t}(e=this.diffs[t])||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(e.push(o.value),3!==e.length);n=!0);}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}}(e)||G(e,3)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=n[1],i=n[2];return this.getObjFromDiffAndReference(i,r)}}]),t}(),Mt=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new V;$(this,t),this.fnMap=e,this.subscribers={},this.nextId=0,this.order=[]}return Q(t,[{key:"add",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:-1;return this.subscribers["".concat(this.nextId)]={callback:t,num:n},this.order.push("".concat(this.nextId)),this.nextId+=1,this.nextId-1}},{key:"publish",value:function(t){for(var e=this,n=[],r=0;r<this.order.length;r+=1){var i=this.order[r],o=this.subscribers[i],a=o.callback,s=o.num;1===s&&n.push(i);var l=!1;0!==s&&(l=!0),0<s&&(this.subscribers["".concat(i)].num=s-1),l&&this.fnMap.exec(a,t)}n.forEach((function(t){e.remove(t)}))}},{key:"remove",value:function(t){var e="".concat(t);null!=this.subscribers[e]&&delete this.subscribers[e];var n=this.order.indexOf(e);-1<n&&this.order.splice(n,1)}},{key:"_excludeStateKeys",value:function(){return["fnMap"]}}]),t}(),jt=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new V;$(this,t),this.subscriptions={},this.fnMap=e}return Q(t,[{key:"add",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:-1;return null==this.subscriptions[t]&&(this.subscriptions[t]=new Mt(this.fnMap)),this.subscriptions[t].add(e,r)}},{key:"publish",value:function(t,e){null!=this.subscriptions[t]&&this.subscriptions[t].publish(e)}},{key:"remove",value:function(t,e){if(null!=this.subscriptions[t]){var n=this.subscriptions[t];n.remove(e),0===n.order.length&&delete this.subscriptions[t]}}},{key:"_excludeStateKeys",value:function(){return["fnMap"]}}]),t}();function Rt(t,e){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,".concat(encodeURIComponent(e))),n.setAttribute("download",t),n.style.display="none";var r=document.body;null!=r&&(r.appendChild(n),n.click(),r.removeChild(n))}function Ct(t,e){return[t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]]}function Dt(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}function Lt(t,e){return[1,0,t,0,1,e,0,0,1]}function Bt(t,e,n){return Ct(t,Lt(e,n))}function It(t){var e=Math.cos(t),n=Math.sin(t);return[e,-n,0,n,e,0,0,0,1]}function Ft(t,e){return Ct(t,It(e))}function Wt(t,e){return[t,0,0,0,e,0,0,0,1]}function qt(t,e,n){return Ct(t,Wt(e,n))}function Nt(t){var e=1/(t[0]*(t[4]*t[8]-t[7]*t[5])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]));return[(t[4]*t[8]-t[7]*t[5])*e,(t[2]*t[7]-t[1]*t[8])*e,(t[1]*t[5]-t[2]*t[4])*e,(t[5]*t[6]-t[3]*t[8])*e,(t[0]*t[8]-t[2]*t[6])*e,(t[3]*t[2]-t[0]*t[5])*e,(t[3]*t[7]-t[6]*t[4])*e,(t[6]*t[1]-t[0]*t[7])*e,(t[0]*t[4]-t[3]*t[1])*e]}function zt(t){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ht(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function Vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Gt(t);if(e){var i=Gt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ut(this,n)}}function Ut(t,e){return!e||"object"!==zt(e)&&"function"!=typeof e?function(){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():e}function Gt(t){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $t(t,e,n){return e&&Yt(t.prototype,e),n&&Yt(t,n),t}function Kt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Qt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Zt(t,e,n,r){return(1-r)*((1-r)*t+r*e)+r*((1-r)*e+r*n)}function Jt(t,e){var n=t%(2*Math.PI);return"0to360"===e&&(n<0&&(n+=2*Math.PI),n>=2*Math.PI&&(n-=2*Math.PI)),"-180to180"===e&&(n<-Math.PI&&(n+=2*Math.PI),n>=Math.PI&&(n-=2*Math.PI)),n}function te(t,e){var n,r=1<arguments.length&&void 0!==e?e:8;t&&(n=t.precision);var i=r;return null!=n&&(i=n),i}function ee(t,e){if(t instanceof se)return t;var n=e;if(null==n&&(n=null),null==t)return n;var r=t;if("string"==typeof r)try{r=JSON.parse(r)}catch(t){return n}if(Array.isArray(r))return 2===r.length?new se(r[0],r[1]):n;if(null==r.f1Type)return"number"==typeof r?new se(r,r):n;if("p"===r.f1Type&&null!=r.state&&Array.isArray([r.state])&&2===r.state.length){var i=Kt(r.state,2),o=i[0],a=i[1];return new se(o,a)}return n}function ne(t){var e=ee(t);return null==e&&(e=new se(0,0)),e}function re(t){return!Array.isArray(t)||2===t.length&&"number"==typeof t[0]?[ne(t)]:t.map((function(t){return ne(t)}))}function ie(t){return"number"==typeof t?new se(t,t):ne(t)}var oe=function(){function t(e,n,r,i){Xt(this,t),this.left=e,this.width=r,this.height=i,this.bottom=n,this.top=n+i,this.right=e+r}return $t(t,[{key:"_dup",value:function(){return new t(this.left,this.bottom,this.width,this.height)}},{key:"_state",value:function(t){var e=te(t);return{f1Type:"rect",state:[h(this.left,e),h(this.bottom,e),h(this.width,e),h(this.height,e)]}}},{key:"isPointInside",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=ne(t).round(n),i=h(this.top,n),o=h(this.bottom,n),a=h(this.left,n),s=h(this.right,n);return!(r.x<a||r.x>s||r.y<o||r.y>i)}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8;return new t(h(this.left,n),h(this.bottom,n),h(this.width,n),h(this.height,n))}}]),t}();function ae(t){var e=function(){if(t instanceof oe)return t;var e=void 0;if(null==e&&(e=null),null==t)return e;var n=t;if("string"==typeof n)try{n=JSON.parse(n)}catch(n){return e}if(Array.isArray(n)&&4===n.length)return new oe(n[0],n[1],n[2],n[3]);var r=n.f1Type,i=n.state;if(null!=r&&"rect"===r&&null!=i&&Array.isArray([i])&&4===i.length){var o=Kt(i,4),a=o[0],s=o[1],l=o[2],u=o[3];return new oe(a,s,l,u)}return e}();return null==e&&(e=new oe(0,0,1,1)),e}var se=function(){function t(e,n){Xt(this,t),this.x=e,this.y=n,this._type="point"}return $t(t,null,[{key:"zero",value:function(){return new t(0,0)}},{key:"Unity",value:function(){return new t(1,1)}}]),$t(t,[{key:"_state",value:function(t){var e=te(t);return{f1Type:"p",state:[h(this.x,e),h(this.y,e)]}}},{key:"_dup",value:function(){return new t(this.x,this.y)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"sub",value:function(e,n){var r=1<arguments.length&&void 0!==n?n:0;return e instanceof t?new t(this.x-e.x,this.y-e.y):new t(this.x-e,this.y-r)}},{key:"add",value:function(e,n){var r=1<arguments.length&&void 0!==n?n:0;return e instanceof t?new t(this.x+e.x,this.y+e.y):new t(this.x+e,this.y+r)}},{key:"distance",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;if(null==e)return Math.sqrt(this.x*this.x+this.y*this.y);var n=ne(e);return null==n?this.distance():this.sub(n).distance()}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8;return new t(h(this.x,n),h(this.y,n))}},{key:"clip",value:function(e,n){var r,i,o,a;return i=e instanceof t?(r=e.x,e.y):r=e,a=n instanceof t?(o=n.x,n.y):o=n,new t(p(this.x,r,o),p(this.y,i,a))}},{key:"transformBy",value:function(e){var n,r,i=(n=this.x,r=this.y,[e[0]*n+e[1]*r+e[2],e[3]*n+e[4]*r+e[5]]);return new t(i[0],i[1])}},{key:"quadraticBezier",value:function(e,n,r){return new t(Zt(this.x,e.x,n.x,r),Zt(this.y,e.y,n.y,r))}},{key:"rotate",value:function(e,n){var r=1<arguments.length&&void 0!==n?n:new t(0,0),i=Math.cos(e),o=Math.sin(e),a=[i,-o,o,i],s=r,l=this.sub(s);return new t(a[0]*l.x+a[1]*l.y+s.x,a[2]*l.x+a[3]*l.y+s.y)}},{key:"isEqualTo",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=this,i=t;return"number"==typeof n&&(r=this.round(n),i=i.round(n)),r.x===i.x&&r.y===i.y}},{key:"isWithinDelta",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:1e-7,r=Math.abs(this.x-t.x),i=Math.abs(this.y-t.y);return!(n<r||n<i)}},{key:"isNotEqualTo",value:function(t,e){return!this.isEqualTo(t,e)}},{key:"isNotWithinDelta",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:1e-7;return!this.isWithinDelta(t,n)}},{key:"isWithinLine",value:function(t,e){return t.hasPointOn(this,e)}},{key:"getShaddowOnLine",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=new ge(this,1,t.angle()+Math.PI/2).intersectsWith(t).intersect;return null!=r&&r.isWithinLine(t,n)?r:null}},{key:"shaddowIsOnLine",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8;return null!=this.getShaddowOnLine(t,n)}},{key:"clipToLine",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8;if(t.hasPointOn(this,n))return this._dup();var r=this.getShaddowOnLine(t,n);return null!=r?r:this.distance(t.p1)<=this.distance(t.p2)?t.p1._dup():t.p2._dup()}},{key:"isOnUnboundLine",value:function(t,e){return t.hasPointAlong(this,e)}},{key:"isInPolygon",value:function(e){var n=0,r=e.length-1,i=e.slice(),o=this,a=!1;i[0].isNotEqualTo(i[r])&&(i.push(i[0]),a=!0,r+=1);for(var s=0;s<r;s+=1)i[s].y<=o.y?i[s+1].y>o.y&&0<t.isLeft(i[s],i[s+1],o)&&(n+=1):i[s+1].y<=o.y&&t.isLeft(i[s],i[s+1],o)<0&&--n;return a&&i.pop(),0!==n}},{key:"isOnPolygon",value:function(t){var e=!1,n=t.length-1,r=t.slice();r[0].isNotEqualTo(r[n])&&(r.push(r[0]),e=!0,n+=1);for(var i=0;i<n;i+=1){var o=we(r[i],r[i+1]);if(this.isWithinLine(o))return e&&r.pop(),!0}return this.isInPolygon(t)?(e&&r.pop(),!0):(e&&r.pop(),!1)}},{key:"toPolar",value:function(){return{mag:Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)),angle:Math.atan2(this.y,this.x)}}},{key:"toDelta",value:function(t,e,n,r){var i=3<arguments.length&&void 0!==r?r:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""};return ce(2<arguments.length&&void 0!==n?n:"linear",this._dup(),t,e,i)}}],[{key:"isLeft",value:function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}}]),t}();function le(t,e,n){return t.add(e.x*n,e.y*n)}function ue(t,e,n,r){var i=r,o=Math.atan2(e.y,e.x),a=t.add(new se(e.x*i.offset,e.y*i.offset)),s=e.toPolar().mag*i.magnitude,l=r.controlPoint;if(null==l){var u=r.direction,c=Math.cos(o+i.rot*Math.PI/2),h=Math.sin(o+i.rot*Math.PI/2);"up"===u?h<0&&(h=Math.sin(o+i.rot*Math.PI/2+Math.PI)):"down"===u?0<h&&(h=Math.sin(o+i.rot*Math.PI/2+Math.PI)):"left"===u?0<c&&(c=Math.cos(o+i.rot*Math.PI/2+Math.PI)):"right"===u&&c<0&&(c=Math.cos(o+i.rot*Math.PI/2+Math.PI)),l=new se(a.x+s*c,a.y+s*h)}var f=t,d=l,p=t.add(e),y=Zt(f.x,d.x,p.x,n),v=Zt(f.y,d.y,p.y,n);return new se(y,v)}function ce(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"linear",e=1<arguments.length?arguments[1]:void 0,n=2<arguments.length?arguments[2]:void 0,r=3<arguments.length?arguments[3]:void 0,i=4<arguments.length?arguments[4]:void 0;return"linear"===t?le(e,n,r):"curved"===t?ue(e,n,r,i):new se(0,0)}function he(t,e){return new se(t,e)}function fe(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function de(t){return 180*t/Math.PI}function pe(t,e){return t===e?0:Math.atan2(Math.sin(t-e),Math.cos(t-e))}function ye(t){for(var e=t;e>=2*Math.PI;)e-=2*Math.PI;for(;e<0;)e+=2*Math.PI;return e}function ve(t){var e=ye(t);return e>Math.PI/2&&e<Math.PI&&(e+=Math.PI),e===Math.PI&&(e=0),e>Math.PI&&e<3*Math.PI/2&&(e-=Math.PI),e}function me(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=ye(t),i=ye(e);return r===i?0:0===n?pe(i,r):1===n&&i<r?2*Math.PI-r+i:-1===n&&r<i?-r-(2*Math.PI-i):i-r}var ge=function(){function t(e,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2;Xt(this,t),this.p1=ne(e),null==n?(this.ang=r,this.p2=this.p1.add(+Math.cos(this.ang),+Math.sin(this.ang))):"number"==typeof n?(this.p2=this.p1.add(n*Math.cos(r),n*Math.sin(r)),this.ang=r):(this.p2=ne(n),this.ang=Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x)),this.ends=i,this.setupLine()}return $t(t,[{key:"_state",value:function(t){var e=te(t);return{f1Type:"l",state:[[h(this.p1.x,e),h(this.p1.y,e)],[h(this.p2.x,e),h(this.p2.y,e)],this.ends]}}},{key:"setupLine",value:function(){this.A=this.p2.y-this.p1.y,this.B=this.p1.x-this.p2.x,this.C=this.A*this.p1.x+this.B*this.p1.y,this.distance=fe(this.p1,this.p2)}},{key:"_dup",value:function(){return new t(this.p1,this.p2,0,this.ends)}},{key:"setP1",value:function(t){this.p1=ne(t),this.ang=Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x),this.setupLine()}},{key:"setP2",value:function(t){this.p2=ne(t),this.ang=Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x),this.setupLine()}},{key:"getPoint",value:function(t){return 2===(0<arguments.length&&void 0!==t?t:1)?this.p2:this.p1}},{key:"getYFromX",value:function(t){return 0!==this.B?(this.C-this.A*t)/this.B:null}},{key:"getXFromY",value:function(t){return 0!==this.A?(this.C-this.B*t)/this.A:null}},{key:"getYIntercept",value:function(){return this.getYFromX(0)}},{key:"getXIntercept",value:function(){return this.getXFromY(0)}},{key:"getGradient",value:function(){return 0===this.B?null:-this.A/this.B}},{key:"angle",value:function(){return this.ang}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8,r=new t(this.p1,this.p2,0,this.ends);return r.A=h(r.A,n),r.B=h(r.B,n),r.C=h(r.C,n),r.ang=h(r.ang,n),r.distance=h(r.distance,n),r}},{key:"length",value:function(){return this.distance}},{key:"midPoint",value:function(){return this.pointAtPercent(.5)}},{key:"pointAtPercent",value:function(t){var e=this.length(),n=this.p2.sub(this.p1),r=Math.atan2(n.y,n.x);return he(this.p1.x+e*t*Math.cos(r),this.p1.y+e*t*Math.sin(r))}},{key:"pointAtLength",value:function(t){var e=this.p2.sub(this.p1),n=Math.atan2(e.y,e.x);return he(this.p1.x+t*Math.cos(n),this.p1.y+t*Math.sin(n))}},{key:"hasPointAlong",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=ne(t);if(null==n){if(this.C===this.A*r.x+this.B*r.y)return!0}else if(h(this.C,n)===h(this.A*r.x+this.B*r.y,n))return!0;return!1}},{key:"distanceToPoint",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=ne(t);return h(Math.abs(this.A*r.x+this.B*r.y-this.C)/Math.sqrt(Math.pow(this.A,2)+Math.pow(this.B,2)),n)}},{key:"hasPointOn",value:function(e,n){var r=1<arguments.length&&void 0!==n?n:8,i=ne(e);return!!this.hasPointAlong(i,r)&&(2===this.ends?!!function(t,e,n,r){if(null==r){if(t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x)&&t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y))return 1}else if(h(t.x,r)>=h(Math.min(e.x,n.x),r)&&h(t.x,r)<=h(Math.max(e.x,n.x),r)&&h(t.y,r)>=h(Math.min(e.y,n.y),r)&&h(t.y,r)<=h(Math.max(e.y,n.y),r))return 1}(i,this.p1,this.p2,r):1!==this.ends||!!this.p1.isEqualTo(i,r)||f(Jt(new t(this.p1,i).ang,"0to360"),r)===f(Jt(this.ang,"0to360"),r))}},{key:"isEqualTo",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=this,i=t;return!(r.ends!==i.ends||(2===r.ends?r.p1.isNotEqualTo(i.p1,n)&&r.p1.isNotEqualTo(i.p2,n)||r.p2.isNotEqualTo(i.p1,n)&&r.p2.isNotEqualTo(i.p2,n):1===r.ends?r.p1.isNotEqualTo(i.p1,n)||!r.hasPointOn(i.p2,n):!r.hasPointOn(i.p1)))}},{key:"isWithinDelta",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:1e-8,r=this,i=t;return!(r.ends!==i.ends||(2===r.ends?r.p1.isNotWithinDelta(i.p1,n)&&r.p1.isNotWithinDelta(i.p2,n)||r.p2.isNotWithinDelta(i.p1,n)&&r.p2.isNotWithinDelta(i.p2,n):1===r.ends?r.p1.isNotWithinDelta(i.p1,n)||!r.hasPointOn(i.p2,n):!r.hasPointOn(i.p1)))}},{key:"hasLineWithin",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8;return t.isWithinLine(this,n)}},{key:"isAlongLine",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=this.round(n),i=t.round(n);if(0===r.A&&0===r.B||0===i.A&&0===i.B)return!1;if(0!==r.A){var o=i.A/r.A;return r.B*o===i.B&&r.C*o===i.C}if(0!==i.A){var a=r.A/i.A;return i.B*a===r.B&&i.C*a===r.C}if(0!==r.B){var s=i.B/r.B;return r.A*s===i.A&&r.C*s===i.C}if(0===i.B)return!0;var l=r.B/i.B;return i.A*l===r.A&&i.C*l===r.C}},{key:"isWithinLine",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=this.round(n),i=t.round(n);return!!r.isAlongLine(i,n)&&(0===t.ends||!(this.ends<t.ends)&&(this.ends,i.hasPointOn(this.p1,n)&&i.hasPointOn(this.p2,n)))}},{key:"offset",value:function(e,n){var r=this.ang;r>=Math.PI&&(r-=Math.PI),r<0&&(r+=Math.PI);var i=r-Math.PI/2;return"positive"===e?i=Jt(this.ang,"0to360")+Math.PI/2:"negative"===e?i=Jt(this.ang,"0to360")-Math.PI/2:r<Math.PI/2?"left"!==e&&"top"!==e||(i=r+Math.PI/2):"left"!==e&&"bottom"!==e||(i=r+Math.PI/2),new t(new se(this.p1.x+n*Math.cos(i),this.p1.y+n*Math.sin(i)),new se(this.p2.x+n*Math.cos(i),this.p2.y+n*Math.sin(i)),0,this.ends)}},{key:"isParallelWith",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,r=this.A*t.B-t.A*this.B;return 0===h(r,n)}},{key:"reflectsOn",value:function(e,n){var r=1<arguments.length&&void 0!==n?n:8,i=this.intersectsWith(e,r).intersect;if(null==i)return null;var o=new t(i,1,e.ang+Math.PI/2),a=this.p1.getShaddowOnLine(o,r),s=new t(this.p1,a),l=s.distance;return new t(i,new se(this.p1.x+2*l*Math.cos(s.ang),this.p1.y+2*l*Math.sin(s.ang)))}},{key:"intersectsWith",value:function(e,n){var r=1<arguments.length&&void 0!==n?n:8,i=e,o=this,a=h(this.distance,r),s=h(i.distance,r);if(0===a||0===s){var l,u=!1,c=!1;return 0===a&&0===s&&o.p1.isEqualTo(i.p1,r)&&(l=o.p1._dup(),c=u=!0),0<a&&(o.hasPointOn(i.p1,r)?(l=i.p1._dup(),u=c=!0):o.hasPointAlong(i.p1,r)&&(l=i.p1._dup(),u=!0)),0<s&&(i.hasPointOn(o.p1,r)?(l=o.p1._dup(),u=c=!0):i.hasPointAlong(o.p1,r)&&(l=o.p1._dup(),u=!0)),{intersect:l,alongLine:u,withinLine:c}}if(!o.isParallelWith(i)){var f;if(0===h(o.A,r)&&0===h(i.B,r))f=new se(i.p1.x,o.p1.y);else if(0===h(o.B,r)&&0===h(i.A,r))f=new se(o.p1.x,i.p1.y);else if(0===h(o.B,r)){var d=(i.C*o.B-o.C*i.B)/(-o.A*i.B+i.A*o.B),p=-i.A/i.B*d+i.C/i.B;f=new se(d,p)}else{var y=(i.C*o.B-o.C*i.B)/(-o.A*i.B+i.A*o.B),v=-o.A/o.B*y+o.C/o.B;f=new se(y,v)}return o.hasPointOn(f,r)&&i.hasPointOn(f,r)?{alongLine:!0,withinLine:!0,intersect:f}:{alongLine:!0,withinLine:!1,intersect:f}}if(!o.isAlongLine(i,r))return{alongLine:!1,withinLine:!1,intersect:void 0};var m,g,b,w=this.getXIntercept(),S=this.getYIntercept();if(m=null!=S?new se(0,S):new se(null!=w?w:0,0),o.isEqualTo(i,r))return{alongLine:!0,withinLine:!0,intersect:2===o.ends?o.midPoint():1===o.ends?o.p1._dup():m};function x(e,n){return e.hasLineWithin(n,r)&&(2===e.ends&&(g=new t(e.midPoint(),n.midPoint()).midPoint()),1===e.ends&&1===n.ends&&(g=new t(e.p1,n.p1)),1===e.ends&&2===n.ends&&(g=n.midPoint()),0===e.ends&&2===n.ends&&(g=n.midPoint()),0===e.ends&&1===n.ends&&(g=n.p1._dup()),e.ends>n.ends&&(g=2===e.ends?e.midPoint():e.p1),1===e.ends&&1===n.ends&&(g=new t(e.p1,n.p1).midPoint()),1)}if(x(o,i))return{alongLine:!0,withinLine:!0,intersect:g};if(x(i,o))return{alongLine:!0,withinLine:!0,intersect:g};if(2===o.ends&&2===i.ends){if(o.p1.isWithinLine(i,r)||o.p2.isWithinLine(i,r)||i.p1.isWithinLine(o,r)||i.p2.isWithinLine(o,r))return{alongLine:!0,withinLine:!0,intersect:g=o.p1.isWithinLine(i,r)?i.p1.isWithinLine(o,r)?new t(o.p1,i.p1).midPoint():new t(o.p1,i.p2).midPoint():i.p1.isWithinLine(o,r)?new t(o.p2,i.p1).midPoint():new t(o.p2,i.p2).midPoint()};var _=new t(o.p1,i.p1),T=new t(o.p1,i.p2),k=new t(o.p2,i.p1),O=new t(o.p2,i.p2);g=_.midPoint();var P=_.length();return T.length()<P&&(g=T.midPoint(),P=T.length()),k.length()<P&&(g=k.midPoint(),P=k.length()),O.length()<P&&(g=O.midPoint(),P=O.length()),{alongLine:!0,withinLine:!1,intersect:g}}if(1===o.ends&&1===i.ends)return{alongLine:!0,withinLine:!1,intersect:new t(o.p1,i.p1).midPoint()};function A(e,n){if(e.p1.isWithinLine(n))b=!0,g=n.p1.isWithinLine(e)?new t(e.p1,n.p1).midPoint():new t(e.p1,n.p2).midPoint();else{b=!1;var r=new t(e.p1,n.p1),i=new t(e.p1,n.p2);g=r.length()<i.length()?r.midPoint():i.midPoint()}}return 1===o.ends&&2===i.ends?A(o,i):A(i,o),{alongLine:!0,withinLine:b,intersect:g}}}]),t}(),be=function(){Ht(e,ge);var t=Vt(e);function e(n,r){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return Xt(this,e),(i=n instanceof ge?t.call(this,n.p1,n.distance,n.ang):t.call(this,n,r,o)).i=i.distance*Math.cos(i.ang),i.j=i.distance*Math.sin(i.ang),Ut(i)}return $t(e,[{key:"unit",value:function(){return new e(this.p1,1,this.ang)}},{key:"dotProduct",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8;return h(this.i*t.i+this.j*t.j,n)}}]),e}();function we(t,e){return new ge(t,e)}function Se(t){var e=function(){if(t instanceof ge)return t;var e=void 0;if(null==e&&(e=null),null==t)return e;var n=t;if("string"==typeof n)try{n=JSON.parse(n)}catch(n){return e}if(Array.isArray(n))return 4===n.length?new ge(ne(n[0]),n[1],n[2],n[3]):3===n.length?"number"==typeof n[1]?new ge(ne(n[0]),n[1],n[2]):new ge(ne(n[0]),ne(n[1]),0,n[2]):2===n.length?new ge(ne(n[0]),ne(n[1])):e;if(null==n.f1Type)return e;if("l"===n.f1Type&&null!=n.state&&Array.isArray([n.state])&&3===n.state.length){var r=Kt(n.state,3),i=r[0],o=r[1],a=r[2];return new ge(ne(i),ne(o),0,a)}return e}();return null==e&&(e=new ge(new se(0,0),new se(1,0))),e}var xe=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";Xt(this,t);var r=n,i=e;if("string"==typeof i)try{i=JSON.parse(i)}catch(e){i=0}if("number"==typeof i)this.r=i;else if(null!=i.f1Type&&"r"===i.f1Type&&null!=i.state&&Array.isArray(i.state)&&2===i.state.length){var o=Kt(i.state,2),a=o[0],s=o[1];r=a,this.r=s}else this.r=0;this.name=r}return $t(t,[{key:"_state",value:function(t){var e=te(t);return{f1Type:"r",state:[this.name,h(this.r,e)]}}},{key:"matrix",value:function(){return It(this.r)}},{key:"sub",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t(0,this.name);return new t(this.r-n.r,this.name)}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8;return new t(h(this.r,n),this.name)}},{key:"add",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t(0,this.name);return new t(this.r+n.r,this.name)}},{key:"mul",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t(1,this.name);return new t(this.r*n.r,this.name)}},{key:"_dup",value:function(){return new t(this.r,this.name)}}]),t}(),_e=function(){Ht(e,se);var t=Vt(e);function e(n){var r,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";Xt(this,e);var a=o,s=n,l=i;if("string"==typeof s){try{s=JSON.parse(s)}catch(n){s=0}if(Array.isArray(s)&&2===s.length){var u=Kt(s,2);s=u[0],l=u[1]}}if(s instanceof se)r=t.call(this,s.x,s.y);else if("number"==typeof s)r=t.call(this,s,l);else if(null!=s.f1Type&&"t"===s.f1Type&&null!=s.state&&Array.isArray(s.state)&&3===s.state.length){var c=Kt(s.state,3),h=c[0],f=c[1],d=c[2];a=h,r=t.call(this,f,d)}else r=t.call(this,0,0);return r.name=a,Ut(r)}return $t(e,[{key:"_state",value:function(t){var e=te(t);return{f1Type:"t",state:[this.name,h(this.x,e),h(this.y,e)]}}},{key:"matrix",value:function(){return Lt(this.x,this.y)}},{key:"sub",value:function(t,n){var r=0<arguments.length&&void 0!==t?t:new e(0,0),i=1<arguments.length&&void 0!==n?n:0,o=new se(0,0);return o="number"==typeof r?new e(r,i):r,new e(this.x-o.x,this.y-o.y,this.name)}},{key:"add",value:function(t,n){var r=0<arguments.length&&void 0!==t?t:new e(0,0),i=1<arguments.length&&void 0!==n?n:0,o=new se(0,0);return o="number"==typeof r?new e(r,i):r,new e(this.x+o.x,this.y+o.y,this.name)}},{key:"mul",value:function(t){var n=0<arguments.length&&void 0!==t?t:new e(1,1);return new e(this.x*n.x,this.y*n.y,this.name)}},{key:"round",value:function(t){var n=0<arguments.length&&void 0!==t?t:8;return new e(h(this.x,n),h(this.y,n),this.name)}},{key:"_dup",value:function(){return new e(this.x,this.y,this.name)}}]),e}(),Te=function(){Ht(e,se);var t=Vt(e);function e(n,r){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";Xt(this,e);var a=o,s=n,l=r;if("string"==typeof s){try{s=JSON.parse(s)}catch(n){s=0}if(Array.isArray(s)&&2===s.length){var u=Kt(s,2);s=u[0],l=u[1]}}if(s instanceof se)i=t.call(this,s.x,s.y);else if("number"==typeof s)i=null!=l?t.call(this,s,l):t.call(this,s,s);else if(null!=s.f1Type&&"s"===s.f1Type&&null!=s.state&&Array.isArray(s.state)&&3===s.state.length){var c=Kt(s.state,3),h=c[0],f=c[1],d=c[2];a=h,i=t.call(this,f,d)}else i=t.call(this,1,1);return i.name=a,Ut(i)}return $t(e,[{key:"_state",value:function(t){var e=te(t);return{f1Type:"s",state:[this.name,h(this.x,e),h(this.y,e)]}}},{key:"matrix",value:function(){return Wt(this.x,this.y)}},{key:"sub",value:function(t,n){var r=0<arguments.length&&void 0!==t?t:new e(0,0),i=1<arguments.length&&void 0!==n?n:0,o=new se(0,0);return o="number"==typeof r?new e(r,i):r,new e(this.x-o.x,this.y-o.y,this.name)}},{key:"round",value:function(t){var n=0<arguments.length&&void 0!==t?t:8;return new e(h(this.x,n),h(this.y,n),this.name)}},{key:"add",value:function(t,n){var r=0<arguments.length&&void 0!==t?t:new e(0,0),i=1<arguments.length&&void 0!==n?n:0,o=new se(0,0);return o="number"==typeof r?new e(r,i):r,new e(this.x+o.x,this.y+o.y,this.name)}},{key:"mul",value:function(t){var n=0<arguments.length&&void 0!==t?t:new e(1,1);return n instanceof e||n instanceof se?new e(this.x*n.x,this.y*n.y):new e(this.x*n,this.y*n,this.name)}},{key:"_dup",value:function(){return new e(this.x,this.y,this.name)}}]),e}(),ke=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";Xt(this,t),"string"==typeof e?(this.order=[],this.name=e):(this.order=e.map((function(t){return t._dup()})),this.name=n),this.index=this.order.length,this._type="transform",this.calcMatrix()}return $t(t,[{key:"_state",value:function(t){var e=0<arguments.length&&void 0!==t?t:{precision:8},n=[];return this.order.forEach((function(t){n.push(t._state(e))})),{f1Type:"tf",state:[this.name].concat(n)}}},{key:"standard",value:function(){return this.scale(1,1).rotate(0).translate(0,0)}},{key:"translate",value:function(e,n,r){var i=1<arguments.length&&void 0!==n?n:0,o=2<arguments.length&&void 0!==r?r:this.name,a=new _e(e,i,o),s=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=a,this.index+=1,this.calcMatrix(),this):(s.push(a),new t(s,o))}},{key:"rotate",value:function(e,n){var r=1<arguments.length&&void 0!==n?n:this.name,i=new xe(e,r),o=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=i,this.index+=1,this.calcMatrix(),this):(o.push(i),new t(o,r))}},{key:"scale",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.name,i=new Te(e,n,r),o=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=i,this.index+=1,this.calcMatrix(),this):(o.push(i),new t(o,r))}},{key:"remove",value:function(e){var n,r=[];return n="string"==typeof e?[e]:e,this.order.forEach((function(t){-1===n.indexOf(t.name)&&r.push(t._dup())})),new t(r,this.name)}},{key:"calcMatrix",value:function(){for(var t=[1,0,0,0,1,0,0,0,1],e=this.order.length-1;0<=e;--e)t=Ct(t,this.order[e].matrix());this.mat=t}},{key:"update",value:function(t){return t<this.order.length&&(this.index=t),this}},{key:"t",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=0;n<this.order.length;n+=1){var r=this.order[n];if(r instanceof _e){if(e===t)return new se(r.x,r.y);e+=1}}return null}},{key:"clipRotation",value:function(t){for(var e=0;e<this.order.length;e+=1){var n=this.order[e];n instanceof xe&&(n.r=Jt(n.r,t))}}},{key:"updateTranslation",value:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:0,i=0,o=2<arguments.length&&void 0!==n?n:0;t instanceof se&&(o=r);for(var a=0;a<this.order.length;a+=1)if(this.order[a]instanceof _e){if(i===o)return this.order[a]=new _e(t,r,this.name),this.calcMatrix(),this;i+=1}return this}},{key:"s",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0,r=0;r<this.order.length;r+=1){var i=this.order[r];if(i instanceof Te){if(n===e)return new se(i.x,i.y);n+=1}}return null}},{key:"toDelta",value:function(t,e,n,r){for(var i=this._dup(),o=0;o<this.order.length;o+=1){var a=this.order[o],s=t.order[o];a instanceof Te&&s instanceof Te&&(i.order[o]=a.add(s.mul(e))),a instanceof xe&&s instanceof xe&&(i.order[o]=new xe(a.r+s.r*e,a.name)),a instanceof _e&&s instanceof _e&&(i.order[o]=new _e(ce(n,a,s,e,r),0,a.name))}return i}},{key:"updateScale",value:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:null,i=0,o=2<arguments.length&&void 0!==n?n:0,a=new se(1,1);t instanceof se?(o=null==r?0:r,a=t):null==r?(a.x=t,a.y=t):(a.x=t,a.y=r);for(var s=0;s<this.order.length;s+=1)if(this.order[s]instanceof Te){if(i===o)return this.order[s]=new Te(a.x,a.y,this.name),this.calcMatrix(),this;i+=1}return this}},{key:"r",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0,r=0;r<this.order.length;r+=1){var i=this.order[r];if(i instanceof xe){if(n===e)return i.r;n+=1}}return null}},{key:"updateRotation",value:function(t,e){for(var n=1<arguments.length&&void 0!==e?e:0,r=0,i=0;i<this.order.length;i+=1)if(this.order[i]instanceof xe){if(r===n)return this.order[i]=new xe(t,this.name),this.calcMatrix(),this;r+=1}return this}},{key:"m",value:function(){return this.mat}},{key:"matrix",value:function(){return this.mat}},{key:"isSimilarTo",value:function(t){if(t.order.length!==this.order.length)return!1;for(var e=0;e<this.order.length;e+=1)if(this.order[e].constructor.name!==t.order[e].constructor.name)return!1;return!0}},{key:"isEqualTo",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8;if(!this.isSimilarTo(t))return!1;for(var r=0;r<this.order.length;r+=1){var i=t.order[r],o=this.order[r];if(o.constructor.name!==i.constructor.name)return!1;if((o instanceof _e&&i instanceof _e||o instanceof Te&&i instanceof Te)&&i.isNotEqualTo(o,n))return!1;if(o instanceof xe&&h(i.r,n)!==h(o.r,n))return!1}return!0}},{key:"isWithinDelta",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:1e-8;if(!this.isSimilarTo(t))return!1;for(var r=0;r<this.order.length;r+=1){var i=t.order[r],o=this.order[r];if(o.constructor.name!==i.constructor.name)return!1;if((o instanceof _e&&i instanceof _e||o instanceof Te&&i instanceof Te)&&i.isNotWithinDelta(o,n))return!1;if(o instanceof xe&&n<Math.abs(i.r-o.r))return!1}return!0}},{key:"sub",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t;if(!this.isSimilarTo(n))return new t(this.order,this.name);for(var r=[],i=0;i<this.order.length;i+=1)r.push(this.order[i].sub(n.order[i]));return new t(r,this.name)}},{key:"add",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t;if(!this.isSimilarTo(n))return new t(this.order,this.name);for(var r=[],i=0;i<this.order.length;i+=1)r.push(this.order[i].add(n.order[i]));return new t(r,this.name)}},{key:"mul",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t;if(!this.isSimilarTo(n))return new t(this.order,this.name);for(var r=[],i=0;i<this.order.length;i+=1)r.push(this.order[i].mul(n.order[i]));return new t(r,this.name)}},{key:"transform",value:function(e){var n=new t([],this.name);return n.order=e.order.concat(this.order),n.mat=Ct(this.matrix(),e.matrix()),n}},{key:"transformBy",value:function(e){var n=new t([],this.name);return n.order=this.order.concat(e.order),n.mat=Ct(e.matrix(),this.matrix()),n}},{key:"round",value:function(e){for(var n=0<arguments.length&&void 0!==e?e:8,r=[],i=0;i<this.order.length;i+=1)r.push(this.order[i].round(n));return new t(r,this.name)}},{key:"clip",value:function(e,n,r){if(!this.isSimilarTo(e)||!this.isSimilarTo(n))return this._dup();for(var i=[],o=0;o<this.order.length;o+=1){var a=this.order[o],s=e.order[o],l=n.order[o];if(a instanceof _e&&s instanceof _e&&l instanceof _e){var u=p(a.x,s.x,l.x),c=p(a.y,s.y,l.y);i.push(new _e(u,c,this.name))}else if(a instanceof xe&&s instanceof xe&&l instanceof xe)i.push(new xe(p(a.r,s.r,l.r),this.name));else if(a instanceof Te&&s instanceof Te&&l instanceof Te){var h=p(a.x,s.x,l.x),f=p(a.y,s.y,l.y);i.push(new Te(h,f,this.name))}}var d=new t(i,this.name);if(null!=r){var y=d.t();if(null!=y){var v=new ge(y,1,r.angle()+Math.PI/2).intersectsWith(r).intersect;v&&(v.isWithinLine(r,4)?d.updateTranslation(v):fe(v,r.p1)<fe(v,r.p2)?d.updateTranslation(r.p1):d.updateTranslation(r.p2))}}return d}},{key:"clipMag",value:function(e,n,r){for(var i=!(2<arguments.length&&void 0!==r)||r,o=[],a=Ve(e,this),s=Ve(n,this),l=0;l<this.order.length;l+=1){var u=this.order[l];if(u instanceof _e)if(i){var c=u.toPolar(),h=c.mag,f=c.angle,p=d(h,a[l],s[l]);o.push(new _e(p*Math.cos(f),p*Math.sin(f),this.name))}else{var y=d(u.x,a[l],s[l]),v=d(u.y,a[l],s[l]);o.push(new _e(y,v,this.name))}else if(u instanceof xe){var m=d(u.r,a[l],s[l]);o.push(new xe(m,this.name))}else if(u instanceof Te){var g=d(u.x,a[l],s[l]),b=d(u.y,a[l],s[l]);o.push(new Te(g,b,this.name))}}return new t(o,this.name)}},{key:"constant",value:function(e){for(var n=0<arguments.length&&void 0!==e?e:0,r=[],i=0;i<this.order.length;i+=1){var o=this.order[i];o instanceof _e?r.push(new _e(n,n,this.name)):o instanceof xe?r.push(new xe(n,this.name)):o instanceof Te&&r.push(new Te(n,n,this.name))}return new t(r,this.name)}},{key:"zero",value:function(){return this.constant(0)}},{key:"isZero",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0;n<this.order.length;n+=1){var r=this.order[n];if(r instanceof _e||r instanceof Te){if(Math.abs(r.x)>e||Math.abs(r.y)>e)return!1}else if(r instanceof xe&&Jt(r.r,"0to360")>e)return!1}return!0}},{key:"_dup",value:function(){var e=new t(this.order,this.name);return e.index=this.index,e}},{key:"decelerate",value:function(t,e,n,r,i,o,a){var s=6<arguments.length&&void 0!==a?a:8,l=Ve(e,this),u=Ve(i,this),c=Ve(o,this),h=$e(this,t,l,n,r instanceof Ue?r:new Ue(this,r),u,c,s);return{velocity:h.velocity,transform:h.transform,duration:h.duration}}},{key:"timeToZeroV",value:function(t,e,n,r,i,o){var a=5<arguments.length&&void 0!==o?o:8;return this.decelerate(t,e,null,n,r,i,a)}},{key:"velocity",value:function(e,n,r,i){var o=[];if(!this.isSimilarTo(e))return this.zero();for(var a=this.sub(e),s=0;s<a.order.length;s+=1){var l=a.order[s];l instanceof _e?o.push(new _e(l.x/n,l.y/n)):l instanceof xe?o.push(new xe(l.r/n)):l instanceof Te&&o.push(new Te(l.x/n,l.y/n))}return new t(o).clipMag(r,i)}},{key:"identity",value:function(){for(var e=[],n=0;n<this.order.length;n+=1){var r=this.order[n];r instanceof _e?e.push(new _e(0,0,this.name)):r instanceof xe?e.push(new xe(0,this.name)):r instanceof Te&&e.push(new Te(1,1,this.name))}return new t(e,this.name)}}]),t}();function Oe(t){var e=function(){if(t instanceof ke)return t;var e=void 0;if(null==e&&(e=null),null==t)return e;var n=t;if("string"==typeof n)try{n=JSON.parse(n)}catch(n){return e}if(Array.isArray(n)){var r=new ke;return n.forEach((function(t){if("string"!=typeof t)if(3!==t.length){var e=Kt(t,2),n=e[0],i=e[1];r="s"===n?r.scale(i,i):"t"===n?r.translate(i,i):r.rotate(i)}else{var o=Kt(t,3),a=o[0],s=o[1],l=o[2];r="s"===a?r.scale(s,l):r.translate(s,l)}else r.name=t})),r}var i=n.f1Type,o=n.state;if(null!=i&&"tf"===i&&null!=o&&Array.isArray(o)){var a=new ke;return n.state.forEach((function(t){if("string"!=typeof t){var e=t.f1Type;null!=e&&("s"===e?a=a.scale(t):"t"===e?a=a.translate(t):"r"===e&&(a=a.rotate(t)))}else a.name=t})),a}return e}();return null==e&&(e=new ke),e}function Pe(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=e.x.width/t.x.width,i=e.y.height/t.y.height;return new ke(n).scale(r,i).translate(e.x.bottomLeft-t.x.bottomLeft*r,e.y.bottomLeft-t.y.bottomLeft*i)}function Ae(t,e){var n=e.x.width/t.x.width,r=e.y.height/t.y.height;return new se(n,r)}function Ee(t,e,n,r){var i=new se(0,0),o=new se(0,0);return r?(i.x=t.x,i.y=t.y,o.x=t.x,o.y=t.y):(i.x=t.x<e.x?t.x:e.x,i.y=t.y<e.y?t.y:e.y,o.x=t.x>n.x?t.x:n.x,o.y=t.y>n.y?t.y:n.y),{min:i,max:o}}function Me(t,e){return new se(t*Math.cos(e),t*Math.sin(e))}function je(t){var e,n=(e="number"==typeof t?new se(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0):t).distance(),r=Math.atan2(e.y,e.x);return r<0&&(r+=2*Math.PI),{mag:n,angle:r}}function Re(t){var e=!0,n={min:new se(0,0),max:new se(0,0)};return t.forEach((function(t){Array.isArray(t)?t.forEach((function(t){n=Ee(t,n.min,n.max,e),e=!1})):n=Ee(t,n.min,n.max,e),e=!1})),new oe(n.min.x,n.min.y,n.max.x-n.min.x,n.max.y-n.min.y)}function Ce(t,e,n){var r=t.sub(e),i=n.sub(e),o=r.toPolar().angle,a=i.toPolar().angle;return a-=o,o=0,Jt(a,"0to360")}function De(t,e,n){var r=Jt(Math.atan2(t.y-e.y,t.x-e.x),"0to360"),i=Jt(Math.atan2(n.y-e.y,n.x-e.x),"0to360")-r;return i>Math.PI?i=-(2*Math.PI-i):i<-Math.PI&&(i=2*Math.PI+i),i}function Le(t){var e=E(t.left,t.bottom,t.right,t.top);return new se(e.x,e.y)}function Be(t,e,n){var r,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=e.sub(t),a=0;return r="number"==typeof n?t._dup().constant(n):n,o.order.forEach((function(n,o){if(n instanceof _e||n instanceof Te){var s=r.order[o];if((s instanceof _e||s instanceof Te)&&0!==s.x&&0!==s.y){var l=Math.abs(n.x)/s.x,u=Math.abs(n.y)/s.y;a=(a=a<l?l:a)<u?u:a}}var c=t.order[o],h=e.order[o];if(n instanceof xe&&c instanceof xe&&h instanceof xe){var f=me(c.r,h.r,i);n.r=f;var d=r.order[o];if(d instanceof xe&&0!==d){var p=Math.abs(n.r/d.r);a=a<p?p:a}}})),a}function Ie(t,e){var n,r,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new se(.25,.25),a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2*Math.PI/6,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new se(1,1);if(n=t instanceof ke?[t]:t,(r=e instanceof ke?[e]:e).length!==n.length)return 0;var l=0;return n.forEach((function(t,e){for(var n=r[e],u=t._dup(),c=0;c<u.order.length;c+=1){var h=u.order[c];h instanceof _e?(h.x=o.x,h.y=o.y):h instanceof xe?h.r=a:(h.x=s.x,h.y=s.y)}var f=Be(t,n,u,i);l<f&&(l=f)})),l}function Fe(t,e,n,r){var i=1/r;if(0===r||1===r||2===r)return[t,e,n];for(var o=[],a=0;a<r+1;a+=1){var s=0+a*i;o.push(new se(Math.pow(1-s,2)*t.x+2*(1-s)*s*e.x+s*s*n.x,Math.pow(1-s,2)*t.y+2*(1-s)*s*e.y+s*s*n.y))}return o}var We=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"inside",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:8;Xt(this,t),this.boundary=e,this.bounds=n,this.precision=r}return $t(t,[{key:"_dup",value:function(){return new t}},{key:"_state",value:function(){return{f1Type:"bounds",state:[]}}},{key:"contains",value:function(){return!0}},{key:"intersect",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;return"number"==typeof t?{intersect:t,distance:0,reflection:n+Math.PI}:{intersect:ne(t),distance:0,reflection:n+Math.PI}}},{key:"clip",value:function(t){return"number"==typeof t?t:ne(t)}}]),t}(),qe=function(){Ht(e,We);var t=Vt(e);function e(n){Xt(this,e);var r=st({},{bounds:"inside",precision:8,min:null,max:null},n),i={min:r.min,max:r.max};return t.call(this,i,r.bounds,r.precision)}return $t(e,[{key:"_dup",value:function(){return new e({bounds:this.bounds,precision:this.precision,min:this.boundary.min,max:this.boundary.max})}},{key:"_state",value:function(t){var e=te(t);return{f1Type:"rangeBounds",state:[this.bounds,this.precision,null!=this.boundary.min?h(this.boundary.min,e):null,null!=this.boundary.max?h(this.boundary.max,e):null]}}},{key:"contains",value:function(t){if("number"==typeof t){var e=h(t,this.precision);return(null==this.boundary.min||e>=h(this.boundary.min,this.precision))&&(null==this.boundary.max||e<=h(this.boundary.max,this.precision))}var n=ne(t);return!(!this.contains(n.x)||!this.contains(n.y))}},{key:"intersect",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:1,r=-1*n,i=this.boundary,o=i.min,a=i.max;return"number"!=typeof t?{intersect:null,distance:0,reflection:n}:this.contains(t)?null!=a&&f(t,this.precision)===f(a,this.precision)&&"outside"===this.bounds?-1===n?{intersect:a,distance:0,reflection:1}:{intersect:null,distance:0,reflection:1}:null!=o&&f(t,this.precision)===f(o,this.precision)&&"outside"===this.bounds?1===n?{intersect:o,distance:0,reflection:-1}:{intersect:null,distance:0,reflection:-1}:1===n?null==a?{intersect:null,distance:0,reflection:n}:{intersect:a,distance:Math.abs(t-a),reflection:-1}:null==o?{intersect:null,distance:0,reflection:n}:{intersect:o,distance:Math.abs(t-o),reflection:1}:null!=o&&t<o&&1===n?{intersect:o,distance:Math.abs(t-o),reflection:r}:null!=a&&a<t&&-1===n?{intersect:a,distance:Math.abs(t-a),reflection:r}:{intersect:null,distance:0,reflection:n}}},{key:"clip",value:function(t){if("number"==typeof t)return p(t,this.boundary.min,this.boundary.max);var e=ne(t),n=e._dup();return n.x=p(e.x,this.boundary.min,this.boundary.max),n.y=p(e.y,this.boundary.min,this.boundary.max),n}}]),e}(),Ne=function(){Ht(e,We);var t=Vt(e);function e(n){Xt(this,e);var r=st({},{left:null,right:null,top:null,bottom:null,bounds:"inside",precision:8},n),i={left:r.left,right:r.right,top:r.top,bottom:r.bottom};return t.call(this,i,r.bounds,r.precision)}return $t(e,[{key:"_dup",value:function(){return new e({bounds:this.bounds,precision:this.precision,left:this.boundary.left,right:this.boundary.right,top:this.boundary.top,bottom:this.boundary.bottom})}},{key:"_state",value:function(t){var e=te(t);return{f1Type:"rectBounds",state:[this.bounds,this.precision,null!=this.boundary.left?h(this.boundary.left,e):null,null!=this.boundary.bottom?h(this.boundary.bottom,e):null,null!=this.boundary.right?h(this.boundary.right,e):null,null!=this.boundary.top?h(this.boundary.top,e):null]}}},{key:"contains",value:function(t){if("number"==typeof t)return!1;var e=ne(t).round(this.precision);return!(null!=this.boundary.left&&e.x<h(this.boundary.left,this.precision)||null!=this.boundary.right&&e.x>h(this.boundary.right,this.precision)||null!=this.boundary.bottom&&e.y<h(this.boundary.bottom,this.precision)||null!=this.boundary.top&&e.y>h(this.boundary.top,this.precision))}},{key:"clip",value:function(t){if("number"==typeof t)return t;var e=ne(t);return null!=this.boundary.left&&e.x<this.boundary.left&&(e.x=this.boundary.left),null!=this.boundary.right&&e.x>this.boundary.right&&(e.x=this.boundary.right),null!=this.boundary.bottom&&e.y<this.boundary.bottom&&(e.y=this.boundary.bottom),null!=this.boundary.top&&e.y>this.boundary.top&&(e.y=this.boundary.top),e}},{key:"intersect",value:function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if("number"==typeof t)return{intersect:null,distance:0,reflection:n};function r(t){if(null!=t){if(null!=m&&null!=v)return new ge([t,m],[t,v]);if(null==m&&null!=v)return new ge([t,v],null,-Math.PI/2,1);if(null!=m&&null==v)return new ge([t,m],null,Math.PI/2,1);if(null==m&&null==v)return new ge([t,0],null,Math.PI/2,0)}return null}function i(t){if(null!=t){if(null!=g&&null!=b)return new ge([g,t],[b,t]);if(null==g&&null!=b)return new ge([b,t],null,-Math.PI,1);if(null!=g&&null==b)return new ge([g,t],null,0,1);if(null==g&&null==b)return new ge([0,t],null,Math.PI,0)}return null}function o(t,n){if(null==t)return null;if(t.hasPointOn(p,e.precision))return{intersect:p._dup(),distance:0,id:n};var r=T.intersectsWith(t,e.precision);return r.withinLine&&null!=r.intersect?{intersect:r.intersect,distance:f(p.distance(r.intersect),e.precision),id:n}:null}function a(t,n){var r=null;return null!=t&&null!=n?r=0===t.distance&&"inside"===e.bounds||!(0===n.distance&&"inside"===e.bounds||t.distance<n.distance)?n:t:null!=t?r=t:null!=n&&(r=n),r}var s,l=h(Jt(n,"0to360"),this.precision),u=h(Math.PI,this.precision),c=h(3*Math.PI/2,this.precision),d=h(Math.PI/2,this.precision),p=ne(t),y=this.boundary,v=y.top,m=y.bottom,g=y.left,b=y.right,w=i(m),S=i(v),x=r(g),_=r(b),T=new ge(p,null,n,1),k=o(w,"bottom"),O=o(S,"top"),P=o(x,"left"),A=o(_,"right"),E=a(k,O),M=a(P,A),j=[];if(null!=E&&null!=M&&E.distance===M.distance)j=[E,M];else{var R=a(E,M);null!=R&&(j=[R])}if(0===j.length)return{intersect:null,distance:0,reflection:n};var C=0,D=1,L=1;j.forEach((function(t){"left"===t.id||"right"===t.id?D=-1:L=-1,s=t.intersect,C=t.distance}));var B=Me(1,n);-1===D&&(B.x*=-1),-1===L&&(B.y*=-1),0===C&&(s=p);var I=je(B).angle,F=!1;if(0===C&&"inside"===this.bounds&&1===j.length&&("bottom"!==j[0].id&&"top"!==j[0].id||null!=this.boundary.left&&null!=this.boundary.right||0!==l&&l!==u||(F=!0),"right"!==j[0].id&&"left"!==j[0].id||null!=this.boundary.top&&null!=this.boundary.bottom||l!==d&&l!==c||(F=!0),"right"===j[0].id&&null==this.boundary.left&&l===u&&(F=!0),"left"===j[0].id&&null==this.boundary.right&&0===l&&(F=!0),"top"===j[0].id&&null==this.boundary.bottom&&l===c&&(F=!0),"bottom"===j[0].id&&null==this.boundary.top&&l===d&&(F=!0)),0===C&&"inside"===this.bounds&&2===j.length&&("bottom"===j[0].id&&"left"===j[1].id&&null==this.boundary.right&&0===l&&(F=!0),"bottom"===j[0].id&&"left"===j[1].id&&null==this.boundary.top&&l===d&&(F=!0),"top"===j[0].id&&"left"===j[1].id&&null==this.boundary.right&&0===l&&(F=!0),"top"===j[0].id&&"left"===j[1].id&&null==this.boundary.bottom&&l===c&&(F=!0),"top"===j[0].id&&"right"===j[1].id&&null==this.boundary.left&&l===u&&(F=!0),"top"===j[0].id&&"right"===j[1].id&&null==this.boundary.bottom&&l===c&&(F=!0),"bottom"===j[0].id&&"right"===j[1].id&&null==this.boundary.left&&l===u&&(F=!0),"bottom"===j[0].id&&"right"===j[1].id&&null==this.boundary.top&&l===d&&(F=!0)),0===C&&"outside"===this.bounds&&2===j.length&&("bottom"===j[0].id&&"left"===j[1].id&&(d<=l||0===l)&&(F=!0),"top"===j[0].id&&"left"===j[1].id&&0<=l&&l<=c&&(F=!0),"top"===j[0].id&&"right"===j[1].id&&(l<=u||c<=l)&&(F=!0),"bottom"===j[0].id&&"right"===j[1].id&&(l<=d||u<=l)&&(F=!0)),0===C&&"outside"===this.bounds&&1===j.length){var W=Kt(j,1)[0];"left"===W.id&&d<=l&&l<=c&&(F=!0),"right"===W.id&&(l<=d||c<=l)&&(F=!0),"bottom"===W.id&&(u<=l||0===l)&&(F=!0),"top"===W.id&&l<=u&&(F=!0)}return F&&(s=null,I=n),{intersect:s,distance:C,reflection:I}}}]),e}(),ze=function(){Ht(e,We);var t=Vt(e);function e(n){var r;Xt(this,e);var i=st({},{angle:0,mag:1,bounds:"inside",precision:8,ends:2},n);return null!=i.line?r=Se(i.line):null!=i.p1&&null!=i.p2?r=new ge(i.p1,i.p2,0,i.ends):null!=i.p1&&(r=new ge(i.p1,i.mag,i.angle,i.ends)),t.call(this,r,i.bounds,i.precision)}return $t(e,[{key:"_dup",value:function(){return new e({bounds:this.bounds,precision:this.precision,p1:this.boundary.p1._dup(),p2:this.boundary.p2._dup(),mag:this.boundary.distance,angle:this.boundary.ang,ends:this.boundary.ends})}},{key:"_state",value:function(t){var e=te(t);return{f1Type:"lineBounds",state:[this.bounds,this.precision,h(this.boundary.p1.x,e),h(this.boundary.p1.y,e),h(this.boundary.p2.x,e),h(this.boundary.p2.y,e),this.boundary.ends]}}},{key:"contains",value:function(t){return"number"!=typeof t&&ne(t).isWithinLine(this.boundary,this.precision)}},{key:"clip",value:function(t){return"number"==typeof t?t:ne(t).clipToLine(this.boundary,this.precision)}},{key:"intersect",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;if("number"==typeof t||0===this.boundary.ends)return{intersect:null,distance:0,reflection:n};var r=ne(t);if(!this.boundary.hasPointAlong(r,this.precision))return{intersect:null,distance:0,reflection:n};var i=!1;this.boundary.hasPointOn(r,this.precision)&&(i=!0);var o,a,s=this.boundary,l=this.boundary.p1._dup(),u=this.boundary.p2._dup(),c=f(Math.abs(Jt(n,"0to360")-Jt(s.ang,"0to360")),this.precision),h=r.distance(l),d=r.distance(u);if(r.isEqualTo(l,this.precision)){if("inside"===this.bounds&&0!==c)return{intersect:l,distance:0,reflection:s.ang};if("outside"===this.bounds&&0!==c)return{intersect:null,distance:0,reflection:n};if("outside"===this.bounds&&0===c)return{intersect:l,distance:0,reflection:s.ang+Math.PI}}if(1===s.ends)return!0===i&&0===c||!1===i&&0!==c?{intersect:null,distance:0,reflection:n}:{intersect:l,distance:h,reflection:n+Math.PI};if(r.isEqualTo(u,this.precision)){if("inside"===this.bounds&&0===c)return{intersect:u,distance:0,reflection:s.ang+Math.PI};if("outside"===this.bounds&&0===c)return{intersect:null,distance:0,reflection:n};if("outside"===this.bounds&&0!==c)return{intersect:u,distance:0,reflection:s.ang}}if(i&&0===c)return{intersect:u,distance:d,reflection:n+Math.PI};if(i)return{intersect:l,distance:h,reflection:n+Math.PI};if(h<d&&0===c)o=l,a=h;else{if(!(d<h&&0!==c))return{intersect:null,distance:0,reflection:n};o=u,a=d}return{intersect:o,distance:a,reflection:n+Math.PI}}},{key:"clipVelocity",value:function(t){if("number"==typeof t)return t;if(null==this.boundary)return t;var e=ne(t),n=new be(this.boundary).unit().dotProduct(new be([0,0],e)),r=this.boundary.ang;return n<-1&&(r+=Math.PI,n=-n),Me(n,r)}}]),e}();function He(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new ke;if(null==t)return new We;if(t instanceof We)return t;if(null!=t.type)return He(t.bounds,t.type);if("rect"===e)return new Ne(t);if("range"===e)return new qe(t);if("line"===e)return new ze(t);if("transform"===e)return new Ue(n,t);if(void 0!==t.min||void 0!==t.max)return He(t,"range");if(t instanceof oe)return new Ne(t);if(t instanceof ge)return new ze({line:t});if(void 0!==t.left||void 0!==t.right||void 0!==t.top||void 0!==t.bottom)return He(t,"rect");if(void 0!==t.line||void 0!==t.p1||void 0!==t.p2||void 0!==t.angle||void 0!==t.mag||void 0!==t.ends)return He(t,"line");if(void 0!==t.translation||void 0!==t.scale||void 0!==t.rotation)return He(t,"transform",n);if(void 0!==t.f1Type&&null!=t.state){var r=t.f1Type,i=t.state;if(null!=r&&"rangeBounds"===r&&null!=i&&Array.isArray([i])&&4===i.length){var o=Kt(i,4),a=o[0],s=o[1],l=o[2],u=o[3];return new qe({bounds:a,precision:s,min:l,max:u})}if(null!=r&&"rectBounds"===r&&null!=i&&Array.isArray([i])&&6===i.length){var c=Kt(i,6),h=c[0],f=c[1],d=c[2],p=c[3],y=c[4],v=c[5];return new Ne({bounds:h,precision:f,left:d,bottom:p,right:y,top:v})}if(null!=r&&"lineBounds"===r&&null!=i&&Array.isArray([i])&&7===i.length){var m=Kt(i,7),g=m[0],b=m[1],w=m[2],S=m[3],x=m[4],_=m[5],T=m[6];return new ze({bounds:g,precision:b,p1:new se(w,S),p2:new se(x,_),ends:T})}if(null!=r&&"transformBounds"===r&&null!=i&&Array.isArray([i])&&3===i.length){var k=Kt(i,3),O=k[0],P=k[1],A=k[2],E=new Ue(new ke,{},O);E.order=P.slice();var M=[];return A.forEach((function(t){null==t?M.push(null):M.push(He(t))})),E.boundary=M,E}}return null}function Ve(t,e){if(Array.isArray(t))return t;var n=[];if("number"==typeof t){for(var r=0;r<e.order.length;r+=1)n.push(t);return n}for(var i=0;i<e.order.length;i+=1){var o=e.order[i];if(o instanceof _e){var a=0;null!=t.position&&(a=t.position),null!=t.translation&&(a=t.translation),n.push(a)}else if(o instanceof Te){var s=0;null!=t.scale&&(s=t.scale),n.push(s)}else if(o instanceof xe){var l=0;null!=t.rotation&&(l=t.rotation),n.push(l)}}return n}var Ue=function(){Ht(e,We);var t=Vt(e);function e(n){var r,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:8;Xt(this,e);for(var a=[],s=0;s<n.order.length;s+=1){var l=n.order[s];l instanceof _e?a.push("t"):l instanceof Te?a.push("s"):a.push("r")}return(r=t.call(this,[],"inside",o)).order=a,r.createBounds(i),r}return $t(e,[{key:"_dup",value:function(){var t=new e(new ke,{},this.precision);return t.order=this.order.slice(),t.boundary=[],this.boundary.forEach((function(e){null==e?t.boundary.push(null):t.boundary.push(e._dup())})),t}},{key:"_state",value:function(t){var e=te(t),n=[];return this.boundary.forEach((function(t){null==t?n.push(null):n.push(t._state({precision:e}))})),{f1Type:"transformBounds",state:[this.precision,this.order.slice(),n]}}},{key:"createBounds",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;if(null==t||t instanceof We)this.boundary[n]=t;else if(Array.isArray(t))this.boundary=t;else{var r=[];this.order.forEach((function(e){var n=null;"t"===e&&null!=t.position&&(n=He(t.position)),"t"===e&&null!=t.translation&&(n=He(t.translation)),"r"===e&&null!=t.rotation&&(n=He(t.rotation)),"s"===e&&null!=t.scale&&(n=He(t.scale)),r.push(n)})),this.boundary=r}}},{key:"update",value:function(t,e,n){for(var r=2<arguments.length&&void 0!==n?n:0,i=0,o=0;o<this.order.length;o+=1)this.order[o]===t&&(null!=r&&r!==i||(this.boundary[o]=He(e)),i+=1)}},{key:"updateTranslation",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,r=He(t);r instanceof qe&&(r=new Ne({left:r.boundary.min,bottom:r.boundary.min,top:r.boundary.max,right:r.boundary.max})),this.update("t",r,n)}},{key:"updateRotation",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;this.update("r",t,n)}},{key:"updateScale",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;this.update("s",t,n)}},{key:"getBound",value:function(t,e){for(var n=1<arguments.length&&void 0!==e?e:0,r=0,i=0;i<this.order.length;i+=1)if(this.order[i]===t){if(r===n)return this.boundary[i];r+=1}return null}},{key:"getTranslation",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;return this.getBound("t",e)}},{key:"getScale",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;return this.getBound("s",e)}},{key:"getRotation",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;return this.getBound("r",e)}},{key:"contains",value:function(t){for(var e=0;e<t.order.length;e+=1){var n=t.order[e],r=this.boundary[e];if(n instanceof xe){if(null!=r&&!r.contains(n.r))return!1}else if(null!=r&&!r.contains(new se(n.x,n.y)))return!1}return!0}},{key:"clip",value:function(t){for(var e=[],n=0;n<t.order.length;n+=1){var r,i,o=t.order[n],a=this.boundary[n];null!=a?(r=o instanceof xe?a.clip(o.r):a.clip(new se(o.x,o.y)),i=o instanceof _e?new _e(r.x,r.y,o.name):o instanceof Te?new Te(r.x,r.y,o.name):new xe(r,o.name),e.push(i)):e.push(o._dup())}return new ke(e,t.name)}}]),e}();function Ge(t,e,n){var r,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:8,u=e;null!=(r=o instanceof qe?new Ne({left:o.boundary.min,right:o.boundary.max,bottom:o.boundary.min,top:o.boundary.max}):o)&&null!=r.clipVelocity&&(u=r.clipVelocity(e));var c=!1;null==i&&(c=!0);var h=u.toPolar(),d=h.mag,p=h.angle;if(d<=s)return{velocity:new se(0,0),position:t,duration:0};var y=t._dup();null!=r&&(y=r.clip(t));var v=d,m=Math.abs(v)-s,g=i;(null==g||g>Math.abs(m/n))&&(g=Math.abs(m/n));var b=v*g-.5*n*Math.pow(g,2),w=Me(b,p).add(y);if(null==r||r.contains(w)){if(c)return{duration:g,position:w,velocity:new se(0,0)};var S=v-n*g;return f(S,l)<=f(s,l)&&(S=0),{position:w,velocity:Me(S,p),duration:g}}var x,_=1-a,T=r.intersect(y,Jt(p,"0to360"));if(null!=T.distance&&T.distance>b)throw new Error("Error in calculating intersect");if("number"==typeof T.intersect)x=new se(T.intersect,0);else{if(null==T.intersect)return{position:w,velocity:new se(0,0),duration:g};x=T.intersect}var k=T.distance,O=T.reflection,P=-v/Math.abs(v)*n,A=.5*P,E=-k,M=(-v+Math.sqrt(Math.pow(v,2)-4*A*E))/(2*A);if(1===a)return{velocity:new se(0,0),position:x,duration:M};var j=(v+P*M)*_,R=new se(j*Math.cos(O),j*Math.sin(O));if(c){var C=Ge(x,R,n,i,r,a,s,l);return{duration:M+C.duration,position:C.position,velocity:new se(0,0)}}return Ge(x,R,n,g-M,r,a,s,l)}function Xe(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:8,l=i;null!=i&&(l=new ze({p1:[null!=i.boundary.min?i.boundary.min:0,0],p2:[null!=i.boundary.max?i.boundary.max:0,0]}));var u=Ge(new se(t,0),new se(e,0),n,r,l,o,a,s);return{duration:u.duration,value:u.position.x,velocity:u.velocity.x}}function Ye(t,e,n,r,i,o,a,s){var l=3<arguments.length&&void 0!==r?r:null,u=4<arguments.length&&void 0!==i?i:null,c=5<arguments.length&&void 0!==o?o:0,h=6<arguments.length&&void 0!==a?a:0,f=7<arguments.length&&void 0!==s?s:8,d=null,p=null;null!=u&&(d=new qe({min:u.boundary.left,max:u.boundary.right}),p=new qe({min:u.boundary.bottom,max:u.boundary.top}));var y=Xe(t.x,e.x,n,l,d,c,h,f),v=Xe(t.y,e.y,n,l,p,c,h,f);return{duration:Math.max(y.duration,v.duration),point:new se(y.value,v.value),velocity:new se(y.velocity,v.velocity)}}function $e(t,e,n,r,i,o,a){var s,l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:8,u=0,c=[],h=[];s=i instanceof Ue?i:new Ue(t,i);for(var f=0;f<t.order.length;f+=1){var d,p=t.order[f],y=void 0,v=void 0;d=p instanceof _e?(y=Ge(p,e.order[f],n[f],r,s.boundary[f],o[f],a[f],l),v=new _e(y.position.x,y.position.y),new _e(y.velocity.x,y.velocity.y)):p instanceof Te?(y=Ye(p,e.order[f],n[f],r,s.boundary[f],o[f],a[f],l),v=new Te(y.point.x,y.point.y),new Te(y.velocity.x,y.velocity.y)):(y=Xe(p.r,e.order[f].r,n[f],r,s.boundary[f],o[f],a[f],l),v=new xe(y.value),new xe(y.velocity)),null!==r||y.duration>u&&(u=y.duration),h.push(d),c.push(v)}return null!=r&&(u=r),{transform:new ke(c),velocity:new ke(h),duration:u}}var Ke={simple:{source:"attribute vec2 a_position;uniform mat3 u_matrix;uniform float u_z;void main() {gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);}",varNames:["a_position","u_matrix","u_z"]},withTexture:{source:"attribute vec2 a_position;attribute vec2 a_texcoord;uniform mat3 u_matrix;uniform float u_z;varying vec2 v_texcoord;void main() {gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);v_texcoord = a_texcoord;}",varNames:["a_position","a_texcoord","u_matrix","u_z"]}},Qe={simple:{source:"precision mediump float;uniform vec4 u_color;void main() {gl_FragColor = u_color;}",varNames:["u_color"]},withTexture:{source:"precision mediump float;uniform vec4 u_color;uniform int u_use_texture;uniform sampler2D u_texture;varying vec2 v_texcoord;void main() {if ( u_use_texture == 1) {gl_FragColor = texture2D(u_texture, v_texcoord);} else {gl_FragColor = u_color;}}",varNames:["u_color","u_use_texture","u_texture"]},text:{source:"precision mediump float;uniform vec4 u_color;uniform sampler2D u_texture;varying vec2 v_texcoord;void main() {vec4 c = texture2D(u_texture, v_texcoord);gl_FragColor = vec4(c.a * u_color.rgb, c.a * u_color.a);}",varNames:["u_color","u_texture"]}};function Ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Je(t,e,n){return e&&Ze(t.prototype,e),n&&Ze(t,n),t}var tn={TRIANGLES:1,TRIANGLE_STRIP:2,TRIANGLE_FAN:3,LINES:4,LINK_STATUS:1,VERTEX_SHADER:1,COMPILE_STATUS:1,FRAGMENT_SHADER:1,SRC_ALPHA:1,ONE_MINUS_SRC_ALPHA:1,BLEND:1,COLOR_BUFFER_BIT:1,TEXTURE_2D:1,RGBA:1,UNSIGNED_BYTE:1,TEXTURE_WRAP_S:1,CLAMP_TO_EDGE:1,TEXTURE_WRAP_T:1,TEXTURE_MIN_FILTER:1,LINEAR:1,ARRAY_BUFFER:1,STATIC_DRAW:1,FLOAT:1,UNPACK_PREMULTIPLY_ALPHA_WEBGL:1,createBuffer:function(){},bindBuffer:function(){},bufferData:function(){},enableVertexAttribArray:function(){},vertexAttribPointer:function(){},disableVertexAttribArray:function(){},uniformMatrix3fv:function(){},uniform4f:function(){},uniform1f:function(){},uniform1i:function(){},texParameteri:function(){},drawArrays:function(){},clearColor:function(){},clear:function(){},createTexture:function(){},activeTexture:function(){},bindTexture:function(){},pixelStorei:function(){},texImage2D:function(){},blendFunc:function(){},attachShader:function(){},linkProgram:function(){},getProgramParameter:function(){},createProgram:function(){},deleteProgram:function(){},createShader:function(){},shaderSource:function(){},compileShader:function(){},getShaderParameter:function(){},getAttribLocation:function(){},getUniformLocation:function(){},enable:function(){},map:function(){},getExtension:function(){return{loseContext:function(){}}},disable:function(){},deleteShader:function(){},useProgram:function(){},viewport:function(){},canvas:{toDataURL:function(){return""},width:100,clientHeight:100,height:100,style:{top:0,visibility:"visible"}}};function en(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(t.deleteShader(r),null)}var nn=function(){function t(e,n){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var r=e.getContext("webgl",{antialias:!0});null==r&&(r=tn),this.programs=[],this.lastUsedProgram=null,this.textures={},null!=r&&(this.gl=r,this.resize(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.disable(this.gl.DEPTH_TEST),this.gl.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.gl.enable(r.BLEND))}return Je(t,[{key:"addTexture",value:function(t,e,n){return this.textures[t]&&null!=this.textures[t].glTexture?this.textures[t].index:(r=this.textures[t]?this.textures[t].index:Object.keys(this.textures).length,this.textures[t]={glTexture:e,index:r,type:n,state:"loaded",onLoad:[]},r);var r}},{key:"onLoad",value:function(t){this.textures[t].onLoad.forEach((function(t){return t()})),this.textures[t].onLoad=[]}},{key:"getProgram",value:function(t,e){for(var n=0;n<this.programs.length;n+=1){var r=this.programs[n];if(r.vertexShader===t&&r.fragmentShader===e)return n}var i,o,a,s,l,u,c,h,f,d=function(t,e){var n=0<arguments.length&&void 0!==t?t:"simple",r=1<arguments.length&&void 0!==e?e:"simple";return Object.hasOwnProperty.call(Ke,n)&&Object.hasOwnProperty.call(Qe,r)?{vertexSource:Ke[n].source,fragmentSource:Qe[r].source,varNames:Ke[n].varNames.concat(Qe[r].varNames)}:{vertexSource:"",fragmentSource:"",varNames:[]}}(t,e),p=(i=this.gl,o=d.vertexSource,a=d.fragmentSource,h=en(i,i.VERTEX_SHADER,o),f=en(i,i.FRAGMENT_SHADER,a),h&&f?(l=h,u=f,c=(s=i).createProgram(),s.attachShader(c,l),s.attachShader(c,u),s.linkProgram(c),s.getProgramParameter(c,s.LINK_STATUS)?c:(s.deleteProgram(c),null)):null),y={vertexShader:t,fragmentShader:e,program:p,locations:function(t,e,n){var r,i,o={};for(r=0;r<n.length;r+=1)"a"===(i=n[r])[0]&&(o[i]=t.getAttribLocation(e,i)),"u"===i[0]&&(o[i]=t.getUniformLocation(e,i));return o}(this.gl,p,d.varNames)};return this.programs.push(y),this.programs.length-1}},{key:"useProgram",value:function(t){var e=this.programs[t];return this.lastUsedProgram!==e&&(this.gl.useProgram(e.program),this.lastUsedProgram=e.program),e.locations}}]),Je(t,[{key:"resize",value:function(){var t=window.devicePixelRatio,e=Math.floor(this.gl.canvas.clientWidth*t),n=Math.floor(this.gl.canvas.clientHeight*t);this.gl.canvas.width===e&&this.gl.canvas.height===n||(this.gl.canvas.width=e,this.gl.canvas.height=n),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}}]),t}();function rn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return on(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?on(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function on(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function an(t,e,n){var r=st({},{precision:5,ignoreShown:!1,min:!1},n),i=r.precision,o={};return e.forEach((function(e){var n=function t(e,n,r){var i=rn(r,1)[0];return 1===r.length?[e,n,r[0]]:(null==e[i]&&(e[i]={}),null==n[i]?null:t(e[i],n[i],r.slice(1)))}(o,t,e.split("."));if(null!=n){var a=rn(n,3),s=a[0],l=a[1],u=a[2];s[u]=function t(e){if("string"==typeof e)return e;if("number"==typeof e)return e;if("boolean"==typeof e)return e;if(null==e)return e;if(null!=e._def)return e._def(i);if(null!=e._state)return e._state(r);if(Array.isArray(e)){var n=[];return e.forEach((function(e){n.push(t(e))})),n}if(null!=e._dup)return e._dup();var o={},a=Object.keys(e);e._stateKeys&&(a=e._stateKeys());var s=a;if(e._excludeStateKeys){s=[];var l=e._excludeStateKeys();a.forEach((function(t){-1===l.indexOf(t)&&s.push(t)}))}return s.forEach((function(n){o[n]=t(e[n])})),o}(l[u])}})),o}var sn=function(){function t(){return function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),t.instance||(this.requestNextAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,(t.instance=this).reset()),t.instance}var e,n,r,i;function o(t){return r.apply(this,arguments)}function a(t,e){return i.apply(this,arguments)}return e=t,n=[{key:"reset",value:function(){this.drawQueue=[],this.nextDrawQueue=[],this.lastFrame=null,this.debug=!1,this.simulatedFPS=60,this.debugFrameTime=.5,null!=this.timers&&0<this.timers.length&&this.timers.forEach((function(t){return clearTimeout(t)})),this.timers=[],null!=this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=null,this.now=function(){return performance.now()},this.updateSyncNow=!0}},{key:"getWhen",value:function(t){return"now"===t?this.now():"prevFrame"===t?this.lastFrame:"sync"===t?this.syncNow():null}},{key:"syncNow",value:function(){var t=this;return this.updateSyncNow&&(this.updateSyncNow=!1,this.synchronizedNow=performance.now(),this.syncNowTimer=setTimeout((function(){t.updateSyncNow=!0}),100)),this.synchronizedNow}},{key:"now",value:function(){return performance.now()}},{key:"setDebugFrameRate",value:function(t,e){var n=this,r=0<arguments.length&&void 0!==t?t:60,i=1<arguments.length&&void 0!==e?e:1;null!=this.timeoutId&&clearTimeout(this.timeoutId),cancelAnimationFrame(this.animationId),this.simulatedFPS=r,this.debugFrameTime=i,this.debug=!0,this.nowTime=performance.now(),this.now=function(){return n.nowTime},this.queueNextDebugFrame()}},{key:"queueNextDebugFrame",value:function(){var t=this;null!=this.debugFrameTime?this.timeoutId=setTimeout((function(){t.nowTime+=1/t.simulatedFPS*1e3,0<t.nextDrawQueue.length&&t.draw(t.now()),t.queueNextDebugFrame()}),1e3*this.debugFrameTime):(this.nowTime+=1/this.simulatedFPS*1e3,0<this.nextDrawQueue.length&&this.draw(this.now()))}},{key:"setTimeout",value:(i=function(t,e){if(this.debug){var n=0;if(null!=this.debugFrameTime&&(n=(this.debugFrameTime||0)/(1/this.simulatedFPS)),0<n){var r=setTimeout(t,e*n);return this.timers.push(r),r}var i=setTimeout(t,0);return this.timers.push(i),i}var o=setTimeout(t,e);return this.timers.push(o),o},a.toString=function(){return i.toString()},a)},{key:"clearTimeout",value:(r=function(t){if(null!=t){clearTimeout(t);var e=this.timers.indexOf(t);-1<e&&this.timers.splice(e,1)}},o.toString=function(){return r.toString()},o)},{key:"disableDebugFrameRate",value:function(){null!=this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=null,this.debug=!1,0<this.nextDrawQueue.length&&this.animateNextFrame()}},{key:"draw",value:function(t){clearTimeout(this.syncNowTimer),this.updateSyncNow=!0,this.drawQueue=this.nextDrawQueue,this.nextDrawQueue=[];for(var e=.001*t,n=0;n<this.drawQueue.length;n+=1)this.drawQueue[n](e);this.drawQueue=[],this.lastFrame=t}},{key:"queueNextFrame",value:function(t){this.nextDrawQueue.push(t),1===this.nextDrawQueue.length&&(this.debug||this.animateNextFrame())}},{key:"animateNextFrame",value:function(){cancelAnimationFrame(this.animationId);var t=this.requestNextAnimationFrame.call(window,this.draw.bind(this));this.animationId=t}}],function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,n),t}(),ln=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var n=st({},{onFinish:null,completeOnCancel:null,removeOnFinish:!0,name:vt(),duration:0,delay:0,beforeFrame:null,afterFrame:null,precision:8},e);return this.onFinish=n.onFinish,this.completeOnCancel=n.completeOnCancel,this.duration=n.duration,this.startTime=null,this.state="idle",this.name=n.name,this.afterFrame=n.afterFrame,this.beforeFrame=n.beforeFrame,this.startDelay=n.delay,this.precision=n.precision,this.removeOnFinish=n.removeOnFinish,this.startTimeOffset=0,this.fnMap=new V,this.fnMap.add("tools.math.easein",w),this.fnMap.add("tools.math.easeout",b),this.fnMap.add("tools.math.easeinout",g),this.fnMap.add("tools.math.linear",v),this.fnMap.add("tools.math.sinusoid",S),this}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"_fromDef",value:function(t,e){return st(this,t),this}},{key:"fnExec",value:function(t){for(var e,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(e=this.fnMap).exec.apply(e,[t].concat(r))}},{key:"setTimeDelta",value:function(t){null!=this.startTime&&(this.startTime+=t)}},{key:"_getStateProperties",value:function(){return["startTime","duration","onFinish","completeOnCancel","state","startTimeOffset","removeOnFinish","name","startDelay","beforeFrame","afterFrame","_stepType"]}},{key:"_getStateName",value:function(){return"animationStep"}},{key:"_state",value:function(t){return{f1Type:this._getStateName(),state:an(this,this._getStateProperties(),t)}}},{key:"_fromState",value:function(t){return st(this,t),this}},{key:"nextFrame",value:function(t){null==this.startTime&&(this.startTime=t-this.startTimeOffset);var e=t-this.startTime,n=f(-(this.duration+this.startDelay-e),this.precision);if(e>=this.startDelay){var r=e-this.startDelay;r>=this.duration&&(n=r-this.duration,r=this.duration),this.beforeFrame&&this.beforeFrame(r/this.duration),this.setFrame(r),this.afterFrame&&this.afterFrame(r/this.duration),0<=n&&this.finish()}return n}},{key:"getRemainingTime",value:function(t){var e=0<arguments.length&&void 0!==t?t:(new sn).now()/1e3,n=this.getTotalDuration();if(null==this.startTime)return"animating"===this.state||"waitingToStart"===this.state?n:0;var r=e-this.startTime;return this.duration+this.startDelay-r}},{key:"getTotalDuration",value:function(){return this.duration+this.startDelay}},{key:"setFrame",value:function(){}},{key:"startWaiting",value:function(){this.state="waitingToStart"}},{key:"start",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.state="animating","number"!=typeof e&&null!=e?"next"!==e?("prev"===e&&(this.startTime=(new sn).lastFrame),this.startTime=(new sn).now()/1e3):this.startTime=null:this.startTime=e}},{key:"finishIfZeroDuration",value:function(){0===this.duration&&0===this.startDelay&&this.finish()}},{key:"setToEnd",value:function(){}},{key:"finish",value:function(t,e){var n=0<arguments.length&&void 0!==t&&t,r=1<arguments.length&&void 0!==e?e:null;if("idle"!==this.state&&"finished"!==this.state){var i=this.state;this.state="finished",n&&("complete"===r||null==r&&!0===this.completeOnCancel?("waitingToStart"===i&&this.start(),this.setToEnd()):"waitingToStart"===i&&this.cancelledWithNoComplete()),!1===n&&("waitingToStart"===i&&this.start(),this.setToEnd()),null!=this.onFinish&&this.fnExec(this.onFinish,n)}}},{key:"cancelledWithNoComplete",value:function(){}},{key:"cancel",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.finish(!0,e)}},{key:"_dup",value:function(){var e=new t;return lt(this,e),e}},{key:"whenFinished",value:function(t){return this.onFinish=t,this}},{key:"ifCanceledThenComplete",value:function(){return this.completeOnCancel=!0,this}},{key:"ifCancelled",value:function(t){var e=0<arguments.length&&void 0!==t?t:"freeze";return this.completeOnCancel="complete"===e,this}},{key:"ifCanceledThenStop",value:function(){return this.completeOnCancel=!1,this}}]),t}();function un(t){return(un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function hn(t,e,n){return(hn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dn(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function fn(t,e){return(fn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function dn(t){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var pn=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fn(t,e)}(r,ln);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=dn(t);if(e){var o=dn(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==un(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),t=n.call(this,e);var i="easeinout";"color"!==e.type&&"custom"!==e.type&&"opacity"!==e.type||(i="linear");var o=st({},{element:null,type:"custom",progression:i,duration:0},e);return t.element=o.element,t.type=o.type,t.onFinish=o.onFinish,t.duration=o.duration,t.progression=o.progression,"linear"===t.progression?t.progression="tools.math.linear":"easein"===o.progression?t.progression="tools.math.easein":"easeout"===o.progression?t.progression="tools.math.easeout":"easeinout"===o.progression?t.progression="tools.math.easeinout":t.progression=o.progression,t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"fnExec",value:function(t){for(var e,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return null==this.element?(e=this.fnMap).exec.apply(e,[t].concat(r)):(o=this.fnMap).execOnMaps.apply(o,[t,[this.element.fnMap.map]].concat(r));var o}},{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return cn(t)}(t=hn(dn(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return cn(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?cn(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["type","progression"]);var t}},{key:"_fromState",value:function(t,e){return st(this,t),null!=this.element&&"string"==typeof this.element&&null!=e&&(this.element=e(this.element)),this}},{key:"_state",value:function(t){var e=hn(dn(r.prototype),"_state",this).call(this,t);return null!=this.element&&(e.state.element={f1Type:"de",state:this.element.getPath()}),e}},{key:"getPercentComplete",value:function(t){if("string"!=typeof this.progression)return"function"==typeof this.progression?this.progression(t):0;var e=this.fnExec(this.progression,t);return null==e?0:e}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}();function yn(t){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mn(t,e,n){return(mn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bn(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function gn(t,e){return(gn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function bn(t){return(bn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var wn=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gn(t,e)}(r,pn);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=bn(t);if(e){var o=bn(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==yn(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=st.apply(void 0,[{},{type:"position"}].concat(i));pt(a,["start","delta","target","translationStyle","translationOptions","velocity","maxDuration"]),(t=n.call(this,a))._stepType="position";var s={start:null,target:null,delta:null,translationStyle:"linear",translationOptions:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:"",maxDuration:null},velocity:null};if(t.element&&t.element.animations.options.translation){var l=t.element.animations.options.translation;null!=l.style&&(s.style=l.style),st(s.translationOptions,l)}var u=st.apply(void 0,[{},s].concat(i));return null!=u.start&&(u.start=ne(u.start)),null!=u.target&&(u.target=ne(u.target)),null!=u.delta&&(u.delta=ne(u.delta)),t.position={translationOptions:{}},yt(u,t.position,["start","delta","target","translationStyle","velocity","maxDuration"]),lt(u.translationOptions,t.position.translationOptions),t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return vn(t)}(t=mn(bn(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return vn(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?vn(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["position"]);var t}},{key:"_getStateName",value:function(){return"positionAnimationStep"}},{key:"start",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(mn(bn(r.prototype),"start",this).call(this,t),null==this.position.start){if(null==this.element)return void(this.duration=0);this.position.start=this.element.getPosition()}else"now"!==t&&"prev"!==t||null!=this.element&&this.element.setPosition(ne(this.position.start));if(null==this.position.delta&&null!=this.position.target&&null!=this.position.start){var e=this.position.target.sub(this.position.start);this.position.delta=e}else null!=this.position.delta&&null!=this.position.start?this.position.target=this.position.start.add(this.position.delta):this.duration=0;var n=this.position,i=n.target,o=n.start,a=n.velocity;if(null!=a&&null!=o&&null!=i){var s=ne(a);this.duration=Be((new ke).translate(o),(new ke).translate(i),(new ke).translate(s))}null!=this.position.maxDuration&&this.duration>this.position.maxDuration&&(this.duration=this.position.maxDuration)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.getPercentComplete(e);if(null!=this.position.delta&&null!=this.position.start){var r=this.position.start.toDelta(this.position.delta,n,this.position.translationStyle,this.position.translationOptions);null!=this.element&&this.element.setPosition(r)}}},{key:"setToEnd",value:function(){null!=this.element&&null!=this.position.target&&this.element.setPosition(this.position.target)}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}();function Sn(t){return(Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xn(t,e,n){var r=[];return Object.keys(t).forEach((function(i){var o="".concat(e,".").concat(i);if(i.includes(n))r.push(o);else if("object"===Sn(t[i])){var a=xn(t[i],o,n);a&&(r=r.concat(a))}else"string"==typeof t[i]&&t[i].includes(n)&&r.push(o)})),r}function _n(t,e){function n(t){return t[1].toUpperCase()}var r=new RegExp(e,"g");return t.replace(r,"").replace(/-[a-z]/g,n).replace(/_[a-z]/g,n).replace(/-/g,"")}function Tn(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:function(t){return t},o={},a=t;if("string"==typeof t&&(a=document.getElementById(t)),a instanceof HTMLElement){var s=window.getComputedStyle(a);s&&e.forEach((function(t){var e=s.getPropertyValue(t);if(null!=e){e=e.trim();var a=parseFloat(e),l=e;if(Number.isNaN(a)||(l=a),l=i(l),r){var u=_n(t,n);o[u]=l}else{var c=new RegExp(n,"g"),h=t.replace(c,"");rt(o,h,l,"-")}}}))}return o}function kn(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r={},i=t;if("string"==typeof t&&(i=document.getElementById(t)),i instanceof HTMLElement){var o=window.getComputedStyle(i);if(o)for(var a=o.length,s=0;s<a;s+=1){var l=o[s];if(""===e||l.startsWith(e)){var u=o.getPropertyValue(l);if(null!=u){u=u.trim();var c=parseFloat(u),h=u;if(Number.isNaN(c)||(h=c),n)r[_n(l,e)]=h;else{var f=new RegExp(e,"g");rt(r,l.replace(f,""),h,"-")}}}}}return r}var On=["base","lighter","light","dark","darker","higher","high","low","lower"],Pn=[];["blue","red","yellow","green","cyan","brown","orange","violet","grey","black","white"].forEach((function(t){On.forEach((function(e){Pn.push("--palette-".concat(t,"-").concat(e))}))}));var An=["--diagram-background","--diagram-primary","--diagram-warning","--diagram-safe","--diagram-passive","--diagram-construction1","--diagram-construction2","--diagram-construction3","--diagram-construction4","--diagram-construction5","--diagram-construction6","--diagram-construction7","--diagram-construction8","--diagram-construction9","--diagram-disabled","--diagram-disabledDark","--diagram-disabledDarker","--diagram-disabledDarkest","--diagram-push","--diagram-action","--diagram-text-base","--diagram-text-warning","--diagram-text-plot","--diagram-text-keyword","--diagram-text-keyword2","--diagram-text-latin","--diagram-text-greek","--diagram-text-english","--diagram-text-note","--diagram-qr-background"];function En(){var t={},e={},n={},r=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).map((function(t){return"--colors-".concat(t)})),i=document.body;return i&&(t=Tn(i,r,"--colors-",!1,Rn),e=Tn(i,Pn,"--palette-",!1,Rn),n=Tn(i,An,"--diagram-",!1,Rn)),t.palette=e,t.diagram=n,t}function Mn(t){var e=t.replace(/.*\(/i,"").replace(/\)/i,"").split(",").map((function(t,e){return e<3?parseInt(t,10)/255:parseFloat(t)}));return 3===e.length&&e.push(1),e}function jn(t){var e=t.slice(1);return e.length<6&&(e="".concat(e[0]).concat(e[0]).concat(e[1]).concat(e[1]).concat(e[2]).concat(e[2])),[parseInt(e.slice(0,2),16)/255,parseInt(e.slice(2,4),16)/255,parseInt(e.slice(4,6),16)/255,1]}function Rn(t){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},n=t.slice(0);n in e&&(n=e[n]);var r=[];return n.toLowerCase().startsWith("rgb")?r=Mn(n):n.startsWith("#")&&(r=jn(n)),0<r.length?r:null}function Cn(t){return"rgba(".concat(Math.floor(255*t[0]),",").concat(Math.floor(255*t[1]),",").concat(Math.floor(255*t[2]),",").concat(t[3],")")}function Dn(t){return"rgb(".concat(Math.floor(255*t[0]),",").concat(Math.floor(255*t[1]),",").concat(Math.floor(255*t[2]),")")}function Ln(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:5;if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(f(t[r],n)!==f(e[r],n))return!1;return!0}function Bn(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.001;if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(n<Math.abs(t[r]-e[r]))return!1;return!0}function In(t){return(In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fn(t,e,n){return(Fn=zn()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Nn(i,n.prototype),i}).apply(null,arguments)}function Wn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function qn(t,e,n){return(qn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Hn(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Nn(t,e){return(Nn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Hn(t){return(Hn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Vn=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nn(t,e)}(r,ln);var t,e,n=(t=r,e=zn(),function(){var n,r,i=Hn(t);if(e){var o=Hn(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==In(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var i,o={steps:[]},a=arguments.length,s=new Array(1<a?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];Array.isArray(e)?(i=st.apply(void 0,[{},o].concat(s))).steps=e:i=st.apply(void 0,[{},o,e].concat(s)),(t=n.call(this,i)).steps=[];var u=[];return Array.isArray(i.steps)||null==i.steps?null!=i.steps&&(u=i.steps):u=[i.steps],t.steps=[],u.forEach((function(e){null!=e&&t.steps.push(e)})),t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return Wn(t)}(t=qn(Hn(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Wn(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Wn(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["steps"]);var t}},{key:"_getStateName",value:function(){return"parallelAnimationStep"}},{key:"setTimeDelta",value:function(t){qn(Hn(r.prototype),"setTimeDelta",this).call(this,t),null!=this.steps&&this.steps.forEach((function(e){e.setTimeDelta(t)}))}},{key:"with",value:function(t){return null!=t&&this.steps.push(t),this}},{key:"nextFrame",value:function(t){null===this.startTime&&(this.startTime=t-this.startTimeOffset);var e=null;return null!=this.beforeFrame&&this.beforeFrame(t-this.startTime),this.steps.forEach((function(n){if("animating"===n.state||"waitingToStart"===n.state){var r=n.nextFrame(t);null===e&&(e=r),r<e&&(e=r)}})),null!=this.afterFrame&&this.afterFrame(t-this.startTime),null===e&&(e=0),0<=e&&this.finish(),e}},{key:"finishIfZeroDuration",value:function(){var t="finished";this.steps.forEach((function(e){"finished"!==e.state&&(t="animating")})),"finished"===t&&this.finish()}},{key:"startWaiting",value:function(){qn(Hn(r.prototype),"startWaiting",this).call(this),this.steps.forEach((function(t){t.startWaiting()}))}},{key:"start",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.startWaiting(),qn(Hn(r.prototype),"start",this).call(this,e),this.steps.forEach((function(t){t.start(e),t.finishIfZeroDuration()}))}},{key:"finish",value:function(t,e){var n=0<arguments.length&&void 0!==t&&t,r=1<arguments.length&&void 0!==e?e:null;if("idle"!==this.state&&"finished"!==this.state){this.state="finished";var i=null;!0===this.completeOnCancel&&(i="complete"),!1===this.completeOnCancel&&(i="freeze"),null!=r&&(i=r),this.steps.forEach((function(t){"idle"!==t.state&&"finished"!==t.state&&t.finish(n,i)})),null!=this.onFinish&&this.fnExec(this.onFinish,n)}}},{key:"getTotalDuration",value:function(){var t=0;return this.steps.forEach((function(e){var n=e.getTotalDuration();t<n&&(t=n)})),t}},{key:"getRemainingTime",value:function(t){var e=0<arguments.length&&void 0!==t?t:(new sn).now()/1e3,n=this.getTotalDuration();return null==this.startTime?"animating"===this.state||"waitingToStart"===this.state?n:0:n-(e-this.startTime)}},{key:"_dup",value:function(){var t=new r;return lt(this,t),t}}]),r}();function Un(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Fn(Vn,[t].concat(n))}function Gn(t){return(Gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xn(t,e){if(t){if("string"==typeof t)return Yn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yn(t,e):void 0}}function Yn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $n(t,e,n){return($n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qn(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Kn(t,e){return(Kn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Qn(t){return(Qn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Zn=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Kn(t,e)}(r,Vn);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Qn(t);if(e){var o=Qn(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Gn(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=st.apply(void 0,[{},{type:"scenario"}].concat(i));pt(a,["start","target","translationStyle","translationOptions","velocity","maxDuration","allDurationsSame","rotDirection","clipRotationTo","element","progression"]),(t=n.call(this,a))._stepType="position";var s={element:null,start:null,target:null,translationStyle:"linear",translationOptions:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""},rotDirection:0,clipRotationTo:null,velocity:null,maxDuration:null,allDurationsSame:!0,zeroDurationThreshold:0,progression:"tools.math.easeinout"};if(t.element&&t.element.animations.options.translation){var l=t.element.animations.options.translation;null!=l.style&&(s.translationStyle=l.style),st(s.translationOptions,l)}var u=st.apply(void 0,[{},s].concat(i));return t.element=u.element,t.scenario={translationOptions:{}},yt(u,t.scenario,["start","target","translationStyle","velocity","maxDuration","allDurationsSame","zeroDurationThreshold","rotDirection","clipRotationTo","progression"]),lt(u.translationOptions,t.scenario.translationOptions),t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return Yn(t)}(t=$n(Qn(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Xn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["scenario"]);var t}},{key:"_getStateName",value:function(){return"scenarioAnimationStep"}},{key:"getDuration",value:function(t,e){var n=this.element,r=this.scenario.velocity;if(null==r||null==n)return[this.duration,this.duration,this.duration];var i=n.transform._dup().constant(1),o=null==r.color?1:r.color,a=null==r.opacity?1:r.opacity;null!=r.transform&&(i=Oe(r.transform)._dup()),null!=r.position&&i.updateTranslation(ie(r.position)),null!=r.translation&&i.updateTranslation(ie(r.translation)),null!=r.scale&&i.updateScale(ie(r.scale)),null!=r.rotation&&i.updateRotation(r.rotation);var s=0,l=t.transform,u=e.transform;null!=l&&null!=u&&(s=Be(l._dup(),u._dup(),i,this.scenario.rotDirection));var c=0;null==t.color||null==e.color||Ln(e.color,t.color)||(c=Math.max(Math.abs(e.color[0]-t.color[0]),Math.abs(e.color[1]-t.color[1]),Math.abs(e.color[2]-t.color[2]),Math.abs(e.color[3]-t.color[3]))/o);var h=0;null!=t.isShown&&null!=e.isShown&&(null!=t.opacity&&!0===e.isShown?h=(1-t.opacity)/a:null!=t.opacity&&!1===e.isShown?h=t.opacity/a:t.isShown!==e.isShown&&(h=1/a));var f=this.scenario.maxDuration;return null!=f&&(c=Math.min(c,f),h=Math.min(h,f),s=Math.min(s,f)),c<=this.scenario.zeroDurationThreshold&&(c=0),c<this.duration&&(c=this.duration),h<=this.scenario.zeroDurationThreshold&&(h=0),h<this.duration&&(h=this.duration),s<=this.scenario.zeroDurationThreshold&&(s=0),s<this.duration&&(s=this.duration),this.scenario.allDurationsSame&&(s=h=c=Math.max(c,h,s)),[s,c,h]}},{key:"start",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;$n(Qn(r.prototype),"start",this).call(this,t);var e=this.element;if(null==e)throw new Error("Missing Element in animation");var n=e.getScenarioTarget(this.scenario.target);0===Object.keys(n).length&&(n=e.getCurrentScenario());var i={};null!=this.scenario.start&&(i=e.getScenarioTarget(this.scenario.start)),0===Object.keys(i).length&&(i=e.getCurrentScenario(),1!==e.opacity&&(i.opacity=e.opacity));var o=null,a=!1;!1===i.isShown&&!0===n.isShown&&null==i.opacity?o="in":!0===n.isShown&&null!=i.opacity?(o="in",a=!0):!0===i.isShown&&!1===n.isShown&&null==i.opacity?o="out":!1===n.isShown&&null!=i.opacity&&(o="out",a=!0);var s,l=function(t){if(Array.isArray(t))return t}(s=this.getDuration(i,n))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(e.push(o.value),3!==e.length);n=!0);}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}}(s)||Xn(s,3)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),u=l[0],c=l[1],h=l[2],f=[];null!=n.transform&&f.push(e.anim.transform({start:i.transform,target:n.transform,duration:u,rotDirection:this.scenario.rotDirection,translationStyle:this.scenario.translationStyle,translationOptions:this.scenario.translationOptions,clipRotationTo:this.scenario.clipRotationTo,progression:this.scenario.progression})),null!=n.color&&f.push(e.anim.color({start:i.color,target:n.color,duration:c,progression:this.scenario.progression})),null!=o&&f.push(e.anim.opacity({dissolve:o,dissolveFromCurrent:a,duration:h,progression:this.scenario.progression})),this.steps=f,$n(Qn(r.prototype),"start",this).call(this,t)}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}();function Jn(t){return(Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tr(t,e,n){return(tr=sr()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&or(i,n.prototype),i}).apply(null,arguments)}function er(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function nr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rr(t,e,n){return(rr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=lr(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ir(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&or(t,e)}function or(t,e){return(or=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ar(t){var e=sr();return function(){var n,r,i,o=lr(t);if(e){var a=lr(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return r=this,!(i=n)||"object"!==Jn(i)&&"function"!=typeof i?function(){if(void 0!==r)return r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():i}}function sr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function lr(t){return(lr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ur=function(){ir(e,pn);var t=ar(e);function e(){var n;nr(this,e);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var a=st.apply(void 0,[{}].concat(i,[{type:"color"}]));pt(a,["start","delta","target","dissolve"]),n=t.call(this,a);var s=st.apply(void 0,[{},{start:null,target:null,delta:null,dissolve:null}].concat(i));return n.color={},yt(s,n.color,["start","delta","target","dissolve"]),"dim"===n.color.target?(null!=n.element&&(n.color.target=n.element.dimColor.slice()),n.color.setDefault=!1):"undim"===n.color.target?(null!=n.element&&(n.color.target=n.element.defaultColor.slice()),n.color.setDefault=!1):n.color.setDefault=!0,n}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return er(t)}(t=rr(lr(e.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return er(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?er(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["color"]);var t}},{key:"_getStateName",value:function(){return"colorAnimationStep"}},{key:"start",value:function(t){var n,r,i,o,a=0<arguments.length&&void 0!==t?t:null,s=this.element;null!=s?(rr(lr(e.prototype),"start",this).call(this,a),null==this.color.start?this.color.start=s.color.slice():"now"!==a&&"prev"!==a||s.setColor(this.color.start),null==this.color.delta&&null==this.color.target?this.color.target=this.color.start.slice():null!=this.color.delta&&(this.color.target=(i=this.color.start,o=this.color.delta,i.map((function(t,e){return Math.min(t+o[e],1)})))),this.color.whenComplete=this.color.target.slice(),"out"===this.color.dissolve&&(this.color.target[3]=.001),"in"===this.color.dissolve&&(this.color.start[3]=.001,s.setColor(this.color.start,this.color.setDefault),s.showAll()),this.color.delta=(n=this.color.target,r=this.color.start,n.map((function(t,e){return t-r[e]})))):this.duration=0}},{key:"setFrame",value:function(t){var e=this,n=t/this.duration,r=this.getPercentComplete(n),i=this.color.start.map((function(t,n){var i=t+e.color.delta[n]*r;return 1<i&&(i=1),i<0&&(i=0),i}));null!=this.element&&this.element.setColor(i,this.color.setDefault)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.setColor(this.color.whenComplete,this.color.setDefault),"out"===this.color.dissolve&&t.hide())}},{key:"_dup",value:function(){var t=new e;return lt(this,t,["element"]),t.element=this.element,t}}]),e}(),cr=function(){ir(e,ur);var t=ar(e);function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};nr(this,e);for(var r,i={duration:1,target:"dim",completeOnCancel:!0},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return r=st.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(a):[{},i,n].concat(a)),t.call(this,r)}return e}();function hr(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return tr(cr,[t].concat(n))}var fr=function(){ir(e,ur);var t=ar(e);function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};nr(this,e);for(var r,i={duration:1,target:"undim",completeOnCancel:!0},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return r=st.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(a):[{},i,n].concat(a)),t.call(this,r)}return e}();function dr(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return tr(fr,[t].concat(n))}function pr(t){return(pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yr(t,e,n){return(yr=xr()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&wr(i,n.prototype),i}).apply(null,arguments)}function vr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gr(t,e,n){return(gr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_r(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function br(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wr(t,e)}function wr(t,e){return(wr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Sr(t){var e=xr();return function(){var n,r,i,o=_r(t);if(e){var a=_r(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return r=this,!(i=n)||"object"!==pr(i)&&"function"!=typeof i?function(){if(void 0!==r)return r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():i}}function xr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _r(t){return(_r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Tr=function(){br(e,pn);var t=Sr(e);function e(){var n;mr(this,e);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var a=st.apply(void 0,[{}].concat(i,[{type:"opacity"}]));pt(a,["start","delta","target","dissolve","dissolveFromCurrent"]),n=t.call(this,a);var s=st.apply(void 0,[{},{start:null,target:null,delta:null,dissolve:null,dissolveFromCurrent:!1}].concat(i));return n.opacity={},yt(s,n.opacity,["start","delta","target","dissolve","dissolveFromCurrent"]),n}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return vr(t)}(t=gr(_r(e.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return vr(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?vr(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["opacity"]);var t}},{key:"_getStateName",value:function(){return"opacityAnimationStep"}},{key:"start",value:function(t){var n=0<arguments.length&&void 0!==t?t:null,r=this.element;null!=r?(gr(_r(e.prototype),"start",this).call(this,n),null==this.opacity.start?this.opacity.start=r.opacity:"now"!==n&&"prev"!==n||r.setOpacity(this.opacity.start),null==this.opacity.delta&&null==this.opacity.target?this.opacity.target=this.opacity.start:null!=this.opacity.delta&&(this.opacity.target=this.opacity.start+this.opacity.delta),this.opacity.whenComplete=this.opacity.target,"out"===this.opacity.dissolve&&(this.opacity.dissolveFromCurrent&&r.isShown?this.opacity.start=r.opacity:this.opacity.start=1,this.opacity.target=.001,this.opacity.whenComplete=1,r.setOpacity(this.opacity.start)),"in"===this.opacity.dissolve&&(this.opacity.dissolveFromCurrent&&r.isShown?this.opacity.start=r.opacity:this.opacity.start=.001,this.opacity.target=1,this.opacity.whenComplete=1,r.showAll(),r.setOpacity(this.opacity.start)),this.opacity.delta=this.opacity.target-this.opacity.start):this.duration=0}},{key:"cancelledWithNoComplete",value:function(){var t=this.element;null!=t&&.001===t.opacity&&(t.hide(),t.opacity=1)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.getPercentComplete(e),r=this.opacity.start+this.opacity.delta*n;1<r&&(r=1),r<0&&(r=0),null!=this.element&&this.element.setOpacity(r)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.setOpacity(this.opacity.whenComplete),"out"===this.opacity.dissolve&&t.hide())}},{key:"_dup",value:function(){var t=new e;return lt(this,t,["element"]),t.element=this.element,t}}]),e}(),kr=function(){br(e,Tr);var t=Sr(e);function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};mr(this,e);for(var r,i={duration:1,dissolve:"in",completeOnCancel:!0},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return r=st.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(a):[{},i,n].concat(a)),t.call(this,r)}return e}();function Or(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return yr(kr,[t].concat(n))}var Pr=function(){br(e,Tr);var t=Sr(e);function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};mr(this,e);for(var r,i={duration:1,dissolve:"out",completeOnCancel:!0},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return r=st.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(a):[{},i,n].concat(a)),t.call(this,r)}return e}();function Ar(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return yr(Pr,[t].concat(n))}function Er(t){return(Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function jr(t,e,n){return(jr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Cr(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Rr(t,e){return(Rr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Cr(t){return(Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Dr=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rr(t,e)}(r,pn);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Cr(t);if(e){var o=Cr(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Er(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=st.apply(void 0,[{},{type:"transform"}].concat(i));pt(a,["start","delta","target","rotDirection","translationStyle","translationOptions","velocity","clipRotationTo","maxDuration"]);var s={start:null,target:null,delta:null,translationStyle:"linear",rotDirection:0,translationOptions:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""},velocity:null,clipRotationTo:null,maxDuration:null};if((t=n.call(this,a)).element&&t.element.animations.options.translation){var l=t.element.animations.options.translation;null!=l.style&&(s.translationStyle=l.style),st(s.translationOptions,l)}var u=st.apply(void 0,[{},s].concat(i));return t.transform={translationOptions:{}},yt(u,t.transform,["start","delta","target","translationStyle","velocity","rotDirection","clipRotationTo","maxDuration"]),lt(u.translationOptions,t.transform.translationOptions),t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return Mr(t)}(t=jr(Cr(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Mr(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Mr(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["transform"]);var t}},{key:"_getStateName",value:function(){return"transformAnimationStep"}},{key:"start",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:null;if(jr(Cr(r.prototype),"start",this).call(this,n),null===this.transform.start){if(null==this.element)return void(this.duration=0);this.transform.start=this.element.transform._dup()}if(null==this.transform.delta&&null!=this.transform.target){var i=this.transform.target.sub(this.transform.start);i.order.forEach((function(t,n){var r=e.transform.start.order[n],i=e.transform.target.order[n];if(t instanceof xe&&r instanceof xe&&i instanceof xe){var o=me(r.r,i.r,e.transform.rotDirection);t.r=o}})),this.transform.delta=i}else null!=this.transform.delta?this.transform.target=this.transform.start.add(this.transform.delta):this.duration=0;null!=this.transform.velocity&&(this.duration=Be(this.transform.start,this.transform.target,this.transform.velocity,this.transform.rotDirection)),null!=this.transform.maxDuration&&this.duration>this.transform.maxDuration&&(this.duration=this.transform.maxDuration),"now"!==n&&"prev"!==n||this.setFrame(0)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.getPercentComplete(e),r=this.transform.start.toDelta(this.transform.delta,n,this.transform.translationStyle,this.transform.translationOptions);null!==this.transform.clipRotationTo&&r.clipRotation(this.transform.clipRotationTo),null!=this.element&&this.element.setTransform(r)}},{key:"setToEnd",value:function(){null!=this.element&&this.element.setTransform(this.transform.target)}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}();function Lr(t){return(Lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Br(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ir(t,e,n){return(Ir="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wr(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Fr(t,e){return(Fr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wr(t){return(Wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var qr=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fr(t,e)}(r,pn);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Wr(t);if(e){var o=Wr(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Lr(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=st.apply(void 0,[{},{type:"transform"}].concat(i));pt(a,["start","delta","target","rotDirection","translationStyle","translationOptions","velocity","clipRotationTo","maxDuration","zeroDurationThreshold"]);var s={start:null,target:null,delta:[],translationStyle:"linear",rotDirection:0,translationOptions:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""},velocity:null,clipRotationTo:null,maxDuration:null,zeroDurationThreshold:0};if((t=n.call(this,a)).element&&t.element.animations.options.translation){var l=t.element.animations.options.translation;null!=l.style&&(s.translationStyle=l.style),st(s.translationOptions,l)}var u=st.apply(void 0,[{},s].concat(i));return t.transform={translationOptions:{}},yt(u,t.transform,["start","delta","target","translationStyle","velocity","rotDirection","clipRotationTo","maxDuration","zeroDurationThreshold"]),lt(u.translationOptions,t.transform.translationOptions),t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"spread",value:function(t,e){if(e===t.length)return t;if(e<=1)return[t[0]];var n=[];if(e>t.length){for(var r=e-t.length,i=Math.ceil(r/2),o=Math.floor(r/2),a=t[0]._dup(),s=t[t.length-1]._dup(),l=0;l<i;l+=1)n.push(a._dup());for(var u=0;u<t.length;u+=1)n.push(t[u]._dup());for(var c=0;c<o;c+=1)n.push(s._dup());return n}for(var h=t.length-e,f=Math.ceil((t.length-h)/2),d=Math.floor((t.length-h)/2),p=0;p<f;p+=1)n.push(t[p]._dup());for(var y=t.length-d;y<t.length;y+=1)n.push(t[y]._dup());return n}},{key:"setStartAndTarget",value:function(){var t=this.transform,e=t.start,n=t.target,r=Math.max(e.length,n.length);this.transform.start=this.spread(this.transform.start,r),this.transform.target=this.spread(this.transform.target,r)}},{key:"calculateStartTargetDelta",value:function(){var t=this;if(this.transform.start.length===this.transform.target.length){this.transform.delta=[];for(var e=function(e){var n=t.transform.start[e],r=t.transform.target[e],i=r.sub(n);i.order.forEach((function(e,i){var o=n.order[i],a=r.order[i];if(e instanceof xe&&o instanceof xe&&a instanceof xe){var s=me(o.r,a.r,t.transform.rotDirection);e.r=s}})),t.transform.delta.push(i)},n=0;n<this.transform.start.length;n+=1)e(n)}else this.transform.delta=[]}},{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return Br(t)}(t=Ir(Wr(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Br(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Br(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["transform"]);var t}},{key:"_getStateName",value:function(){return"transformAnimationStep"}},{key:"getVelocityTransform",value:function(){var t=this.element;if(null==t)return new ke;var e=this.transform.velocity;if(null==e)return new ke;if(e instanceof ke)return e;if("number"==typeof e)return t.transform._dup().constant(e);var n=t.transform._dup().constant(1);return null!=e.transform&&(n=Oe(e.transform)._dup()),null!=e.position&&n.updateTranslation(ie(e.position)),null!=e.translation&&n.updateTranslation(ie(e.translation)),null!=e.scale&&n.updateScale(ie(e.scale)),null!=e.rotation&&n.updateRotation(e.rotation),n}},{key:"start",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(Ir(Wr(r.prototype),"start",this).call(this,t),null==this.transform.start||0===this.transform.start.length){if(null==this.element)return void(this.duration=0);0<this.element.pulseTransforms.length?this.transform.start=this.element.pulseTransforms.map((function(t){return t._dup()})):this.transform.start=[this.transform.target[0].identity()]}if(0===this.transform.start.length&&null!=this.element&&(this.transform.start=[this.element.transform._dup()]),this.setStartAndTarget(),this.calculateStartTargetDelta(),0===this.transform.delta.length&&(this.duration=0),null!=this.transform.velocity)for(var e=this.getVelocityTransform(),n=0;n<this.transform.start.length;n+=1){var i=Be(this.transform.start[n],this.transform.target[n],e,this.transform.rotDirection);i>this.duration&&(this.duration=i)}null!=this.transform.maxDuration&&this.duration>this.transform.maxDuration&&(this.duration=this.transform.maxDuration),this.duration<=this.transform.zeroDurationThreshold&&(this.duration=0),this.duration=f(this.duration,this.precision),"now"!==t&&"prev"!==t||this.setFrame(0)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.getPercentComplete(e);if(null!=this.element){var r=this.element;r.frozenPulseTransforms=[];for(var i=0;i<this.transform.start.length;i+=1){var o=this.transform.start[i].toDelta(this.transform.delta[i],n,this.transform.translationStyle,this.transform.translationOptions);null!==this.transform.clipRotationTo&&o.clipRotation(this.transform.clipRotationTo),r.frozenPulseTransforms.push(o)}}}},{key:"setToEnd",value:function(){if(null!=this.element){var t=this.element;t.frozenPulseTransforms=[],this.transform.target.forEach((function(e){t.frozenPulseTransforms.push(e._dup())}))}}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}();function Nr(t){return(Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Hr(t,e,n){return(Hr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ur(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Vr(t,e){return(Vr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ur(t){return(Ur=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Gr=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vr(t,e)}(r,pn);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Ur(t);if(e){var o=Ur(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Nr(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=st.apply(void 0,[{},{type:"rotation"}].concat(i));pt(a,["start","delta","target","direction","velocity","clipTo","maxDuration"]),t=n.call(this,a);var s=st.apply(void 0,[{},{start:null,target:null,delta:null,direction:0,velocity:null,clipTo:null,maxDuration:null}].concat(i));return t.rotation={},yt(s,t.rotation,["start","delta","target","velocity","direction","clipTo","maxDuration"]),t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return zr(t)}(t=Hr(Ur(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return zr(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?zr(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["rotation"]);var t}},{key:"_getStateName",value:function(){return"rotationAnimationStep"}},{key:"start",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;if(Hr(Ur(r.prototype),"start",this).call(this,e),null===this.rotation.start){if(null==this.element)return void(this.duration=0);this.rotation.start=this.element.transform.r()||0}if(null==this.rotation.delta&&null!=this.rotation.target){var n=me(this.rotation.start,this.rotation.target,this.rotation.direction);this.rotation.delta=n}else null!=this.rotation.delta?this.rotation.target=this.rotation.start+this.rotation.delta:this.duration=0;var i=this.rotation.velocity;null!=i&&(this.duration=Be((new ke).rotate(this.rotation.start),(new ke).rotate(this.rotation.target),(new ke).rotate(i),this.rotation.direction)),null!=this.rotation.maxDuration&&this.duration>this.rotation.maxDuration&&(this.duration=this.rotation.maxDuration),"now"!==e&&"prev"!==e||this.setFrame(0)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.getPercentComplete(e),r=this.rotation.start+this.rotation.delta*n;r=Jt(r,this.rotation.clipTo);var i=this.element;null!=i&&i.setRotation(r)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.transform.updateRotation(Jt(this.rotation.target,this.rotation.clipTo)),this.fnExec(t.setTransformCallback,t.transform))}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}();function Xr(t){return(Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $r(t,e,n){return($r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qr(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Kr(t,e){return(Kr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Qr(t){return(Qr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Zr=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Kr(t,e)}(r,pn);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Qr(t);if(e){var o=Qr(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Xr(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=st.apply(void 0,[{},{type:"position"}].concat(i));pt(a,["start","delta","target","velocity","maxDuration"]),t=n.call(this,a);var s=st.apply(void 0,[{},{start:null,target:null,delta:null,velocity:null,maxDuration:null}].concat(i));return t.scale={},null!=s.start&&(s.start=ne(s.start)),null!=s.target&&(s.target=ne(s.target)),null!=s.delta&&(s.delta=ne(s.delta)),yt(s,t.scale,["start","delta","target","translationStyle","velocity","maxDuration"]),t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return Yr(t)}(t=$r(Qr(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Yr(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Yr(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["scale"]);var t}},{key:"_getStateName",value:function(){return"scaleAnimationStep"}},{key:"start",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if($r(Qr(r.prototype),"start",this).call(this,t),null===this.scale.start){if(null==this.element)return void(this.duration=0);this.scale.start=this.element.getScale()}if(null==this.scale.delta&&null!=this.scale.target&&null!=this.scale.start){var e=this.scale.target.sub(this.scale.start);this.scale.delta=e}else null!=this.scale.delta&&null!=this.scale.start?this.scale.target=this.scale.start.add(this.scale.delta):this.duration=0;var n=this.scale,i=n.target,o=n.start,a=n.velocity;if(null!=a&&null!=i&&null!=o){var s=ne(a);this.duration=Be((new ke).scale(o),(new ke).scale(i),(new ke).scale(s))}null!=this.scale.maxDuration&&this.duration>this.scale.maxDuration&&(this.duration=this.scale.maxDuration),"now"!==t&&"prev"!==t||this.setFrame(0)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.getPercentComplete(e);if(null!=this.scale.start&&null!=this.scale.delta){var r=this.scale.start.toDelta(this.scale.delta,n);null!=this.element&&this.element.setScale(r)}}},{key:"setToEnd",value:function(){null!=this.element&&null!=this.scale.target&&this.element.setScale(this.scale.target)}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}();function Jr(t){return(Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ti(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ei(t,e,n){return(ei="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ri(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ni(t,e){return(ni=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ri(t){return(ri=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ii=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ni(t,e)}(r,pn);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=ri(t);if(e){var o=ri(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Jr(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=st.apply(void 0,[{},{scale:1.5,numLines:1,type:"pulse",duration:1,frequency:0,stopAfterDuration:!0}].concat(i));return(t=n.call(this,a)).scale=a.scale,t.numLines=a.numLines,t.duration=a.duration,t.frequency=a.frequency,t.stopAfterDuration=a.stopAfterDuration,t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return ti(t)}(t=ei(ri(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return ti(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ti(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["scale","numLines","frequency","stopAfterDuration"]);var t}},{key:"_getStateName",value:function(){return"pulseAnimationStep"}},{key:"start",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;ei(ri(r.prototype),"start",this).call(this,e);var n=this.element;null!=n&&(1===this.numLines?n.pulseScaleNow(this.duration,this.scale,this.frequency):n.pulseThickNow(this.duration,this.scale,this.numLines))}},{key:"setToEnd",value:function(){null!=this.element&&this.stopAfterDuration&&this.element.stopPulsing()}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}();function oi(t){return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ai(t,e,n){return(ai=ci()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&ui(i,n.prototype),i}).apply(null,arguments)}function si(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function li(t,e,n){return(li="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=hi(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ui(t,e){return(ui=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ci(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function hi(t){return(hi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var fi=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ui(t,e)}(r,ln);var t,e,n=(t=r,e=ci(),function(){var n,r,i=hi(t);if(e){var o=hi(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==oi(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var i,o={payload:null,duration:0},a=arguments.length,s=new Array(1<a?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return"function"==typeof e||"string"==typeof e?(i=st.apply(void 0,[{},o].concat(s))).callback=e:i=st.apply(void 0,[{},o,e].concat(s)),(t=n.call(this,i)).element=i.element,t.callback=i.callback,t.payload=i.payload,t.duration=i.duration,t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"fnExec",value:function(t){for(var e,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return null==this.element?(e=this.fnMap).exec.apply(e,[t].concat(r)):(o=this.fnMap).execOnMaps.apply(o,[t,[this.element.fnMap.map]].concat(r));var o}},{key:"_fromState",value:function(t,e){return st(this,t),null!=this.element&&"string"==typeof this.element&&null!=e&&(this.element=e(this.element)),this}},{key:"_state",value:function(t){var e=li(hi(r.prototype),"_state",this).call(this,t);return null!=this.element&&(e.state.element={f1Type:"de",state:this.element.getPath()}),e}},{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return si(t)}(t=li(hi(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return si(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?si(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["callback","payload"]);var t}},{key:"_getStateName",value:function(){return"triggerAnimationStep"}},{key:"setFrame",value:function(){this.fnExec(this.callback,this.payload),this.callback=null}},{key:"setToEnd",value:function(){this.fnExec(this.callback,this.payload),this.callback=null}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t}}]),r}();function di(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return ai(fi,[t].concat(n))}function pi(t){return(pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yi(t,e,n){return(yi=bi()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&gi(i,n.prototype),i}).apply(null,arguments)}function vi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mi(t,e,n){return(mi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wi(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function gi(t,e){return(gi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function bi(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function wi(t){return(wi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Si=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gi(t,e)}(r,ln);var t,e,n=(t=r,e=bi(),function(){var n,r,i=wi(t);if(e){var o=wi(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==pi(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=st.apply(void 0,[{}].concat(i));t=n.call(this,a);var s=st.apply(void 0,[{},{element:null,callback:null,startPercent:0,progression:"linear"}].concat(i));return t.element=s.element,t.progression=s.progression,"linear"===t.progression?t.progression="tools.math.linear":"easein"===s.progression?t.progression="tools.math.easein":"easeout"===s.progression?t.progression="tools.math.easeout":"easeinout"===s.progression&&(t.progression="tools.math.easeinout"),t.callback=s.callback,t.startPercent=s.startPercent,t.startTimeOffset=t.getPercentComplete(s.startPercent,!0)*s.duration,t.duration=s.duration,t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"fnExec",value:function(t){for(var e,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return null==this.element?(e=this.fnMap).exec.apply(e,[t].concat(r)):(o=this.fnMap).execOnMaps.apply(o,[t,[this.element.fnMap.map]].concat(r));var o}},{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return vi(t)}(t=mi(wi(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return vi(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?vi(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["callback","startPercent","progression"]);var t}},{key:"_fromState",value:function(t,e){return st(this,t),null!=this.element&&"string"==typeof this.element&&null!=e&&(this.element=e(this.element)),this}},{key:"_state",value:function(t){var e=mi(wi(r.prototype),"_state",this).call(this,t);return null!=this.element&&(e.state.element={f1Type:"de",state:this.element.getPath()}),e}},{key:"_getStateName",value:function(){return"customAnimationStep"}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.getPercentComplete(e);this.fnExec(this.callback,n)}},{key:"getPercentComplete",value:function(t,e){var n=1<arguments.length&&void 0!==e&&e;if("string"!=typeof this.progression)return"function"==typeof this.progression?this.progression(t):0;var r=this.fnExec(this.progression,t,n);return null==r?0:r}},{key:"setToEnd",value:function(){this.fnExec(this.callback,1)}},{key:"_dup",value:function(){var t=new r;return lt(this,t),t}}]),r}();function xi(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return yi(Si,e)}function _i(t){return(_i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ti(t,e,n){return(Ti=Ai()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Pi(i,n.prototype),i}).apply(null,arguments)}function ki(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Oi(t,e,n){return(Oi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ei(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Pi(t,e){return(Pi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ai(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Ei(t){return(Ei=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Mi=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pi(t,e)}(r,ln);var t,e,n=(t=r,e=Ai(),function(){var n,r,i=Ei(t);if(e){var o=Ei(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==_i(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var i,o={steps:[]},a=arguments.length,s=new Array(1<a?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return Array.isArray(e)?(i=st.apply(void 0,[{},o].concat(s))).steps=e:i=st.apply(void 0,[{},o,e].concat(s)),(t=n.call(this,i)).index=0,t.steps=[],Array.isArray(i.steps)||null==i.steps?null!=i.steps&&(t.steps=i.steps):t.steps=[i.steps],t}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(){return[].concat(function(t){if(Array.isArray(t))return ki(t)}(t=Oi(Ei(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return ki(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ki(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["steps","index"]);var t}},{key:"_getStateName",value:function(){return"serialAnimationStep"}},{key:"setTimeDelta",value:function(t){Oi(Ei(r.prototype),"setTimeDelta",this).call(this,t),null!=this.steps&&this.steps.forEach((function(e){e.setTimeDelta(t)}))}},{key:"then",value:function(t){return null!=t&&this.steps.push(t),this}},{key:"startWaiting",value:function(){Oi(Ei(r.prototype),"startWaiting",this).call(this),this.steps.forEach((function(t){t.startWaiting()}))}},{key:"start",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;"animating"!==this.state&&(this.startWaiting(),Oi(Ei(r.prototype),"start",this).call(this,e),(this.index=0)<this.steps.length&&(this.steps[0].start(e),this.steps[0].finishIfZeroDuration())),this.finishIfZeroDuration()}},{key:"finishIfZeroDuration",value:function(){for(var t=0,e=this.steps[0];t<this.steps.length&&"finished"===e.state;)(t+=1)<this.steps.length&&(this.index=t,(e=this.steps[t]).start(this.steps[t-1].startTime),e.finishIfZeroDuration());t===this.steps.length&&this.finish()}},{key:"nextFrame",value:function(t){null===this.startTime&&(this.startTime=t-this.startTimeOffset);var e=-1;return null!=this.beforeFrame&&this.beforeFrame(t-this.startTime),this.index<=this.steps.length-1&&(e=this.steps[this.index].nextFrame(t),null!=this.afterFrame&&this.afterFrame(t-this.startTime),0<=e)?this.index===this.steps.length-1?(this.finish(),e):(this.index+=1,this.steps[this.index].start(t-e),this.nextFrame(t)):e}},{key:"finish",value:function(t,e){var n=0<arguments.length&&void 0!==t&&t,r=1<arguments.length&&void 0!==e?e:null;if("idle"!==this.state&&"finished"!==this.state){this.state="finished";var i=null;!0===this.completeOnCancel&&(i="complete"),!1===this.completeOnCancel&&(i="freeze"),null!=r&&(i=r),this.steps.forEach((function(t){"idle"!==t.state&&"finished"!==t.state&&t.finish(n,i)})),null!=this.onFinish&&this.fnExec(this.onFinish,n)}}},{key:"getTotalDuration",value:function(){var t=0;return this.steps.forEach((function(e){t+=e.getTotalDuration()})),t}},{key:"getRemainingTime",value:function(t){var e=0<arguments.length&&void 0!==t?t:(new sn).now()/1e3,n=this.getTotalDuration();return null==this.startTime?"animating"===this.state||"waitingToStart"===this.state?n:0:n-(e-this.startTime)}},{key:"_dup",value:function(){var t=new r;return lt(this,t),t}}]),r}();function ji(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ti(Mi,[t].concat(n))}function Ri(t){return(Ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ci(t,e,n){return(Ci=Li()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Di(i,n.prototype),i}).apply(null,arguments)}function Di(t,e){return(Di=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Li(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Bi(t){return(Bi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ii=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Di(t,e)}(r,ln);var t,e,n=(t=r,e=Li(),function(){var n,r,i=Bi(t);if(e){var o=Bi(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Ri(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var e,i={duration:0},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return e=st.apply(void 0,"number"==typeof t?[{},i,{duration:t}].concat(a):[{},i,t].concat(a)),n.call(this,e)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_dup",value:function(){var t=new r;return lt(this,t),t}},{key:"_getStateName",value:function(){return"delayAnimationStep"}}]),r}();function Fi(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ci(Ii,[t].concat(n))}var Wi=n(0),qi=n.n(Wi);function Ni(t){return function(t){if(Array.isArray(t))return Vi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Hi(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zi(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||Hi(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hi(t,e){if(t){if("string"==typeof t)return Vi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vi(t,e):void 0}}function Vi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ui(t,e){if(e<1)return e;for(var n=e,r=!0,i=t[e][0];0<n&&r;)t[n-1][0]!==i?r=!1:--n;return n}function Gi(t,e){for(var n=t[e][0],r=e,i=!0;i;)r!==t.length-1&&t[r+1][0]===n?r+=1:i=!1;return Math.max(r,e)}function Xi(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:0,o=3<arguments.length&&void 0!==r?r:t.length-1;if(0===t.length)return[-1,-1];var a=parseFloat(t[i][0]);if(e===a)return[i,i];if(e<a)return[-1,i];var s=parseFloat(t[o][0]);if(e===s)return[o,o];if(s<e)return[o,-1];var l=o-i;if(l<2)return[i,o];var u=i+Math.floor(l/2),c=parseFloat(t[u][0]);return e===c?[u,u]:e<c?Xi(t,e,i,u):Xi(t,e,u,o)}function Yi(t,e,n,r,i){var o=2<arguments.length&&void 0!==n?n:0,a=3<arguments.length&&void 0!==r?r:t.length-1;return(4<arguments.length&&void 0!==i&&!i?Gi:Ui)(t,Xi(t,e,o,a)[1])}function $i(t,e,n,r,i){var o=2<arguments.length&&void 0!==n?n:0,a=3<arguments.length&&void 0!==r?r:t.length-1;return(4<arguments.length&&void 0!==i&&!i?Gi:Ui)(t,Xi(t,e,o,a)[0])}var Ki=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),e)return t.instance||this.initialize(),t.instance;this.initialize()}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"initialize",value:function(){this.subscriptions=new jt,this.events={},this.eventsCache={},this.reset(),this.precision=4,this.stateTimeStep=1,this.audio=null,this.worker=null,this.pauseState=null,this.settings={pause:"freeze",play:"instant"}}},{key:"timeStamp",value:function(){return(new sn).now()}},{key:"now",value:function(){return f((this.timeStamp()-this.videoToNowDelta)/1e3,8)}},{key:"getCurrentTime",value:function(){return"idle"!==this.state?this.now():this.currentTime}},{key:"getDeltaTime",value:function(t){var e=0<arguments.length&&void 0!==t?t:0,n=this.getCurrentTime()+e;return n>this.duration?this.duration:n<0?0:n}},{key:"setCurrentTime",value:function(t){this.currentTime=t,this.subscriptions.publish("timeUpdate",[t])}},{key:"setVideoToNowDeltaTime",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;this.videoToNowDelta=this.timeStamp()-1e3*e}},{key:"calcDuration",value:function(t){var e=this,n=0<arguments.length&&void 0!==t&&t,r=0,i=0,o=0,a=0,s=0;return Object.keys(this.events).forEach((function(t){var n=e.events[t];0<n.list.length&&(r=Math.max(r,n.list[n.list.length-1][0]))})),Object.keys(this.eventsCache).forEach((function(t){var n=e.eventsCache[t];0<n.list.length&&(i=Math.max(i,n.list[n.list.length-1][0]))})),0<this.states.diffs.length&&(o=zi(this.states.diffs[this.states.diffs.length-1],1)[0]),0<this.statesCache.diffs.length&&(a=zi(this.statesCache.diffs[this.statesCache.diffs.length-1],1)[0]),null==this.audio||isNaN(this.audio.duration)||(s=this.audio.duration),n?Math.max(i,a):Math.max(r,i,o,a,s)}},{key:"reset",value:function(){var t=this;this.states=new Et(this.precision),this.statesCache=new Et(this.precision),Object.keys(this.events).forEach((function(e){t.events[e].list=[]})),this.eventsCache={},this.stateIndex=-1,this.eventIndex={},this.stopTimeouts(),this.videoToNowDelta=0,this.state="idle",this.isAudioPlaying=!1,this.setCurrentTime(0),this.duration=0,this.reference="__base",this.lastRecordTimeCount=0,this.lastRecordTime=null,this.eventsToPlay=[],this.lastSeekTime=null}},{key:"loadAudio",value:function(t){var e=this;this.audio=t,this.audio.onloadedmetadata=function(){e.duration=e.calcDuration()},this.subscriptions.publish("audioLoaded")}},{key:"loadEvents",value:function(t,e){var n=this,r=!(1<arguments.length&&void 0!==e)||e,i=this.decodeEvents(t,r);Object.keys(i).forEach((function(t){null!=n.events[t]&&(n.events[t].list=i[t])})),this.duration=this.calcDuration(),this.subscriptions.publish("eventsLoaded")}},{key:"loadStates",value:function(t,e,n){var r=!(1<arguments.length&&void 0!==e)||e,i=!(2<arguments.length&&void 0!==n)||n;this.states=this.decodeStates(t,r,i),this.duration=this.calcDuration(),this.subscriptions.publish("statesLoaded")}},{key:"encodeEvents",value:function(t){var e=!(0<arguments.length&&void 0!==t)||t,n={},r=it(this.events);return Object.keys(r).forEach((function(t){n[t]=r[t].list})),(e?wt:it)(n)}},{key:"decodeEvents",value:function(t,e){return(1<arguments.length&&void 0!==e&&!e?it:St)(t)}},{key:"encodeStates",value:function(t,e,n){var r,i=!(0<arguments.length&&void 0!==t)||t,o=!(1<arguments.length&&void 0!==e)||e,a=2<arguments.length&&void 0!==n?n:this.precision;return r=o?this.states.toObj():it(this.states),i?wt(r,a):r}},{key:"decodeStates",value:function(t,e,n){var r=!(2<arguments.length&&void 0!==n)||n,i=t;if(1<arguments.length&&void 0!==e&&!e||(i=St(t)),r){var o=new Et;o.setFromObj(i),i=o}var a=new Et;return a.diffs=i.diffs,a.baseReference=i.baseReference,a.references=i.references,a.precision=i.precision,a}},{key:"clearListOrDiffs",value:function(t,e,n){var r=Yi(t,e),i=$i(t,n),o=[];return 0<r&&(o=t.slice(0,r)),-1<i&&i+1<=t.length-1&&(o=[].concat(Ni(o),Ni(t.slice(i+1)))),o}},{key:"clear",value:function(t,e){var n=this;Object.keys(this.events).forEach((function(r){var i=n.events[r];i.list=n.clearListOrDiffs(i.list,t,e)})),this.states.diffs=this.clearListOrDiffs(this.states.diffs,t,e)}},{key:"startRecording",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:0,r=1<arguments.length&&void 0!==e?e:[];this.state="recording",this.lastSeekTime=null,this.setVideoToNowDeltaTime(n),0<this.states.diffs.length&&this.setToTime(n,!0),this.states.precision=this.precision,0===n&&null==this.states.baseReference&&this.states.setBaseReference(this.diagram.getState({precision:this.precision,ignoreShown:!0})),this.startWorker(),null!=this.worker&&this.worker.postMessage({message:"reset",payload:{baseReference:this.states.baseReference,references:this.states.references}}),this.eventsCache={},this.lastRecordTime=null,this.duration=this.calcDuration(),this.queueRecordState(n%this.stateTimeStep),this.eventsToPlay=r,this.startEventsPlayback(n),this.startAudioPlayback(n),this.subscriptions.publish("startRecording"),this.startRecordingTime=n,this.startTimeUpdates()}},{key:"startWorker",value:function(){null==this.worker&&(this.worker=new qi.a,this.worker.addEventListener("message",this.parseMessage.bind(this)))}},{key:"parseMessage",value:function(t){var e=t.data,n=e.message,r=e.payload;if("cache"===n){if(this.statesCache=new Et,this.statesCache.diffs=r.diffs,this.statesCache.baseReference=r.baseReference,this.statesCache.references=r.references,this.mergeEventsCache(),this.mergeStatesCache(),this.duration=this.calcDuration(),0<this.duration%1){var i=this.states.diffs.length-1,o=zi(this.states.diffs[i],3),a=o[1],s=o[2];this.states.diffs.push([Math.ceil(this.duration),a,it(s),0])}this.duration=this.calcDuration()}}},{key:"addCurrentStateAsReference",value:function(){this.referenceIndex+=1,this.reference="ref".concat(this.referenceIndex);var t=this.diagram.getState({precision:this.precision,ignoreShown:!0});"recording"===this.state?null!=this.worker&&this.worker.postMessage({message:"addReference",payload:{state:t,refName:this.reference,basedOn:"__base"}}):this.states.addReference(t,this.reference)}},{key:"getCacheStartTime",value:function(){var t=this,e=null;return 0<this.statesCache.diffs.length&&(e=this.statesCache.diffs[0][0]),Object.keys(this.eventsCache).forEach((function(n){var r=t.eventsCache[n];if(0<r.list.length){var i=zi(r.list[0],1)[0];e=null==e?i:Math.min(i,e)}})),e}},{key:"getCacheEndTime",value:function(){return this.calcDuration(!0)}},{key:"getMergedCacheArray",value:function(t,e){var n=this.startRecordingTime,r=this.currentTime;if(null==n||0===r)return[];var i=$i(t,n);-1<i&&t[i][0]===n&&(i=Ui(t,i)-1)<0&&(i=-1);var o=Yi(t,r);-1<o&&t[o][0]===r&&(o=Gi(t,o)+1)>t.length-1&&(o=-1);var a=[],s=[];return 0<=i&&(a=t.slice(0,i+1)),0<=o&&(s=t.slice(o)),[].concat(Ni(a),Ni(e),Ni(s))}},{key:"mergeEventsCache",value:function(){var t=this,e={};Object.keys(this.events).forEach((function(t){e[t]=null})),Object.keys(this.eventsCache).forEach((function(t){e[t]=null})),Object.keys(e).forEach((function(e){var n=[];null!=t.eventsCache[e]&&(n=t.eventsCache[e].list);var r=[];null!=t.events[e]&&(r=t.events[e].list);var i=t.getMergedCacheArray(r,n);0!==i.length&&(t.events[e].list=i)}))}},{key:"mergeStatesCache",value:function(){var t=this.getMergedCacheArray(this.states.diffs,this.statesCache.diffs);0!==t.length&&(this.states.diffs=t,this.states.references=it(this.statesCache.references))}},{key:"stopTimeouts",value:function(){(new sn).clearTimeout(this.timeoutID),(new sn).clearTimeout(this.timeUpdatesTimeoutID),this.timeoutID=null,this.timeUpdatesTimeoutID=null}},{key:"stopRecording",value:function(){this.setCurrentTime(this.getCurrentTime()),this.state="idle",this.stopTimeouts(),this.worker.postMessage({message:"get"}),this.audio&&(this.audio.pause(),this.isAudioPlaying=!1),this.lastSeekTime=null,this.subscriptions.publish("stopRecording")}},{key:"addEventType",value:function(t,e,n){var r=!(2<arguments.length&&void 0!==n)||n;this.events[t]={setOnSeek:r,list:[],playbackAction:e},this.eventIndex[t]=-1}},{key:"recordState",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:this.getCurrentTime();(null==this.lastRecordTime||n>this.lastRecordTime)&&(this.lastRecordTime=n,this.lastRecordTimeCount=0),null!=this.worker&&this.worker.postMessage({message:"add",payload:{now:n,state:t,reference:this.reference,lastRecordTimeCount:this.lastRecordTimeCount}}),this.lastRecordTimeCount+=1,n>this.duration&&(this.duration=n)}},{key:"recordCurrentState",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.getCurrentTime(),n=this.diagram.getState({precision:this.precision,ignoreShown:!0});this.recordState(n,e)}},{key:"recordCurrentStateAsReference",value:function(t,e){var n=this.diagram.getState({precision:this.precision,ignoreShown:!0});null!=this.worker&&this.worker.postMessage({message:"addReference",payload:{state:n,refName:t,basedOn:e}})}},{key:"recordEvent",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:this.now();null!=this.events[t]&&(null==this.eventsCache[t]&&(this.eventsCache[t]={list:[]}),(null==this.lastRecordTime||r>this.lastRecordTime)&&(this.lastRecordTime=r,this.lastRecordTimeCount=0),this.eventsCache[t].list.push([r,e,this.lastRecordTimeCount]),this.lastRecordTimeCount+=1,r>this.duration&&(this.duration=r))}},{key:"queueRecordState",value:function(t){function e(){"recording"===n.state&&(!1===n.diagram.getIsInTransition()&&n.recordCurrentState(),n.queueRecordState(n.stateTimeStep-n.getCurrentTime()%n.stateTimeStep))}var n=this,r=0<arguments.length&&void 0!==t?t:0;0!==f(r,4)?this.timeoutID=(new sn).setTimeout((function(){e()}),f(1e3*r,0)):e()}},{key:"save",value:function(){var t=(new Date).toISOString(),e=window.location.pathname.replace("/","_"),n=this.encodeStates(),r=this.encodeEvents();null!=n&&Rt("".concat(t," ").concat(e,".vidstates.json"),JSON.stringify(n)),null!=r&&Rt("".concat(t," ").concat(e,".videvents.json"),JSON.stringify(r))}},{key:"show",value:function(){function t(t){var e=JSON.stringify(t,null,2);return(e=e.replace(/\n/g,"<br>")).replace(/ /g,"&nbsp")}var e=window.open("about:blank","","_blank");e.document.write("<br><br>"),e.document.write("// ".concat("/".repeat(500),"<br>")),e.document.write("// ".concat("/".repeat(500),"<br>")),e.document.write("<br><br>"),e.document.write(t(this.events),"<br>"),e.document.write("<br><br>"),e.document.write("// ".concat("/".repeat(500),"<br>")),e.document.write("// ".concat("/".repeat(500),"<br>")),e.document.write("<br><br>"),e.document.write(t(this.states.diffs),"<br>"),e.document.write(t(this.states.references),"<br>")}},{key:"seekToPercent",value:function(t){var e=this.calcDuration();this.seek(e*t)}},{key:"seek",value:function(t){this.pauseState=null;var e=t;e<0&&(e=0),0!==this.states.diffs.length&&("recording"===this.state?this.stopRecording():"playing"===this.state&&this.pausePlayback("freeze"),this.setToTime(e),this.diagram.stop("freeze"))}},{key:"setToTime",value:function(t,e){var n=this,r=1<arguments.length&&void 0!==e&&e;0===t&&0<this.states.diffs.length?this.stateIndex=0:this.stateIndex=$i(this.states.diffs,t);var i=0,o=0;if(-1!==this.stateIndex){var a=zi(this.states.diffs[this.stateIndex],4);i=a[0],o=a[3]}if(i!==this.lastSeekTime||r){var s=i;this.lastSeekTime=i;var l=[],u=[];Object.keys(this.events).forEach((function(e){var r=n.events[e];if(!1!==r.setOnSeek){var a=$i(r.list,s);if(-1!==a)for(var c=Gi(r.list,$i(r.list,t)),h=a;h<=c;h+=1){var f=zi(r.list[h],3),d=f[0],p=f[2];-1===n.stateIndex||d<i||d===i&&p<o?l.push([e,h,d,p]):(i<d||d===i&&o<p)&&u.push([e,h,d,p])}}}));var c=function(t){return t.sort((function(t,e){return t[2]<e[2]||t[2]===e[2]&&t[3]<e[3]?-1:t[2]>e[2]||t[2]===e[2]&&t[3]>e[3]?1:0}))};c(l),c(u);var h=function(t){t.forEach((function(t){var e=zi(t,2),r=e[0],i=e[1];n.setEvent(r,i)}))};h(l),-1!==this.stateIndex&&this.setState(this.stateIndex),h(u),this.audio&&(this.audio.currentTime=s),this.setCurrentTime(s),this.setCursor(s),this.diagram.animateNextFrame()}}},{key:"setCursor",value:function(t){var e=this.getCursorState(t);if(null!=e){var n=e.show,r=e.up,i=e.position;n&&r?this.diagram.showCursor("up",i):n&&!1===r?this.diagram.showCursor("down",i):this.diagram.showCursor("hide")}}},{key:"getCursorState",value:function(t){if(null==this.events.touch||null==this.events.cursor||null==this.events.cursorMove)return null;var e=$i(this.events.cursor.list,t),n=$i(this.events.touch.list,t),r=$i(this.events.cursorMove.list,t),i=null,o=null,a=null,s=null,l=null;if(-1!==n){var u=zi(this.events.touch.list[n],3),c=u[0],h=zi(u[1],3),f=h[0],d=h[1],p=h[2],y=u[2];"down"===f?(i=!1,s=c,l=y,a=new se(d,p)):i=!0}if(-1!==e){var v=zi(this.events.cursor.list[e],3),m=v[0],g=zi(v[1],3),b=g[0],w=g[1],S=g[2],x=v[2];"show"===b?(o=!0,(null==s||s<m||m===s&&l<x)&&(s=m,l=x,a=new se(w,S))):o=!1}if(-1!==r){var _=zi(this.events.cursorMove.list[r],3),T=_[0],k=zi(_[1],2),O=k[0],P=k[1],A=_[2];(null==s||s<T||T===s&&l<A)&&(a=new se(O,P))}return{show:null!=o&&o,up:null==i||i,position:null==a?new se(0,0):a}}},{key:"startPlayback",value:function(t,e,n){var r=this,i=0<arguments.length&&void 0!==t?t:this.lastSeekTime||0,o=!(1<arguments.length&&void 0!==e)||e,a=2<arguments.length&&void 0!==n?n:null,s=i;(null==i||i>=this.duration)&&(s=0),this.eventsToPlay=null==a?Object.keys(this.events):a;var l=this.getStateForTime(s);function u(){null==r.pauseState?r.setToTime(s,!0):r.pauseState=null,r.state="playing",r.setVideoToNowDeltaTime(s),r.setCurrentTime(s),r.startTimeUpdates(),r.startEventsPlayback(s),r.startAudioPlayback(s),r.diagram.animateNextFrame(),!1===r.areEventsPlaying()&&!1===r.isAudioPlaying&&r.finishPlaying(),r.subscriptions.publish("playbackStarted")}o||null==this.pauseState||(l=this.pauseState),this.diagram.setState(l,this.settings.play),this.diagram.state.preparingToSetState?(this.state="preparingToPlay",this.subscriptions.publish("preparingToPlay"),this.diagram.subscriptions.add("stateSet",u,1)):u()}},{key:"getPlaySettings",value:function(){var t={how:"instant",maxDuration:6,velocity:{position:2,rotation:2*Math.PI/2,scale:1,opacity:.8,color:.8},allDurationsSame:!0,zeroDurationThreshold:1e-5,duration:0};if("string"==typeof this.settings.play?t.how=this.settings.play:t=st({},t,this.settings.play),"dissolve"===t.how){var e={dissolveIn:.8,dissolveOut:.8,delay:.2};0===t.duration?t.duration=e:"number"==typeof t.duration?t.duration={dissolveOut:t.duration/10*4.5,dissolveIn:t.duration/10*4.5,delay:t.duration/10*1}:t.duration=st({},e,t.duration)}else null!=t.duration&&"number"!=typeof t.duration&&(t.duration=1);return t}},{key:"resumePlayback",value:function(){this.startPlayback(this.currentTime,!1)}},{key:"startAudioPlayback",value:function(t){var e=this;if(this.audio){this.isAudioPlaying=!0,this.audio.currentTime=t,this.audio.play();var n=function(){e.isAudioPlaying=!1,"playing"===e.state&&e.finishPlaying()},r=this.audio;null!=r&&(r.removeEventListener("ended",n.bind(this),!1),r.addEventListener("ended",n.bind(this),!1))}}},{key:"startTimeUpdates",value:function(){var t=this;this.timeUpdatesTimeoutID=(new sn).setTimeout((function(){t.setCurrentTime(t.getCurrentTime()),t.subscriptions.publish("timeUpdate",[t.getCurrentTime()]),t.startTimeUpdates()}),100)}},{key:"startEventsPlayback",value:function(t){var e=this;this.eventsToPlay.forEach((function(n){if(0!==e.events[n].list.length){var r=e.events[n],i=Yi(r.list,t);-1!==i?(zi(r.list[i],1)[0]===t&&(i=Gi(r.list,i)+1),i>r.list.length-1?e.eventIndex[n]=-1:e.eventIndex[n]=i):e.eventIndex[n]=-1}}));var n=this.getNextEvent();null!=this.events[n]&&this.playbackEvent(n)}},{key:"getNextEvent",value:function(){var t=this,e="",n=null,r=null;return this.eventsToPlay.forEach((function(i){if(!(null==t.eventIndex[i]||-1===t.eventIndex[i]||t.events[i].list.length<=t.eventIndex[i])){var o=zi(t.events[i].list[t.eventIndex[i]],3),a=o[0],s=o[2];(null==n||a<n||a===n&&s<r)&&(n=a,r=s,e=i)}})),e}},{key:"playbackEvent",value:function(t){var e=this.eventIndex[t],n=f(this.events[t].list[e][0]-this.getCurrentTime(),8);if(1e-4<n)this.timeoutID=(new sn).setTimeout(this.playbackEvent.bind(this,t),f(1e3*n,0));else{if(this.setEvent(t,e),this.diagram.animateNextFrame(),e+1===this.events[t].list.length){if(!(this.eventIndex[t]=-1)===this.areEventsPlaying()&&!1===this.isAudioPlaying)return void this.finishPlaying()}else this.eventIndex[t]=e+1;var r=this.getNextEvent();null!=r&&this.events[r]&&this.playbackEvent(r)}}},{key:"areEventsPlaying",value:function(){for(var t=0;t<this.eventsToPlay.length;t+=1){var e=this.eventsToPlay[t];if(this.eventIndex[e]<this.events[e].list.length&&-1<this.eventIndex[e])return!0}return!1}},{key:"finishPlaying",value:function(){var t=this;if(this.areEventsPlaying())return!1;var e=this.duration-this.getCurrentTime();return 1e-4<e?(this.timeoutID=(new sn).setTimeout((function(){t.finishPlaying()}),f(1e3*e,0)),!1):!this.isAudioPlaying&&(this.setCurrentTime(this.getCurrentTime()),this.stop(),!0)}},{key:"stop",value:function(){this.stopTimeouts(),this.audio&&(this.audio.pause(),this.isAudioPlaying=!1),this.state="idle",this.subscriptions.publish("playbackStopped")}},{key:"pausePlayback",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:this.settings.pause;this.setCurrentTime(this.getCurrentTime()),this.pauseState=this.diagram.getState({precision:this.precision,ignoreShown:!0}),this.stopTimeouts(),this.audio&&(this.audio.pause(),this.isAudioPlaying=!1),this.diagram.subscriptions.add("stopped",(function(){e.state="idle",e.subscriptions.publish("playbackStopped")}),1),this.diagram.stop(n),this.diagram.state.preparingToStop&&(this.subscriptions.publish("preparingToPause"),this.state="preparingToPause")}},{key:"setEvent",value:function(t,e){var n=this.events[t];null!=n&&n.playbackAction(n.list[e][1],n.list[e][0])}},{key:"setState",value:function(t){if(!(t>this.states.diffs.length-1)){var e=this.states.getFromIndex(t);this.diagram.setState(e)}}},{key:"getState",value:function(t){return t>this.states.diffs.length-1?{}:this.states.getFromIndex(t)}},{key:"getStateForTime",value:function(t){var e;return e=0===t&&0<this.states.diffs.length?0:$i(this.states.diffs,t),this.getState(e)}}]),t}(),Qi=function(){function t(){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.location=new se(0,0),this.border=[[]],this.holeBorder=[[]],this.onLoad=null,this.type="drawingObject",this.state="loading"}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"_dup",value:function(){return this}},{key:"setText",value:function(){}},{key:"update",value:function(){}},{key:"getGLBoundaries",value:function(t){var e=[];return this.border.forEach((function(n){var r=[];n.forEach((function(e){r.push(e.transformBy(t))})),e.push(r)})),e}},{key:"getGLBoundaryHoles",value:function(t){var e=[];return this.holeBorder.forEach((function(n){var r=[];n.forEach((function(e){r.push(e.transformBy(t))})),e.push(r)})),e}},{key:"drawWithTransformMatrix",value:function(){}},{key:"getGLBoundingRect",value:function(t){return Re(this.getGLBoundaries(t))}},{key:"getVertexSpaceBoundingRect",value:function(){return Re(this.border)}},{key:"getLocation",value:function(){return this.location}},{key:"getGLLocation",value:function(t){return this.getLocation().transformBy(t)}},{key:"getRelativeGLBoundingRect",value:function(t){var e=this.getGLLocation(t),n=this.getGLBoundingRect(t);return new oe(n.left-e.x,n.bottom-e.y,n.width,n.height)}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){var t=this.getVertexSpaceBoundingRect();return new oe(t.left-this.location.x,t.bottom-this.location.y,t.width,t.height)}},{key:"change",value:function(){}},{key:"_getStateProperties",value:function(){return[]}},{key:"_state",value:function(t){return an(this,this._getStateProperties(),t)}}]),t}();function Zi(t){return(Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ji(t,e){return(Ji=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function to(t){return(to=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var eo=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ji(t,e)}(r,Qi);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=to(t);if(e){var o=to(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Zi(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e,i){var o,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"middle",s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"center";!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),o=n.call(this);var l=document.getElementById(e);return l&&(o.element=l),o.id=e,o.location=i,o.yAlign=a,o.xAlign=s,o.parentDiv=t,o.show=!0,o.setBorder(),o.lastMatrix=[0,0,0,0,0,0,0,0,0],o.lastColor=[-1,-1,-1,-1],o}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_dup",value:function(){var t=new r(this.parentDiv,this.id,this.location._dup(),this.yAlign,this.xAlign);return t.show=this.show,t.border=this.border.map((function(t){return t.map((function(t){return t._dup()}))})),t}},{key:"setBorder",value:function(){var t=this.parentDiv.getBoundingClientRect(),e=this.element.getBoundingClientRect(),n=e.left-t.left,r=n+e.width,i=e.top-t.top,o=i+e.height,a=[];a.push(new se(n,i)),a.push(new se(r,i)),a.push(new se(r,o)),a.push(new se(n,o)),this.border=[],this.border.push(a)}},{key:"getGLBoundaries",value:function(){var t=this.parentDiv.getBoundingClientRect(),e=Pe({x:{bottomLeft:0,width:t.width},y:{bottomLeft:t.height,height:-t.height}},{x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}}),n=this.element.getBoundingClientRect(),r=n.left-t.left,i=r+n.width,o=n.top-t.top,a=o+n.height,s=[];return s.push(new se(r,o)),s.push(new se(i,o)),s.push(new se(i,a)),s.push(new se(r,a)),[s.map((function(t){return t.transformBy(e.matrix())}))]}},{key:"glToPixelSpace",value:function(t){var e=(t.x- -1)/2*this.parentDiv.clientWidth,n=(1-t.y)/2*this.parentDiv.clientHeight;return new se(e,n)}},{key:"change",value:function(t,e){var n=t;"string"==typeof t&&((n=document.createElement("div")).innerHTML=t),n instanceof HTMLElement&&(this.element.innerHTML="",this.element.appendChild(n),this.transformHtml(e))}},{key:"transformHtml",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:1;if(this.show){var r=this.location.transformBy(t),i=this.glToPixelSpace(r),o=this.element.clientWidth,a=this.element.clientHeight,s=0,l=0;"center"===this.xAlign?s=-o/2:"right"===this.xAlign&&(s=-o),"middle"===this.yAlign?l=-a/2:"bottom"===this.yAlign&&(l=-a);var u=i.x+s,c=i.y+l,h="position: absolute; left: ".concat(u,"px; top: ").concat(c,"px; visibility: visible; opacity: ").concat(n,";");h!==this.element.getAttribute("style")&&this.element.setAttribute("style",h)}else this.element.setAttribute("style","position: absolute; left: -10000px; top: -10000px; visibility: hidden; opacity: ".concat(n,";"))}},{key:"drawWithTransformMatrix",value:function(t,e){for(var n=!1,r=0;r<t.length;r+=1)f(t[r],8)!==this.lastMatrix[r]&&(n=!0);!n&&this.lastColor[3]===f(e[3],8)||(this.transformHtml(t,e[3]),this.lastMatrix=f(t,8),this.lastColor=f(e,8))}}]),r}();function no(t){return(no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ro(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function io(t,e,n){return(io="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ao(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function oo(t,e){return(oo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ao(t){return(ao=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var so=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oo(t,e)}(r,Qi);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=ao(t);if(e){var o=ao(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==no(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t){var e,i,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"simple",a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"simple";return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=n.call(this)).numPoints=0,i=Array.isArray(t)?t:[t],e.gl=i.map((function(t){return t.gl})),e.webgl=i,e.glPrimitive=i[0].gl.TRIANGLES,e.points=[],e.z=0,e.buffer=i.map((function(){return null})),e.texture=null,e.programIndex=i.map((function(t){return t.getProgram(o,a)})),e.type="vertexPrimitive",e}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"addTextureToBuffer",value:function(t,e,n,r){function i(t){return 0==(t&t-1)}var o=this.gl[t],a=this.webgl[t],s=this.texture;if(null!=s){var l=a.textures[s.id].index;o.activeTexture(o.TEXTURE0+l),o.bindTexture(o.TEXTURE_2D,e),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),i(n.width)&&i(n.height)?(o.generateMipmap(o.TEXTURE_2D),null!=r&&!0===r?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE))):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE))}}},{key:"setupBuffer",value:function(t){for(var e=this,n=0<arguments.length&&void 0!==t?t:0,r=function(t){var r=e.gl[t],i=e.webgl[t];e.state="loaded",e.numPoints=0===n?e.points.length/2:n;var o=e.texture;if(null!=o)if(null==o.points&&(o.points=[]),0===o.points.length&&e.createTextureMap(),null==o.buffer&&(o.buffer=e.gl.map((function(){return null}))),o.buffer[t]=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,o.buffer[t]),r.bufferData(r.ARRAY_BUFFER,new Float32Array(o.points),r.STATIC_DRAW),!(o.id in i.textures)||o.id in i.textures&&null==i.textures[o.id].glTexture){var a=r.createTexture();i.addTexture(o.id,a,o.type),r.activeTexture(r.TEXTURE0+i.textures[o.id].index),r.bindTexture(r.TEXTURE_2D,a);var s=o.src;if(s){r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([0,0,255,100]));var l=new Image;l.src=s,e.state="loading",i.textures[o.id].state="loading",i.textures[o.id].onLoad.push(e.executeOnLoad.bind(e)),l.addEventListener("load",(function(){o.data=l,e.addTextureToBuffer(t,a,o.data,o.repeat),i.onLoad(o.id),e.state="loaded",i.textures[o.id].state="loaded"}))}else null!=o.data&&e.addTextureToBuffer(t,a,o.data,o.repeat)}else o.id in i.textures&&("loading"===i.textures[o.id].state?(e.state="loading",i.textures[o.id].onLoad.push(e.executeOnLoad.bind(e))):e.state="loaded");e.buffer[t]=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,e.buffer[t]),r.bufferData(r.ARRAY_BUFFER,new Float32Array(e.points),r.STATIC_DRAW)},i=0;i<this.webgl.length;i+=1)r(i)}},{key:"executeOnLoad",value:function(){null!=this.onLoad&&this.onLoad()}},{key:"resetBuffer",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0;n<this.webgl.length;n+=1){var r=this.gl[n],i=this.webgl[n],o=this.texture;o&&(null!=i.textures[o.id].glTexture&&(r.deleteTexture(i.textures[o.id].glTexture),i.textures[o.id].glTexture=null),null!=o.buffer&&(r.deleteBuffer(o.buffer[n]),o.buffer[n]=null)),r.deleteBuffer(this.buffer[n]),this.setupBuffer(e)}}},{key:"change",value:function(){this.resetBuffer()}},{key:"update",value:function(){this.resetBuffer()}},{key:"_getStateProperties",value:function(){return function(t){if(Array.isArray(t))return ro(t)}(t=io(ao(r.prototype),"_getStateProperties",this).call(this))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return ro(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ro(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var t}},{key:"changeVertices",value:function(t,e){var n=this,r=1<arguments.length&&void 0!==e?e:[];this.points=[],this.border=[];var i=null,o=null,a=null,s=null;t.forEach((function(t){n.points.push(t.x),n.points.push(t.y),(null===i||t.x<i)&&(i=t.x),(null===o||t.y<o)&&(o=t.y),(null===s||t.y>s)&&(s=t.y),(null===a||t.x>a)&&(a=t.x)})),0===r.length?null!=i&&null!=o&&null!=a&&null!=s&&(this.border[0]=[new se(i,o),new se(i,s),new se(a,s),new se(a,o)]):this.border=r,this.resetBuffer()}},{key:"getPointCountForAngle",value:function(t){return 0<arguments.length&&void 0!==t||Math.PI,this.numPoints}},{key:"getPointCountForLength",value:function(){return this.numPoints}},{key:"createTextureMap",value:function(t,e,n,r,i,o,a,s){var l=0<arguments.length&&void 0!==t?t:-1,u=2<arguments.length&&void 0!==n?n:-1,c=4<arguments.length&&void 0!==i?i:0,h=6<arguments.length&&void 0!==a?a:0,f=(1<arguments.length&&void 0!==e?e:1)-l,d=(3<arguments.length&&void 0!==r?r:1)-u,p=(5<arguments.length&&void 0!==o?o:1)-c,y=(7<arguments.length&&void 0!==s?s:1)-h,v=this.texture;if(null!=v){v.points=[];for(var m=0;m<this.points.length;m+=2){var g=(this.points[m]-l)/f,b=(this.points[m+1]-u)/d;v.points.push(g*p+c),v.points.push(b*y+h)}}}},{key:"draw",value:function(t,e,n,r,i,o){var a=5<arguments.length&&void 0!==o?o:0,s=[1,0,0,0,1,0,0,0,1];s=qt(s=Ft(s=Bt(s,t.x,t.y),e),n.x,n.y),this.drawWithTransformMatrix(Dt(s),i,a,r)}},{key:"drawWithTransformMatrix",value:function(t,e,n,r){var i=this.gl[n],o=this.webgl[n],a=i.FLOAT,s=o.useProgram(this.programIndex[n]);this.texture&&o.textures[this.texture.id].type,i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.enableVertexAttribArray(s.a_position),i.bindBuffer(i.ARRAY_BUFFER,this.buffer[n]),i.vertexAttribPointer(s.a_position,2,a,!1,0,0),i.uniformMatrix3fv(s.u_matrix,!1,Dt(t)),i.uniform1f(s.u_z,this.z),i.uniform4f(s.u_color,e[0],e[1],e[2],e[3]);var l=this.texture;if(null!=l){var u=i.FLOAT;i.enableVertexAttribArray(s.a_texcoord),i.bindBuffer(i.ARRAY_BUFFER,l.buffer[n]),i.vertexAttribPointer(s.a_texcoord,2,u,!1,0,0)}if(l){i.uniform1i(s.u_use_texture,1);var c=o.textures[l.id].index;i.uniform1i(s.u_texture,c)}else i.uniform1i(s.u_use_texture,0);i.drawArrays(this.glPrimitive,0,r),l&&i.disableVertexAttribArray(s.a_texcoord)}},{key:"transform",value:function(t){for(var e=0;e<this.points.length;e+=2){var n=new se(this.points[e],this.points[e+1]);n=n.transformBy(t),this.points[e]=n.x,this.points[e+1]=n.y}for(var r=0;r<this.border.length;r+=1)for(var i=0;i<this.border[r].length;i+=1)this.border[r][i]=this.border[r][i].transformBy(t)}}]),r}(),lo=function(){function t(e){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.canvas=e,this.ctx=this.canvas.getContext("2d");var n=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,r=window.devicePixelRatio||1;1===r&&(r=2),this.ratio="number"==typeof n?r/n:1,this.resize()}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"resize",value:function(){this.ctx.setTransform(1,0,0,1,0,0),this.canvas.width=this.canvas.clientWidth*this.ratio,this.canvas.height=this.canvas.clientHeight*this.ratio,this.ctx.scale(this.ratio,this.ratio)}},{key:"_dup",value:function(){return this}}]),t}();function uo(t){return(uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function co(t){return function(t){if(Array.isArray(t))return ho(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return ho(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ho(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ho(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function fo(t,e,n){return(fo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=yo(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function po(t,e){return(po=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function yo(t){return(yo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function go(t,e,n){return e&&mo(t.prototype,e),n&&mo(t,n),t}var bo=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Helvetica Neue",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"200",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"center",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"middle",s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;vo(this,t),this.family=e,this.style=n,this.size=r,this.weight=i,this.xAlign=o,this.yAlign=a,this.opacity=1,this.setColor(s)}return go(t,[{key:"setColor",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.color=e}},{key:"set",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:1;t.font="".concat(this.style," ").concat(this.weight," ").concat(this.size*n,"px ").concat(this.family),t.textAlign=this.xAlign,t.textBaseline=this.yAlign}},{key:"_dup",value:function(){return new t(this.family,this.style,this.size,this.weight,this.xAlign,this.yAlign,this.color)}}]),t}(),wo=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new se(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new bo;vo(this,t),this.location=e._dup(),this.text=n.slice(),this.font=r._dup()}return go(t,[{key:"_dup",value:function(){return new t(this.location._dup(),this.text,this.font._dup())}}]),t}(),So=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&po(t,e)}(r,Qi);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=yo(t);if(e){var o=yo(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==uo(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(vo(this,r),e=n.call(this),Array.isArray(t)?e.drawContext2D=t:e.drawContext2D=[t],e.text=i,e.scalingFactor=1,e.lastDraw=[],e.lastDrawTransform=[],0<i.length){var o=e.text[0].font.size;if(e.text.forEach((function(t){0<t.font.size&&t.font.size<o&&(o=t.font.size)})),o<20&&(e.scalingFactor=50*o),o<1){var a=-Math.log(o)/Math.LN10+2;e.scalingFactor=Math.pow(10,a)}}return e.setBorder(),e.state="loaded",e}return go(r,[{key:"setText",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;this.text[n].text=t,this.setBorder()}},{key:"_dup",value:function(){var t=new r(this.drawContext2D,this.text);return lt(this,t),t.scalingFactor=this.scalingFactor,t.border=this.border.map((function(t){return t.map((function(t){return t._dup()}))})),t}},{key:"setFont",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.size=t;this.setBorder()}},{key:"setOpacity",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.opacity=t}},{key:"setColor",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.color=t}},{key:"draw",value:function(t,e,n,r,i){var o=[1,0,0,0,1,0,0,0,1];o=qt(o=Ft(o=Bt(o,t.x,t.y),e),n.x,n.y),this.drawWithTransformMatrix(Dt(o),i)}},{key:"drawWithTransformMatrix",value:function(t,e,n){var r=this,i=1<arguments.length&&void 0!==e?e:[1,1,1,1],o=2<arguments.length&&void 0!==n?n:0,a=this.drawContext2D[o],s=this.drawContext2D[o].ctx,l=this.scalingFactor,u="rgba(\n      ".concat(Math.floor(255*i[0]),",\n      ").concat(Math.floor(255*i[1]),",\n      ").concat(Math.floor(255*i[2]),",\n      ").concat(Math.floor(255*i[3]),")");s.save();var c=a.canvas.offsetWidth/2/l,h=a.canvas.offsetHeight/2/l,f=Ct([c,0,a.canvas.offsetWidth/2,0,h,a.canvas.offsetHeight/2,0,0,1],[t[0],-t[1],t[2]*l,-t[3],t[4],t[5]*-l,0,0,1]);s.transform(f[0],f[3],f[1],f[4],f[2],f[5]),this.lastDrawTransform=f.slice(),this.text.forEach((function(t){if(t.font.set(s,l),null!=t.font.color){var e=[].concat(co(t.font.color.slice(0,3)),[t.font.color[3]*t.font.opacity*i[3]]);s.fillStyle=(n=e,"rgba(".concat(Math.floor(255*n[0]),",").concat(Math.floor(255*n[1]),",").concat(Math.floor(255*n[2]),",").concat(n[3],")"))}else s.fillStyle=u;var n;r.recordLastDraw(s,t,l,t.location.x*l,t.location.y*-l),s.fillText(t.text,t.location.x*l,t.location.y*-l)})),s.restore()}},{key:"recordLastDraw",value:function(t,e,n,r,i){var o=1.2*t.measureText(e.text).width,a=e.font.size*n*1.2,s=i+.1*a,l=r-.1*o;"baseline"===e.font.yAlign?s=i+.2*a:"top"===e.font.yAlign?s=i+a:"middle"===e.font.yAlign&&(s=i+a/2),"center"===e.font.xAlign?l-=o/2:"right"===e.font.xAlign&&(l-=o),this.lastDraw.push({width:o,height:-a,x:l,y:s})}},{key:"clear",value:function(t){var e=0<arguments.length&&void 0!==t?t:0,n=this.lastDraw;if(0<n.length){var r=this.drawContext2D[e].ctx,i=this.lastDrawTransform;r.save(),r.transform(i[0],i[3],i[1],i[4],i[2],i[5]),n.forEach((function(t){var e=t.x-t.width,n=t.y-t.height;r.clearRect(e,n,3*t.width,3*t.height)})),r.restore()}this.lastDraw=[]}},{key:"getGLBoundaries",value:function(t){var e=this,n=[];return this.text.forEach((function(r){n.push(e.getGLBoundaryOfText(r,t))})),n}},{key:"setBorder",value:function(){var t=this;this.border=[],this.text.forEach((function(e){t.border.push(t.getBoundaryOfText(e))}))}},{key:"measureText",value:function(t,e){var n,r=t.font.match(/[^ ]*px/),i=1.4*(n=null!=r?parseFloat(r[0])/2:t.measureText("a").width),o=.08*n,a=e.text.match(/[acemnorsuvwxz*gyqp]/g);Array.isArray(a)&&a.length===e.text.length&&(i=.95*n);var s=e.text.match(/[;,$]/g);Array.isArray(s)&&0<s.length&&(o=.2*n);var l=e.text.match(/[gjyqp@Q(){}[\]|]/g);Array.isArray(l)&&0<l.length&&(o=.5*n);var u=i+o,c=t.measureText(e.text).width,h=0,f=0,d=0,p=0;return"left"===e.font.xAlign&&(p=c),"center"===e.font.xAlign&&(p=d=c/2),"right"===e.font.xAlign&&(d=c),"alphabetic"!==e.font.yAlign&&"baseline"!==e.font.yAlign||(h=i,f=o),"top"===e.font.yAlign&&(h=0,f=u),"bottom"===e.font.yAlign&&(h=u,f=0),"middle"===e.font.yAlign&&(f=h=u/2),{actualBoundingBoxLeft:d,actualBoundingBoxRight:p,fontBoundingBoxAscent:h,fontBoundingBoxDescent:f}}},{key:"getBoundaryOfText",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,r=[],i=this.scalingFactor;t.font.set(this.drawContext2D[n].ctx,i);var o=this.measureText(this.drawContext2D[n].ctx,t),a=t.location;return[new se(-o.actualBoundingBoxLeft/i,o.fontBoundingBoxAscent/i).add(a),new se(o.actualBoundingBoxRight/i,o.fontBoundingBoxAscent/i).add(a),new se(o.actualBoundingBoxRight/i,-o.fontBoundingBoxDescent/i).add(a),new se(-o.actualBoundingBoxLeft/i,-o.fontBoundingBoxDescent/i).add(a)].forEach((function(t){r.push(t)})),r}},{key:"getGLBoundaryOfText",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:0,i=[];return this.getBoundaryOfText(t,r).forEach((function(t){i.push(t.transformBy(e))})),i}},{key:"_getStateProperties",value:function(){return co(fo(yo(r.prototype),"_getStateProperties",this).call(this))}}]),r}();function xo(t){return(xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _o(t,e,n){return(_o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Oo(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function To(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Co(t,e)}function ko(t){var e=Ro();return function(){var n,r,i,o=Oo(t);if(e){var a=Oo(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return r=this,!(i=n)||"object"!==xo(i)&&"function"!=typeof i?function(){if(void 0!==r)return r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():i}}function Oo(t){return(Oo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Po(t){return function(t){if(Array.isArray(t))return Mo(t)}(t)||Eo(t)||Ao(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ao(t,e){if(t){if("string"==typeof t)return Mo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mo(t,e):void 0}}function Eo(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function Mo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function jo(t,e,n){return(jo=Ro()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Co(i,n.prototype),i}).apply(null,arguments)}function Ro(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Co(t,e){return(Co=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Do(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Lo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bo(t,e,n){return e&&Lo(t.prototype,e),n&&Lo(t,n),t}function Io(t,e){var n=[];return 0===e.length?t.map((function(t){return t._dup()})):(t.forEach((function(t){e.forEach((function(e){n.push(Oe(t).transform(Oe(e)))}))})),0<n.length?n.map((function(t){return t._dup()})):t.map((function(t){return t._dup()})))}var Fo=function(){function t(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ke,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new oe(-1,-1,2,2),i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;Do(this,t),this.name="",this.uid=(1e18*Math.random()).toString(36),this.isShown=!0,this.transform=n._dup(),this.dependantTransform=!1,this.fnMap=new V,this.subscriptions=new jt(this.fnMap),this.isMovable=!1,this.isTouchable=!1,this.isInteractive=void 0,this.hasTouchableElements=!1,this.color=[1,1,1,1],this.lastDrawOpacity=1,this.dimColor=[.5,.5,.5,1],this.defaultColor=this.color.slice(),this.opacity=1,this.setTransformCallback=null,this.beforeDrawCallback=null,this.afterDrawCallback=null,this.internalSetTransformCallback=null,this.lastDrawTransform=this.transform._dup(),this.parentTransform=new ke,this.lastDrawPulseTransform=this.transform._dup(),this.onClick=null,this.lastDrawElementTransformPosition={parentCount:0,elementCount:0},this.recorder=new Ki(!0),this.custom={},this.parent=i,this.drawPriority=1,this.stateProperties=[],this.lastDrawTime=0,this.pulseDefault={frequency:0,scale:2,time:1},this.anim={rotation:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new Gr(i)},scale:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new Zr(i)},trigger:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=st.apply(void 0,[{}].concat(e));return new fi(r)},delay:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=st.apply(void 0,[{}].concat(e));return new Ii(r)},translation:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new wn(i)},position:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new wn(i)},color:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new ur(i)},opacity:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new Tr(i)},transform:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new Dr(i)},pulseTransform:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new qr(i)},pulse:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=st.apply(void 0,[{},{element:this}].concat(e));return new ii(r)},dissolveIn:function(t){for(var n,r=0<arguments.length&&void 0!==t?t:{},i={element:e},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n=st.apply(void 0,"number"==typeof r?[{},i,{duration:r}].concat(a):[{},i,r].concat(a)),new kr(n)},dissolveOut:function(t){for(var n,r=0<arguments.length&&void 0!==t?t:{},i={element:e},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n=st.apply(void 0,"number"==typeof r?[{},i,{duration:r}].concat(a):[{},i,r].concat(a)),new Pr(n)},dim:function(t){for(var n,r=0<arguments.length&&void 0!==t?t:{},i={element:e},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n=st.apply(void 0,"number"==typeof r?[{},i,{duration:r}].concat(a):[{},i,r].concat(a)),new cr(n)},undim:function(t){for(var n,r=0<arguments.length&&void 0!==t?t:{},i={element:e},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n=st.apply(void 0,"number"==typeof r?[{},i,{duration:r}].concat(a):[{},i,r].concat(a)),new fr(n)},builder:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return jo(Ko,[e].concat(n))},scenario:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{element:e}].concat(n));return new Zn(i)},scenarios:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},{}].concat(n)),o=e.getAllElementsWithScenario(i.target),a=[],s={};return lt(i,s,["steps","element"]),o.forEach((function(t){a.push(t.anim.scenario(s))})),new Vn(s,{steps:a})}},r instanceof oe?this.diagramLimits=r:null!=r&&(this.diagramLimits=this.diagram.limits._dup()),this.move={bounds:new Ue(this.transform),maxVelocity:5,freely:{zeroVelocityThreshold:1e-4,deceleration:5,callback:null,bounceLoss:.5},canBeMovedAfterLosingTouch:!0,type:"translation",element:null,transformClip:null},this.scenarios={},this.fnMap.add("_elementPulseSettingsTransformMethod",(function(t,e){return null==e||0===e.x&&0===e.y?(new ke).scale(t,t):(new ke).translate(-e.x,-e.y).scale(t,t).translate(e.x,e.y)})),this.fnMap.add("tools.math.easeinout",g),this.fnMap.add("tools.math.linear",v),this.fnMap.add("tools.math.sinusoid",S),this.fnMap.add("tools.math.triangle",m),this.pulseSettings={time:1,frequency:.5,A:1,B:.5,C:0,progression:"tools.math.sinusoid",num:1,delta:new se(0,0),transformMethod:"_elementPulseSettingsTransformMethod",callback:function(){},allowFreezeOnStop:!1},this.state={isBeingMoved:!1,isMovingFreely:!1,movement:{previousTime:null,previousTransform:this.transform._dup(),velocity:this.transform.zero()},isPulsing:!1,pulse:{startTime:null},preparingToStop:!1},this.interactiveLocation=new se(0,0),this.animationFinishedCallback=null,this.animations=new No({element:this,finishedCallback:this.animationFinished.bind(this)}),this.tieToHTML={element:null,scale:"fit",window:this.diagramLimits,updateOnResize:!0},this.isRenderedAsImage=!1,this.unrenderNextDraw=!1,this.renderedOnNextDraw=!1,this.pulseTransforms=[],this.frozenPulseTransforms=[],this.copyTransforms=[],this.drawTransforms=[]}return Bo(t,[{key:"animationFinished",value:function(t){var e=0<arguments.length&&void 0!==t?t:"animation";this.fnMap.exec(this.animationFinishedCallback),this.subscriptions.publish("animationFinished",e)}},{key:"setProperties",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:[];if(null!=t.move&&null!=t.move.bounds&&"diagram"!==t.move.bounds){"string"==typeof n?n=[n,"move.bounds"]:n.push("move.bounds");var r=He(t.move.bounds,"transform",this.transform);if(r instanceof Ue){for(var i=0;i<r.boundary.length;i+=1){var o=r.boundary[i],a=r.order[i];null!=r.boundary[i]&&o instanceof qe&&("t"===a||"s"===a)&&(r.boundary[i]=new Ne({left:o.boundary.min,bottom:o.boundary.min,right:o.boundary.max,top:o.boundary.max}))}this.move.bounds=r}}at({except:n},this,t)}},{key:"_getStateProperties",value:function(t){var e=t.ignoreShown;return null==e&&(e=!1),this.isShown||e?["animations","color","opacity","dimColor","defaultColor","transform","isShown","isMovable","isTouchable","state","pulseSettings","setTransformCallback","move","subscriptions","pulseTransforms","frozenPulseTransforms"].concat(Po(this.stateProperties)):["isShown","transform"]}},{key:"_getStatePropertiesMin",value:function(){return this.isShown?["color","transform","isShown"]:["isShown"]}},{key:"_state",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};return e.min?an(this,this._getStatePropertiesMin(),e):an(this,this._getStateProperties(e),e)}},{key:"setTimeDelta",value:function(t){"animating"===this.animations.state&&this.animations.setTimeDelta(t),this.state.isPulsing&&null!=this.state.pulse.startTime&&(this.state.pulse.startTime+=t),null!=this.state.movement.previousTime&&(this.state.movement.previousTime+=t)}},{key:"updateHTMLElementTie",value:function(t){var e;if("string"==typeof this.tieToHTML.element&&(e=document.getElementById(this.tieToHTML.element)),null!=e){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=this.diagramLimits,o=this.tieToHTML.window,a=r.width/r.height,s=i.width/i.height,l=n.width/n.height,u=o.width/o.height,c=new se(n.left-r.left,n.top-r.top),h=c.add(new se(n.width,n.height)),f=this.diagramTransforms.pixelToDiagram,d=c.transformBy(f.m()),p=h.transformBy(f.m()),y=p.x-d.x,v=d.y-p.y,m=d.add(new se(y/2,-v/2)),g=this.tieToHTML.scale.trim().toLowerCase(),b=1,w=1,S=i.width/o.width,x=i.height/o.height;if(g.endsWith("em")){var _=parseFloat(g),T=parseFloat(getComputedStyle(e).fontSize),k=i.width/.2;b=_*T*k/r.width,w=_*T*k/s/r.height}if(g.endsWith("px")){var O=parseFloat(g);if(1<u){var P=O/r.width;b=P*S,w=P*a/s*S}else{var A=O/r.height;b=A/a*s*x,w=A*x}}if("stretch"===g&&(b=n.width/r.width*S,w=n.height/r.height*x),"max"===g||"fit"===g){var E=new se(n.height/r.height/a*s*x,n.height/r.height*x),M=new se(n.width/r.width*S,n.width/r.width*a/s*S);w="max"===g&&u<l||"fit"===g&&l<u?(b=M.x,M.y):(b=E.x,E.y)}this.setScale(b,w),this.setPosition(m.x-b*(this.tieToHTML.window.left+this.tieToHTML.window.width/2),m.y-w*(this.tieToHTML.window.bottom+this.tieToHTML.window.height/2)),this.setFirstTransform(this.getParentLastDrawTransform())}}},{key:"setFirstTransform",value:function(){}},{key:"clearFrozenPulseTransforms",value:function(){this.frozenPulseTransforms=[]}},{key:"freezePulseTransforms",value:function(t){var e=!(0<arguments.length&&void 0!==t)||t;(e&&0===this.pulseTransforms.length||!e&&0<this.pulseTransforms.length)&&(this.frozenPulseTransforms=this.pulseTransforms.map((function(t){return t._dup()})))}},{key:"animateToState",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n&&n,o=3<arguments.length&&void 0!==r?r:null,a={};(this.isShown!==t.isShown&&1===this.opacity||1!==this.opacity)&&(a.isShown=t.isShown),Bn(this.color,t.color,.001)||(a.color=t.color);var s=Oe(t.transform);this.transform.isWithinDelta(s,.001)||!1!==this.dependantTransform&&!1!==i||(a.transform=s);var l=null,u=0;if(0<Object.keys(a).length){var c=st({},e,{target:a});l=this.anim.scenario(c)}var h=null;if(!this.arePulseTransformsSame(t,.001)){var f=this.pulseTransforms.map((function(t){return t._dup()}));0===this.pulseTransforms.length&&(f=this.frozenPulseTransforms.map((function(t){return t._dup()})));var d=t.pulseTransforms.map((function(t){return Oe(t)}));0===d.length&&0<t.frozenPulseTransforms.length&&(d=t.frozenPulseTransforms.map((function(t){return Oe(t)}))),0===d.length&&0<f.length&&(d=[f[0].identity()]),h=this.anim.pulseTransform(st({},e,{start:f,target:d}))}return null==l&&null==h||this.animations.new().inParallel([l,h]).start(o),null!=l&&(u=Math.max(u,l.getTotalDuration())),null!=h&&(u=Math.max(u,h.getTotalDuration())),u}},{key:"dissolveInToState",value:function(t,e,n){var r=this,i=1<arguments.length&&void 0!==e?e:.8,o=2<arguments.length&&void 0!==n?n:null;return!1===t.isShown?0:(this.transform=Oe(t.transform),this.color=t.color.slice(),this.frozenPulseTransforms=[],t.pulseTransforms.forEach((function(t){return r.frozenPulseTransforms.push(Oe(t))})),this.show(),this.animations.new().opacity({target:t.opacity,start:.001,duration:i}).trigger({callback:function(){r.frozenPulseTransforms=[]}}).start(o),i)}},{key:"isStateSame",value:function(t,e,n){var r=1<arguments.length&&void 0!==e&&e,i=2<arguments.length&&void 0!==n?n:[],o=this.getPath();if(-1<i.indexOf(o))return!0;if(this.isShown!==t.isShown||.001<Math.abs(this.opacity-t.opacity))return!1;if(!Bn(this.color,t.color,.001))return!1;if(!this.transform.isWithinDelta(Oe(t.transform),.001))return!1;if(r)return!!this.arePulseTransformsSame(t,.001);if(t.pulseTransforms.length!==this.pulseTransforms.length)return!1;for(var a=0;a<this.pulseTransforms.length;a+=1)if(!this.pulseTransforms[a].isWithinDelta(Oe(t.pulseTransforms[a]),.001))return!1;return!0}},{key:"arePulseTransformsSame",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:.001,r=[],i=[];if(r=Io([this.transform._dup()],t.pulseTransforms),r=Io(r,t.frozenPulseTransforms),i=Io([this.transform._dup()],this.pulseTransforms),(i=Io(i,this.frozenPulseTransforms)).length!==r.length)return!1;for(var o=0;o<i.length;o+=1)if(!i[o].isWithinDelta(r[o],n))return!1;return!0}},{key:"getDrawTransforms",value:function(t){var e=Io(t,this.copyTransforms);return e=Io(e,this.pulseTransforms),Io(e,this.frozenPulseTransforms)}},{key:"exec",value:function(t){var e,n,r;if(Array.isArray(t)){var i=function(t){if(Array.isArray(t))return t}(r=t)||Eo(r)||Ao(r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();e=i[0],n=i.slice(1)}else e=t;null!=this[e]&&"function"==typeof this[e]&&(void 0===n?this[e]():this[e].apply(this,Po(n)))}},{key:"pulse",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,n={frequency:0,time:1,scale:2};"function"!=typeof this.pulseDefault&&"string"!=typeof this.pulseDefault&&(n.frequency=this.pulseDefault.frequency,n.time=this.pulseDefault.time,n.scale=this.pulseDefault.scale);var r,i={x:"center",y:"middle",space:"diagram",centerOn:null,frequency:n.frequency,time:n.time,scale:n.scale,done:null,progression:"tools.math.sinusoid"},o=i;r="function"==typeof e||"string"==typeof e?(o=i,e):null==e?(o=i,null):(o=st({},i,e)).done,"function"==typeof this.pulseDefault||"string"==typeof this.pulseDefault?this.fnMap.exec(this.pulseDefault,r):this.pulseScaleRelativeTo(o.centerOn,o.x,o.y,o.space,o.time,o.scale,o.frequency,r,o.progression)}},{key:"getElement",value:function(){return this}},{key:"getElements",value:function(){return[this]}},{key:"highlight",value:function(){this.undim()}},{key:"setPosition",value:function(t,e){var n;n="number"==typeof t?new se(t,1<arguments.length&&void 0!==e?e:0):ne(t);var r=this.transform._dup();r.updateTranslation(n),this.setTransform(r)}},{key:"setRotation",value:function(t){var e=this.transform._dup();e.updateRotation(t),this.setTransform(e)}},{key:"setScale",value:function(t,e){var n,r=1<arguments.length&&void 0!==e?e:null;n="number"==typeof t?new se(t,"number"==typeof r?r:t):ne(t);var i=this.transform._dup();i.updateScale(n),this.setTransform(i)}},{key:"setTransform",value:function(t){if(null!=this.move.transformClip){var e=this.fnMap.exec(this.move.transformClip,t);e instanceof ke&&(this.transform=e)}else this.checkMoveBounds(),this.move.bounds instanceof Ue&&(this.transform=this.move.bounds.clip(t));this.internalSetTransformCallback&&this.fnMap.exec(this.internalSetTransformCallback,this.transform),this.fnMap.exec(this.setTransformCallback,this.transform),this.subscriptions.publish("setTransform",[this.transform])}},{key:"nextMovingFreelyFrame",value:function(t){if(this.state.isMovingFreely){if(null==this.state.movement.previousTime)return void(this.state.movement.previousTime=t);var e=t-this.state.movement.previousTime,n=this.decelerate(e);this.state.movement.velocity=n.velocity,this.state.movement.previousTime=t,this.state.movement.velocity.isZero()&&(this.state.movement.velocity=this.state.movement.velocity.zero(),this.stopMovingFreely("complete")),this.setTransform(n.transform)}}},{key:"clear",value:function(){}},{key:"willStartAnimating",value:function(){return!!this.animations.willStartAnimating()}},{key:"setColor",value:function(t,e){var n=!(1<arguments.length&&void 0!==e)||e;this.color=null!=t?t.slice():[0,0,0,0],n&&(this.defaultColor=this.color.slice())}},{key:"dim",value:function(){this.setColor(this.dimColor,!1)}},{key:"setDimColor",value:function(t){this.dimColor=null!=t?t.slice():[0,0,0,0]}},{key:"undim",value:function(){this.setColor(this.defaultColor,!0)}},{key:"setOpacity",value:function(t){this.opacity=t}},{key:"getScenarioTarget",value:function(t){var e,n,r,i;return null==t?{}:(null!=(i="string"==typeof t?t in this.scenarios?this.scenarios[t]:{}:t).transform&&(e=Oe(i.transform)),null!=i.position&&(null==e&&(e=this.transform._dup()),e.updateTranslation(ne(i.position))),null!=i.rotation&&(null==e&&(e=this.transform._dup()),e.updateRotation(i.rotation)),null!=i.scale&&(null==e&&(e=this.transform._dup()),e.updateScale(ie(i.scale))),i.color&&(n=i.color.slice()),null!=i.isShown&&(r=i.isShown),{transform:e,color:n,isShown:r})}},{key:"setScenario",value:function(t){var e=this.getScenarioTarget(t);null!=e.transform&&this.setTransform(e.transform._dup()),null!=e.isShown&&(e.isShown?this.show():this.hide()),null!=e.color&&this.setColor(e.color)}},{key:"setScenarios",value:function(t){null!=this.scenarios[t]&&this.setScenario(t)}},{key:"saveScenario",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:["transform","color","isShown"],r=this.getCurrentScenario(n);0<Object.keys(r).length&&(this.scenarios[t]=r)}},{key:"getCurrentScenario",value:function(t){var e=this,n={};return(0<arguments.length&&void 0!==t?t:["transform","color","isShown"]).forEach((function(t){"transform"===t?n.transform=e.transform._dup():"position"===t?n.position=e.getPosition():"rotation"===t?n.rotation=e.getRotation():"scale"===t?n.scale=e.getScale():"color"===t?n.color=e.color.slice():"isShown"===t&&(n.isShown=e.isShown)})),n}},{key:"saveScenarios",value:function(t,e){this.saveScenario(t,e)}},{key:"getAllElementsWithScenario",value:function(t){return null!=this.scenarios[t]?[this]:[]}},{key:"getMovingFreelyEnd",value:function(){return this.decelerate(null)}},{key:"getRemainingMovingFreelyTime",value:function(){return this.state.isMovingFreely?this.decelerate(null).duration:0}},{key:"decelerate",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.checkMoveBounds();var n=this.move.bounds,r=this.transform.decelerate(this.state.movement.velocity,this.move.freely.deceleration,e,n,this.move.freely.bounceLoss,this.move.freely.zeroVelocityThreshold);return{velocity:r.velocity,transform:r.transform,duration:r.duration}}},{key:"updateLastDrawTransform",value:function(){var t=this,e=this.lastDrawElementTransformPosition.parentCount,n=this.lastDrawTransform.order.length;this.getTransform().order.forEach((function(r,i){t.lastDrawTransform.order[n-e-i-1]=r._dup()})),this.lastDrawTransform.calcMatrix()}},{key:"getParentLastDrawTransform",value:function(){var t=this.lastDrawElementTransformPosition.parentCount;return new ke(this.lastDrawTransform.order.slice(-t))}},{key:"getPath",value:function(){return null==this.parent||"diagramRoot"===this.parent.name||null==this.parent.parent?this.name:"".concat(this.parent.getPath(),".").concat(this.name)}},{key:"startBeingMoved",value:function(){this.animations.cancelAll("freeze"),this.stopMovingFreely("freeze"),this.state.movement.velocity=this.transform.zero(),this.state.movement.previousTransform=this.transform._dup(),this.state.movement.previousTime=(new sn).now()/1e3,this.state.isBeingMoved=!0,this.unrender(),"recording"===this.recorder.state&&this.recorder.recordEvent("startBeingMoved",[this.getPath()])}},{key:"moved",value:function(t){var e=this.transform._dup();this.setTransform(t._dup());var n=this.move.bounds.getTranslation();n instanceof Ne&&n.boundary.right>n.boundary.left&&n.boundary.top>n.boundary.bottom?this.calcVelocity(e,t):this.calcVelocity(e,this.transform),"recording"===this.recorder.state&&this.recorder.recordEvent("moved",[this.getPath(),this.transform.round(this.recorder.precision)._state()])}},{key:"stopBeingMoved",value:function(){if(this.state.isBeingMoved){var t=(new sn).now()/1e3;null!=this.state.movement.previousTime&&.05<t-this.state.movement.previousTime&&(this.state.movement.velocity=this.transform.zero()),"recording"===this.recorder.state&&this.state.isBeingMoved&&this.recorder.recordEvent("stopBeingMoved",[this.getPath(),this.transform._state(),this.state.movement.velocity._state()]),this.state.isBeingMoved=!1,this.state.movement.previousTime=null}}},{key:"calcVelocity",value:function(t,e){var n=(new sn).now()/1e3;if(null!=this.state.movement.previousTime){var r=n-this.state.movement.previousTime;r<1e-4||(this.state.movement.velocity=e.velocity(t,r,this.move.freely.zeroVelocityThreshold,this.move.maxVelocity),this.state.movement.previousTime=n)}else this.state.movement.previousTime=n}},{key:"simulateStartMovingFreely",value:function(t,e){this.transform=t,this.state.movement.velocity=e,this.startMovingFreely()}},{key:"startMovingFreely",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.animations.cancelAll("freeze"),this.stopBeingMoved(),e&&(this.move.freely.callback=e),this.state.isMovingFreely=!0,this.state.movement.previousTime=(new sn).now()/1e3,this.state.movement.velocity=this.state.movement.velocity.clipMag(this.move.freely.zeroVelocityThreshold,this.move.maxVelocity),"recording"===this.recorder.state&&this.recorder.recordEvent("startMovingFreely",[this.getPath(),this.transform._state(),this.state.movement.velocity._state()])}},{key:"stopMovingFreely",value:function(t){var e=0<arguments.length&&void 0!==t?t:"cancel";if("animateToComplete"!==e){var n=!1;if(!0===this.state.isMovingFreely&&(n=!0),"complete"===e&&n){var r=this.getMovingFreelyEnd();this.setTransform(r.transform)}this.state.isMovingFreely=!1,this.state.movement.previousTime=null,this.move.freely.callback&&(this.fnMap.exec(this.move.freely.callback,e),this.move.freely.callback=null),n&&(this.fnMap.exec(this.animationFinishedCallback),this.animationFinished("movingFreely"),this.subscriptions.publish("stopMovingFreely"))}}},{key:"getRemainingPulseTime",value:function(t){var e=0<arguments.length&&void 0!==t?t:(new sn).now()/1e3;return!1===this.state.isPulsing?0:null==this.state.pulse.startTime?this.pulseSettings.time:this.pulseSettings.time-(e-this.state.pulse.startTime)}},{key:"getPulseTransforms",value:function(t){var e=[];if(this.state.isPulsing){null==this.state.pulse.startTime&&(this.state.pulse.startTime=t);var n=t-this.state.pulse.startTime;n>=this.pulseSettings.time&&0!==this.pulseSettings.time&&(this.stopPulsing("complete"),n=this.pulseSettings.time);for(var r=0;r<this.pulseSettings.num;r+=1){var i=this.fnMap.exec(this.pulseSettings.progression,n,this.pulseSettings.frequency,this.pulseSettings.A instanceof Array?this.pulseSettings.A[r]:this.pulseSettings.A,this.pulseSettings.B instanceof Array?this.pulseSettings.B[r]:this.pulseSettings.B,this.pulseSettings.C instanceof Array?this.pulseSettings.C[r]:this.pulseSettings.C),o=this.fnMap.exec(this.pulseSettings.transformMethod,i,ne(this.pulseSettings.delta));null!=o&&e.push(o)}}return e}},{key:"pulseScaleNow",value:function(t,e,n,r,i,o){var a=2<arguments.length&&void 0!==n?n:0,s=3<arguments.length&&void 0!==r?r:null,l=4<arguments.length&&void 0!==i?i:new se(0,0),u=5<arguments.length&&void 0!==o?o:"tools.math.sinusoid";this.pulseScale({duration:t,scale:e,frequency:a,callback:s,delta:l,progression:u,when:"nextFrame"})}},{key:"pulseScale",value:function(t){var e=st({},{duration:1,scale:2,callback:null,delta:[0,0],when:"sync",progression:"tools.math.sinusoid"},t);(null==e.frequency||0===e.frequency&&0!==e.duration)&&(e.frequency=1/(2*e.duration)),0===e.frequency&&0===e.duration&&(e.frequency=1),this.pulseSettings.time=e.duration,this.pulseSettings.frequency=e.frequency,this.pulseSettings.A=1,this.pulseSettings.B=e.scale-1,this.pulseSettings.C=0,this.pulseSettings.num=1,this.pulseSettings.delta=ne(e.delta),this.pulseSettings.callback=e.callback,this.pulseSettings.progression=e.progression,this.startPulsing(e.when)}},{key:"pulseScaleRelativeToPoint",value:function(t,e,n,r,i,o,a){var s=4<arguments.length&&void 0!==i?i:0,l=5<arguments.length&&void 0!==o?o:null,u=6<arguments.length&&void 0!==a?a:"tools.math.sinusoid",c=this.getPosition(e),h=ne(t).sub(c);this.pulseScaleNow(n,r,s,l,h,u)}},{key:"pulseScaleRelativeToElement",value:function(t,e,n,r,i,o,a,s,l){var u,c=6<arguments.length&&void 0!==a?a:0,h=7<arguments.length&&void 0!==s?s:null,f=8<arguments.length&&void 0!==l?l:"tools.math.sinusoid";u=null==t?this.getPositionInBounds(r,e,n):t.getPositionInBounds(r,e,n),this.pulseScaleRelativeToPoint(u,r,i,o,c,h,f)}},{key:"pulseScaleRelativeTo",value:function(e,n,r,i,o,a,s,l,u){var c=6<arguments.length&&void 0!==s?s:0,h=7<arguments.length&&void 0!==l?l:null,f=8<arguments.length&&void 0!==u?u:"tools.math.sinusoid";null==e||e instanceof t?this.pulseScaleRelativeToElement(e,n,r,i,o,a,c,h,f):this.pulseScaleRelativeToPoint(e,i,o,a,c,h,f)}},{key:"pulseThickNow",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:3,o=3<arguments.length&&void 0!==r?r:null,a=[e];if(this.pulseSettings.num=i,1<this.pulseSettings.num){var s=Math.abs(1-e),l=s,u=(l- -s)/(this.pulseSettings.num-1);a=[];for(var c=0;c<this.pulseSettings.num;c+=1)a.push(l-c*u)}this.pulseSettings.time=t,this.pulseSettings.frequency=1/(2*t),this.pulseSettings.A=1,this.pulseSettings.B=a,this.pulseSettings.C=0,this.pulseSettings.callback=o,this.startPulsing()}},{key:"pulseThick",value:function(t){var e=st({},{duration:1,scale:2,callback:null,when:"sync",num:3},t),n=[e.scale];if(this.pulseSettings.num=e.num,1<this.pulseSettings.num){var r=Math.abs(1-e.scale),i=r,o=(i- -r)/(this.pulseSettings.num-1);n=[];for(var a=0;a<this.pulseSettings.num;a+=1)n.push(i-a*o)}this.pulseSettings.time=e.duration,this.pulseSettings.frequency=1/(2*e.duration),this.pulseSettings.A=1,this.pulseSettings.B=n,this.pulseSettings.C=0,this.pulseSettings.callback=e.callback,this.startPulsing(e.when)}},{key:"startPulsing",value:function(t){var e=0<arguments.length&&void 0!==t?t:"nextFrame";this.state.isPulsing=!0;var n=(new sn).getWhen(e);this.state.pulse.startTime=null==n?n:n/1e3,this.unrender(),this.frozenPulseTransforms=[]}},{key:"stopPulsing",value:function(t){var e=0<arguments.length&&void 0!==t?t:"cancel",n=this.state.isPulsing;if("animateToComplete"!==e){if("freeze"===e&&this.state.isPulsing&&(this.frozenPulseTransforms=this.pulseTransforms.map((function(t){return t._dup()})),this.pulseTransforms=[]),"cancel"!==e&&"complete"!==e||(this.pulseTransforms=[]),this.state.isPulsing=!1,this.pulseSettings.num=1,this.pulseSettings.callback){var r=this.pulseSettings.callback;this.pulseSettings.callback=null,this.fnMap.exec(r,e)}n&&(this.animationFinished("pulse"),this.subscriptions.publish("stopPulsing"))}}},{key:"stop",value:function(t){function e(){--i<=0&&(n.state.preparingToStop=!1,n.subscriptions.publish("stopped"))}var n=this,r=0<arguments.length&&void 0!==t?t:"cancel",i=0;"animateToComplete"!==r&&"dissolveToComplete"!==r||(this.animations.isAnimating()&&(this.state.preparingToStop=!0,i+=1,this.animations.subscriptions.add("finished",e,1)),this.state.isPulsing&&(this.state.preparingToStop=!0,i+=1,this.subscriptions.add("stopPulsing",e,1)),this.state.isMovingFreely&&(this.state.preparingToStop=!0,i+=1,this.subscriptions.add("stopMovingFreely",e,1))),this.state.preparingToStop&&this.subscriptions.publish("preparingToStop"),this.stopAnimating(r),this.stopMovingFreely(r),this.stopBeingMoved(),this.stopPulsing(r)}},{key:"stopAnimating",value:function(t){var e=0<arguments.length&&void 0!==t?t:"cancel";"freeze"===e?this.animations.cancelAll("freeze"):"cancel"===e?this.animations.cancelAll(null):"complete"===e&&this.animations.cancelAll("complete")}},{key:"updateLimits",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:this.diagramTransforms;this.diagramLimits=t,this.diagramTransforms=n}},{key:"resize",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;e&&this.tieToHTML.updateOnResize&&this.updateHTMLElementTie(e)}},{key:"getVertexSpaceBoundaries",value:function(){return[[]]}},{key:"getGLBoundaries",value:function(){return[[]]}},{key:"getLocalBoundaries",value:function(){return[[]]}},{key:"getDiagramBoundaries",value:function(){return[[]]}},{key:"getBoundaries",value:function(t){var e=0<arguments.length&&void 0!==t?t:"local";return"local"===e?this.getLocalBoundaries():"diagram"===e?this.getDiagramBoundaries():"vertex"===e?this.getVertexSpaceBoundaries():"gl"===e?this.getGLBoundaries():[[]]}},{key:"getGLBoundingRect",value:function(){return new oe(0,0,1,1)}},{key:"getLocalBoundingRect",value:function(){return new oe(0,0,1,1)}},{key:"getVertexSpaceBoundingRect",value:function(){return new oe(0,0,1,1)}},{key:"getDiagramBoundingRect",value:function(){var t=this.getGLBoundingRect(),e=Pe({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}}),n=new se(t.left,t.bottom).transformBy(e.matrix()),r=new se(t.right,t.top).transformBy(e.matrix());return new oe(n.x,n.y,r.x-n.x,r.y-n.y)}},{key:"getBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:"local";return"local"===e?this.getLocalBoundingRect():"diagram"===e?this.getDiagramBoundingRect():"vertex"===e?this.getVertexSpaceBoundingRect():"gl"===e?this.getGLBoundingRect():new oe(0,0,1,1)}},{key:"getRelativeBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:"local",n=this.getBoundingRect(e),r=this.getPosition(e);return new oe(n.left-r.x,n.bottom-r.y,n.width,n.height)}},{key:"getRelativeGLBoundingRect",value:function(){return new oe(0,0,1,1)}},{key:"getRelativeDiagramBoundingRect",value:function(){var t=this.getRelativeGLBoundingRect(),e=Pe({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}}),n=new se(t.left,t.bottom).transformBy(e.matrix()),r=new se(t.right,t.top).transformBy(e.matrix());return new oe(n.x,n.y,r.x-n.x,r.y-n.y)}},{key:"getCenterDiagramPosition",value:function(){var t=this.getDiagramBoundingRect();return new se(t.left+t.width/2,t.bottom+t.height/2)}},{key:"getScale",value:function(){var t=this.transform.s(),e=new se(0,0);return null!=t&&(e=t._dup()),e}},{key:"getRotation",value:function(t){var e=0<arguments.length&&void 0!==t?t:"",n=this.transform.r(),r=0;return null!=n&&(r=n),""!==e&&null!=n&&(r=Jt(n,e)),r}},{key:"getVertexSpaceDiagramPosition",value:function(t){var e=t.transformBy(this.lastDrawTransform.matrix()),n=Pe({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}});return e.transformBy(n.matrix())}},{key:"getLocalPosition",value:function(){var t=this.transform.t(),e=new se(0,0);return null!=t&&(e=t._dup()),e}},{key:"getPositionInBounds",value:function(t,e,n){var r=0<arguments.length&&void 0!==t?t:"local",i=1<arguments.length?e:void 0,o=2<arguments.length?n:void 0,a=this.getBoundingRect(r),s=this.getPosition(r);return"left"===i?s.x=a.left:"right"===i?s.x=a.right:"center"===i?s.x=a.left+a.width/2:"number"==typeof i&&(s.x=a.left+a.width*i),"top"===o?s.y=a.top:"bottom"===o?s.y=a.bottom:"middle"===o?s.y=a.bottom+a.height/2:"number"==typeof o&&(s.y=a.bottom+a.height*o),s}},{key:"getPosition",value:function(t,e,n){var r=0<arguments.length&&void 0!==t?t:"local",i=1<arguments.length&&void 0!==e?e:"origin",o=2<arguments.length&&void 0!==n?n:"origin";return"origin"===i&&"origin"===o||this.getPositionInBounds(r,i,o),"vertex"===r?new se(0,0):"local"===r?this.getLocalPosition():"diagram"===r?this.getVertexSpaceDiagramPosition(new se(0,0)):"gl"===r?new se(0,0).transformBy(this.lastDrawTransform.matrix()):new se(0,0)}},{key:"getPixelToVertexSpaceScale",value:function(){var t=this.diagramTransforms.pixelToDiagram.matrix(),e=this.diagramSpaceToVertexSpaceTransformMatrix(),n=t[0]*e[0],r=t[4]*e[4];return new se(n,r)}},{key:"getVertexToPixelSpaceScale",value:function(){var t=this.getPixelToVertexSpaceScale();return new se(1/t.x,1/t.y)}},{key:"getDiagramPositionInVertexSpace",value:function(t){return t.transformBy(this.diagramSpaceToVertexSpaceTransformMatrix())}},{key:"diagramSpaceToVertexSpaceTransformMatrix",value:function(){return Nt(new ke(this.lastDrawTransform.order.slice(this.lastDrawElementTransformPosition.elementCount,this.lastDrawTransform.order.length-2)).matrix())}},{key:"vertexToDiagramSpaceTransformMatrix",value:function(){return new ke(this.lastDrawTransform.order.slice(0,this.lastDrawTransform.order.length-2)).matrix()}},{key:"setDiagramPosition",value:function(t){var e=Pe({x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}},{x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}}),n=t.transformBy(e.matrix()),r=new ke(this.lastDrawTransform.order.slice(this.transform.order.length)),i=n.transformBy(Nt(r.matrix()));this.setPosition(i._dup())}},{key:"setDiagramPositionToElement",value:function(t){var e=t.getPosition("diagram");this.setDiagramPosition(e._dup())}},{key:"setPositionToElement",value:function(t,e){if("local"!==(1<arguments.length&&void 0!==e?e:"local")){var n=this.getPosition("diagram"),r=this.getPosition("local"),i=t.getPosition("diagram").sub(n);this.setPosition(r.add(i))}else{var o=t.transform.t();null!=o&&this.setPosition(o._dup())}}},{key:"checkMoveBounds",value:function(){"diagram"!==this.move.bounds?this.move.bounds instanceof Ue||this.setMoveBounds():this.setMoveBounds("diagram",!0)}},{key:"setMoveBounds",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:null,r=1<arguments.length&&void 0!==e&&e;if(this.isMovable){if(n instanceof Ue)this.move.bounds=n;else if(null===n)this.move.bounds=new Ue(this.transform);else if("diagram"===n)this.move.bounds instanceof Ue||(this.move.bounds=new Ue(this.transform)),this.move.bounds.updateTranslation(new Ne({left:this.diagramLimits.left,bottom:this.diagramLimits.bottom,right:this.diagramLimits.right,top:this.diagramLimits.top}));else{var i=He(n,"transform",this.transform);i instanceof Ue&&(this.move.bounds=i)}if(r){var o=this.getRelativeBoundingRect("diagram"),a=this.move.bounds.getTranslation();null!=a&&(a.boundary.left-=o.left,a.boundary.bottom-=o.bottom,a.boundary.right-=o.right,a.boundary.top-=o.top,this.move.bounds.updateTranslation(a))}}}},{key:"show",value:function(){this.isShown=!0,this.setOpacity(1),null!=this.parent&&(this.parent.isShown||this.parent.show())}},{key:"makeTouchable",value:function(t){0<arguments.length&&void 0!==t&&!t?this.hasTouchableElements=!0:this.isTouchable=!0,null!=this.parent&&this.parent.makeTouchable(!1)}},{key:"setMovable",value:function(t){0<arguments.length&&void 0!==t&&!t?(this.isMovable=!1,this.isTouchable=!1):(this.isMovable=!0,this.makeTouchable(!0))}},{key:"clearRender",value:function(){var t,e="";if("string"==typeof this.tieToHTML.element&&(e=this.tieToHTML.element,t=document.getElementById(this.tieToHTML.element)),t){var n=document.getElementById("".concat(e,"_webgl"));null!=n&&(n.style.display="none");var r=document.getElementById("".concat(e,"_2d"));null!=r&&(r.style.display="none")}}},{key:"setRenderedOnNextDraw",value:function(){this.renderedOnNextDraw=!0}},{key:"unrender",value:function(){this.isRenderedAsImage&&(this.unrenderNextDraw=!0,this.isRenderedAsImage=!1),null!=this.parent&&this.parent.unrender()}},{key:"showAll",value:function(){this.show()}},{key:"hide",value:function(){this.isShown=!1}},{key:"hideAll",value:function(){this.hide()}},{key:"toggleShow",value:function(){this.isShown?this.hide():this.show()}},{key:"click",value:function(){null!==this.onClick&&void 0!==this.onClick&&("recording"===this.recorder.state&&this.recorder.recordEvent("elementClick",[this.getPath()]),this.fnMap.exec(this.onClick,this))}},{key:"getTransform",value:function(){return this.transform}},{key:"isMoving",value:function(){return!(!1===this.isShown||!this.isAnimating()&&!this.state.isBeingMoved)}},{key:"isAnimating",value:function(){return!1!==this.isShown&&!!(this.state.isMovingFreely||this.state.isPulsing||this.animations.isAnimating())}},{key:"isAnyElementMoving",value:function(){return this.isMoving()}}]),t}(),Wo=function(){To(e,Fo);var t=ko(e);function e(n){var r,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ke,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[.5,.5,.5,1],a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new oe(-1,-1,2,2),s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return Do(this,e),(r=t.call(this,i,a,s)).drawingObject=n,r.color=null!=o?o.slice():[0,0,0,0],r.defaultColor=r.color.slice(),r.dimColor=[.5,.5,.5,1],r.pointsToDraw=-1,r.angleToDraw=-1,r.lengthToDraw=-1,r.cannotTouchHole=!1,r.type="primitive",r.pointsDefinition={},r.setPointsFromDefinition=null,r}return Bo(e,[{key:"_getStateProperties",value:function(t){var n=t.ignoreShown;return null==n&&(n=!1),this.isShown||n?[].concat(Po(_o(Oo(e.prototype),"_getStateProperties",this).call(this,t)),["pointsToDraw","angleToDraw","lengthToDraw","cannotTouchHole","drawingObject","pointsDefinition"]):_o(Oo(e.prototype),"_getStateProperties",this).call(this,t)}},{key:"setAngleToDraw",value:function(t){var e=0<arguments.length&&void 0!==t?t:-1;this.angleToDraw=e}},{key:"isBeingTouched",value:function(t){if(!this.isTouchable)return!1;for(var e=this.drawingObject.getGLBoundaries(this.lastDrawTransform.matrix()),n=this.drawingObject.getGLBoundaryHoles(this.lastDrawTransform.matrix()),r=0;r<e.length;r+=1){var i=e[r];if(t.isInPolygon(i)){var o=!0;if(this.cannotTouchHole)for(var a=0;a<n.length;a+=1){var s=n[a];Array.isArray(s)&&2<s.length&&t.isInPolygon(s)&&(o=!1,a=n.length)}if(o)return!0}}return!1}},{key:"_dup",value:function(t){var n=0<arguments.length&&void 0!==t?t:null,r=new e(this.drawingObject._dup());return lt(this,r,["parent","diagram","recorder"]),null!=n&&(r.transform=n._dup()),r.recorder=this.recorder,r}},{key:"clear",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;this.drawingObject instanceof So&&this.drawingObject.clear(e)}},{key:"resize",value:function(t){var n=0<arguments.length&&void 0!==t?t:null;if(this.resizeHtmlObject(),_o(Oo(e.prototype),"resize",this).call(this,n),"vertexText"===this.drawingObject.type){var r=this.getPixelToVertexSpaceScale();this.drawingObject.drawTextIntoBuffer(new se(r.x,Math.abs(r.y)))}}},{key:"setColor",value:function(t,n){var r=!(1<arguments.length&&void 0!==n)||n;this.color=null!=t?t.slice():[0,0,0,0],r&&(this.defaultColor=this.color.slice()),this instanceof e&&(this.drawingObject instanceof So&&this.drawingObject.setColor(this.color),this.drawingObject instanceof eo&&(this.drawingObject.element.style.color=Cn(this.color)))}},{key:"setOpacity",value:function(t){this.opacity=t,this instanceof e&&(this.drawingObject instanceof So&&this.drawingObject.setOpacity(t),this.drawingObject instanceof eo&&(this.drawingObject.element.style.opacity="".concat(t)))}},{key:"show",value:function(){_o(Oo(e.prototype),"show",this).call(this),this.drawingObject instanceof eo&&(this.drawingObject.show=!0,this.drawingObject.transformHtml(this.lastDrawTransform.matrix()))}},{key:"hide",value:function(){_o(Oo(e.prototype),"hide",this).call(this),this.drawingObject instanceof eo&&(this.drawingObject.show=!1,this.drawingObject.transformHtml(this.lastDrawTransform.matrix()))}},{key:"getTouched",value:function(t){return this.isTouchable&&this.isBeingTouched(t)?[this]:[]}},{key:"setFont",value:function(t){this.drawingObject instanceof So&&this.drawingObject.setFont(t)}},{key:"resizeHtmlObject",value:function(){this.drawingObject instanceof eo&&this.drawingObject.transformHtml(this.lastDrawTransform.matrix())}},{key:"setupDraw",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;if(this.isShown){if(this.lastDrawTime=e,!0===this.isRenderedAsImage){if(!this.willStartAnimating())return;this.unrender()}this.subscriptions.publish("beforeDraw",[e]),null!=this.beforeDrawCallback&&this.fnMap.exec(this.beforeDrawCallback,e),this.animations.nextFrame(e),this.nextMovingFreelyFrame(e)}}},{key:"draw",value:function(t,e,n,r){var i=this,o=1<arguments.length&&void 0!==e?e:[new ke],a=2<arguments.length&&void 0!==n?n:1,s=3<arguments.length&&void 0!==r?r:0;if(this.isShown){var l=-1;this.drawingObject instanceof so?(l=this.drawingObject.numPoints,-1!==this.angleToDraw&&(l=this.drawingObject.getPointCountForAngle(this.angleToDraw)),-1!==this.lengthToDraw&&(l=this.drawingObject.getPointCountForLength(this.lengthToDraw)),-1!==this.pointsToDraw&&(l=this.pointsToDraw)):l=1;var u=[].concat(Po(this.color.slice(0,3)),[this.color[3]*this.opacity*a]);this.lastDrawOpacity=u[3];var c=this.getTransform(),h=Io(o,[c]);this.lastDrawElementTransformPosition={parentCount:o[0].order.length,elementCount:this.transform.order.length},this.pulseTransforms=this.getPulseTransforms(t),this.drawTransforms=this.getDrawTransforms(h),this.lastDrawTransform=o[0].transform(c),this.lastDrawPulseTransform=this.drawTransforms[0],0<l&&this.drawTransforms.forEach((function(t){i.drawingObject.drawWithTransformMatrix(t.matrix(),u,s,l)})),this.unrenderNextDraw&&(this.clearRender(),this.unrenderNextDraw=!1),this.renderedOnNextDraw&&(this.isRenderedAsImage=!0,this.renderedOnNextDraw=!1),this.subscriptions.publish("afterDrawDraw",[t]),null!=this.afterDrawCallback&&this.fnMap.exec(this.afterDrawCallback,t)}}},{key:"setFirstTransform",value:function(t){var e=0<arguments.length&&void 0!==t?t:new ke;this.lastDrawElementTransformPosition={parentCount:e.order.length,elementCount:this.transform.order.length};var n=e.transform(this.getTransform());this.lastDrawTransform=n,this.drawingObject instanceof eo&&this.drawingObject.transformHtml(n.matrix()),this.checkMoveBounds()}},{key:"getVertexSpaceBoundaries",value:function(){return this.drawingObject.border}},{key:"getLocalBoundaries",value:function(){return this.drawingObject.getGLBoundaries(this.getTransform().matrix())}},{key:"getDiagramBoundaries",value:function(){return this.drawingObject.getGLBoundaries(this.vertexToDiagramSpaceTransformMatrix())}},{key:"getGLBoundaries",value:function(){return this.drawingObject.getGLBoundaries(this.lastDrawTransform.matrix())}},{key:"getVertexSpaceBoundingRect",value:function(){return this.drawingObject.getVertexSpaceBoundingRect()}},{key:"getLocalBoundingRect",value:function(){return this.drawingObject.getGLBoundingRect(this.getTransform().matrix())}},{key:"getGLBoundingRect",value:function(){return this.drawingObject.getGLBoundingRect(this.lastDrawTransform.matrix())}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){return this.drawingObject.getRelativeVertexSpaceBoundingRect()}},{key:"getRelativeGLBoundingRect",value:function(){return this.drawingObject.getRelativeGLBoundingRect(this.lastDrawTransform.matrix())}},{key:"getRelativeLocalBoundingRect",value:function(){return this.drawingObject.getRelativeGLBoundingRect(this.getTransform().matrix())}},{key:"increaseBorderSize",value:function(t,e){var n,r,i=0<arguments.length&&void 0!==t?t:1,o=1<arguments.length&&void 0!==e?e:null;if(r=i instanceof se?(n=i.x,i.y):(n=i,null==o?n:o),this.drawingObject instanceof so)for(var a=0;a<this.drawingObject.border.length;a+=1)for(var s=this.drawingObject.border[a],l=0;l<s.length;l+=1)s[l].x*=n,s[l].y*=r}}]),e}(),qo=function(){To(e,Fo);var t=ko(e);function e(){var n,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new ke,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new oe(-1,1,2,2),o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Do(this,e),(n=t.call(this,r,i,o)).elements={},n.drawOrder=[],n.touchInBoundingRect=!1,n.eqns={},n.type="collection",n}return Bo(e,[{key:"_getStateProperties",value:function(t){var n=t.ignoreShown;return null==n&&(n=!1),this.isShown||n?[].concat(Po(_o(Oo(e.prototype),"_getStateProperties",this).call(this,t)),["touchInBoundingRect","elements","hasTouchableElements"]):[].concat(Po(_o(Oo(e.prototype),"_getStateProperties",this).call(this,t)),["elements"])}},{key:"_getStatePropertiesMin",value:function(){return[].concat(Po(_o(Oo(e.prototype),"_getStatePropertiesMin",this).call(this)),["elements"])}},{key:"_dup",value:function(t){var n=0<arguments.length&&void 0!==t?t:[],r=new e,i=this.drawOrder.map((function(t){return"_".concat(t)}));lt(this,r,["elements","drawOrder","parent","recorder","diagram","shapes","objects","equation"].concat(Po(i),Po(n)));for(var o=0;o<this.drawOrder.length;o+=1){var a=this.drawOrder[o];r.add(a,this.elements[a]._dup())}return r.recorder=this.recorder,r}},{key:"toFront",value:function(t){var e=[];t.forEach((function(t){"string"==typeof t?e.push(t):e.push(t.name)}));var n=[];this.drawOrder.forEach((function(t){-1===e.indexOf(t)&&n.push(t)})),this.drawOrder=[].concat(n,e)}},{key:"toBack",value:function(t){var e=[];t.forEach((function(t){"string"==typeof t?e.push(t):e.push(t.name)}));var n=[];this.drawOrder.forEach((function(t){-1===e.indexOf(t)&&n.push(t)})),this.drawOrder=[].concat(Po(e.reverse()),n)}},{key:"isAnyElementMoving",value:function(){if(!1===this.isShown)return!1;if(this.isMoving())return!0;for(var t=0;t<this.drawOrder.length;t+=1)if(this.elements[this.drawOrder[t]].isAnyElementMoving())return!0;return!1}},{key:"add",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:-1;(e.parent=this).elements[t]=e,this.elements[t].name=t,this["_".concat(t)]=this.elements[t],-1!==r?this.drawOrder=[].concat(Po(this.drawOrder.slice(0,r)),[t],Po(this.drawOrder.slice(r))):this.drawOrder.push(t)}},{key:"willStartAnimating",value:function(){if(_o(Oo(e.prototype),"willStartAnimating",this).call(this))return!0;for(var t=0,n=this.drawOrder.length;t<n;t+=1)if(this.elements[this.drawOrder[t]].willStartAnimating())return!0;return!1}},{key:"setupDraw",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:0,r=1<arguments.length&&void 0!==e?e:0;if(this.isShown){if(this.lastDrawTime=n,!0===this.isRenderedAsImage){if(!this.willStartAnimating())return;this.unrender()}if(null!=this.beforeDrawCallback&&this.fnMap.exec(this.beforeDrawCallback,n),this.animations.nextFrame(n),this.nextMovingFreelyFrame(n),!this.isShown)return;for(var i=0,o=this.drawOrder.length;i<o;i+=1)this.elements[this.drawOrder[i]].setupDraw(n,r)}}},{key:"draw",value:function(t,e,n,r){var i=1<arguments.length&&void 0!==e?e:[new ke],o=2<arguments.length&&void 0!==n?n:1,a=3<arguments.length&&void 0!==r?r:0;if(this.isShown){this.lastDrawElementTransformPosition={parentCount:i[0].order.length,elementCount:this.transform.order.length};var s=this.getTransform(),l=Io(i,[s]);this.lastDrawTransform=i[0].transform(s),this.pulseTransforms=this.getPulseTransforms(t),this.drawTransforms=this.getDrawTransforms(l),this.lastDrawPulseTransform=this.drawTransforms[0];var u=this.color[3]*this.opacity*o;this.lastDrawOpacity=u;for(var c=0,h=this.drawOrder.length;c<h;c+=1)this.elements[this.drawOrder[c]].draw(t,this.drawTransforms,u,a);this.unrenderNextDraw&&(this.clearRender(),this.unrenderNextDraw=!1),this.renderedOnNextDraw&&(this.isRenderedAsImage=!0,this.renderedOnNextDraw=!1),null!=this.afterDrawCallback&&this.fnMap.exec(this.afterDrawCallback,t)}}},{key:"exec",value:function(t,n){var r=this,i=1<arguments.length&&void 0!==n?n:null;null!=i?Array.isArray(i)&&0===i.length||i.forEach((function(e){var n;null!=(n="string"==typeof e?r.getElement(e):e)&&n.exec(t)})):_o(Oo(e.prototype),"exec",this).call(this,t)}},{key:"pulse",value:function(t,n){var r=this,i=0<arguments.length&&void 0!==t?t:null,o=1<arguments.length&&void 0!==n?n:null;if(null!=i&&"function"!=typeof i&&"string"!=typeof i){var a={frequency:0,time:1,scale:2};"function"!=typeof this.pulseDefault&&"string"!=typeof this.pulseDefault&&(a.frequency=this.pulseDefault.frequency,a.time=this.pulseDefault.time,a.scale=this.pulseDefault.scale);var s,l,u,c={x:"center",y:"middle",space:"diagram",centerOn:null,frequency:a.frequency,time:a.time,scale:a.scale,done:null,elements:null,progression:"tools.math.sinusoid"};if(Array.isArray(i)?(l=c,s=o,u=i):(l=st({},c,i),u=l.elements,s=l.done,null==i.scale&&(l.scale=void 0),null==i.frequency&&(l.frequency=void 0),null==i.time&&(l.time=void 0)),(l.elements=null)!=u&&0!==u.length){var h=0;l.done=function(){(h+=1)===u.length&&null!=s&&s()},u.forEach((function(t){var e;null!=(e="string"==typeof t?r.getElement(t):t)&&e.pulse(l)}))}else _o(Oo(e.prototype),"pulse",this).call(this,i)}else _o(Oo(e.prototype),"pulse",this).call(this,i)}},{key:"getElement",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return null==t?this:"string"!=typeof t?t:function t(e,n){var r=e.split("."),i=n.elements[r[0]];return null==i&&(i=n[r[0]]),null==i?null:1<r.length?t(r.slice(1).join("."),i):i}(t,this)}},{key:"getElements",value:function(t){var e=this,n=[];return t.forEach((function(t){var r=e.getElement(t);null!=r&&n.push(r)})),n}},{key:"show",value:function(t){var n=0<arguments.length&&void 0!==t?t:[];_o(Oo(e.prototype),"show",this).call(this),n.forEach((function(t){t instanceof e?t.showAll():t.show()}))}},{key:"hide",value:function(t){var n=0<arguments.length&&void 0!==t?t:[];_o(Oo(e.prototype),"hide",this).call(this),n.forEach((function(t){t instanceof e?t.hideAll():t.show()}))}},{key:"showAll",value:function(){this.show();for(var t=0,e=this.drawOrder.length;t<e;t+=1){var n=this.elements[this.drawOrder[t]];n.show(),"function"==typeof n.hideAll&&n.showAll()}}},{key:"hideAll",value:function(){this.hide();for(var t=0,e=this.drawOrder.length;t<e;t+=1){var n=this.elements[this.drawOrder[t]];n.hide(),"function"==typeof n.hideAll&&n.hideAll()}}},{key:"showOnly",value:function(t){this.hideAll(),this.show();for(var e=0,n=t.length;e<n;e+=1){var r=t[e];if(!r)throw Error("Diagram Element Error: Element does not exist at position ".concat(e));r.show()}}},{key:"hideOnly",value:function(t){this.showAll();for(var e=0,n=t.length;e<n;e+=1)t[e].hide()}},{key:"isBeingTouched",value:function(t){if(!this.isTouchable)return!1;if(this.touchInBoundingRect){var e=this.getGLBoundingRect();if(t.x>=e.left&&t.x<=e.right&&t.y<=e.top&&t.y>=e.bottom)return!0}for(var n=0,r=this.drawOrder.length;n<r;n+=1){var i=this.elements[this.drawOrder[n]];if(!0===i.isShown&&i.isBeingTouched(t))return!0}return!1}},{key:"resizeHtmlObject",value:function(){for(var t=0;t<this.drawOrder.length;t+=1)this.elements[this.drawOrder[t]].resizeHtmlObject()}},{key:"resize",value:function(t){var n=0<arguments.length&&void 0!==t?t:null;_o(Oo(e.prototype),"resize",this).call(this,n);for(var r=0;r<this.drawOrder.length;r+=1)this.elements[this.drawOrder[r]].resize(n)}},{key:"clear",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].clear(e)}},{key:"setFirstTransform",value:function(t){var e=(0<arguments.length&&void 0!==t?t:new ke).transform(this.getTransform());this.lastDrawTransform=e;for(var n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].setFirstTransform(e);this.checkMoveBounds()}},{key:"getAllBoundaries",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:"local",n=[],r=0;r<this.drawOrder.length;r+=1){var i=this.elements[this.drawOrder[r]];if(i.isShown){var o=i.getBoundaries(e);n=n.concat(o)}}return n}},{key:"getBoundaries",value:function(t,e){var n=this,r=0<arguments.length&&void 0!==t?t:"local",i=1<arguments.length&&void 0!==e?e:null,o=[];return null==i?this.getAllBoundaries(r):(i.forEach((function(t){var e=n.getElement(t);if(null!=e){var i=e.getBoundaries(r);o=o.concat(i)}})),o)}},{key:"getGLBoundaries",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];if(n.isShown){var r=n.getGLBoundaries();t=t.concat(r)}}return t}},{key:"getVertexSpaceBoundaries",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];if(n.isShown){var r=n.getVertexSpaceBoundaries();t=t.concat(r)}}return t}},{key:"getPositionInBounds",value:function(t,e,n,r){var i=0<arguments.length&&void 0!==t?t:"local",o=1<arguments.length?e:void 0,a=2<arguments.length?n:void 0,s=3<arguments.length&&void 0!==r?r:null,l=this.getBoundingRect(i,s),u=this.getPosition(i);return"left"===o?u.x=l.left:"right"===o?u.x=l.right:"center"===o?u.x=l.left+l.width/2:"number"==typeof o&&(u.x=l.left+l.width*o),"top"===a?u.y=l.top:"bottom"===a?u.y=l.bottom:"middle"===a?u.y=l.bottom+l.height/2:"number"==typeof a&&(u.y=l.bottom+l.height*a),u}},{key:"getBoundingRect",value:function(t,e){var n=this,r=0<arguments.length&&void 0!==t?t:"local",i=1<arguments.length&&void 0!==e?e:null;if(null==i)return Re(this.getBoundaries(r));var o=[];return i.forEach((function(t){var e=n.getElement(t);if(null!=e){var r=e.getBoundingRect();o.push(new se(r.left,r.bottom)),o.push(new se(r.right,r.top))}})),Re(o)}},{key:"getGLBoundingRect",value:function(){return Re(this.getGLBoundaries())}},{key:"getVertexSpaceBoundingRect",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:null;if(null==n)return Re(this.getVertexSpaceBoundaries());var r=[];return n.forEach((function(t){var n=e.getElement(t);if(null!=n){var i=n.getBoundingRect();r.push(new se(i.left,i.bottom)),r.push(new se(i.right,i.top))}})),Re(r)}},{key:"getRelativeGLBoundingRect",value:function(){var t=this.getGLBoundingRect(),e=new se(0,0).transformBy(this.lastDrawTransform.matrix());return new oe(t.left-e.x,t.bottom-e.y,t.width,t.height)}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){var t=this.getVertexSpaceBoundingRect(),e=new se(0,0);return new oe(t.left-e.x,t.bottom-e.y,t.width,t.height)}},{key:"updateLimits",value:function(t,e){for(var n=1<arguments.length&&void 0!==e?e:this.diagramTransforms,r=0;r<this.drawOrder.length;r+=1)this.elements[this.drawOrder[r]].updateLimits(t,n);this.diagramLimits=t,this.diagramTransforms=n}},{key:"updateHTMLElementTie",value:function(t){_o(Oo(e.prototype),"updateHTMLElementTie",this).call(this,t);for(var n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].updateHTMLElementTie(t)}},{key:"getTouched",value:function(t){if(!this.isTouchable&&!this.hasTouchableElements)return[];var e=[];(this.touchInBoundingRect||this.isTouchable)&&this.isBeingTouched(t)&&e.push(this);for(var n=this.drawOrder.length-1;0<=n;--n){var r=this.elements[this.drawOrder[n]];!0===r.isShown&&(e=e.concat(r.getTouched(t)))}return e}},{key:"stop",value:function(t,n){var r=0<arguments.length&&void 0!==t?t:"cancel",i=1<arguments.length&&void 0!==n&&n;if(_o(Oo(e.prototype),"stop",this).call(this,r),!i)for(var o=0;o<this.drawOrder.length;o+=1)this.elements[this.drawOrder[o]].stop(r,i)}},{key:"setFont",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setFont(t)}},{key:"setColor",value:function(t,e){for(var n=0<arguments.length&&void 0!==t?t:[0,0,0,1],r=!(1<arguments.length&&void 0!==e)||e,i=null!=n?n:[0,0,0,0],o=0;o<this.drawOrder.length;o+=1)this.elements[this.drawOrder[o]].setColor(i,r);this.color=i.slice(),r&&(this.defaultColor=this.color.slice())}},{key:"setDimColor",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:[0,0,0,1],n=null!=e?e:[0,0,0,0],r=0;r<this.drawOrder.length;r+=1)this.elements[this.drawOrder[r]].setDimColor(n);this.dimColor=n.slice()}},{key:"undim",value:function(){this.color=this.defaultColor.slice();for(var t=0;t<this.drawOrder.length;t+=1)this.elements[this.drawOrder[t]].undim()}},{key:"dim",value:function(t){if(null==t||Array.isArray(t)&&0===t.length){this.color=this.dimColor.slice();for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].dim()}else this.exec("dim",t)}},{key:"highlight",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;null!=e?Array.isArray(e)&&0===e.length||(this.dim(),this.exec("undim",e)):this.undim()}},{key:"getDiagramBoundingRect",value:function(t){var n=this,r=0<arguments.length&&void 0!==t?t:null;if(null==r)return _o(Oo(e.prototype),"getDiagramBoundingRect",this).call(this);var i=[];return r.forEach((function(t){var e;if(null!=(e="string"==typeof t?n.getElement(t):t)){var r=e.getDiagramBoundingRect();i.push(new se(r.left,r.bottom)),i.push(new se(r.right,r.top))}})),Re(i)}},{key:"setOpacity",value:function(t){this.opacity=t}},{key:"getElementTransforms",value:function(){for(var t={},e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];t[n.name]=n.transform._dup()}return t}},{key:"setElementTransforms",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];n.name in t&&(n.transform=t[n.name],n.internalSetTransformCallback&&this.fnMap.exec(n.internalSetTransformCallback,n.transform))}}},{key:"reorder",value:function(){var t=this;this.drawOrder.sort((function(e,n){var r=t.elements[e];return t.elements[n].drawPriority-r.drawPriority}));for(var n=0;n<this.drawOrder.length;n+=1){var r=this.elements[this.drawOrder[n]];r instanceof e&&r.reorder()}}},{key:"animateToTransforms",value:function(t,e,n,r,i,o){for(var a=1<arguments.length&&void 0!==e?e:1,s=2<arguments.length&&void 0!==n?n:0,l=3<arguments.length&&void 0!==r?r:0,u=5<arguments.length&&void 0!==o?o:"tools.math.easeinout",c=4<arguments.length&&void 0!==i?i:null,h=0,f=0;f<this.drawOrder.length;f+=1){var d=this.elements[this.drawOrder[f]];d.name in t&&(d.isShown?t[d.name].isEqualTo(d.transform)||(d.animations.new().delay(s).transform({target:t[d.name],duration:a,rotDirection:l,progression:u,onFinish:c}).start(),c=null,h=a+s):(d.transform=t[d.name]._dup(),d.internalSetTransformCallback&&this.fnMap.exec(d.internalSetTransformCallback,d.transform)))}return 0===h&&null!=c&&this.fnMap.exec(c,!0),h}},{key:"getAllPrimitives",value:function(){for(var t=[],n=0;n<this.drawOrder.length;n+=1){var r=this.elements[this.drawOrder[n]];r instanceof e?t=[].concat(Po(t),Po(r.getAllPrimitives())):t.push(r)}return t}},{key:"getAllElements",value:function(){for(var t=[this],n=0;n<this.drawOrder.length;n+=1){var r=this.elements[this.drawOrder[n]];r instanceof e?t.push.apply(t,Po(r.getAllElements())):t.push(r)}return t}},{key:"getChildren",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];t.push(n)}return t}},{key:"getAllElementsWithScenario",value:function(t){for(var n=_o(Oo(e.prototype),"getAllElementsWithScenario",this).call(this,t),r=0;r<this.drawOrder.length;r+=1){var i=this.elements[this.drawOrder[r]];null!=i.scenarios[t]&&n.push(i),i instanceof e&&(n=[].concat(Po(n),Po(i.getAllElementsWithScenario(t))))}return n}},{key:"getAllPossiblyInteractiveElements",value:function(){for(var t=[],n=0;n<this.drawOrder.length;n+=1){var r=this.elements[this.drawOrder[n]];r instanceof e&&(r.isTouchable||r.isMovable||!r.hasTouchableElements||r.isInteractive&&null!=r.isInteractive||(t=[].concat(Po(t),Po(r.getAllPossiblyInteractiveElements())))),(void 0!==r.isInteractive||r.isTouchable||r.isMovable)&&t.push(r)}return t}},{key:"goToStep",value:function(t){var e=document.getElementById("id__figureone_item_selector_0"),n=[];if(null!=e&&0<e.children.length)for(var r=0;r<e.children.length;r+=1)n.push(e.children[r]);n.forEach((function(e,n){n===t?e.classList.add("figureone__item_selector_selected"):e.classList.remove("figureone__item_selector_selected")}))}},{key:"setMovable",value:function(t){var n=!(0<arguments.length&&void 0!==t)||t;_o(Oo(e.prototype),"setMovable",this).call(this,n),n&&(this.hasTouchableElements=!0)}},{key:"setupWebGLBuffers",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setupWebGLBuffers(t)}},{key:"changeWebGLInstance",value:function(t){for(var e,n=0;n<this.drawOrder.length;n+=1)e=this.elements[this.drawOrder[n]].changeWebGLInstance(t);return e}},{key:"getLoadingElements",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];n instanceof Wo?"loading"===n.drawingObject.state&&t.push(n):t=[].concat(Po(t),Po(n.getLoadingElements()))}return t}},{key:"setPointsFromDefinition",value:function(){for(var t=0;t<this.drawOrder.length;t+=1){var e=this.elements[this.drawOrder[t]];null!=e.setPointsFromDefinition&&e.setPointsFromDefinition()}}},{key:"setPrimitiveColors",value:function(){for(var t=0;t<this.drawOrder.length;t+=1){var e=this.elements[this.drawOrder[t]];e instanceof Wo?(e.setColor(e.color),e.setOpacity(e.opacity)):e.setPrimitiveColors()}}},{key:"unrenderAll",value:function(){this.unrender();for(var t=0;t<this.drawOrder.length;t+=1){var e=this.elements[this.drawOrder[t]];e instanceof Wo?e.unrender():e.unrenderAll()}}},{key:"setScenarios",value:function(t,n){var r=1<arguments.length&&void 0!==n&&n;_o(Oo(e.prototype),"setScenarios",this).call(this,t);for(var i=0;i<this.drawOrder.length;i+=1){var o=this.elements[this.drawOrder[i]];(r&&o.isShown||!1===r)&&o.setScenarios(t,r)}}},{key:"saveScenarios",value:function(t,n){_o(Oo(e.prototype),"saveScenarios",this).call(this,t,n);for(var r=0;r<this.drawOrder.length;r+=1)this.elements[this.drawOrder[r]].saveScenarios(t,n)}},{key:"animateToState",value:function(t,n,r,i){var o=2<arguments.length&&void 0!==r&&r,a=3<arguments.length&&void 0!==i?i:null,s=0;if(s=_o(Oo(e.prototype),"animateToState",this).call(this,t,n,o,a),!1===this.dependantTransform||!1===o)for(var l=0;l<this.drawOrder.length;l+=1){var u=this.elements[this.drawOrder[l]];if(null!=t.elements&&null!=t.elements[this.drawOrder[l]]){var c=u.animateToState(t.elements[this.drawOrder[l]],n,o,a);s<c&&(s=c)}}return s}},{key:"dissolveInToState",value:function(t,n,r){var i=1<arguments.length&&void 0!==n?n:.8,o=2<arguments.length&&void 0!==r?r:null,a=0;if(0===(a=_o(Oo(e.prototype),"dissolveInToState",this).call(this,t,i,o)))return 0;for(var s=0;s<this.drawOrder.length;s+=1){var l=this.elements[this.drawOrder[s]];if(null!=t.elements&&null!=t.elements[this.drawOrder[s]]){var u=l.dissolveInToState(t.elements[this.drawOrder[s]],i,o);a<u&&(a=u)}}return a}},{key:"setTimeDelta",value:function(t){_o(Oo(e.prototype),"setTimeDelta",this).call(this,t);for(var n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].setTimeDelta(t)}},{key:"isStateSame",value:function(t,n,r){var i=1<arguments.length&&void 0!==n&&n,o=2<arguments.length&&void 0!==r?r:[];if(!1===_o(Oo(e.prototype),"isStateSame",this).call(this,t,i,o))return!1;for(var a=0;a<this.drawOrder.length;a+=1){var s=this.elements[this.drawOrder[a]];if(null!=t.elements&&null!=t.elements[this.drawOrder[a]]&&!1===s.isStateSame(t.elements[this.drawOrder[a]],i,o))return!1}return!0}},{key:"clearFrozenPulseTransforms",value:function(){_o(Oo(e.prototype),"clearFrozenPulseTransforms",this).call(this);for(var t=0;t<this.drawOrder.length;t+=1)this.elements[this.drawOrder[t]].clearFrozenPulseTransforms()}},{key:"freezePulseTransforms",value:function(t){var n=!(0<arguments.length&&void 0!==t)||t;_o(Oo(e.prototype),"freezePulseTransforms",this).call(this,n);for(var r=0;r<this.drawOrder.length;r+=1)this.elements[this.drawOrder[r]].freezePulseTransforms(n)}},{key:"isAnimating",value:function(){if(!1===this.isShown)return!1;if(_o(Oo(e.prototype),"isAnimating",this).call(this))return!0;for(var t=0;t<this.drawOrder.length;t+=1)if(this.elements[this.drawOrder[t]].isAnimating())return!0;return!1}}]),e}(),No=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);for(var n,r={finishedCallback:null},i=arguments.length,o=new Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return e instanceof Fo?(n=st.apply(void 0,[{},r].concat(o))).element=e:n=st.apply(void 0,[{},r,e].concat(o)),this.element=n.element,this.animations=[],this.state="idle",this.options={translation:{}},this.fnMap=new V,this.finishedCallback=n.finishedCallback,this.subscriptions=new jt,this}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"_state",value:function(t){var e=an(this,["animations","state","options"],t);return null!=this.element&&(e.element={f1Type:"de",state:this.element.getPath()}),e}},{key:"setTimeDelta",value:function(t){this.animations.forEach((function(e){e.setTimeDelta(t)}))}},{key:"willStartAnimating",value:function(){if("animating"===this.state)return!0;var t=!1;return this.animations.forEach((function(e){"waitingToStart"!==e.state&&"animating"!==e.state||(t=!0)})),t}},{key:"isAnimating",value:function(){if("animating"===this.state||"waitingToStart"===this.state)return!0;for(var t=0;t<this.animations.length;t+=1){var e=this.animations[t];if("waitingToStart"===e.state||"animating"===e.state)return!0}return!1}},{key:"nextFrame",value:function(t){var e=[],n=null,r=!1;this.animations.forEach((function(i,o){var a=!1;if("waitingToStart"===i.state||"animating"===i.state){var s=i.nextFrame(t);null===n&&(n=s),s<n&&(n=s),a=!0}"finished"===i.state&&i.removeOnFinish&&(a=!1,e.push(o)),a&&(r=!0)}));var i=null;r?this.state="animating":("animating"===this.state&&(this.state="idle",i=this.finishedCallback,this.subscriptions.publish("finished")),this.state="idle");for(var o=e.length-1;0<=o;--o)this.animations.splice(e[o],1);return this.fnMap.exec(i),n}},{key:"cleanAnimations",value:function(){for(var t=[],e=!1,n=0;n<this.animations.length;n+=1){var r=this.animations[n];"finished"===r.state&&r.removeOnFinish?t.push(n):"animating"!==r.state&&"waitingToStart"!==r.state||(e=!0)}for(var i=t.length-1;0<=i;--i)this.animations.splice(t[i],1);e?this.state="animating":("animating"===this.state&&(this.state="idle",this.fnMap.exec(this.finishedCallback),this.subscriptions.publish("finished")),this.state="idle")}},{key:"cancel",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:null;if(null==t)this.cancelAll(n);else{for(var r=0;r<this.animations.length;r+=1){var i=this.animations[r];i.name===t&&i.cancel(n)}this.cleanAnimations()}}},{key:"cancelAll",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:null,n=0;n<this.animations.length;n+=1)this.animations[n].cancel(e);this.cleanAnimations()}},{key:"getFrameTime",value:function(t){(new sn).getWhen(t)}},{key:"start",value:function(t){var e=st({},t,{name:null,frame:"next"}),n=e.name,r=e.frame,i=this.getFrameTime(r);if(null==n)this.startAll(r);else for(var o=0;o<this.animations.length;o+=1){var a=this.animations[o];a.name===n&&"animating"!==a.state&&(a.start(i),a.finishIfZeroDuration(),"animating"===a.state&&(this.state="animating"))}"idle"===this.state&&(this.fnMap.exec(this.finishedCallback),this.subscriptions.publish("finished"))}},{key:"startAll",value:function(t){for(var e=st({},t,{frame:"next"}).frame,n=this.getFrameTime(e),r=0;r<this.animations.length;r+=1){var i=this.animations[r];"animating"!==i.state&&(i.start(n),i.finishIfZeroDuration(),"animating"===i.state&&(this.state="animating"))}"idle"===this.state&&(this.fnMap.exec(this.finishedCallback),this.subscriptions.publish("finished"))}},{key:"getTotalDuration",value:function(){var t=0;return this.animations.forEach((function(e){var n=e.getTotalDuration();t<n&&(t=n)})),t}},{key:"getRemainingTime",value:function(t){var e=0<arguments.length&&void 0!==t?t:(new sn).now()/1e3,n=0;return this.animations.forEach((function(t){var r=t.getRemainingTime(e);n<r&&(n=r)})),n}},{key:"addTo",value:function(t){for(var e=0;e<this.animations.length;e+=1){var n=this.animations[e];if(n.name===t)return n}return this.new(t)}},{key:"new",value:function(t){var e={};null!=this.element&&(e.element=this.element),null!=t&&(e.name=t);var n=new Ko(e);return this.animations.push(n),n}},{key:"newFromStep",value:function(t){return this.animations.push(t),t}},{key:"_dup",value:function(){var e=new t;return lt(this,e,["element"]),e.element=this.element,e}}]),t}();function zo(t){return(zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ho(t,e,n){return(Ho=Yo()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Uo(i,n.prototype),i}).apply(null,arguments)}function Vo(t,e,n){return(Vo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=$o(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Uo(t,e){return(Uo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Go(t,e){return!e||"object"!==zo(e)&&"function"!=typeof e?Xo(t):e}function Xo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yo(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function $o(t){return($o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ko=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Uo(t,e)}(r,Mi);var t,e,n=(t=r,e=Yo(),function(){var n,r=$o(t);if(e){var i=$o(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Go(this,n)});function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);for(var i,o={},a=arguments.length,s=new Array(1<a?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return e instanceof Fo?(i=st.apply(void 0,[{},o].concat(s))).element=e:i=st.apply(void 0,[{},o,e].concat(s)),(t=n.call(this,i)).element=i.element,t._stepType="builder",Go(t,Xo(t))}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"fnExec",value:function(t){for(var e,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return null==this.element?(e=this.fnMap).exec.apply(e,[t].concat(r)):(o=this.fnMap).execOnMaps.apply(o,[t,[this.element.fnMap.map]].concat(r));var o}},{key:"_fromState",value:function(t,e){return st(this,t),null!=this.element&&"string"==typeof this.element&&null!=e&&(this.element=e(this.element)),this}},{key:"_getStateName",value:function(){return"animationBuilder"}},{key:"_state",value:function(t){var e=Vo($o(r.prototype),"_state",this).call(this,t);return null!=this.element&&(e.state.element={f1Type:"de",state:this.element.getPath()}),e}},{key:"custom",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(null!=this.element){var r={element:this.element},i=st.apply(void 0,[{},r].concat(e));this.then(new Si(i))}else this.then(Ho(Si,e));return this}},{key:"rotation",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(new Gr(i))}return this}},{key:"position",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(new wn(i))}return this}},{key:"translation",value:function(){return this.position.apply(this,arguments)}},{key:"scale",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(new Zr(i))}return this}},{key:"transform",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(new Dr(i))}return this}},{key:"pulseTransforms",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(new qr(i))}return this}},{key:"scenario",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(new Zn(i))}return this}},{key:"scenarios",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(i.element.anim.scenarios(i))}return this}},{key:"color",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(new ur(i))}return this}},{key:"opacity",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));this.then(new Tr(i))}return this}},{key:"dissolveOut",value:function(t){for(var e,n=0<arguments.length&&void 0!==t?t:{},r={element:this.element},i=arguments.length,o=new Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return e=st.apply(void 0,"number"==typeof n?[{},r,{duration:n}].concat(o):[{},r,n].concat(o)),this.then(Ar(e)),this}},{key:"dissolveIn",value:function(t){for(var e,n=0<arguments.length&&void 0!==t?t:{},r={element:this.element},i=arguments.length,o=new Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return e=st.apply(void 0,"number"==typeof n?[{},r,{duration:n}].concat(o):[{},r,n].concat(o)),this.then(Or(e)),this}},{key:"dim",value:function(t){for(var e,n=0<arguments.length&&void 0!==t?t:{},r={element:this.element},i=arguments.length,o=new Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return e=st.apply(void 0,"number"==typeof n?[{},r,{duration:n}].concat(o):[{},r,n].concat(o)),this.then(hr(e)),this}},{key:"undim",value:function(t){for(var e,n=0<arguments.length&&void 0!==t?t:{},r={element:this.element},i=arguments.length,o=new Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return e=st.apply(void 0,"number"==typeof n?[{},r,{duration:n}].concat(o):[{},r,n].concat(o)),this.then(dr(e)),this}},{key:"delay",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.then(Fi.apply(s,[e].concat(r))),this}},{key:"trigger",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(null!=this.element){var o={element:this.element},a=st.apply(void 0,[{},o].concat(r));this.then(di(e,a))}else this.then(di.apply(s,[e].concat(r)));return this}},{key:"inParallel",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.then(Un.apply(s,[e].concat(r))),this}},{key:"inSerial",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.then(ji.apply(s,[e].concat(r))),this}},{key:"pulse",value:function(){for(var t={element:this.element},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));return this.then(new ii(i)),this}},{key:"reset",value:function(){this.steps=[],this.state="idle"}},{key:"_dup",value:function(){var t=new r;return lt(this,t,["element"]),t.element=this.element,t}}]),r}(),Qo=function(){function t(e){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.diagram=e,this.start=this.diagram.touchDownHandler.bind(this.diagram),this.end=this.diagram.touchUpHandler.bind(this.diagram),this.move=this.diagram.touchMoveHandler.bind(this.diagram),this.free=this.diagram.touchFreeHandler.bind(this.diagram),this.toggleCursor=this.diagram.toggleCursor.bind(this.diagram),this.addEvent("mousedown",this.mouseDownHandler,!1),this.addEvent("mouseup",this.mouseUpHandler,!1),this.addEvent("mousemove",this.mouseMoveHandler,!1),this.addEvent("touchstart",this.touchStartHandler,!1),this.addEvent("touchend",this.touchEndHandler,!1),this.addEvent("touchmove",this.touchMoveHandler,!1),this.enable=!0}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"addEvent",value:function(t,e,n){this.diagram.gestureCanvas.addEventListener(t,e.bind(this),n)}},{key:"removeEvent",value:function(t,e,n){this.diagram.gestureCanvas.removeEventListener(t,e.bind(this),n)}},{key:"startHandler",value:function(t){return!!this.enable&&(this.mouseDown=!0,this.previousPoint=t,this.start(t))}},{key:"endHandler",value:function(){this.mouseDown=!1,this.end()}},{key:"moveHandler",value:function(t,e){this.enable&&this.mouseDown?(this.move(this.previousPoint,e)&&t.preventDefault(),this.previousPoint=e):this.free(e)}},{key:"touchStartHandler",value:function(t){var e=t.touches[0];this.startHandler(new se(e.clientX,e.clientY))&&t.preventDefault()}},{key:"mouseDownHandler",value:function(t){this.startHandler(new se(t.clientX,t.clientY))&&t.preventDefault()}},{key:"touchMoveHandler",value:function(t){var e=t.touches[0];this.moveHandler(t,new se(e.clientX,e.clientY))}},{key:"mouseMoveHandler",value:function(t){this.moveHandler(t,new se(t.clientX,t.clientY))}},{key:"mouseUpHandler",value:function(){this.endHandler()}},{key:"touchEndHandler",value:function(){this.endHandler()}},{key:"destroy",value:function(){this.removeEvent("mousedown",this.mouseDownHandler,!1),this.removeEvent("mouseup",this.mouseUpHandler,!1),this.removeEvent("mousemove",this.mouseMoveHandler,!1),this.removeEvent("touchstart",this.touchStartHandler,!1),this.removeEvent("touchend",this.touchEndHandler,!1),this.removeEvent("touchmove",this.touchMoveHandler,!1)}}]),t}();function Zo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Jo(t,e){var n=1<arguments.length&&void 0!==e?e:null,r="",i="";return null!=n&&(i=' style="margin-top:'.concat(n,'%"')),Array.isArray(t)?t.forEach((function(t,e){t.startsWith("<")?r+=t:r+=0===e?'<p style="margin-top:'.concat(i,'">').concat(t,"</p>"):"<p>".concat(t,"</p>")})):r=t,r}function ta(){var t=1<arguments.length?arguments[1]:void 0,e=Jo(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"");return'<div class="'.concat(t,'">').concat(e,"</div>")}function ea(){var t=Jo(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",0);return'<div style="display: table; height: 100%; width: 100%;">\n        <div style="display: table-cell; vertical-align: middle; height: 100%; width: 100%;">\n        '.concat(t,"</div></div>")}function na(){var t=Jo(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",0);return'<div style="display: table; height: 100%; text-align:center; width:100%;">\n        <div style="display: table-cell; vertical-align: middle; height: 100%; width: 100%;">\n        '.concat(t,"</div></div>")}function ra(){var t=Jo(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"");return'<div style="text-align:center;">\n        '.concat(t,"</div>")}function ia(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n="",r="",i="",o="",a="",s="",l="",u="",c="";"number"==typeof t?i="margin-top:".concat(t,"%"):(null!=t.left&&(n="margin-left:".concat(t.left,"%;")),null!=t.right&&(r="margin-right:".concat(t.right,"%;")),t.centerV&&(i="margin-top:0;"),null!=t.top&&(i="margin-top:".concat(t.top,"%;")),null!=t.line&&(o="margin-top:".concat(t.line,"%;")),null!=t.size&&(a="font-size:".concat(t.size,"em;")),t.className&&(s='class="'.concat(t.className,'"')),t.color&&(l="color:".concat(Cn(t.color),";")),t.listStyleType&&(u="list-style-type:".concat(t.listStyleType,";")),t.id&&(c='id="'.concat(t.id,'"')));var h,f='<p style="'.concat(n).concat(r).concat(o).concat(a).concat(l,'"').concat(s,">"),d='<p style="'.concat(n).concat(r).concat(i).concat(a).concat(l,'"').concat(s).concat(c,">"),p='<li style="'.concat(n).concat(r).concat(o).concat(a).concat(l).concat(u,'"').concat(s,">"),y='<ul style="'.concat(n).concat(r).concat(i).concat(a).concat(l,'"').concat(s).concat(c,">"),v='<ol style="'.concat(n).concat(r).concat(i).concat(a).concat(l,'"').concat(s).concat(c,">");return h=null!=t.list?(h=Array.isArray(e)?e.join("</li>".concat(p)):e,"unordered"===t.list?"".concat(y).concat(p).concat(h,"</ul>"):"".concat(v).concat(p).concat(h,"</ol>")):(h=Array.isArray(e)?e.join("</p>".concat(f)):e,"".concat(d).concat(h,"</p>")),t.centerH&&(h=ra(h)),t.centerV&&(h=ea(h)),h}function oa(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[""],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n='<ul id="id__figureone_item_selector_'.concat(2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,'" \n                    class=').concat(e,">");return t.forEach((function(t,e){n+='<li id="id__figureone_item_selector_'.concat(e,'">').concat(t,"</li>")})),n+="</ul>"}var aa=function(t,e){return'<span class="figureone__unit_deg">'.concat(t,'</span><span class="figureone__unit_rad">').concat(e,"</span>\n  ")};function sa(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i="";e&&(i=' id="'.concat(e,'"'));var o="";n&&(o=' class="'.concat(n,'"'));var a="";return r&&(a=' style="color:'.concat(Cn(r),';"')),{replacementText:"<span".concat(i).concat(o,'"').concat(a,">").concat(t.replace(RegExp(/_/,"gi")," ").trim(),"</span>")}}function la(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e="highlight_word";"string"==typeof t&&(e="".concat(t," ").concat(e));var n=null;return Array.isArray(t)&&(n=t),{replacementText:function(t){return sa(t,"",e,n)}}}function ua(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n="action_word interactive_word",r=null,i={color:null,id:"figureone__id_".concat(ut()),interactive:!0,classes:"",text:null,newTab:!0},o=i;Array.isArray(e)?r=e:null!=e&&(o=st(i,e));var a=o.color,s=o.id,l=o.classes,u=o.text;null!=a&&(r=a),""!==l&&(n="".concat(n," ").concat(l));var c=o.newTab?' target="_blank"':"";return{replacementText:function(e){var i=s?' id="'.concat(s,'"'):"",o=r?' style="color:'.concat(Cn(r),';"'):"";return{replacementText:"<a href=".concat(t).concat(i,'class="').concat(n,'"').concat(o,' rel="noreferrer noopener"').concat(c,">").concat((u||e).trim(),"</a>")}},id:function(){return s}}}function ca(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n="highlight_word";"string"==typeof e&&(n="".concat(e," ").concat(n));var r=null;return Array.isArray(e)&&(r=e),{replacementText:sa(t,"",n,r).replacementText}}function ha(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return{replacementText:function(e){return sa(e,"",t)}}}function fa(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return{replacementText:function(e){return sa(e,t)}}}function da(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r="action_word",i=null,o={color:null,id:"figureone__id_".concat(ut()),interactive:!0,classes:"",text:null},a=o;Array.isArray(n)?i=n:null!=n&&(a=st(o,n));var s=a.interactive,l=a.color,u=a.id,c=a.classes,h=a.text;function f(){return u}return null!=l&&(i=l),s&&(r="".concat(r," interactive_word")),""!==c&&(r="".concat(r," ").concat(c)),{replacementText:function(t){return sa(h||t,f(),r,i)},id:f,actionMethod:t,bind:e}}function pa(t,e,n){return da(e,n,{color:3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,text:t})}function ya(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ut(),n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r="action_word";3<arguments.length&&void 0!==arguments[3]&&!arguments[3]||(r="".concat(r," interactive_word")),"string"==typeof n&&(r="".concat(n," ").concat(r));var i=null;return Array.isArray(n)&&(i=n),{replacementText:sa(t,e,r,i).replacementText,id:e}}function va(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new Ki,o=document.getElementById(t);o&&(o.classList.add("action_word_enabled"),r.split(" ").forEach((function(t){t&&o.classList.add(t)})),o.onclick=function(){var r;"recording"===i.state&&i.recordEvent("click",[t]),e.bind.apply(e,function(t){if(Array.isArray(t))return Zo(t)}(r=n)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(r)||function(t){if(t){if("string"==typeof t)return Zo(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Zo(t,void 0):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())()})}function ma(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"highlight_word",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=t;Object.keys(e).forEach((function(t){var n,r,o,a,s,l=e[t];n=i,r=t,o=l,a=new RegExp("\\|".concat(r,"\\|"),"gi"),s="string"==typeof o?o:"string"==typeof o.replacementText?o.replacementText:o.replacementText(r).replacementText,i=n.replace(a,s)}));var o=RegExp(/\|([^|]*)\|/gi);if(i=i.replace(o,'<span class="'.concat(n,'">$1</span>')),r){var a=RegExp(/style="color:rgba\([^)]*\);"/gi);i=i.replace(a,"");var s=RegExp(/highlight_word/gi);i=i.replace(s,"");var l=RegExp(/interactive_word/gi);i=i.replace(l,"");var u=RegExp(/id="[^"]*"/gi);i=i.replace(u,"")}return i}function ga(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Ki;Object.keys(t).forEach((function(r){var i=t[r];"string"!=typeof i&&"actionMethod"in i&&va("string"==typeof i.id?i.id:i.id(r),i.actionMethod,i.bind,e,n)}))}function ba(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",i=ma(e,n);t.innerHTML=i,ga(n,r)}function wa(t){return(wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sa(t,e){return(Sa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function xa(t){return(xa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _a=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Sa(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=xa(t);if(e){var o=xa(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==wa(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e){var i;return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(i=n.call(this,t)).glPrimitive=t[0].gl.TRIANGLE_FAN,i.points=[],e.forEach((function(t){i.points.push(t.x),i.points.push(t.y),i.border[0].push(t)})),i.setupBuffer(),i}return r}();function Ta(t){return(Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ka(t,e){return(ka=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Oa(t){return(Oa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Pa=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ka(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Oa(t);if(e){var o=Oa(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Ta(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.05,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Math.PI/4,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=n.call(this,t)).innerRadius=i,e.outerRadius=o,e.dAngle=s,e.maxAngle=l;for(var u=0,c=-1,h=-1,f=[i,-a/2,o,-a/2,o,a/2,i,-a/2,o,a/2,i,a/2];u<=l;){for(var d=0;d<6;d+=1){var p=new se(f[2*d],f[2*d+1]).rotate(u);e.points[c+=1]=p.x,e.points[c+=1]=p.y}var y=[new se(e.points[c-11],e.points[c-10]),new se(e.points[c-9],e.points[c-8]),new se(e.points[c-7],e.points[c-6]),new se(e.points[c-1],e.points[+c]),new se(e.points[c-11],e.points[c-10])];e.border[h+=1]=y,u+=s}return e.setupBuffer(),e}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"drawToAngle",value:function(t,e,n,r,i){var o=6*Math.floor(r/this.dAngle)+6;r>=this.maxAngle&&(o=this.numPoints),this.draw(t,e,n,o,i)}},{key:"getPointCountForAngle",value:function(t){var e=0<arguments.length&&void 0!==t?t:2*Math.PI,n=6*Math.floor(e/this.dAngle)+6;return e>=2*Math.PI&&(n=this.numPoints),n}}]),r}();function Aa(t){return(Aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ea(t,e){return(Ea=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ma(t){return(Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ja=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ea(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Ma(t);if(e){var o=Ma(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Aa(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new se(0,0),o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);var l=0-a/2,u=[];(e=n.call(this,t)).glPrimitive=e.gl[0].TRIANGLE_STRIP,u.push(new se(0,l)),u.push(new se(0,l+a)),u.push(new se(0+o,l)),u.push(new se(0+o,l+a));var c=(new ke).rotate(s).translate(i.x,i.y),h=u.map((function(t){return t.transformBy(c.matrix())}));return h.forEach((function(t){e.points.push(t.x),e.points.push(t.y)})),e.border[0]=[h[0],h[1],h[h.length-1],h[h.length-2]],e.border[0].push(e.border[0][0]._dup()),e.setupBuffer(),e}return r}();function Ra(t){return(Ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ca(t,e){return(Ca=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Da(t){return(Da=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var La=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ca(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Da(t);if(e){var o=Da(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Ra(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new se(0,0),o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[1];!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=n.call(this,t)).glPrimitive=e.gl[0].TRIANGLES,e.dashCumLength=[],e.maxLength=o;for(var u,c,h,f,d,p=[],y=0,v=new se(0,0-a/2),m=!1;y<o;)for(var g=0;g<l.length&&y<o;g+=1){var b=l[g];o<b+y&&(b=o-y),m||(c=b,h=a,[f=(u=v)._dup(),u.add(new se(0,h)),d=u.add(new se(c,h)),f,d,u.add(new se(c,0))].forEach((function(t){p.push(t)}))),y+=b,v.x+=b,m=!m,e.dashCumLength.push(y)}var w=(new ke).rotate(s).translate(i.x,i.y),S=p.map((function(t){return t.transformBy(w.matrix())}));return S.forEach((function(t){e.points.push(t.x),e.points.push(t.y)})),e.border[0]=[S[0],S[1],S[S.length-2],S[S.length-1]],e.border[0].push(e.border[0][0]._dup()),e.setupBuffer(),e}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPointCountForLength",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.maxLength;if(e>=this.maxLength)return this.numPoints;if(e<this.dashCumLength[0])return 0;for(var n=0;n<this.dashCumLength.length;n+=1)if(e<this.dashCumLength[n])return 6*(Math.floor((n-1)/2)+1);return this.numPoints}}]),r}();function Ba(t){return(Ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ia(t){return function(t){if(Array.isArray(t))return Fa(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Fa(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Fa(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fa(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Wa(t,e){return(Wa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function qa(t){return(qa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Na=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wa(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=qa(t);if(e){var o=qa(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Ba(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e,i){var o,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:20;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(o=n.call(this,t)).glPrimitive=o.gl[0].TRIANGLE_FAN;var c=[];function h(t,e,n,r){var i=[];if(0===t||0===e)i.push(r);else for(var o=Math.PI/2/e,a=0;a<e+1;a+=1)i.push(new se(t*Math.cos(a*o+n)+r.x,t*Math.sin(a*o+n)+r.y));return i}c.push(new se(0,0));var f=Math.min(l,a/2,s/2),d=u;return 0===d&&(f=0),c=[].concat(Ia(c),Ia(h(f,d,0,new se(a/2-f,s/2-f)))),c=[].concat(Ia(c),Ia(h(f,d,Math.PI/2,new se(-a/2+f,s/2-f)))),c=[].concat(Ia(c),Ia(h(f,d,Math.PI,new se(-a/2+f,-s/2+f)))),c=[].concat(Ia(c),Ia(h(f,d,Math.PI/2*3,new se(a/2-f,-s/2+f)))),c="top"===i?c.map((function(t){return t.add(0,-s/2)})):"bottom"===i?c.map((function(t){return t.add(0,s/2)})):"middle"===i?c.map((function(t){return t.add(0,0)})):c.map((function(t){return t.add(0,i)})),(c="left"===e?c.map((function(t){return t.add(a/2,0)})):"right"===e?c.map((function(t){return t.add(-a/2,0)})):"center"===e?c.map((function(t){return t.add(0,0)})):c.map((function(t){return t.add(e,e)}))).forEach((function(t){o.points.push(t.x),o.points.push(t.y)})),o.points.push(o.points[2]),o.points.push(o.points[3]),o.border[0]=c.slice(1),o.setupBuffer(),o}return r}();function za(t){return(za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ha(t){return function(t){if(Array.isArray(t))return Va(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Va(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Va(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Va(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ua(t,e){return(Ua=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ga(t){return(Ga=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Xa=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ua(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Ga(t);if(e){var o=Ga(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==za(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e,i){var o,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.01,u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,c=7<arguments.length&&void 0!==arguments[7]?arguments[7]:20;function h(t,e,n,r){var i=[];if(0===t||0===e)i.push(r);else for(var o=Math.PI/2/e,a=0;a<e+1;a+=1)i.push(new se(t*Math.cos(a*o+n)+r.x,t*Math.sin(a*o+n)+r.y));return i}!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(o=n.call(this,t)).glPrimitive=o.gl[0].TRIANGLE_STRIP;var f=[],d=Math.min(u,a/2,s/2),p=Math.max(u-l,1e-4),y=c;0===y&&(p=d=0);var v=[].concat(Ha(h(d,y,0,new se(a/2-d,s/2-d))),Ha(h(d,y,Math.PI/2,new se(-a/2+d,s/2-d))),Ha(h(d,y,Math.PI,new se(-a/2+d,-s/2+d))),Ha(h(d,y,Math.PI/2*3,new se(a/2-d,-s/2+d)))),m=[].concat(Ha(h(p,y,0,new se(a/2-p-l,s/2-p-l))),Ha(h(p,y,Math.PI/2,new se(-a/2+p+l,s/2-p-l))),Ha(h(p,y,Math.PI,new se(-a/2+p+l,-s/2+p+l))),Ha(h(p,y,Math.PI/2*3,new se(a/2-p-l,-s/2+p+l))));return v.forEach((function(t,e){f.push(t),f.push(m[e])})),f="top"===i?f.map((function(t){return t.add(0,-s/2)})):"bottom"===i?f.map((function(t){return t.add(0,s/2)})):"middle"===i?f.map((function(t){return t.add(0,0)})):f.map((function(t){return t.add(0,i)})),(f="left"===e?f.map((function(t){return t.add(a/2,0)})):"right"===e?f.map((function(t){return t.add(-a/2,0)})):"center"===e?f.map((function(t){return t.add(0,0)})):f.map((function(t){return t.add(e,e)}))).forEach((function(t){o.points.push(t.x),o.points.push(t.y)})),o.points.push(o.points[0]),o.points.push(o.points[1]),o.points.push(o.points[2]),o.points.push(o.points[3]),o.border[0]=f.slice(1),o.setupBuffer(),o}return r}();function Ya(t){return function(t){if(Array.isArray(t))return $a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return $a(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?$a(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ka(t,e){var n={},r=0,i=re(t);if(null==e)return i;var o=[];return o=Array.isArray(e)?e:[e],n[0]=0,n[1]=t.length,o.forEach((function(t,e){if("string"==typeof t)n[t]=i.length;else{var o=st({},{start:r,end:"end",original:!0},t),a="to";null!=o.along&&(a=o.along);var s=function(t,e,n,r){var i,o=[],a=r["".concat(e)];null==(i="end"===n?t.length:r["".concat(n)])&&(i=t.length);for(var s=a;s<i;s+=1)o.push(t[s]._dup());return o}(i,o.start,o.end,n);!1===o.original&&(r=i.length),i=[].concat(Ya(i),Ya((l=s,c=o,"linear"===(u=a)||"x"===u||"y"===u||"number"==typeof u?function(t){if(null==c.along)return[];var e=0,n=st({},{num:1},c);if("y"===n.along?e=Math.PI/2:"x"===n.along?e=0:"number"==typeof n.along&&(e=n.along),null==n.step){var r=Re(t);n.step=Math.abs(r.height/Math.sin(e))}for(var i=[],o=function(r){var o=n.step*r;i=[].concat(Ya(i),Ya(t.map((function(t){return t.add(Me(o,e))}))))},a=1;a<n.num+1;a+=1)o(a);return i}(l):"to"===u?null==c.to||Array.isArray(c.to)&&0===c.to.length?l:(c.to instanceof ke||Array.isArray(c.to)&&c.to[0]instanceof ke?function(t,e){var n=st({},{to:[]},e);n.to instanceof ke&&(n.to=[e.to]);for(var r=[],i=function(e){var i=n.to[e].matrix();r=[].concat(Ya(r),Ya(t.map((function(t){return t.transformBy(i)}))))},o=0;o<n.to.length;o+=1)i(o);return r}:function(t,e){var n=st({},{to:[]},e);n.to=re(n.to);for(var r=[],i=function(e){r=[].concat(Ya(r),Ya(t.map((function(t){return t.add(n.to[e])}))))},o=0;o<n.to.length;o+=1)i(o);return r})(l,c):"rotation"===u?function(t,e){var n=st({},{num:1,step:Math.PI/4,center:[0,0]},e);n.center=ne(n.center);for(var r=[],i=n.center,o=function(e){var o=(new ke).translate(-i.x,-i.y).rotate(e*n.step).translate(i.x,i.y).matrix();r=[].concat(Ya(r),Ya(t.map((function(t){return t.transformBy(o)}))))},a=1;a<n.num+1;a+=1)o(a);return r}(l,c):l))),n["".concat(e+2)]=i.length}var l,u,c})),Ya(i.slice(r))}function Qa(t){return(Qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Za(t,e){return(Za=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ja(t,e){return!e||"object"!==Qa(e)&&"function"!=typeof e?function(){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():e}function ts(t){return(ts=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var es=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Za(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r=ts(t);if(e){var i=ts(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ja(this,n)});function r(t,e,i,o,a){var s,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"",u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:new oe(-1,-1,2,2),c=7<arguments.length&&void 0!==arguments[7]?arguments[7]:new oe(0,0,1,1),h=8<arguments.length&&void 0!==arguments[8]&&arguments[8],f=9<arguments.length?arguments[9]:void 0;return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),s=""!==l?n.call(this,t,"withTexture","withTexture"):n.call(this,t),"lines"===a?s.glPrimitive=s.gl[0].LINES:"strip"===a?s.glPrimitive=s.gl[0].TRIANGLE_STRIP:"fan"===a&&(s.glPrimitive=s.gl[0].TRIANGLE_FAN),s.setupPoints(e,i,o,f),s.setupTexture(l,u,c,h),s.setupBuffer(),Ja(s)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"change",value:function(t,e,n){this.setupPoints(t,e,n),this.resetBuffer()}},{key:"setupTexture",value:function(t,e,n,r){var i=0<arguments.length&&void 0!==t?t:"",o=1<arguments.length&&void 0!==e?e:new oe(-1,-1,2,2),a=2<arguments.length&&void 0!==n?n:new oe(0,0,1,1),s=3<arguments.length&&void 0!==r&&r;i&&(this.texture={id:i,src:i,type:"image",points:[],repeat:s},this.createTextureMap(o.left,o.right,o.bottom,o.top,a.left,a.right,a.bottom,a.top))}},{key:"setupPoints",value:function(t,e,n,r){var i=this;this.points=[];var o=t;if((o=Ka(t,r)).forEach((function(t){i.points.push(t.x),i.points.push(t.y)})),null==e){var a=Re(o);this.border[0]=[new se(a.left,a.bottom),new se(a.right,a.bottom),new se(a.right,a.top),new se(a.left,a.top)]}else this.border=e;null!=n&&(this.holeBorder=n)}}]),r}();function ns(t){return(ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rs(t,e){return(rs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function is(t){return(is=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var os=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rs(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=is(t);if(e){var o=is(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==ns(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.01,s=4<arguments.length&&void 0!==arguments[4]&&arguments[4];!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=n.call(this,t)).glPrimitive=e.gl[0].TRIANGLE_STRIP,e.lineWidth=a,e.fill=s;var l=e.getPoints(i,o,a,s);return e.updatePoints(l,i,o,!0),e}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"updatePoints",value:function(t,e,n,r){var i=this,o=3<arguments.length&&void 0!==r&&r;this.points=[],t.forEach((function(t){i.points.push(t.x),i.points.push(t.y)})),this.border[0]=[new se(-e/2,-n/2),new se(e/2,-n/2),new se(e/2,n/2),new se(-e/2,n/2)],o?this.setupBuffer():this.resetBuffer()}},{key:"updateBox",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:this.lineWidth,o=3<arguments.length&&void 0!==r?r:this.fill,a=this.getPoints(t,e,i,o);this.updatePoints(a,t,e,!1)}},{key:"getPoints",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:this.lineWidth;return(3<arguments.length&&void 0!==r?r:this.fill)?[new se(-t/2,-e/2),new se(-t/2+t,-e/2),new se(-t/2,-e/2+e),new se(-t/2+t,-e/2+e)]:[new se(-t/2,-e/2),new se(-t/2+i,-e/2+i),new se(-t/2,-e/2+e),new se(-t/2+i,-e/2+e-i),new se(-t/2+t,-e/2+e),new se(-t/2+t-i,-e/2+e-i),new se(-t/2+t,-e/2),new se(-t/2+t-i,-e/2+i),new se(-t/2,-e/2),new se(-t/2+i,-e/2+i)]}}]),r}();function as(t){return(as="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ss(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ls(t,e){return(ls=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function us(t){return(us=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var cs=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ls(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=us(t);if(e){var o=us(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==as(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(i=n.call(this,t)).glPrimitive=i.gl[0].LINES,i.points=[],e.forEach((function(t){for(var e=function(t){if(Array.isArray(t))return t}(c=t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(e.push(o.value),2!==e.length);n=!0);}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}}(c)||function(t){if(t){if("string"==typeof t)return ss(t,2);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ss(t,2):void 0}}(c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=e[0],r=e[1],a=new ge(n,r).angle()+Math.PI/2,s=-.003*(o-1)/2,l=0;l<o;l+=1){var u=s+.003*l;i.points.push(n.x+u*Math.cos(a)),i.points.push(n.y+u*Math.sin(a)),i.points.push(r.x+u*Math.cos(a)),i.points.push(r.y+u*Math.sin(a))}var c})),i.border=[],i.setupBuffer(),i}return r}();function hs(t){return(hs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fs(t,e){return(fs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ds(t){return(ds=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ps=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fs(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=ds(t);if(e){var o=ds(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==hs(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new se(0,0),u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=n.call(this,t)).glPrimitive=e.gl[0].TRIANGLE_FAN;var c=(e.height=a)-s,h=[];h.push(new se(0,0)),h.push(new se(-i/2,-c)),s&&(h.push(new se(-o/2,-c)),h.push(new se(-o/2,-a)),h.push(new se(o/2,-a)),h.push(new se(o/2,-c))),h.push(new se(i/2,-c));var f=(new ke).rotate(u).translate(l);return h.map((function(t){return t.transformBy(f.matrix())})).forEach((function(t){e.points.push(t.x),e.points.push(t.y),e.border[0].push(t)})),e.border[0].push(e.border[0][0]._dup()),e.setupBuffer(),e}return r}();function ys(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new se(0,0),a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[1,1,1,1],l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:new se(0,0),u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:new oe(-1,-1,2,2),c=new ps(t,e,n,r,i,o,a),h=new ke;return h=l instanceof se?h.translate(l.x,l.y):l._dup(),new Wo(c,h,s,u)}function vs(t){return(vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ms(t,e){return(ms=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gs(t){return(gs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function bs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ws(){bs(this,ws),this.length=1,this.width=.01,this.color=Ss,this.mode="on",this.offset=0}var Ss=[.7,.7,.7,1],xs=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),ms(t,e)}(r,ws);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=gs(t);if(e){var o=gs(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==vs(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){var t;return bs(this,r),(t=n.call(this)).start=0,t.step=.1,t.length=.05,t.width=.01,t.offset=0,t.labelOffset=new se(0,0),t.color=Ss,t.labels=[],t.labelMode="auto",t.labelsHAlign="center",t.labelsVAlign="middle",t.mode="on",t.fontFamily="Helvetica Neue",t.fontWeight="400",t.fontSize=.1,t.fontColor=Ss,t}return r}(),_s=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;bs(this,t),this.name=e,this.start=new se(0,0),this.length=1,this.width=.01,this.rotation=n,this.color=[.5,.5,.5,1],this.title="",this.titleOffset=new se(this.length/2,-.1),this.titleRotation=0,this.limits={min:0,max:1},this.logarithmic=!1,this.majorTicks=new xs,this.minorTicks=new xs,this.minorTicks.labelMode="off",this.majorGrid=new ws,this.minorGrid=new ws,this.titleFontFamily="Helvetica Neue",this.titleFontWeight="400",this.titleFontSize=.13,this.titleFontColor=Ss}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"getNum",value:function(t,e){return Math.floor((this.limits.max-t)/e)+1}},{key:"getMajorNum",value:function(){return this.getNum(this.majorTicks.start,this.majorTicks.step)}},{key:"getMinorNum",value:function(){return this.getNum(this.minorTicks.start,this.minorTicks.step)}},{key:"generateAuto",value:function(t){var e=0<arguments.length&&void 0!==t?t:10,n=(this.limits.max-this.limits.min)/e,r=h(Math.floor(Math.log10(n)),0);n=h(n,-r);var i=h(this.limits.min,-r);return i<this.limits.min&&(i+=Math.pow(10,r)),11<this.getNum(i,n)&&(n*=2),{start:i,step:n}}},{key:"generateAutoMajorTicks",value:function(t){var e=0<arguments.length&&void 0!==t?t:10,n=this.generateAuto(e),r=n.start,i=n.step;this.majorTicks.start=r,this.majorTicks.step=i}},{key:"generateAutoMinorTicks",value:function(t){var e=0<arguments.length&&void 0!==t?t:50,n=this.generateAuto(e),r=n.start,i=n.step;this.minorTicks.start=r,this.minorTicks.step=i}},{key:"toClip",value:function(t){return t*(this.length/(this.limits.max-this.limits.min))}},{key:"valueToClip",value:function(t){return this.toClip(t-this.limits.min)+this.start.x}},{key:"getMajorLabels",value:function(){for(var t=[],e=0,n=this.getMajorNum();e<n;e+=1){var r=this.majorTicks.start+e*this.majorTicks.step;t.push(r.toString())}return t}},{key:"generateMajorLabels",value:function(){this.majorTicks.labels=this.getMajorLabels()}},{key:"getMinorLabels",value:function(){for(var t=[],e=0,n=this.getMinorNum();e<n;e+=1){var r=this.minorTicks.start+e*this.minorTicks.step;t.push(r.toString())}return t}},{key:"generateMinorLabels",value:function(){this.minorTicks.labels=this.getMinorLabels()}}]),t}();function Ts(t){return(Ts="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ks(t,e){return(ks=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Os(t){return(Os=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ps=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ks(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Os(t);if(e){var o=Os(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Ts(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new _s;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),e=n.call(this,t);var o=i,a=(new ke).rotate(o.rotation).translate(o.start.x,o.start.y).matrix();if(0<o.width){var s=function(t,e,n,r){var i=0<arguments.length&&void 0!==t?t:new se(0,0),o=1<arguments.length&&void 0!==e?e:1,a=2<arguments.length&&void 0!==n?n:.1,s=3<arguments.length&&void 0!==r?r:0,l=(new ke).rotate(s).translate(i.x,i.y),u=[new se(0,0-a/2),new se(0+o,0-a/2),new se(0+o,0+a/2),new se(0,0-a/2),new se(0+o,0+a/2),new se(0,0+a/2)],c=u.map((function(t){return t.transformBy(l.matrix())})),h=[];c.map((function(t){return h.push(t.x),h.push(t.y),!0}));var f=[u[0],u[1],u[2],u[5]];return{points:h,border:f}}(new se(0,0),o.length,o.width,0),l=s.points,u=s.border;e.points=l,e.border=[u]}return e.transform(a),e.setupBuffer(),e}return r}();function As(t){return(As="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Es(t,e){return(Es=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ms(t){return(Ms=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var js=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Es(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Ms(t);if(e){var o=Ms(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==As(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e,i,o,a,s,l,u){var c;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),c=n.call(this,t);var h=(new ke).rotate(i).translate(0,0).matrix(),f=function(t,e,n,r,i,o,a){var s=0<arguments.length&&void 0!==t?t:10,l=1<arguments.length&&void 0!==e?e:.1,u=2<arguments.length&&void 0!==n?n:new se(0,0),c=3<arguments.length&&void 0!==r?r:.1,h=4<arguments.length&&void 0!==i?i:.01,f=5<arguments.length&&void 0!==o&&o,d=[],p=[],y=1;6<arguments.length&&void 0!==a&&a&&(y=-1);for(var v=u.y,m=0;m<s;m+=1){var g=void 0;g=f?u.x+l*Math.floor(m/10)+Math.log10(m%10)*l:u.x+l*m,g-=h/2,d.push(g,y*v),d.push(g+h,y*v),d.push(g+h,y*(v+c)),d.push(g,v),d.push(g+h,y*(v+c)),d.push(g,y*(v+c)),p.push([new se(g,y*v),new se(g+h,y*v),new se(g+h,y*(v+c)),new se(g,y*(v+c))])}return{points:d,border:p}}(o,a,new se(e.x,e.y+u),s,l,!1,!1),d=f.points,p=f.border;return c.points=d,c.border=p,c.transform(h),c.setupBuffer(),c}return r}();function Rs(t){return(Rs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cs(t,e){return(Cs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ds(t){return(Ds=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ls=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Cs(t,e)}(r,qo);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Ds(t);if(e){var o=Ds(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Rs(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new _s,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new ke,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new oe(-1,1,2,2);return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(i=n.call(this,a,s)).props=o,i.webgl=t,i.diagramLimits=s,i.drawContext2D=e,i.build(),i}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"rebuild",value:function(){this.drawOrder=[],this.build()}},{key:"build",value:function(){var t=this.props,e=t.minorTicks,n=t.majorTicks,r=t.minorGrid,i=t.majorGrid;"auto"===n.mode&&this.props.generateAutoMajorTicks(),"auto"===e.mode&&this.props.generateAutoMinorTicks();var o=2/this.diagramLimits.width,a=this.props.valueToClip(n.start),s=this.props.valueToClip(e.start),l=this.props.getMajorNum(),u=this.props.getMinorNum();this.addTicksOrGrid("minorGrid",this.webgl,r,u,e.step,s,o,this.diagramLimits),this.addTicksOrGrid("majorGrid",this.webgl,i,l,n.step,a,o,this.diagramLimits),this.addTicksOrGrid("minorTicks",this.webgl,e,u,e.step,s,o,this.diagramLimits),this.addTicksOrGrid("majorTicks",this.webgl,n,l,n.step,a,o,this.diagramLimits);var c=new Ps(this.webgl,this.props);this.add("line",new Wo(c,new ke,this.props.color,this.diagramLimits));var h=new bo(this.props.titleFontFamily,"normal",this.props.titleFontSize,this.props.titleFontWeight,"center","middle",this.props.titleFontColor),f=[new wo(new se(0,0).transformBy((new ke).rotate(this.props.rotation).matrix()),this.props.title,h)],d=new So(this.drawContext2D[0],f);this.add("title",new Wo(d,(new ke).rotate(this.props.rotation).translate(this.props.titleOffset.x,this.props.titleOffset.y),[.5,.5,.5,1],this.diagramLimits)),this.addTickLabels("major",this.drawContext2D[0],n,this.props.generateMajorLabels.bind(this.props),this.diagramLimits,ne(this.props.majorTicks.labelOffset)),this.addTickLabels("minor",this.drawContext2D[0],e,this.props.generateMinorLabels.bind(this.props),this.diagramLimits,ne(this.props.minorTicks.labelOffset))}},{key:"toClip",value:function(t){return this.props.toClip(t)}},{key:"valueToClip",value:function(t){return this.props.valueToClip(t)}},{key:"addTicksOrGrid",value:function(t,e,n,r,i,o,a,s){if("off"!==n.mode){var l=new js(e,new se(o,this.props.start.y),this.props.rotation,r,this.toClip(i),n.length,n.width,n.offset);this.add(t,new Wo(l,(new ke).scale(1,1).rotate(0).translate(0,0),n.color,s))}}},{key:"addTickLabels",value:function(t,e,n,r,i,o){"auto"===n.labelMode&&r();var a=new bo(n.fontFamily,"normal",n.fontSize,n.fontWeight,n.labelsHAlign,n.labelsVAlign,n.fontColor);this.props.rotation>Math.PI/2*.95&&(a.yAlign="middle",a.xAlign="right");for(var s=[],l=0;l<n.labels.length;l+=1)s.push(new wo(new se(this.valueToClip(n.start+l*n.step),0).transformBy((new ke).rotate(this.props.rotation).matrix()),n.labels[l],a));var u=new So(e,s);this.add("label_".concat(t),new Wo(u,(new ke).scale(1,1).rotate(0).translate(o.x,o.y),[.5,.5,.5,1],i))}}]),r}();function Bs(t){return(Bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Is(t,e){return(Is=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Fs(t){return(Fs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ws=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Is(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Fs(t);if(e){var o=Fs(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Bs(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e){var i;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(i=n.call(this,t,"withTexture","text")).glPrimitive=t[0].gl.TRIANGLE_FAN;var o=st({},{text:"DEFAULT_TEXT",size:"20px",family:"Helvetica",style:"normal",weight:400,xAlign:"center",yAlign:"alphabetic",id:ut("vertexText")},e);return i.size=o.size,i.text=o.text,i.family=o.family,i.xAlign=o.xAlign,i.yAlign=o.yAlign,i.style=o.style,i.weight=o.weight,i.canvas=document.createElement("canvas"),i.canvas.id=o.id,i.ctx=i.canvas.getContext("2d"),i.texture={id:o.id,points:[],type:"canvasText"},i.type="vertexText",i.drawTextIntoBuffer(),i}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"resizeText",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:new se(1,1),r=this.canvas.width*n.x,i=this.canvas.height*n.y,o=new se(0,0);"center"===this.xAlign?o.x=-r/2:"right"===this.xAlign&&(o.x=-r),"baseline"===this.yAlign?o.y=.25*-i:"top"===this.yAlign?o.y=-i:"middle"===this.yAlign&&(o.y=-i/2);var a=[o,new se(o.x,o.y+i),new se(o.x+r,o.y+i),new se(o.x+r,o.y)];this.width=r,this.height=i,this.calcAscentDescent(),this.points=[],a.forEach((function(t){e.points.push(t.x),e.points.push(t.y)})),this.border=[[new se(o.x,-this.descent),new se(o.x,this.ascent),new se(o.x+r,this.ascent),new se(o.x+r,-this.descent)]];var s=this.texture;null!=s&&(s.points=[0,0,0,1,1,1,1,0],s.data=this.ctx.canvas,s.buffer?this.resetBuffer():this.setupBuffer())}},{key:"calcAscentDescent",value:function(){var t=.75,e=0,n=this.text.match(/[,.]/g);Array.isArray(n)&&n.length===this.text.length&&(t=.1);var r=this.text.match(/[acemnorsuvwxz*gyq:><;p=]/g);Array.isArray(r)&&r.length===this.text.length&&(t=.5);var i=this.text.match(/[;,$]/g);Array.isArray(i)&&0<i.length&&(e=.1);var o=this.text.match(/[gjyqp@Q(){}[\]|]/g);Array.isArray(o)&&0<o.length&&(e=.25),this.ascent=t*this.height,this.descent=e*this.height}},{key:"drawTextIntoBuffer",value:function(t){var e=0<arguments.length&&void 0!==t?t:new se(1,1),n=20;(n="string"==typeof this.size&&this.size.endsWith("px")?parseInt(this.size,10):f(("string"==typeof this.size?parseFloat(this.size):this.size)/e.x,0))<1&&(n=1),this.ctx.font="".concat(this.style," ").concat(this.weight," ").concat(n,"px ").concat(this.family);var r=this.ctx.measureText(this.text).width+.3*n,i=1.15*n;this.canvas.width=Math.max(r,1),this.canvas.height=Math.max(i,1),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font="".concat(this.style," ").concat(this.weight," ").concat(n,"px ").concat(this.family),this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",this.ctx.fillStyle="white";var o=.3*n/2,a=.75*this.canvas.height;this.ctx.fillText(this.text,o,a),this.resizeText(e)}}]),r}();function qs(t){return function(t){if(Array.isArray(t))return Ns(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Ns(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Ns(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ns(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function zs(t,e,n,r,i,o){var a,s=new ge(e,t),l=new ge(e,n);if("fromVertex"===i)a=o,a=Math.min(a,s.length()/2*.99,l.length()/2*.99);else if("radius"===i){var u=Math.abs(De(t,e,n))/2;a=o/Math.tan(u),a=Math.min(a,s.length()/2*.99,l.length()/2*.99)}else a=Math.min(s.length(),l.length());return function(t,e,n,r){if(r<1)return[t._dup(),e._dup(),n._dup()];if(1===r)return[t._dup(),n._dup()];var i=t._dup(),o=n._dup(),a=[],s=De(i,e,o);if(s===Math.PI){a.push(t._dup());for(var l=0;l<r-2;l+=1)a.push(e._dup());return a.push(n._dup()),a}var u=!1;0===s&&(u=!0,s=1e-5);var c=s/Math.abs(s),h=new ge(e,i),f=Math.abs(s/2),d=Math.PI/2,p=Math.PI-f-d,y=h.length(),v=Math.sin(d)/Math.sin(p)*y,m=new se(e.x+v*Math.cos(f*c+h.angle()),e.y+v*Math.sin(f*c+h.angle())),g=2*p/r*c*-1,b=new ge(m,i),w=b.angle(),S=b.length();if(a.push(i),u)for(var x=h.angle()+Math.PI/2,_=Math.PI/r,T=0;T<=r;T+=1)a.push(new se(m.x+1e-4*Math.cos(x+_*T),m.y+1e-4*Math.sin(x+_*T)));else for(var k=0;k<r-1;k+=1){var O=w+(k+1)*g;a.push(new se(m.x+S*Math.cos(O),m.y+S*Math.sin(O)))}return a.push(o),a}(s.pointAtPercent(a/s.length()),e,l.pointAtPercent(a/l.length()),r)}function Hs(t,e,n,r,i){var o=4<arguments.length&&void 0!==i&&i,a=new ge(e,t),s=new ge(e,n),l=a.pointAtPercent(r/a.length()),u=s.pointAtPercent(r/s.length());return!1===o&&(r>a.length()&&(l=t._dup()),r>s.length()&&(u=n._dup())),[l,e._dup(),u]}function Vs(t){return function(t){if(Array.isArray(t))return Xs(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Gs(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Us(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||Gs(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gs(t,e){if(t){if("string"==typeof t)return Xs(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xs(t,e):void 0}}function Xs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ys(t,e,n){var r,i=2<arguments.length&&void 0!==n?n:8;r=e>t.sum?h(e%t.sum,i):e;for(var o=0;o<t.definition.length;o+=1){if(r<t.cum[o])return[o,h(t.cum[o]-r,i)];if(r===t.cum[o])return o+1<t.definition.length?[o+1,h(t.cum[o+1]-r,i)]:[0,h(t.cum[0],i)]}return[0,0]}function $s(t){return function(t){if(Array.isArray(t))return Zs(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Qs(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ks(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||Qs(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qs(t,e){if(t){if("string"==typeof t)return Zs(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zs(t,e):void 0}}function Zs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Js(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"line",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"none",i=[],o=[],a=[[]];return t.forEach((function(t){var s=t[0],l=t.slice(-1)[0];if(e)for(var u=0;u<t.length;u+=1)i.push(t[u].p1._dup()),i.push(t[u].p2._dup());else i.push(l.p1._dup()),i.push(l.p2._dup()),i.push(s.p1._dup()),i.push(s.p1._dup()),i.push(l.p2._dup()),i.push(s.p2._dup());"line"===n?o.push([s.p1._dup(),s.p2._dup(),l.p2._dup(),l.p1._dup()]):"negative"===n?(0===o.length&&o.push([]),o[0].push(s.p1._dup(),s.p2._dup())):"positive"===n&&(0===o.length&&o.push([]),o[0].push(l.p1._dup(),l.p2._dup())),"positive"===r?a[0].push(l.p1._dup(),l.p2._dup()):"negative"===r&&a[0].push(s.p1._dup(),s.p2._dup())})),Array.isArray(n)&&(o=n),Array.isArray(r)&&(a=r),[i,o,a]}function tl(t,e){var n=t.intersectsWith(e);null!=n.intersect&&(t.setP2(n.intersect._dup()),e.setP1(n.intersect._dup()))}function el(t,e,n,r){var i=De(t.p1,t.p2,e.p2),o=new ge(t.p2,1,t.angle()+i/2+Math.PI/2),a=o.intersectsWith(n);null!=a.intersect&&n.setP2(a.intersect),null!=(a=o.intersectsWith(r)).intersect&&r.setP1(a.intersect)}function nl(t,e,n,r){var i=n.intersectsWith(e);null!=i.intersect&&n.setP2(i.intersect),null!=(i=r.intersectsWith(t)).intersect&&r.setP1(i.intersect)}function rl(t,e,n,r){var i=n.intersectsWith(e);null!=i.intersect&&i.intersect.isWithinLine(e,8)&&n.setP2(i.intersect),null!=(i=r.intersectsWith(t)).intersect&&i.intersect.isWithinLine(t,8)&&r.setP1(i.intersect)}function il(t,e,n,r,i,o,a,s,l,u){function c(t,e,n){var r=T[t],i=T[e],o=k[t][n],a=k[e][n],s=Ce(r.p1,r.p2,i.p2);0<s&&s<O?"mid"===x?el(r,i,o,a):"negative"===x?nl(r,i,o,a):"positive"===x&&el(r,i,o,a):O<=s&&s<=Math.PI/2?"mid"===x?tl(o,a):"negative"===x?nl(r,i,o,a):"positive"===x&&tl(o,a):Math.PI/2<=s&&s<Math.PI?"mid"===x?tl(o,a):"negative"===x?rl(r,i,o,a):"positive"===x&&tl(o,a):s===Math.PI?"negative"!==x&&"positive"!==x||("inside"===d?rl(r,i,o,a):tl(o,a)):Math.PI<s&&s<Math.PI/2*3?"mid"===x?(tl(o,a),tl(o,a)):"negative"===x?tl(o,a):"positive"===x&&rl(r,i,o,a):Math.PI/2*3<=s&&s<=2*Math.PI-O?"mid"===x||"negative"===x?tl(o,a):"positive"===x&&nl(r,i,o,a):2*Math.PI-O<s&&s<2*Math.PI?"mid"===x||"negative"===x?el(r,i,o,a):"positive"===x&&nl(r,i,o,a):Math.PI}function h(t,e){var n=T[t],r=T[e],i=k[t].slice(-1)[0],o=k[e].slice(-1)[0],a=k[t][0],s=k[e][0],l=Ce(n.p1,n.p2,r.p2);if(m)for(var u=0;u<k[t].length;u+=1)P.push(k[t][u].p2._dup()),P.push(k[e][u].p1._dup());else l<Math.PI?"inside"!==d&&(P.push(i.p2._dup()),P.push(n.p2._dup()),P.push(o.p1._dup())):l>Math.PI&&"inside"!==d&&(P.push(a.p2._dup()),P.push(n.p2._dup()),P.push(s.p1._dup()))}var f=1<arguments.length&&void 0!==e?e:.01,d=2<arguments.length?n:void 0,p=3<arguments.length&&void 0!==r&&r,y=4<arguments.length?i:void 0,v=5<arguments.length&&void 0!==o?o:Math.PI/7,m=6<arguments.length&&void 0!==a&&a,g=7<arguments.length&&void 0!==s?s:2,b=8<arguments.length&&void 0!==l?l:"line",w=9<arguments.length&&void 0!==u?u:"none",S=f,x=function(t,e,n){if("mid"===n||"negative"===n||"positive"===n)return n;for(var r=0,i=e?t.length:t.length-2,o=function(t,e,n){var o=Ce(t,e,n);o<Math.PI&&(r+=1),o===Math.PI&&--i},a=1;a<t.length-1;a+=1)o(t[a-1],t[a],t[a+1]);return e&&(o(t[t.length-1],t[0],t[1]),o(t[t.length-2],t[t.length-1],t[0])),i/2<=r?"inside"===n?"negative":"positive":"inside"===n?"positive":"negative"}(t,p,d),_=Ks(function(t,e,n,r,i,o,a){for(var s=6<arguments.length&&void 0!==a?a:2,l=[],u=function(t,e){return new ge(t,e)},c=0;c<t.length-1;c+=1)l.push(u(t[c],t[c+1]));n&&l.push(u(t[t.length-1],t[0]));for(var h=[],f=function(t,e,n,a,s){var l=a,u=a,c=Math.PI;if(null!=t){c=Ce(t.p1,e.p1,e.p2);var f=De(t.p1,e.p1,e.p2),d=e.distanceToPoint(t.p1),p=Math.min(d,Math.tan(Math.abs(f))*e.length());c<Math.PI/2?l=Math.min(l,p):c>Math.PI/2*3&&(u=Math.min(u,p))}var y,v=Math.PI;if(null!=n){v=Ce(e.p1,e.p2,n.p2);var m=De(e.p1,e.p2,n.p2),g=e.distanceToPoint(n.p2),b=Math.min(g,Math.tan(Math.abs(m))*e.length());v<Math.PI/2?l=Math.min(l,b):v>Math.PI/2*3&&(u=Math.min(u,b))}y="negative"===i?"auto"===r&&(o||c<Math.PI||v<Math.PI)?e.offset("negative",l):e.offset("negative",a):"positive"===i&&"auto"===r&&(o||c>Math.PI||v>Math.PI)?e.offset("positive",u):e.offset("positive",a),h[s].push(y)},d=e/(s-1),p=0;p<l.length;p+=1){var y=0<p?l[p-1]:null,v=l[p],m=p<l.length-1?l[p+1]:null;if(n&&0===p&&(y=l[l.length-1]),n&&p===l.length-1&&(m=l[0]),h.push([]),"negative"===i||"positive"===i)h[p].push(v._dup());else if(1===s)h[p].push(v._dup());else{var g=v.offset("negative",e/2);h[p].push(g)}for(var b=1;b<s;b+=1)f(y,v,m,"negative"===i||"positive"===i?b*d:-e/2+b*d,p);"negative"===i&&h[p].reverse()}return[l,h]}(t,S,p,y,x,"inside"===d,g),2),T=_[0],k=_[1],O=null==v?0:v,P=[];if("none"!==y)for(var A=0;A<g;A+=1){for(var E=0;E<k.length-1;E+=1)"auto"===y?c(E,E+1,A):0===A&&h(E,E+1);p&&("auto"===y?c(k.length-1,0,A):0===A&&h(k.length-1,0))}var M=Ks(Js(k,m,b,w),3),j=M[0],R=M[1],C=M[2];return[[].concat($s(j),P),R,C]}function ol(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.01,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"mid",o=4<arguments.length?arguments[4]:void 0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.1,s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:10,l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:Math.PI/7,u=8<arguments.length&&void 0!==arguments[8]?arguments[8]:[],c=9<arguments.length&&void 0!==arguments[9]&&arguments[9],f=10<arguments.length&&void 0!==arguments[10]?arguments[10]:2,d=11<arguments.length?arguments[11]:void 0,p=12<arguments.length?arguments[12]:void 0,y=13<arguments.length&&void 0!==arguments[13]?arguments[13]:8,v=[],m=t;if("auto"===o?(v=m.map((function(t){return t._dup()})),e="auto"):"radius"===o?(v=function(t,e,n,r,i){var o=[];e?o=zs(t[t.length-1],t[0],t[1],r,n,i):o.push(t[0]);for(var a=1;a<t.length-1;a+=1){var s=zs(t[a-1],t[a],t[a+1],r,n,i);o=[].concat(qs(o),qs(s))}return e?o=[].concat(qs(o),qs(zs(t[t.length-2],t[t.length-1],t[0],r,n,i))):o.push(t[t.length-1]._dup()),o}(m,r,"fromVertex",s,a),e="fill"):(e=o,v=m.map((function(t){return t._dup()}))),1<u.length){var g=function(t,e,n,r,i){for(var o,a,s,l=2<arguments.length&&void 0!==n&&n,u=4<arguments.length&&void 0!==i?i:8,c=[],f=(a=[],s=(o=e).reduce((function(t,e){return a.push(t+e),t+e}),0),{definition:o,sum:s,cum:a}),d=0,p=!1,y=function(t,e){var n=function(t,e,n,r,i){for(var o=4<arguments.length&&void 0!==i?i:8,a=[],s=0,l=Us(Ys(t,r,o),2),u=l[0],c=l[1],f=new ge(e,n),d=h(f.length(),o),p=h(c,o),y=u;s<d;){if(u%2==0){var v,m=f.pointAtPercent(s/d);v=h(s+p,o)<=d?f.pointAtPercent((s+p)/d):n._dup(),s+=p,a.push([m,v])}else s+=p;s=h(s,o),u=((y=u)+1)%t.definition.length,p=h(t.definition[u],o)}return{points:a,continues:d<s&&y%2==0}}(f,t,e,d,u),r=n.points,i=n.continues;c=p&&null!=r[0]?(c[c.length-1]=[].concat(Vs(c[c.length-1]),Vs(r[0].slice(1))),[].concat(Vs(c),Vs(r.slice(1)))):[].concat(Vs(c),Vs(r)),p=i,d=h(d+fe(t,e),u)},v=0;v<t.length-1;v+=1)y(t[v],t[v+1]);if(l){y(t[t.length-1],t[0]);var m=Us(Ys(f,0),1)[0];p&&m%2==0&&1<c.length&&(c[0]=[].concat(Vs(c[c.length-1]),Vs(c[0].slice(1))))}return c}(v,u,r,0,y),b=!1;1===g.length&&(b=r);var w=[],S=[[]],x=[[]];return g.forEach((function(t){var r=Ks(il(t,n,i,b,e,l,c,f,d,p),3),o=r[0],a=r[1],s=r[2];w=[].concat($s(w),$s(o)),S=[[].concat($s(S[0]),$s(a[0]))],x=[[].concat($s(x[0]),$s(s[0]))]})),[w,S,x]}return il(v,n,i,r,e,l,c,f,d,p)}function al(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.01,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length?arguments[3]:void 0,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"mid",o=5<arguments.length?arguments[5]:void 0,a=6<arguments.length?arguments[6]:void 0,s=7<arguments.length?arguments[7]:void 0,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:Math.PI/7,u=9<arguments.length&&void 0!==arguments[9]&&arguments[9],c=10<arguments.length&&void 0!==arguments[10]?arguments[10]:1,h=function(t,e,n,r){for(var i=3<arguments.length&&!1,o=[],a=1;a<t.length-1;a+=1)o.push(Hs(t[a-1],t[a],t[a+1],n,i));return e&&(o.push(Hs(t[t.length-2],t[t.length-1],t[0],n,i)),o.push(Hs(t[t.length-1],t[0],t[1],n,i))),o}(t,n,r,!1),f=[],d=[],p=[];return h.forEach((function(t){var n=Ks(ol(t,e,!1,i,o,a,s,l,[],u,c,"line","none"),3),r=n[0],h=n[1],y=n[2];f=[].concat($s(f),$s(r)),d=[].concat($s(d),$s(h)),p=[].concat($s(p),$s(y))})),[f,d,p]}function sl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ll(t,e,n,r,i,o){var a=2*Math.PI/r,s=[];if(0===i)return[];for(var l=0;l<i;l+=1)s.push(new se(t*Math.cos(a*l*o+e)+n.x,t*Math.sin(a*l*o+e)+n.y));return i<r&&s.push(new se(t*Math.cos(a*i*o+e)+n.x,t*Math.sin(a*i*o+e)+n.y)),s}function ul(t,e,n,r,i,o){var a,s=[n._dup()].concat(function(t){if(Array.isArray(t))return sl(t)}(a=ll(t,e,n,r,i,o))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(a)||function(t){if(t){if("string"==typeof t)return sl(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?sl(t,void 0):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return r===i&&s.push(s[1]._dup()),s}function cl(t){return function(t){if(Array.isArray(t))return dl(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||fl(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||fl(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fl(t,e){if(t){if("string"==typeof t)return dl(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dl(t,e):void 0}}function dl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function pl(t,e){function n(e){var n=t[e];null!=n&&"string"!=typeof n&&(Array.isArray(n)&&"number"!=typeof n[0]?t[e]=function t(e){for(var n=0;n<e.length;n+=1)Array.isArray(e[n])&&"number"!=typeof e[n][0]?e[n]=t(e[n]):e[n]=ne(e[n]);return e}(n):t[e]=ne(n))}"string"==typeof e?n(e):e.forEach((function(t){return n(t)}))}function yl(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=st.apply(void 0,[{}].concat(e));if(null!=r.position){var i=ne(r.position);null==r.transform&&(r.transform=new ke("processOptions").translate(0,0)),r.transform.updateTranslation(i)}return r}function vl(t,e){null!=e.pulse&&"function"!=typeof t.pulseDefault&&"string"!=typeof t.pulseDefault&&(t.pulseDefault.scale=e.pulse)}var ml=function(){function t(e,n,r,i,o,a){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),Array.isArray(e)?this.webgl=e:this.webgl=[e],Array.isArray(n)?this.draw2D=n:this.draw2D=[n],this.htmlCanvas=r,this.limits=i,this.animateNextFrame=a,this.spaceTransforms=o}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"generic",value:function(){for(var t={points:[],border:null,hole:null,drawType:"triangles",color:[1,0,0,1],transform:new ke("generic").standard(),position:null,texture:{src:"",mapTo:new oe(-1,-1,2,2),mapFrom:new oe(0,0,1,1),repeat:!1,onLoad:this.animateNextFrame}},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[t].concat(n));if(null!=i.position){var o=ne(i.position);i.transform.updateTranslation(o)}function a(t){if(null==t||!Array.isArray(t))return null;var e=[];return t.forEach((function(t){Array.isArray(t)&&e.push(t.map((function(t){return ne(t)})))})),e}var s=i.points.map((function(t){return ne(t)})),l=a(i.border),u=a(i.hole),c=i.copy;null==i.copy||Array.isArray(i.copy)||(c=[i.copy]);var h=function(t,e,n,r,i,o,a,s,l,u,c,h,f,d){var p=8<arguments.length&&void 0!==l?l:"",y=9<arguments.length&&void 0!==u?u:new oe(-1,-1,2,2),v=10<arguments.length&&void 0!==c?c:new oe(0,0,1,1),m=12<arguments.length&&void 0!==f?f:null,g=new es(t,e,n,r,i,p,y,v,11<arguments.length&&void 0!==h&&h,13<arguments.length?d:void 0);p&&(g.onLoad=m);var b=new ke;return b=a instanceof se?b.translate(a.x,a.y):a._dup(),new Wo(g,b,o,s)}(this.webgl,s,l,u,i.drawType,i.color,i.transform,this.limits,i.texture.src,i.texture.mapTo,i.texture.mapFrom,i.texture.repeat,i.texture.onLoad,c);return vl(h,i),h}},{key:"polyline",value:function(){for(var t={width:.01,color:[1,0,0,1],close:!1,widthIs:"mid",cornerStyle:"auto",cornerSize:.01,cornerSides:10,cornersOnly:!1,cornerLength:.1,minAutoCornerAngle:Math.PI/7,dash:[],linePrimitives:!1,lineNum:1,transform:new ke("polyline").standard(),border:"line",hole:"none"},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i,o=yl.apply(void 0,[t].concat(n));pl(o,["points","border","hole"]),!1===o.linePrimitives&&(o.lineNum=2);var a=hl((i=o.cornersOnly?function(t){return al(t,o.width,o.close,o.cornerLength,o.widthIs,o.cornerStyle,o.cornerSize,o.cornerSides,o.minAutoCornerAngle,o.linePrimitives,o.lineNum)}:function(t){return ol(t,o.width,o.close,o.widthIs,o.cornerStyle,o.cornerSize,o.cornerSides,o.minAutoCornerAngle,o.dash,o.linePrimitives,o.lineNum,o.border,o.hole)})(o.points),3),s=a[0],l=a[1],u=a[2],c=this.generic(o,{drawType:o.linePrimitives?"lines":"triangles",points:s,border:Array.isArray(o.border)?o.border:l,holeBorder:Array.isArray(o.hole)?o.hole:u});return c.custom.updatePoints=function(t){var e;(e=c.drawingObject).change.apply(e,cl(i(t)))},vl(c,o),c}},{key:"polygon",value:function(){for(var t={radius:1,sides:4,direction:1,rotation:0,width:.01,offset:new se(0,0),transform:new ke("polygon").standard(),touchableLineOnly:!1},e=0,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var o,a=yl.apply(void 0,[t].concat(r));if(null==a.line||null!=a.line&&null==a.line.widthIs){null==a.line&&(a.line={}),a.line.widthIs="mid";var s=2*Math.PI/a.sides,l=(Math.PI-s)/2;e=a.width/2/Math.sin(l)}if(pl(a,["offset"]),null!=a.angleToDraw&&(a.sidesToDraw=Math.floor(a.angleToDraw/(2*Math.PI/a.sides))),null==a.sidesToDraw&&(a.sidesToDraw=a.sides),a.fill){var u=ul(a.radius,a.rotation,a.offset,a.sides,a.sidesToDraw,a.direction);(o=this.generic(a,{drawType:"fan",points:u,border:[cl(u.slice(1,-1))]})).custom.update=function(t){var e=st({},a,t),n=ul(e.radius,e.rotation,e.offset,e.sides,e.sidesToDraw,e.direction);o.drawingObject.change(n,[cl(n.slice(1,-1))],[])}}else{var c,h=ll(a.radius-e,a.rotation,a.offset,a.sides,a.sidesToDraw,a.direction),f="line";1===a.direction&&(f="negative",c="positive"),-1===a.direction&&(f="positive",c="negative"),o=this.polyline(a,a.line,{points:h,close:a.sides===a.sidesToDraw,border:f,hole:c});var d=function(t){for(var e=[],n=0;n<t.drawingObject.border[0].length;n+=2)e.push(t.drawingObject.border[0][n]._dup());t.drawingObject.border=[e]};d(o),o.custom.update=function(t){var n=st({},a,t),r=ll(n.radius-e,n.rotation,n.offset,n.sides,n.sidesToDraw,n.direction);o.custom.updatePoints(r),d(o)}}return o}},{key:"grid",value:function(){for(var t={bounds:new oe(-1,-1,2,2),width:.005,transform:new ke("grid").standard(),dash:[],linePrimitives:!1,lineNum:2},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=yl.apply(void 0,[t].concat(n));function o(t){return ol(t,i.width,!1,"mid","auto",.1,1,Math.PI/7,i.dash,i.linePrimitives,i.lineNum,[[]],[[]])}pl(i,[]),i.bounds=ae(i.bounds);var a=i.bounds,s=i.xStep,l=i.xNum,u=i.yStep,c=i.yNum,h=i.width;i.linePrimitives&&1===i.lineNum&&(h=0);var f=a.width,d=a.height;null!=s&&null==l&&(l=0===s?1:1+Math.floor((f+.1*s)/s)),null!=u&&null==c&&(c=0===u?1:1+Math.floor((d+.1*u)/u)),null==l&&(l=2),null==c&&(c=2),s=l<2?0:f/(l-1),u=c<2?0:d/(c-1);var p=new se(a.left,a.bottom),y=p.add(-h/2,0),v=p.add(f+h/2,0),m=p.add(0,-h/2),g=p.add(0,d+h/2),b=[],w=[];return 0<l&&(w=Ka(hl(o([m,g]),1)[0],[{along:"x",num:l-1,step:s}])),0<c&&(b=Ka(hl(o([y,v]),1)[0],[{along:"y",num:c-1,step:u}])),this.generic(i,{drawType:i.linePrimitives?"lines":"triangles",points:[].concat(cl(b),cl(w)),border:[[p.add(-h/2,-h/2),p.add(f+h/2,-h/2),p.add(f+h/2,d+h/2),p.add(-h/2,d+h/2)]]})}},{key:"polygonSweep",value:function(){for(var t={sides:4,fill:!1,transform:new ke("polygonSweep").standard(),line:{linePrimitives:!1,lineNum:2}},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=yl.apply(void 0,[t].concat(n,[{line:{cornerStyle:"auto",cornersOnly:!1}}])),o=this.polygon(i);return o.drawingObject.getPointCountForAngle=function(t){var e=Math.floor(f(t,8)/f(2*Math.PI,8)*i.sides);return i.fill?e+2:i.line&&i.line.linePrimitives?e*i.line.lineNum*2:6*e},o}},{key:"fan",value:function(){for(var t={points:[],color:[1,0,0,1],transform:new ke("fan").standard(),position:null},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=Object.assign.apply(Object,[{},t].concat(n));if(null!=i.position){var o=ne(i.position);i.transform.updateTranslation(o)}var a,s,l,u,c,h,f,d=(a=this.webgl,s=i.points.map((function(t){return ne(t)})),l=i.color,u=i.transform,c=this.limits,h=new _a(a,s),f=new ke,f=u instanceof se?f.translate(u.x,u.y):u._dup(),new Wo(h,f,l,c));return vl(d,i),null!=i.mods&&i.mods!=={}&&d.setProperties(i.mods),d}},{key:"textGL",value:function(t){return function(t,e,n){var r=st({},{position:new se(0,0),color:[1,0,0,1]},n);null==r.transform&&(r.transform=new ke("Text").translate(0,0)),null!=r.position&&r.transform.updateTranslation(r.position);var i=new Ws(t,r);return new Wo(i,r.transform,r.color,e)}(this.webgl,this.limits,t)}},{key:"text",value:function(t){for(var e,n={text:"",font:null,family:"Times New Roman",style:"italic",size:.2,weight:"200",xAlign:"center",yAlign:"middle",offset:new se(0,0),color:[1,0,0,1],transform:new ke("text").standard()},r=arguments.length,i=new Array(1<r?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];if(null!=(e=st.apply(void 0,"string"==typeof t?[{},n,{text:t}].concat(i):[{},n,t].concat(i))).position){var a=ne(e.position);e.transform.updateTranslation(a)}var s=e,l=s.text,u=s.font;null===u&&(u=new bo(s.family,s.style,s.size,s.weight,s.xAlign,s.yAlign,s.color));var c=new wo(s.offset,l,u),h=new So(this.draw2D,[c]),f=new Wo(h,s.transform,s.color,this.limits);return vl(f,e),null!=e.mods&&e.mods!=={}&&f.setProperties(e.mods),f}},{key:"arrow",value:function(){for(var t={width:.5,legWidth:0,height:.5,legHeight:0,color:[1,0,0,1],transform:new ke("arrow").standard(),tip:new se(0,0),rotation:0},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=Object.assign.apply(Object,[{},t].concat(n));if(null!=i.position){var o=ne(i.position);i.transform.updateTranslation(o)}var a=new ys(this.webgl,i.width,i.legWidth,i.height,i.legHeight,ne(i.tip),i.rotation,i.color,i.transform,this.limits);return vl(a,i),null!=i.mods&&i.mods!=={}&&a.setProperties(i.mods),a}},{key:"html",value:function(t){var e,n,r=st({},{classes:"",position:[0,0],xAlign:"center",yAlign:"middle",wrap:!0,id:"id__temp_".concat(Math.round(1e4*Math.random()))},t);if(r.element=t.element,r.wrap||Array.isArray(r.element))(e=document.createElement("div")).setAttribute("id",r.id),Array.isArray(r.element)?r.element.forEach((function(t){return e.appendChild(t)})):e.appendChild(r.element),this.htmlCanvas.appendChild(e),n=this.htmlCanvas;else{var i=(e=r.element).getAttribute("id");""===i?e.setAttribute("id",r.id):r.id=i,n=e.parentElement}null==n&&(n=this.htmlCanvas);var o=new eo(n,r.id,new se(0,0),r.yAlign,r.xAlign),a=ne(r.position);return new Wo(o,(new ke).scale(1,1).translate(a.x,a.y),[1,1,1,1],this.limits)}},{key:"htmlElement",value:function(t,e,n,r,i,o){var a=1<arguments.length&&void 0!==e?e:"id__temp_".concat(Math.round(1e4*Math.random())),s=2<arguments.length&&void 0!==n?n:"",l=3<arguments.length&&void 0!==r?r:new se(0,0),u=4<arguments.length&&void 0!==i?i:"middle",c=5<arguments.length&&void 0!==o?o:"left",h=document.createElement("div");s&&h&&s.split(" ").forEach((function(t){return h.classList.add(t.trim())})),Array.isArray(t)?t.forEach((function(t){return h.appendChild(t)})):h.appendChild(t),h.style.position="absolute",h.setAttribute("id",a),this.htmlCanvas.appendChild(h);var f=new eo(this.htmlCanvas,a,new se(0,0),u,c);return new Wo(f,(new ke).scale(1,1).translate(l.x,l.y),[1,1,1,1],this.limits)}},{key:"htmlImage",value:function(){for(var t={id:ut("id__html_image_"),classes:"",position:new se(0,0),yAlign:"middle",xAlign:"left",src:""},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n)),o=document.createElement("img");o.src=i.src;var a=i.id,s=i.classes,l=i.position,u=i.yAlign,c=i.xAlign,h=this.htmlElement(o,a,s,ne(l),u,c);return null!=i.color&&h.setColor(i.color),vl(h,i),h}},{key:"htmlText",value:function(){for(var t={text:"",id:ut("id__html_text_"),classes:"",position:new se(0,0),yAlign:"middle",xAlign:"left"},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n)),o=document.createElement("div");ba(o,i.text,i.modifiers);var a=i.id,s=i.classes,l=i.position,u=i.yAlign,c=i.xAlign,h=this.htmlElement(o,a,s,ne(l),u,c);return null!=i.color&&h.setColor(i.color),vl(h,i),h}},{key:"lines",value:function(t,e,n,r){var i,o,a,s,l,u,c=1<arguments.length&&void 0!==e?e:1,h=2<arguments.length?n:void 0,f=3<arguments.length&&void 0!==r?r:new ke;return i=this.webgl,o=h,a=f,s=this.limits,l=new cs(i,t,c),u=new ke,u=a instanceof se?u.translate(a.x,a.y):a._dup(),new Wo(l,u,o,s)}},{key:"horizontalLine",value:function(t,e,n,r,i,o){var a,s,l,u,c,h,f=5<arguments.length&&void 0!==o?o:new ke;return a=this.webgl,s=i,l=f,u=this.limits,c=new ja(a,t,e,n,r),h=new ke,h=l instanceof se?h.translate(l.x,l.y):l._dup(),new Wo(c,h,s,u)}},{key:"dashedLine",value:function(){for(var t={start:[0,0],length:1,width:.01,rotation:0,dashStyle:[.1,.1],transform:new ke("dashedLine").scale(1,1).rotate(0).translate(0,0),position:null},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));null!=i.position&&i.transform.updateTranslation(ne(i.position));var o,a,s,l,u,c,h,f,d,p,y,v=(o=this.webgl,a=ne(i.start),s=i.length,l=i.width,u=i.rotation,c=i.dashStyle,h=i.color,f=i.transform,d=this.limits,p=new La(o,a,s,l,u,c),y=new ke,y=f instanceof se?y.translate(f.x,f.y):f._dup(),new Wo(p,y,h,d));return vl(v,i),v}},{key:"rectangle",value:function(){for(var t={yAlign:"middle",xAlign:"center",width:1,height:1,lineWidth:.01,corner:{radius:0,sides:1},fill:!1,color:[1,0,0,1],transform:new ke("rectangle").scale(1,1).rotate(0).translate(0,0),position:null},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i,o,a,s,l,u,c,h,f,d,p,y,v,m,g,b,w,S,x,_,T,k,O,P,A,E,M=st.apply(void 0,[{},t].concat(n));return null!=M.position&&M.transform.updateTranslation(ne(M.position)),"string"!=typeof M.reference&&(M.reference=ne(M.reference)),vl(i=M.fill?(g=this.webgl,b=M.xAlign,w=M.yAlign,S=M.width,x=M.height,_=M.corner.radius,T=M.corner.sides,k=M.color,O=M.transform,P=this.limits,A=new Na(g,b,w,S,x,_,T),E=new ke,E=O instanceof se?E.translate(O.x,O.y):O._dup(),new Wo(A,E,k,P)):(o=this.webgl,a=M.xAlign,s=M.yAlign,l=M.width,u=M.height,c=M.lineWidth,h=M.corner.radius,f=M.corner.sides,d=M.color,p=M.transform,y=this.limits,v=new Xa(o,a,s,l,u,c,h,f),m=new ke,m=p instanceof se?m.translate(p.x,p.y):p._dup(),new Wo(v,m,d,y)),M),i}},{key:"box",value:function(){for(var t={width:1,height:1,fill:!1,lineWidth:.01,color:[1,0,0,1],transform:(new ke).scale(1,1).rotate(0).translate(0,0),position:null},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));null!=i.position&&i.transform.updateTranslation(ne(i.position)),"string"!=typeof i.reference&&(i.reference=ne(i.reference));var o=function(t,e,n,r,i,o,a,s){var l=new os(t,e,n,r,i),u=new ke;u=a instanceof se?u.translate(a.x,a.y):a._dup();var c=new Wo(l,u,o,s);return c.surround=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"diagram",i=[t];if(null!=e&&""!==e&&(i=t.getElements(e)),0!==i.length){var o;o="number"==typeof n?new se(n,n):ne(n);for(var a=i[0].getBoundingRect(r),s=1;s<i.length;s+=1){var l=i[s].getBoundingRect(r);l.left<a.left&&(a.left=l.left),l.bottom<a.bottom&&(a.bottom=l.bottom),l.right-a.left>a.width&&(a.width=l.right-a.left),l.top-a.bottom>a.height&&(a.height=l.top-a.bottom)}a.left-=o.x,a.bottom-=o.y,a.height+=2*o.x,a.width+=2*o.y,a.right=a.left+a.width,a.top=a.bottom+a.height,c.drawingObject.updateBox(a.width,a.height),c.setPosition(a.left+a.width/2,a.bottom+a.height/2),c.pointsDefinition={width:a.width,height:a.height}}},c.custom.setSize=function(t,e){c.drawingObject.updateBox(t,e),c.pointsDefinition={width:t,height:e}},c.setPointsFromDefinition=function(){var t=c.pointsDefinition.width,e=c.pointsDefinition.height;null!=t&&null!=e&&c.custom.setSize(t,e)},c}(this.webgl,i.width,i.height,i.lineWidth,i.fill,i.color,i.transform,this.limits);return vl(o,i),o}},{key:"radialLines",value:function(){for(var t={innerRadius:0,outerRadius:1,width:.05,dAngle:Math.PI/4,angle:2*Math.PI,transform:(new ke).standard()},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));null!=i.position&&i.transform.updateTranslation(ne(i.position));var o=function(t,e,n,r,i,o,a,s,l){var u=1<arguments.length&&void 0!==e?e:0,c=2<arguments.length&&void 0!==n?n:1,h=3<arguments.length&&void 0!==r?r:.05,f=4<arguments.length&&void 0!==i?i:Math.PI/4,d=5<arguments.length&&void 0!==o?o:2*Math.PI,p=6<arguments.length?a:void 0,y=7<arguments.length?s:void 0,v=8<arguments.length?l:void 0,m=new Pa(t,u,c,h,f,d),g=new ke;return g=y instanceof se?g.translate(y.x,y.y):y._dup(),new Wo(m,g,p,v)}(this.webgl,i.innerRadius,i.outerRadius,i.width,i.dAngle,i.angle,i.color,i.transform,this.limits);return vl(o,i),o}},{key:"repeatPatternVertex",value:function(){for(var t={element:null,xNum:2,yNum:2,xStep:1,yStep:1,transform:new ke("repeatPattern").standard()},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));null!=i.position&&i.transform.updateTranslation(ne(i.position));var o=i.element,a=i.transform,s=i.xNum,l=i.yNum,u=i.xStep,c=i.yStep;if(null==o)return this.collection();var h=o._dup(),f=o.drawingObject;if(f instanceof so){h.transform=a._dup();for(var d=[],p=f.points,y=0;y<s;y+=1)for(var v=0;v<l;v+=1)for(var m=0;m<p.length;m+=2)d.push(new se(p[m]+y*u,p[m+1]+v*c));h.drawingObject.changeVertices(d)}return null!=i.pulse&&"function"!=typeof o.pulseDefault&&(h.pulseDefault.scale=i.pulse),h}},{key:"cursor",value:function(t){var e=st({color:[1,1,0,.5],width:.01,radius:.05},t),n=this.collection(),r={width:e.width,color:e.color,radius:e.radius,sides:50},i=this.polygon(r),o=this.polygon(st({},r,{fill:!0}));return n.add("up",i),n.add("down",o),n}},{key:"collection",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},n=new ke("collection").scale(1,1).rotate(0).translate(0,0),r=[1,0,0,1],i=null;if(e instanceof se)n.updateTranslation(e);else if(e instanceof ke)n=e._dup();else{for(var o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];var l=st.apply(void 0,[e].concat(a));null!=l.transform&&(n=l.transform),null!=l.position&&n.updateTranslation(ne(l.position)),null!=l.color&&(r=l.color),null!=l.pulse&&(i=l.pulse)}var u=new qo(n,this.limits);return u.setColor(r),null!=i&&"function"!=typeof u.pulseDefault&&"string"!=typeof u.pulseDefault&&(u.pulseDefault.scale=i),u}},{key:"repeatPattern",value:function(t,e,n,r,i,o){var a,s=5<arguments.length&&void 0!==o?o:new ke;a=s instanceof ke?this.collection({transform:s}):this.collection({transform:(new ke).translate(s)});var l=t.transform.t(),u=t.transform._dup();if(null===l&&(l=new se(0,0),u=u.translate(0,0)),l)for(var c=0;c<e;c+=1)for(var h=0;h<n;h+=1){var f=t._dup();f.transform=u._dup(),f.transform.updateTranslation(l.x+r*c,l.y+i*h),a.add("xy".concat(c).concat(h),f)}return a}},{key:"repeatPatternVertexLegacy",value:function(t,e,n,r,i,o){var a=5<arguments.length&&void 0!==o?o:new ke,s=t._dup(),l=t.drawingObject;if(l instanceof so){s.transform=a._dup();for(var u=[],c=l.points,h=0;h<e;h+=1)for(var f=0;f<n;f+=1)for(var d=0;d<c.length;d+=2)u.push(new se(c[d]+h*r,c[d+1]+f*i));s.drawingObject.changeVertices(u)}return s}},{key:"axes",value:function(){for(var t={width:1,height:1,limits:new oe(-1,-1,2,2),yAxisLocation:0,xAxisLocation:0,stepX:.1,stepY:.1,fontSize:.13,showGrid:!0,color:[1,1,1,0],location:new ke,decimalPlaces:1,lineWidth:.01},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=st.apply(void 0,[{},t].concat(n));null==i.fontColor&&(i.fontColor=i.color.slice()),null==i.gridColor&&(i.gridColor=i.color.slice());var o=i.width,a=i.lineWidth,s=i.limits,l=i.color,u=i.stepX,c=i.decimalPlaces,f=i.yAxisLocation,d=i.xAxisLocation,p=i.fontSize,y=i.height,v=i.stepY,m=i.location,g=i.showGrid,b=i.gridColor,w=i.fontColor,S=new _s("x",0);S.minorTicks.mode="off",S.minorGrid.mode="off",S.majorGrid.mode="off",S.length=o,S.width=a,S.limits={min:s.left,max:s.right},S.color=l.slice(),S.title="",S.majorTicks.start=s.left,S.majorTicks.step=u,S.majorTicks.length=5*a,S.majorTicks.offset=-S.majorTicks.length/2,S.majorTicks.width=2*a,S.majorTicks.labelMode="off",S.majorTicks.color=l.slice(),S.majorTicks.labels=x(S.limits.min,S.limits.max,u).map((function(t){return t.toFixed(c)})).map((function(t){return t===f.toString()&&f===d?"".concat(t,"     "):t})),S.majorTicks.labelOffset=new se(0,S.majorTicks.offset-.1*p),S.majorTicks.labelsHAlign="center",S.majorTicks.labelsVAlign="top",S.majorTicks.fontColor=w.slice(),S.majorTicks.fontSize=p,S.majorTicks.fontWeight="400";var _=new Ls(this.webgl,this.draw2D,S,(new ke).scale(1,1).rotate(0).translate(0,d-s.bottom*y/2),this.limits),T=new _s("x",0);T.minorTicks.mode="off",T.minorGrid.mode="off",T.majorGrid.mode="off",T.length=y,T.width=S.width,T.limits={min:s.bottom,max:s.top},T.color=S.color,T.title="",T.rotation=Math.PI/2,T.majorTicks.step=v,T.majorTicks.start=s.bottom,T.majorTicks.length=S.majorTicks.length,T.majorTicks.offset=-T.majorTicks.length/2,T.majorTicks.width=S.majorTicks.width,T.majorTicks.labelMode="off",T.majorTicks.color=l.slice(),T.majorTicks.labels=x(T.limits.min,T.limits.max,v).map((function(t){return t.toFixed(c)})).map((function(t){return t===d.toString()&&f===d?"":t})),T.majorTicks.labelOffset=new se(T.majorTicks.offset-.2*p,0),T.majorTicks.labelsHAlign="right",T.majorTicks.labelsVAlign="middle",T.majorTicks.fontColor=S.majorTicks.fontColor,T.majorTicks.fontSize=p,T.majorTicks.fontWeight=S.majorTicks.fontWeight;var k=new Ls(this.webgl,this.draw2D,T,(new ke).scale(1,1).rotate(0).translate(f-s.left*o/2,0),this.limits),O=new ke;O=m instanceof se?O.translate(m.x,m.y):m._dup();var P=this.collection(O);if(g){var A=this.grid({bounds:new oe(0,0,o,y),xStep:h(u*o/s.width,8),yStep:h(v*y/s.height,8),numThickLines:1,width:.6*i.lineWidth,color:b,transform:(new ke).scale(1,1).rotate(0).translate(0,0)});P.add("grid",A)}return P.add("y",k),P.add("x",_),null!=i.pulse&&"function"!=typeof P.pulseDefault&&"string"!=typeof P.pulseDefault&&(P.pulseDefault.scale=i.pulse),P}},{key:"parallelMarks",value:function(){for(var t=this,e={width:.01,num:1,length:.1,angle:Math.PI/4,step:.04,rotation:0,color:[1,0,0,1],transform:(new ke).scale(1,1).rotate(0).translate(0,0),position:null},n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=st.apply(void 0,[{},e].concat(r));null!=o.position&&o.transform.updateTranslation(ne(o.position));var a=o.length*Math.cos(o.angle),s=o.length*Math.sin(o.angle),l=Math.abs(o.width*Math.cos(o.angle+Math.PI/2)),u=o.width*Math.sin(o.angle+Math.PI/2),c=[new se(0,0),new se(0-a,0-s),new se(-a-l,u-s),new se(-Math.abs(o.width/Math.cos(o.angle+Math.PI/2)),0),new se(-a-l,s-u),new se(0-a,0+s)],h=this.collection(o.transform);h.setColor(o.color),null!=o.pulse&&"function"!=typeof h.pulseDefault&&"string"!=typeof h.pulseDefault&&(h.pulseDefault.scale=o.pulse);for(var f=-(o.num-1)/2*o.step,d=function(e){var n=c.map((function(t){return new se(t.x+f+e*o.step,t.y).rotate(o.rotation)}));h.add("".concat(e),t.fan({points:n,color:o.color}))},p=0;p<o.num;p+=1)d(p);return h}},{key:"marks",value:function(){for(var t=this,e={width:.01,num:1,length:.2,angle:Math.PI/2,step:.04,rotation:0,color:[1,0,0,1],transform:(new ke).scale(1,1).rotate(0).translate(0,0),position:null},n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=st.apply(void 0,[{},e].concat(r));null!=o.position&&o.transform.updateTranslation(ne(o.position));var a=[new se(o.length/2,o.width/2),new se(o.length/2,-o.width/2),new se(-o.length/2,-o.width/2),new se(-o.length/2,o.width/2)],s=this.collection(o.transform);s.setColor(o.color),null!=o.pulse&&"function"!=typeof s.pulseDefault&&"string"!=typeof s.pulseDefault&&(s.pulseDefault.scale=o.pulse);for(var l=-(o.num-1)/2*o.step,u=function(e){var n=(new ke).rotate(o.angle).translate(l+e*o.step,0).rotate(o.rotation),r=a.map((function(t){return t._dup().transformBy(n.matrix())}));s.add("".concat(e),t.fan({points:r,color:o.color}))},c=0;c<o.num;c+=1)u(c);return s}}]),t}(),gl=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var n=st({width:0,height:0,ascent:0,descent:0,left:0,right:0,top:0,bottom:0},e);this.copyFrom(n)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"copyFrom",value:function(t){null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height),null!=t.ascent&&(this.ascent=t.ascent),null!=t.descent&&(this.descent=t.descent),null!=t.left&&(this.left=t.left),null!=t.right&&(this.right=t.right),null!=t.top&&(this.top=t.top),null!=t.bottom&&(this.bottom=t.bottom)}},{key:"leftOffset",value:function(t){this.left+=t,this.width=this.right-this.left}},{key:"rightOffset",value:function(t){this.right+=t,this.width=this.right-this.left}},{key:"topOffset",value:function(t){this.top+=t,this.ascent+=t,this.height=this.ascent+this.descent}},{key:"bottomOffset",value:function(t){this.bottom+=t,this.descent-=t,this.height=this.ascent+this.descent}},{key:"offset",value:function(t,e,n,r){this.left+=r,this.right+=e,this.top+=t,this.ascent+=t,this.descent-=n,this.bottom+=n,this.width=this.right-this.left,this.height=this.ascent+this.descent}},{key:"growWithSameBaseline",value:function(t){var e=this.bottom+this.descent;t.left<this.left&&(this.left=t.left),t.right>this.right&&(this.right=t.right),t.top>this.top&&(this.top=t.top),t.bottom<this.bottom&&(this.bottom=t.bottom),this.width=this.right-this.left,this.height=this.top-this.bottom,this.ascent=this.top-e,this.descent=e-this.bottom}}]),t}();function bl(t){return function(t){if(Array.isArray(t))return wl(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return wl(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?wl(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Sl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xl(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _l(t,e,n){return e&&xl(t.prototype,e),n&&xl(t,n),t}var Tl=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.03,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;Sl(this,t),this.width=e,this.ascent=n,this.descent=r,this.height=this.ascent+this.descent}return _l(t,[{key:"_dup",value:function(){return new t(this.width,this.ascent,this.descent)}}]),t}(),kl=function(){function t(e){Sl(this,t),this.content=e,this.ascent=0,this.descent=0,this.width=0,this.location=new se(0,0),this.height=0,this.fullSize={leftOffset:0,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent},this.fnMap=new V}return _l(t,[{key:"calcSize",value:function(t,e){var n=this.content;if(n instanceof Tl&&(this.width=n.width*e,this.height=n.height*e,this.ascent=n.ascent*e,this.descent=n.descent*e,this.location=t._dup(),this.scale=e),n instanceof qo||n instanceof Wo){n.transform.updateTranslation(t.x,t.y),n.transform.updateScale(e,e),n.updateLastDrawTransform(),null!=n.internalSetTransformCallback&&this.fnMap.exec(n.internalSetTransformCallback,n.transform);var r=n.getRelativeVertexSpaceBoundingRect();this.location=t._dup(),this.scale=e,this.ascent=r.top*e,this.descent=-r.bottom*e,this.height=r.height*e,this.width=r.width*e}this.fullSize={leftOffset:0,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent}}},{key:"_dup",value:function(e){var n;return(n=this.content instanceof Tl?new t(this.content):new t(e?e[this.content.name]:this.content)).ascent=this.ascent,n.descent=this.descent,n.width=this.width,n.location=this.location._dup(),n.height=this.height,n.scale=this.scale,n}},{key:"getAllElements",value:function(){return this.content instanceof Tl?[]:[this.content]}},{key:"setPositions",value:function(){var t=this.content;(t instanceof qo||t instanceof Wo)&&(t.transform.updateTranslation(this.location.x,this.location.y),t.transform.updateScale(this.scale,this.scale),t.updateLastDrawTransform())}},{key:"offsetLocation",value:function(t){var e=0<arguments.length&&void 0!==t?t:new se(0,0);this.location=this.location.add(e)}},{key:"getBounds",value:function(t){return 0<arguments.length&&void 0!==t&&t&&null!=this.fullSize?new gl({left:this.location.x+this.fullSize.leftOffset,right:this.location.x+this.fullSize.leftOffset+this.fullSize.width,top:this.location.y+this.fullSize.ascent,bottom:this.location.y-this.fullSize.descent,width:this.fullSize.width,height:this.fullSize.height,ascent:this.fullSize.ascent,descent:this.fullSize.descent}):new gl({left:this.location.x,right:this.location.x+this.width,top:this.location.y+this.ascent,bottom:this.location.y-this.descent,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent})}}]),t}(),Ol=function(){function t(e){Sl(this,t);var n=[];e.forEach((function(t){null!==t&&n.push(t)})),this.content=n,this.ascent=0,this.descent=0,this.width=0,this.location=new se(0,0),this.height=0,this.fnMap=new V}return _l(t,[{key:"_dup",value:function(e){var n=[];this.content.forEach((function(t){return n.push(t._dup(e))}));var r=new t(n);return lt(this,r,["content"]),r}},{key:"calcSize",value:function(t,e){var n=0,r=0,i=t._dup(),o=null;this.content.forEach((function(t){t.calcSize(i,e),i.x+=t.width,t.descent>n&&(n=t.descent),t.ascent>r&&(r=t.ascent);var a=t.getBounds(!0);null==o&&(o=new gl).copyFrom(a)})),null===o&&((o=new gl).left=t.x,o.top=t.y,o.bottom=t.y),this.width=i.x-t.x,this.ascent=r,this.descent=n,this.location=t._dup(),this.height=this.descent+this.ascent,this.fullSize={leftOffset:this.location.x-o.left,width:o.width,ascent:o.ascent,descent:o.descent,height:o.height}}},{key:"getAllElements",value:function(){var t=[];return this.content.forEach((function(e){t=[].concat(bl(t),bl(e.getAllElements()))})),t}},{key:"setPositions",value:function(){this.content.forEach((function(t){t.setPositions()}))}},{key:"offsetLocation",value:function(t){var e=0<arguments.length&&void 0!==t?t:new se(0,0);this.location=this.location.add(e),this.content.forEach((function(t){t.offsetLocation(e)}))}},{key:"getBounds",value:function(t){return 0<arguments.length&&void 0!==t&&t&&null!=this.fullSize?new gl({left:this.location.x+this.fullSize.leftOffset,right:this.location.x+this.fullSize.leftOffset+this.fullSize.width,top:this.location.y+this.fullSize.ascent,bottom:this.location.y-this.fullSize.descent,width:this.fullSize.width,height:this.fullSize.height,ascent:this.fullSize.ascent,descent:this.fullSize.descent}):new gl({left:this.location.x,right:this.location.x+this.width,top:this.location.y+this.ascent,bottom:this.location.y-this.descent,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent})}}]),t}();function Pl(t){return(Pl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Al(t,e){return(Al=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function El(t){return(El=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ml=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Al(t,e)}(r,so);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=El(t);if(e){var o=El(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Pl(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e){var i;return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(i=n.call(this,t)).glPrimitive="strip"===e?i.gl[0].TRIANGLE_STRIP:"fan"===e?i.gl[0].TRIANGLE_FAN:i.gl[0].TRIANGLES,i.points=[],i}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"updatePoints",value:function(t,e,n,r){var i=this,o=3<arguments.length&&void 0!==r&&r;this.points=[],t.forEach((function(t){i.points.push(t.x),i.points.push(t.y)})),this.border[0]=[new se(0,0),new se(e,0),new se(e,n),new se(0,n)],o?this.setupBuffer():this.resetBuffer()}}]),r}();function jl(t){return(jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Cl(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cl(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Dl(t,e){return(Dl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ll(t){return(Ll=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bl=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dl(t,e)}(r,Wo);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Ll(t);if(e){var o=Ll(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==jl(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e,i,o,a,s){var l;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);var u,c=new Ml(t,s);return u=i instanceof ke?i:new ke("Symbol").scale(1,1).translate(0,0),(l=n.call(this,c,u,e,o)).custom.options=a,"dynamic"===l.custom.options.draw&&(l.custom.scale=new se(1,1),l.internalSetTransformCallback=function(){var t=l.getScale();if(l.custom.scale.isNotEqualTo(t,8)){var e=Rl(l.getPoints(l.custom.options,t.x,t.y),3),n=e[0],r=e[1],i=e[2];l.pointsDefinition={points:it(n),width:r,height:i},l.drawingObject.updatePoints(n,r,i),l.custom.scale=t}}),l.custom.setSize=function(t,e,n){var r=l.transform._dup();if("static"===l.custom.options.draw){var i,o=0,s=0;if("first"===l.custom.options.staticHeight||"first"===l.custom.options.staticWidth){var u=Rl(l.getPoints(a,e,n),3);i=u[0],o=u[1],s=u[2]}else if(null!=l.custom.options.staticHeight||null!=l.custom.options.staticWidth){var c=Rl(l.getPoints(a,l.custom.options.staticWidth,l.custom.options.staticHeight),3);i=c[0],o=c[1],s=c[2]}l.pointsDefinition={points:it(i),width:o,height:s},l.drawingObject.updatePoints(i,o,s),l.custom.options.staticHeight=s,l.custom.options.staticWidth=o,r.updateScale(o,s)}else{var h=Rl(l.getPoints(l.custom.options,e,n),3),f=h[0],d=h[1],p=h[2];l.pointsDefinition={points:it(f),width:d,height:p},l.drawingObject.updatePoints(f,d,p),l.custom.scale=new se(e,n),r.updateScale(e,n)}r.updateTranslation(t.x,t.y),l.setTransform(r)},l.setPointsFromDefinition=function(){if(0!==Object.keys(l.pointsDefinition).length){var t=l.pointsDefinition,e=t.points,n=t.width,r=t.height;l.drawingObject.updatePoints(e,n,r)}},l}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getTransform",value:function(){if("static"===this.custom.options.draw){var t=this.transform._dup(),e=t.s();return null!=e&&t.updateScale(e.x/this.custom.options.staticWidth,e.y/this.custom.options.staticHeight),t}var n=this.transform._dup();return n.updateScale(1,1),n}},{key:"getWidth",value:function(t,e){var n;if("static"!==t.draw)return n=t.width,this.getDefaultValues(e,n,t).width;var r=t.staticHeight,i=t.staticWidth;return"first"===r&&(r=e),null==(n=this.getDefaultValues(r,i,t).width)&&(n=e),n/r*e}},{key:"getHeight",value:function(t,e){var n;if("static"!==t.draw)return n=t.height,this.getDefaultValues(n,e,t).height;var r=t.staticWidth,i=t.staticHeight;return"first"===r&&(r=e),null==(n=this.getDefaultValues(i,r,t).height)&&(n=e),n/r*e}},{key:"getBounds",value:function(t,e,n,r,i,o){var a=this.getDefaultValues(i,r,t),s=a.width,l=a.height,u=new gl;return"left"===o?(u.left=e-s,u.bottom=n,u.top=u.bottom+l):"right"===o?(u.left=e,u.bottom=n,u.top=u.bottom+l):("top"===o?(u.bottom=n,u.top=n+l):(u.top=n,u.bottom=n-l),u.left=e+r/2-s/2),u.right=u.left+s,u.width=s,u.height=l,u.ascent=l,u.descent=0,u}},{key:"getPoints",value:function(t,e,n){return[[new se(0,0),new se(e,0),new se(e,n),new se(0,n)],e,n]}},{key:"getDefaultValues",value:function(){return{}}}]),r}();function Il(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||Wl(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fl(t){return function(t){if(Array.isArray(t))return ql(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Wl(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wl(t,e){if(t){if("string"==typeof t)return ql(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ql(t,e):void 0}}function ql(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Nl(t,e){var n=[];return t.forEach((function(t){var r,i;n.push((i=e,{xPosition:(r=t).xPosition,yPosition:r.yPosition,xAlign:r.xAlign,yAlign:r.yAlign,offset:r.offset._dup(),scale:r.scale,content:r.content._dup(i),inSize:r.inSize,fullContentBounds:r.fullContentBounds}))})),n}function zl(t){var e=[];return t.forEach((function(t){e=[].concat(Fl(e),Fl(t.content.getAllElements()))})),e}function Hl(t){t.forEach((function(t){t.content.setPositions()}))}function Vl(t,e){t.forEach((function(t){t.content.offsetLocation(e)}))}var Ul=function(){function t(e,n,r,i){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.glyphs=r,this.content=e,this.annotations=n,this.options=i,this.fnMap=new V}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"_dup",value:function(t){var e,n,r=this.content._dup(t),i=(e=this.glyphs,n={},Object.keys(e).forEach((function(t){if(null!=e[t]){var r=e[t],i={};lt(r,i,["glyph","annotations"]),i.glyph=r.glyph,i.annotations=Nl(r.annotations,void 0),n[t]=i}})),n),o=Nl(this.annotations),a=new this.constructor(r,o,i,this.options);return lt(this,a,["content","glyphs","annotations"]),a}},{key:"getAllElements",value:function(){return[].concat(Fl(this.content.getAllElements()),Fl(zl(this.annotations)),Fl((t=this.glyphs,e=[],Object.keys(t).forEach((function(n){var r=t[n];null!=r&&(e=[].concat(Fl(e),[r.glyph],Fl(zl(r.annotations))))})),e)));var t,e}},{key:"setPositions",value:function(){var t;this.content.setPositions(),Hl(this.annotations),t=this.glyphs,Object.keys(t).forEach((function(e){if(null!=t[e]){var n=t[e],r=n.glyph.transform._dup();r.updateScale(n.width,n.height),r.updateTranslation(n.location.x,n.location.y),n.glyph.setTransform(r),Hl(n.annotations)}}))}},{key:"offsetLocation",value:function(t){var e,n,r=0<arguments.length&&void 0!==t?t:new se(0,0);this.location=this.location.add(r),this.content.offsetLocation(r),Vl(this.annotations,r),e=this.glyphs,n=r,Object.keys(e).forEach((function(t){if(null!=e[t]){var r=e[t];r.location=r.location.add(n),Vl(r.annotations,n)}}))}},{key:"calcSize",value:function(t,e){var n=this;this.location=t._dup();var r=t._dup(),i=this.content,o=this.annotations,a=this.options,s=a.inSize,l=a.space,u=a.topSpace,c=a.bottomSpace,h=a.leftSpace,f=a.rightSpace,d=a.contentScale,p=a.useFullBounds,y=a.fullContentBounds,v=new gl,m=new gl,g=new gl;i.calcSize(r._dup(),e*d),g.copyFrom(i.getBounds(y)),v.copyFrom(g),m.copyFrom(g),o.forEach((function(t){t.content.calcSize(r,e*t.scale),n.setAnnotationPosition(g,t,e);var i=t.content.getBounds();v.growWithSameBaseline(i);var o=t.content.getBounds(!0);m.growWithSameBaseline(o)}));var b=Il(this.setEncompassGlyph(e,g),2),w=b[0],S=b[1];v.growWithSameBaseline(w),m.growWithSameBaseline(S);var x=Il(this.setVerticalGlyph(e,g,"left"),2),_=x[0],T=x[1];v.growWithSameBaseline(_),m.growWithSameBaseline(T);var k=Il(this.setVerticalGlyph(e,g,"right"),2),O=k[0],P=k[1];v.growWithSameBaseline(O),m.growWithSameBaseline(P);var A=Il(this.setHorizontalGlyph(e,g,"top"),2),E=A[0],M=A[1];v.growWithSameBaseline(E),m.growWithSameBaseline(M);var j=Il(this.setHorizontalGlyph(e,g,"bottom"),2),R=j[0],C=j[1];v.growWithSameBaseline(R),m.growWithSameBaseline(C);var D=0,L=(null!=u?u:l||0)*e,B=(null!=c?c:l||0)*e,I=(null!=h?h:l||0)*e,F=(null!=f?f:l||0)*e;if(v.offset(L,F,-B,-I),m.growWithSameBaseline(v),p&&v.copyFrom(m),s?(this.width=v.width,this.ascent=v.ascent,this.descent=v.descent,this.height=v.height,D=r.x-v.left):(this.width=g.width,this.ascent=g.ascent,this.descent=g.descent,this.height=g.height),this.fullSize={leftOffset:this.location.x-m.left,width:m.width,ascent:m.ascent,descent:m.descent,height:m.height},0!==D&&null!=i){var W=new se(D,0);i.offsetLocation(W),o.forEach((function(t){t.content.offsetLocation(W)})),Object.keys(this.glyphs).forEach((function(t){var e=n.glyphs[t];null!=e&&(e.location=e.location.add(W),e.glyph.custom.setSize(e.location,e.width,e.height),e.annotations.forEach((function(t){t.content.offsetLocation(W)})))}))}}},{key:"setEncompassGlyph",value:function(t,e){var n=this;if(null==this.glyphs.encompass){var r=new gl;return r.copyFrom(e),[e,r]}var i=this.glyphs.encompass,o=i.leftSpace,a=i.rightSpace,s=i.bottomSpace,l=i.topSpace,u=i.space,c=this.glyphs.encompass,h=null!=u?u:0,f=null!=o?o:h,d=null!=a?a:h,p=null!=l?l:h,y=null!=s?s:h,v=new gl;v.copyFrom(e),v.offset(p*t,d*t,-y*t,-f*t);var m=c.glyph.getBounds(c.glyph.custom.options,v.left,v.bottom,v.width,v.height),g=new gl,b=new gl;return g.copyFrom(v),g.growWithSameBaseline(m),b.copyFrom(g),c.width=m.width,c.height=m.height,c.location=new se(m.left,m.bottom),c.glyph.custom.setSize(c.location,c.width,c.height),c.annotations.forEach((function(e){e.content.calcSize(c.location,t*e.scale),n.setAnnotationPosition(m,e,t);var r=e.content.getBounds();g.growWithSameBaseline(r);var i=e.content.getBounds(!0);b.growWithSameBaseline(i)})),[g,b]}},{key:"setVerticalGlyph",value:function(t,e,n){var r=this;if(null==this.glyphs[n]){var i=new gl;return i.copyFrom(e),[e,i]}var o=this.glyphs[n],a=o.space,s=o.overhang,l=o.topSpace,u=o.bottomSpace,c=o.minContentHeight,h=o.minContentDescent,f=o.minContentAscent,d=o.descent,p=o.height,y=o.yOffset,v=o.annotationsOverContent,m=this.glyphs[n],g=e.height,b=e.left,w=e.bottom,S=e.descent,x=e.ascent;null!=h&&(S=Math.max(h,S),g=e.ascent+S),null!=f&&(g=(x=Math.max(f,x))+S),null!=c&&(x=-S+Math.max(c,g)),S+=t*(null!=u?u:s),null!=d&&(S=d),g=S+(x+=t*(null!=l?l:s)),null!=p&&(x=(g=p)-S),w=e.bottom-(S-e.descent),"left"===n?b-=a*t:b=e.left+e.width+a*t,null==d&&null==u&&null!=p&&(w=e.bottom+e.height/2-p/2);var _=m.glyph.getBounds(m.glyph.custom.options,b,w+y,null,g,n),T=new gl,k=new gl;T.copyFrom(e),T.growWithSameBaseline(_),k.copyFrom(T);var O=new gl;O.copyFrom(_),m.width=_.width,m.height=_.height,m.location=new se(_.left,_.bottom),m.glyph.custom.setSize(m.location,m.width,m.height),m.annotations.forEach((function(e){e.content.calcSize(m.location,t*e.scale),r.setAnnotationPosition(_,e,t);var n=e.content.getBounds();T.growWithSameBaseline(n),O.growWithSameBaseline(n);var i=e.content.getBounds(!0);k.growWithSameBaseline(i)}));var P=0;if("left"===n&&O.right>b&&!1===v&&(P=b-O.right),"right"===n&&O.left<b&&!1===v&&(P=b-O.left),0!==P){var A=new se(P,0);m.location=m.location.add(A),m.glyph.custom.setSize(m.location,m.width,m.height),m.annotations.forEach((function(t){t.content.offsetLocation(A)})),T.left+=P,T.right=Math.max(T.right+P,e.right),k.left+=P,k.right=Math.max(T.right+P,e.right)}return[T,k]}},{key:"setHorizontalGlyph",value:function(t,e,n){var r=this;if(null==this.glyphs[n]){var i=new gl;return i.copyFrom(e),[e,i]}var o=this.glyphs[n],a=o.space,s=o.overhang,l=o.width,u=o.leftSpace,c=o.rightSpace,h=o.xOffset,f=o.annotationsOverContent,d=this.glyphs[n],p=new gl;p.copyFrom(e);var y,v=p.width,m=p.left;null!=s&&(v+=2*s*t,m=p.left-s*t),null!=l&&(v=l*t),null==u&&null==c||(v=(u||0)*t+p.width+(c||0)*t,null!=u&&(m=p.left-u*t)),null==u&&null==c&&null!=l?m=p.left+(p.width-l)/2:null==u&&null!=c&&null!=l&&(m=p.right+c*t-l),y="top"===n?p.top+a*t:p.bottom-a*t;var g=d.glyph.getBounds(d.glyph.custom.options,m+h,y,v,null,n),b=new gl,w=new gl;b.copyFrom(p),b.growWithSameBaseline(g),w.copyFrom(b);var S=new gl;S.copyFrom(g),d.width=g.width,d.height=g.height,d.location=new se(g.left,g.bottom),d.glyph.custom.setSize(d.location,d.width,d.height),d.annotations.forEach((function(e){e.content.calcSize(d.location,t*e.scale),r.setAnnotationPosition(g,e,t);var n=e.content.getBounds();b.growWithSameBaseline(n),S.growWithSameBaseline(n);var i=e.content.getBounds(!0);w.growWithSameBaseline(i)}));var x=0;if("top"===n&&S.bottom<y&&!1===f&&(x=y-S.bottom),"bottom"===n&&S.top>y&&!1===f&&(x=y-S.top),0!==x){var _=new se(0,x);d.location=d.location.add(_),d.glyph.custom.setSize(d.location,d.width,d.height),d.annotations.forEach((function(t){t.content.offsetLocation(_)})),b.top+=x,b.bottom+=x,w.top+=x,w.bottom+=x}return[b,w]}},{key:"setAnnotationPosition",value:function(t,e,n){var r=e.xPosition,i=e.yPosition,o=e.xAlign,a=e.yAlign,s=e.offset;s=ne(s);var l,u,c=e.content,h=e.fullContentBounds,f=new se(t.left,t.bottom+t.descent);if(null!=t.annotations&&null!=e.reference){var d=t.annotations[e.reference];null!=d.xPosition&&(r=d.xPosition),null!=d.yPosition&&(i=d.yPosition),null!=d.xAlign&&(o=d.xAlign),null!=d.yAlign&&(a=d.yAlign),null!=d.offset&&(s=s.add(ne(d.offset)))}if(l=(l="right"===r?1:"center"===r?.5:"number"==typeof r?r:0)*t.width+f.x,"bottom"===i)u=0;else if("middle"===i)u=.5;else if("top"===i)u=1;else if("number"==typeof i)u=i;else if("string"==typeof i&&"a"===i.slice(-1)[0]){var p=parseFloat(i);u=t.ascent/t.height*p+t.descent/t.height}else u=t.descent/t.height;u=u*t.height+f.y-t.descent;var y=c.getBounds(h);if("center"===o?l-=.5*y.width:"right"===o?l-=y.width:"number"==typeof o&&(l-=y.width*o),"bottom"===a)u+=y.descent;else if("middle"===a)u=u+y.descent-y.height/2;else if("top"===a)u-=y.ascent;else if("string"==typeof a&&"a"===a.slice(-1)[0]){var v=parseFloat(a);u-=y.ascent*v}else"number"==typeof a&&(u+=y.descent-y.height*a);var m=ne(s);l+=m.x*n,u+=m.y*n;var g=new se(l,u).sub(y.left,y.bottom+y.descent);c.offsetLocation(g)}},{key:"getBounds",value:function(t){return 0<arguments.length&&void 0!==t&&t&&null!=this.fullSize?new gl({left:this.location.x+this.fullSize.leftOffset,right:this.location.x+this.fullSize.leftOffset+this.fullSize.width,top:this.location.y+this.fullSize.ascent,bottom:this.location.y-this.fullSize.descent,width:this.fullSize.width,height:this.fullSize.height,ascent:this.fullSize.ascent,descent:this.fullSize.descent}):new gl({left:this.location.x,right:this.location.x+this.width,top:this.location.y+this.ascent,bottom:this.location.y-this.descent,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent})}}]),t}();function Gl(t){return(Gl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xl(t){return function(t){if(Array.isArray(t))return Yl(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Yl(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Yl(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $l(t,e){return($l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Kl(t){return(Kl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ql=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$l(t,e)}(r,Ol);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Kl(t);if(e){var o=Kl(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Gl(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e,i){var o;!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);var a=[];Array.isArray(e)?e.forEach((function(t){a.push(null!=t?new kl(t):null)})):a.push(null!=e?new kl(e):null);var s=[];Array.isArray(e)?s=e:s.push(e);var l=[];return Array.isArray(t)?l=t:l.push(t),(o=n.call(this,[].concat(a,Xl(l)))).glyphs=s,o.contents=l,o.glyphLocations=a.map((function(){return new se(0,0)})),o.glyphWidths=a.map((function(){return 1})),o.glyphHeights=a.map((function(){return 1})),o.options=i,o}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_dup",value:function(t){var e=this.contents.map((function(e){return null==e?null:e._dup(t)})),n=this.glyphs;if(t){var r=[];this.glyphs.forEach((function(e){null!=e?r.push(t[e.name]):r.push(e)})),n=r}var i=new this.constructor(e,n,this.options);return lt(this,i,["content","contents","glyphs"]),i}},{key:"getAllElements",value:function(){var t=[];return this.contents.forEach((function(e){null!=e&&(t=[].concat(Xl(t),Xl(e.getAllElements())))})),this.glyphs.forEach((function(e){null!=e&&(t=[].concat(Xl(t),[e]))})),t}},{key:"setPositions",value:function(){var t=this;this.glyphs.forEach((function(e,n){if(null!=e){var r=e.getTransform()._dup();r.updateTranslation(t.glyphLocations[n].x,t.glyphLocations[n].y),r.updateScale(t.glyphWidths[n],t.glyphHeights[n]),e.setTransform(r)}})),this.contents.forEach((function(t){null!=t&&t.setPositions()}))}},{key:"offsetLocation",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:new se(0,0);this.location=this.location.add(n),this.glyphLocations.forEach((function(t,r){null!=e.glyphs[r]&&(e.glyphLocations[r]=t.add(n))})),this.contents.forEach((function(t){null!=t&&t.offsetLocation(n)}))}},{key:"calcSize",value:function(){}}]),r}();function Zl(t){return(Zl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return tu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tu(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function eu(t,e){return(eu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nu(t){return(nu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ru=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&eu(t,e)}(r,Ql);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=nu(t);if(e){var o=nu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Zl(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),r=Jl(this.glyphs,1)[0],i=Jl(this.contents,2),o=i[0],a=i[1],s=this.options,l=s.scaleModifier,u=s.numeratorSpace,c=s.denominatorSpace,h=s.overhang,f=s.offsetY,d=s.fullContentBounds,p=s.baseline,y=e*l,v=new gl,m=new gl,g=new gl,b=new gl;null!=o&&(o.calcSize(n._dup(),y),m.copyFrom(o.getBounds(d))),null!=a&&(a.calcSize(n._dup(),y),g.copyFrom(a.getBounds(d))),this.location=t._dup(),v.width=Math.max(m.width,g.width)+2*h*y,null!=r&&(v.height=r.getHeight(r.custom.options,v.width));var w=y*f/l,S=new se(n.x+(v.width-m.width)/2,n.y+w+v.height+u*y+m.descent),x=new se(n.x+(v.width-g.width)/2,n.y+w-c*y-g.ascent),_=0;"numerator"===p&&null!=o?_=n.y-S.y:"denominator"===p&&null!=a&&(_=n.y-x.y),null!=o&&o.offsetLocation(S.sub(o.location.x,o.location.y-_)),null!=a&&a.offsetLocation(x.sub(a.location.x,a.location.y-_)),this.width=v.width,this.descent=n.y-(x.y-g.descent),this.descent<0&&(this.descent=0),this.ascent=S.y+m.ascent-n.y,this.height=this.descent+this.ascent,this.glyphLocations[0]=new se(this.location.x,this.location.y+w+_),this.glyphWidths[0]=v.width,this.glyphHeights[0]=v.height,b.copyFrom(v),b.left=this.glyphLocations[0].x,b.bottom=this.glyphLocations[0].y,null!=o&&b.growWithSameBaseline(o.getBounds(!0)),null!=a&&b.growWithSameBaseline(a.getBounds(!0)),r&&r.custom.setSize(this.glyphLocations[0],v.width,v.height),this.fullSize={leftOffset:this.location.x-b.left,width:b.width,ascent:b.ascent,descent:b.descent,height:b.height}}}]),r}();function iu(t){return(iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ou(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return au(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?au(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function au(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function su(t,e){return(su=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function lu(t){return(lu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var uu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&su(t,e)}(r,Ql);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=lu(t);if(e){var o=lu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==iu(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"calcSize",value:function(t,e){this.location=t._dup();for(var n=t._dup(),r=.07*e,i=this.options,o=i.order,a=i.fit,s=i.space,l=i.contentScale,u=i.yAlign,c=i.fullContentBounds,h=ou(o,2),f=h[0],d=h[1],p=[],y=[],v=0,m=[],g=0;g<f;g+=1){m.push([]),p.push([]),y.push([]);for(var b=0;b<d;b+=1){var w=new gl,S=this.contents[v];null!=S&&(S.calcSize(n._dup(),e*l),w.copyFrom(S.getBounds(c))),m[g].push(S),p[g].push(w),y[g].push(new se(0,0)),v+=1}}var x=function(t,e,n){for(var r=[],i=[],o=[],a=0,s=0,l=0,u=0;u<t;u+=1){for(var c=0,h=0,f=0;f<e;f+=1){var d=n[u][f];(d.ascent>c||0===f)&&(c=d.ascent),(d.descent>h||0===f)&&(h=d.descent)}(a<c||0===u)&&(a=c),(s<h||0===u)&&(s=h);var p=h+c;(l<p||0===u)&&(l=p),o.push(p),r.push(c),i.push(h)}return{ascents:r,descents:i,heights:o,maxAscent:a,maxDescent:s,maxHeight:l}}(f,d,p),_=ou(function(t,e,n){for(var r=[],i=0,o=0;o<e;o+=1){for(var a=0,s=0;s<t;s+=1){var l=n[s][o].width;a<l&&(a=l),i<l&&(i=l)}r.push(a)}return[r,i]}(f,d,p),2),T=_[0],k=_[1],O=Math.max(k,x.maxHeight);if("min"!==a){var P;"max"===a?P=new se(O,O):null==(P=ee(a))&&(P=new se(0,0));for(var A=0;A<f;A+=1)x.heights[A]=P.y;for(var E=0;E<d;E+=1)T[E]=P.x}for(var M=0,j=0,R=f-1;0<=R;--R){for(var C=j=0;C<d;C+=1){var D=p[R][C],L=j+T[C]/2-D.width/2,B=M+x.heights[R]/2-(D.ascent-D.descent)/2;"baseline"===u&&(B=M+x.descents[R]),j+=T[C]+s.x*e,y[R][C]=new se(L,B)}M+="baseline"===u?x.descents[R]+x.ascents[R]+s.y*e:x.heights[R]+s.y*e}for(var I=M-s.y*e,F=j-s.x*e,W=new gl,q=0;q<f;q+=1)for(var N=0;N<d;N+=1){y[q][N].x+=n.x,y[q][N].y=n.y-I/2+y[q][N].y+r;var z=m[q][N];null!=z&&(z.offsetLocation(y[q][N].sub(z.location)),0===W.width&&W.copyFrom(z.getBounds(!0)),W.growWithSameBaseline(z.getBounds(!0)))}this.width=F,this.height=I,this.descent=I/2-r,this.ascent=I/2+r,this.fullSize={leftOffset:this.location.x-W.left,width:W.width,ascent:W.ascent,descent:W.descent,height:W.height}}}]),r}();function cu(t){return(cu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function fu(t,e){return(fu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function du(t){return(du=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var pu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fu(t,e)}(r,Ql);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=du(t);if(e){var o=du(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==cu(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"calcSize",value:function(t,e){this.location=t._dup();var n,r=t._dup(),i=this.options,o=i.scaleModifier,a=i.fullContentBounds,s=(function(t){if(Array.isArray(t))return t}(n=this.contents)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(e.push(o.value),1!==e.length);n=!0);}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}}(n)||function(t){if(t){if("string"==typeof t)return hu(t,1);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?hu(t,1):void 0}}(n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],l=new gl,u=new gl;null!=s&&(s.calcSize(r._dup(),e*o),l.copyFrom(s.getBounds(a)),u.copyFrom(s.getBounds(!0))),this.width=l.width,this.height=l.height,this.descent=l.descent,this.ascent=l.ascent,this.fullSize={leftOffset:this.location.x-u.left,width:u.width,ascent:u.ascent,descent:u.descent,height:u.height}}}]),r}();function yu(t){return(yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mu(t,e){return(mu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gu(t){return(gu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var bu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mu(t,e)}(r,Ql);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=gu(t);if(e){var o=gu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==yu(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"calcSize",value:function(t,e){this.location=t._dup();var n,r=t._dup(),i=this.options,o=i.width,a=i.descent,s=i.ascent,l=i.xAlign,u=i.yAlign,c=i.fit,h=i.scaleModifier,f=i.fullContentBounds,d=(function(t){if(Array.isArray(t))return t}(n=this.contents)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(e.push(o.value),1!==e.length);n=!0);}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}}(n)||function(t){if(t){if("string"==typeof t)return vu(t,1);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?vu(t,1):void 0}}(n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],p=new gl,y=new gl,v=new gl;if(null!=d&&(d.calcSize(r._dup(),e*h),p.copyFrom(d.getBounds(f)),y.copyFrom(p)),null!=o&&(y.width=o),null!=a&&(y.descent=a),null!=s&&(y.ascent=s),y.height=y.descent+y.ascent,null!=d){if("width"===c)d.calcSize(r._dup(),y.width/p.width);else if("height"===c)d.calcSize(r._dup(),y.height/p.height);else if("contain"===c){var m=Math.min(y.width/p.width,y.height/p.height);d.calcSize(r._dup(),m)}p.copyFrom(d)}var g=r._dup();"center"===l?g.x=r.x+y.width/2-p.width/2:"right"===l?g.x=r.x+y.width-p.width:"number"==typeof l&&(g.x=r.x+y.width*l),"bottom"===u?g.y=r.y-y.descent+p.descent:"middle"===u?g.y=r.y-y.descent+y.height/2-p.height/2+p.descent:"top"===u?g.y=r.y+y.ascent-p.height+p.descent:"number"==typeof u&&(g.y=r.y-y.descent+y.height*u+p.descent),null!=d&&d.offsetLocation(g.sub(d.location)),null!=d?(v.copyFrom(d.getBounds(!0)),v.growWithSameBaseline(y)):v.copyFrom(y),this.width=y.width,this.height=y.height,this.descent=y.descent,this.ascent=y.ascent,this.fullSize={leftOffset:this.location.x-v.left,width:v.width,ascent:v.ascent,descent:v.descent,height:v.height}}}]),r}();function wu(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||xu(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Su(t){return function(t){if(Array.isArray(t))return _u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||xu(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xu(t,e){if(t){if("string"==typeof t)return _u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_u(t,e):void 0}}function _u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Tu(t,e){return"string"!=typeof e?e:t instanceof qo?t&&"_".concat(e)in t?t["_".concat(e)]:null:t&&e in t?t[e]:null}var ku=function(){function t(e,n,r){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.elements=e,this.phrases={},this.fullLineHeight=null,this.addElementFromKey=n,this.getExistingOrAddSymbol=r}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"stringToElement",value:function(t){if(t.startsWith("space")){var e=parseFloat(t.replace(/space[_]*/,""))||.03;return new kl(new Tl(e))}if(t.startsWith(" ")){var n=.03*t.length;return new kl(new Tl(n))}var r=Tu(this.elements,t);if(r)return new kl(r);if(t in this.phrases)return this.parseContent(this.phrases[t]);var i=this.addElementFromKey(t,{});return null!=i?new kl(i):null}},{key:"parseContent",value:function(t){var e=this;if(null==t)return null;if("number"==typeof t)return null;if(t instanceof Ol)return t;if(t instanceof Ul)return t;if("string"==typeof t)return this.stringToElement(t);if(Array.isArray(t)){var n=[];return t.forEach((function(t){var r=e.parseContent(t);Array.isArray(r)?n=[].concat(Su(n),Su(r)):n.push(r)})),n}var r=wu(Object.entries(t)[0],2),i=r[0],o=r[1],a=this.eqnMethod(i,o);if(null!=a)return a;var s=this.addElementFromKey(i,o);return new kl(s)}},{key:"contentToElement",value:function(t){if(t instanceof Ol)return t._dup();if(t instanceof qo||t instanceof Wo)return new Ol([new kl(t)]);var e=this.parseContent(t);return Array.isArray(e)||(e=[e]),new Ol(e)}},{key:"eqnMethod",value:function(t,e){return"frac"===t?this.frac(e):"strike"===t?this.strike(e):"box"===t?this.box(e):"root"===t?this.root(e):"brac"===t?this.brac(e):"sub"===t?this.sub(e):"sup"===t?this.sup(e):"supSub"===t?this.supSub(e):"topBar"===t?this.topBar(e):"bottomBar"===t?this.bottomBar(e):"annotate"===t?this.annotate(e):"bottomComment"===t?this.bottomComment(e):"topComment"===t?this.topComment(e):"bar"===t?this.bar(e):"topStrike"===t?this.topStrike(e):"bottomStrike"===t?this.bottomStrike(e):"pad"===t?this.pad(e):"int"===t?this.int(e):"sumOf"===t||"prodOf"===t?this.sumProd(e):"matrix"===t?this.matrix(e):"scale"===t?this.scale(e):"container"===t?this.container(e):null}},{key:"container",value:function(t){var e,n,r,i,o,a,s,l,u;if(Array.isArray(t)){var c=wu(t,9);e=c[0],i=c[1],a=c[2],o=c[3],s=c[4],l=c[5],r=c[6],n=c[7],u=c[8]}else e=t.content,i=t.width,a=t.descent,o=t.ascent,s=t.xAlign,l=t.yAlign,r=t.fit,n=t.scale,u=t.fullContentBounds;var h=st({scaleModifier:1,fit:null,width:null,ascent:null,descent:null,xAlign:"center",yAlign:"baseline",fullContentBounds:!1},{scaleModifier:n,fit:r,width:i,ascent:o,descent:a,xAlign:s,yAlign:l,fullContentBounds:u});return new bu([this.contentToElement(e)],[],h)}},{key:"brac",value:function(t){var e,n,r,i,o,a,s,l,u,c,h,f,d,p;if(Array.isArray(t)){var y=wu(t,14);n=y[0],e=y[1],r=y[2],f=y[3],i=y[4],o=y[5],a=y[6],s=y[7],l=y[8],u=y[9],h=y[10],c=y[11],p=y[12],d=y[13]}else n=t.left,e=t.content,r=t.right,f=t.inSize,i=t.insideSpace,o=t.outsideSpace,a=t.topSpace,s=t.bottomSpace,l=t.minContentHeight,u=t.minContentDescent,h=t.height,c=t.descent,p=t.fullContentBounds,d=t.useFullBounds;var v=st({},{insideSpace:.03,outsideSpace:.03,topSpace:.05,bottomSpace:.05,minContentHeight:null,minContentDescent:null,descent:null,height:null,inSize:!0,useFullBounds:!1,fullContentBounds:!1},{insideSpace:i,outsideSpace:o,topSpace:a,bottomSpace:s,minContentHeight:l,minContentDescent:u,descent:c,height:h,inSize:f,useFullBounds:d,fullContentBounds:p}),m={};return n&&(m.left={symbol:n,space:v.insideSpace,topSpace:v.topSpace,bottomSpace:v.bottomSpace,minContentHeight:v.minContentHeight,minContentDescent:v.minContentDescent,descent:v.descent,height:v.height}),r&&(m.right={symbol:r,space:v.insideSpace,topSpace:v.topSpace,bottomSpace:v.bottomSpace,minContentHeight:v.minContentHeight,minContentDescent:v.minContentDescent,descent:v.descent,height:v.height}),this.annotate({content:e,glyphs:m,inSize:v.inSize,leftSpace:v.outsideSpace,rightSpace:v.outsideSpace,useFullBounds:v.useFullBounds,fullContentBounds:v.fullContentBounds})}},{key:"bar",value:function(t,e){var n,r,i,o,a,s,l,u,c,h,f,d,p,y,v,m,g,b=1<arguments.length&&void 0!==e?e:{};if(Array.isArray(t)){var w=wu(t,17);n=w[0],r=w[1],f=w[2],o=w[3],a=w[4],s=w[5],l=w[6],u=w[7],c=w[8],h=w[9],i=w[10],d=w[11],p=w[12],y=w[13],v=w[14],m=w[15],g=w[16]}else n=t.content,r=t.symbol,f=t.inSize,o=t.space,a=t.overhang,s=t.length,l=t.left,u=t.right,c=t.top,h=t.bottom,i=t.side,d=t.minContentHeight,p=t.minContentDescent,y=t.minContentAscent,v=t.descent,m=t.fullContentBounds,g=t.useFullBounds;var S=st({},{inSize:!0,space:.03,overhang:0,length:null,left:null,right:null,top:null,bottom:null,side:"top",minContentHeight:null,minContentDescent:null,minContentAscent:null,descent:null,fullContentBounds:!1,useFullBounds:!1},{side:i,space:o,overhang:a,length:s,left:l,right:u,top:c,bottom:h,inSize:f,minContentHeight:d,minContentDescent:p,minContentAscent:y,descent:v,fullContentBounds:m,useFullBounds:g},b),x={};return"top"===S.side&&(x.top={symbol:r,space:S.space,overhang:S.overhang,leftSpace:S.left,rightSpace:S.right,width:S.length}),"bottom"===S.side&&(x.bottom={symbol:r,space:S.space,overhang:S.overhang,leftSpace:S.left,rightSpace:S.right,width:S.length}),"left"===S.side&&(x.left={symbol:r,space:S.space,overhang:S.overhang,topSpace:S.top,bottomSpace:S.bottom,height:S.length,minContentHeight:S.minContentHeight,minContentDescent:S.minContentDescent,minContentAscent:S.minContentAscent,descent:S.descent}),"right"===S.side&&(x.right={symbol:r,space:S.space,overhang:S.overhang,topSpace:S.top,bottomSpace:S.bottom,height:S.length,minContentHeight:S.minContentHeight,minContentDescent:S.minContentDescent,minContentAscent:S.minContentAscent,descent:S.descent}),this.annotate({content:n,glyphs:x,inSize:S.inSize,fullContentBounds:S.fullContentBounds,useFullBounds:S.useFullBounds})}},{key:"annotate",value:function(t){var e=this,n={inSize:!0,useFullBounds:!1,fullContentBounds:!1,space:0,contentScale:1,encompass:{space:0},left:{space:0,overhang:0,yOffset:0,annotationsOverContent:!1},right:{space:0,overhang:0,yOffset:0,annotationsOverContent:!1},top:{space:0,overhang:0,xOffset:0,annotationsOverContent:!1},bottom:{space:0,overhang:0,xOffset:0,annotationsOverContent:!1}},r=t.content,i=t.annotation,o=t.annotations,a=t.glyphs,s={xPosition:"center",yPosition:"top",xAlign:"center",yAlign:"bottom",offset:new se(0,0),scale:1,inSize:!0,fullContentBounds:!1},l=[];function u(t){if(null==t||!Array.isArray(t))return[];var n=[];return t.forEach((function(t){var r,i;n.push(((i=st({},s,r=t)).content=e.contentToElement(r.content),i))})),n}function c(t){if(null!=a){var r=a[t];if(null!=r){f[t]={};var i=r.annotations;null!=r.annotation&&(i=[r.annotation]);var o=u(i);f[t]=st({},n[t],r),f[t].annotations=o,f[t].glyph=e.getExistingOrAddSymbol(r.symbol||"")}}}null!=i?l.push(i):null!=o&&(l=o);var h=u(l),f={};c("encompass"),c("left"),c("right"),c("top"),c("bottom");var d=st(n,t);return new Ul(this.contentToElement(r),h,f,d)}},{key:"scale",value:function(t){var e,n,r;if(Array.isArray(t)){var i=wu(t,3);e=i[0],n=i[1],r=i[2]}else e=t.content,n=t.scale,r=t.fullContentBounds;var o=st({scaleModifier:1,fullContentBounds:!1},{scaleModifier:n,fullContentBounds:r});return new pu([this.contentToElement(e)],[],o)}},{key:"frac",value:function(t){var e,n,r,i,o,a,s,l,u,c;if(Array.isArray(t)){var h=wu(t,10);e=h[0],r=h[1],n=h[2],i=h[3],a=h[4],s=h[5],o=h[6],l=h[7],c=h[8],u=h[9]}else e=t.numerator,r=t.symbol,n=t.denominator,i=t.scale,a=t.numeratorSpace,s=t.denominatorSpace,o=t.overhang,l=t.offsetY,c=t.baseline,u=t.fullContentBounds;var f=st({scaleModifier:1,numeratorSpace:.05,denominatorSpace:.05,offsetY:.07,overhang:.05,fullContentBounds:!1,baseline:"vinculum"},{scaleModifier:i,overhang:o,numeratorSpace:a,denominatorSpace:s,offsetY:l,fullContentBounds:u,baseline:c});return new ru([this.contentToElement(e),this.contentToElement(n)],this.getExistingOrAddSymbol(r),f)}},{key:"root",value:function(t){var e,n,r,i,o,a,s,l,u,c,h,f,d=!0;if(Array.isArray(t)){var p=wu(t,13);r=p[0],e=p[1],d=p[2],i=p[3],a=p[4],l=p[5],s=p[6],o=p[7],n=p[8],c=p[9],u=p[10],h=p[11],f=p[12]}else r=t.symbol,e=t.content,d=t.inSize,i=t.space,a=t.topSpace,l=t.rightSpace,s=t.bottomSpace,o=t.leftSpace,n=t.root,c=t.rootOffset,u=t.rootScale,h=t.fullContentBounds,f=t.useFullBounds;var y=st({space:.02,rootScale:.6,rootOffset:[0,.06],inSize:!0,fullContentBounds:!1,useFullBounds:!1},{leftSpace:o,topSpace:a,bottomSpace:s,rightSpace:l,space:i,rootScale:u,rootOffset:c,inSize:d,fullContentBounds:h,useFullBounds:f});y.rootOffset=ne(y.rootOffset);var v=[];return null!=n&&v.push({content:n,offset:y.rootOffset,scale:y.rootScale,reference:"root"}),this.annotate({content:e,inSize:y.inSize,useFullBounds:y.useFullBounds,fullContentBounds:y.fullContentBounds,glyphs:{encompass:{symbol:r,annotations:v,space:y.space,leftSpace:y.leftSpace,rightSpace:y.rightSpace,topSpace:y.topSpace,bottomSpace:y.bottomSpace}}})}},{key:"supSub",value:function(t){var e,n,r=null,i=null,o=null,a=null,s=null;if(Array.isArray(t)){var l=wu(t,7);e=l[0],r=l[1],i=l[2],o=l[3],s=l[4],a=l[5],n=l[6]}else e=t.content,r=t.superscript,i=t.subscript,o=t.scale,s=t.superscriptOffset,a=t.subscriptOffset,n=t.inSize;var u=st({scale:.5,subscriptOffset:[0,0],superscriptOffset:[0,0],inSize:!0},{superscript:r,subscript:i,scale:o,subscriptOffset:a,superscriptOffset:s,inSize:n}),c=[];return null!=r&&c.push({content:u.superscript,xPosition:"right",yPosition:"0.7a",xAlign:"left",yAlign:"baseline",offset:u.superscriptOffset,scale:u.scale}),null!=i&&c.push({content:u.subscript,xPosition:"right",yPosition:"baseline",xAlign:"left",yAlign:"0.7a",offset:u.subscriptOffset,scale:u.scale}),this.annotate({content:e,annotations:c,inSize:u.inSize})}},{key:"sup",value:function(t){var e,n,r,i,o;if(Array.isArray(t)){var a=wu(t,5);e=a[0],n=a[1],r=a[2],i=a[3],o=a[4]}else e=t.content,n=t.superscript,r=t.scale,i=t.offset,o=t.inSize;return this.supSub({content:e,superscript:n,superscriptOffset:i,inSize:o,scale:r})}},{key:"sub",value:function(t){var e,n,r,i,o;if(Array.isArray(t)){var a=wu(t,5);e=a[0],n=a[1],r=a[2],i=a[3],o=a[4]}else e=t.content,n=t.subscript,r=t.scale,i=t.offset,o=t.inSize;return this.supSub({content:e,subscript:n,subscriptOffset:i,inSize:o,scale:r})}},{key:"box",value:function(t){var e,n,r,i,o,a,s,l,u,c;if(Array.isArray(t)){var h=wu(t,10);e=h[0],n=h[1],r=h[2],i=h[3],o=h[4],l=h[5],a=h[6],s=h[7],u=h[8],c=h[9]}else e=t.content,n=t.symbol,r=t.inSize,i=t.space,o=t.topSpace,l=t.rightSpace,a=t.bottomSpace,s=t.leftSpace,u=t.fullContentBounds,c=t.useFullBounds;var f=st({inSize:!1,space:0,topSpace:null,bottomSpace:null,leftSpace:null,rightSpace:null,fullContentBounds:!1,useFullBounds:!1},{content:e,symbol:n,inSize:r,space:i,topSpace:o,rightSpace:l,bottomSpace:a,leftSpace:s,fullContentBounds:u,useFullBounds:c});return this.annotate({content:e,inSize:f.inSize,fullContentBounds:f.fullContentBounds,useFullBounds:f.useFullBounds,glyphs:{encompass:{symbol:n,space:f.space,leftSpace:f.leftSpace,rightSpace:f.rightSpace,topSpace:f.topSpace,bottomSpace:f.bottomSpace}}})}},{key:"pad",value:function(t){var e,n,r,i,o;if(Array.isArray(t)){var a=wu(t,5);e=a[0],n=a[1],r=a[2],i=a[3],o=a[4]}else e=t.content,n=t.top,r=t.right,i=t.bottom,o=t.left;var s=st({top:0,left:0,right:0,bottom:0},{top:n,right:r,bottom:i,left:o});return this.annotate({content:e,topSpace:s.top,bottomSpace:s.bottom,rightSpace:s.right,leftSpace:s.left})}},{key:"topBar",value:function(t){return this.bar(t,{side:"top"})}},{key:"bottomBar",value:function(t){return this.bar(t,{side:"bottom"})}},{key:"matrix",value:function(t){var e,n,r,i,o,a,s,l,u,c,h=this;if(Array.isArray(t)){var f=wu(t,10);i=f[0],n=f[1],e=f[2],r=f[3],s=f[4],o=f[5],a=f[6],l=f[7],u=f[8],c=f[9]}else i=t.order,n=t.left,e=t.content,r=t.right,s=t.scale,o=t.fit,a=t.space,l=t.yAlign,u=t.brac,c=t.fullContentBounds;var d=st({},{contentScale:.7,fit:"min",space:[.05,.05],yAlign:"baseline",brac:{},fullContentBounds:!1},{space:a,fit:o,order:i,contentScale:s,brac:u,yAlign:l,fullContentBounds:c}),p=[];null!=e&&(p=e.map((function(t){return h.contentToElement(t)}))),null!=d.order&&d.order[0]*d.order[1]===p.length||(d.order=[1,p.length]),null!=d.space&&(d.space=ne(d.space));var y=new uu(p,[],d);return null!=n&&null!=r?this.brac(st({},d.brac,{content:y,left:n,right:r})):y}},{key:"int",value:function(t){var e,n,r,i,o,a,s,l,u,c,h,f,d,p,y,v,m,g,b,w,S,x,_,T,k,O,P,A={inSize:!0,space:.05,topSpace:.1,bottomSpace:.1,height:null,yOffset:0,contentScale:1,fromScale:.5,toScale:.5,fromOffset:[0,0],toOffset:[.04,0],limitsPosition:"side",limitsAroundContent:!0,fromXPosition:.5,fromYPosition:"bottom",fromXAlign:"left",fromYAlign:"middle",toXPosition:"right",toYPosition:"top",toXAlign:"left",toYAlign:"middle",fullBoundsContent:!1,useFullBounds:!1};if(Array.isArray(t)){var E=wu(t,27);n=E[0],e=E[1],u=E[2],c=E[3],l=E[4],r=E[5],i=E[6],o=E[7],a=E[8],s=E[9],h=E[10],f=E[11],d=E[12],p=E[13],y=E[14],v=E[15],m=E[16],g=E[17],b=E[18],w=E[19],S=E[20],x=E[21],_=E[22],T=E[23],k=E[24],O=E[25],P=E[26]}else e=t.content,n=t.symbol,u=t.from,c=t.to,l=t.inSize,r=t.space,i=t.topSpace,o=t.bottomSpace,a=t.height,s=t.yOffset,h=t.scale,f=t.fromScale,d=t.toScale,p=t.fromOffset,y=t.toOffset,v=t.limitsPosition,m=t.limitsAroundContent,g=t.fromXPosition,b=t.fromYPosition,w=t.fromXAlign,S=t.fromYAlign,x=t.toXPosition,_=t.toYPosition,T=t.toXAlign,k=t.toYAlign,O=t.fullBoundsContent,P=t.useFullBounds;"topBottom"===v&&(A.fromXPosition=.1,A.fromYPosition="bottom",A.fromXAlign="center",A.fromYAlign="top",A.toXPosition=.9,A.toYPosition="top",A.toXAlign="center",A.toYAlign="bottom",A.fromOffset=[0,-.04],A.toOffset=[0,.04]),"topBottomCenter"===v&&(A.fromXPosition="center",A.fromYPosition="bottom",A.fromXAlign="center",A.fromYAlign="top",A.toXPosition="center",A.toYPosition="top",A.toXAlign="center",A.toYAlign="bottom",A.fromOffset=[0,-.04],A.toOffset=[0,.04]);var M=st({},A,{space:r,topSpace:i,bottomSpace:o,height:a,yOffset:s,inSize:l,contentScale:h,fromScale:f,toScale:d,fromOffset:p,toOffset:y,limitsPosition:v,limitsAroundContent:m,fromXPosition:g,fromYPosition:b,fromXAlign:w,fromYAlign:S,toXPosition:x,toYPosition:_,toXAlign:T,toYAlign:k,fullBoundsContent:O,useFullBounds:P});M.fromOffset=ne(M.fromOffset),M.toOffset=ne(M.toOffset);var j=[{content:c,xPosition:M.toXPosition,yPosition:M.toYPosition,xAlign:M.toXAlign,yAlign:M.toYAlign,offset:M.toOffset,scale:M.toScale},{content:u,xPosition:M.fromXPosition,yPosition:M.fromYPosition,xAlign:M.fromXAlign,yAlign:M.fromYAlign,offset:M.fromOffset,scale:M.fromScale}];return this.annotate({content:e,inSize:M.inSize,contentScale:M.contentScale,fullBoundsContent:M.fullBoundsContent,useFullBounds:M.useFullBounds,glyphs:{left:{symbol:n,space:M.space,topSpace:M.topSpace,bottomSpace:M.bottomSpace,height:M.height,yOffset:M.yOffset,annotationsOverContent:M.limitsAroundContent,annotations:j}}})}},{key:"sumOf",value:function(t){return this.sumProd(t)}},{key:"prodOf",value:function(t){return this.sumProd(t)}},{key:"sumProd",value:function(t){var e,n,r,i,o,a,s,l,u,c,h,f,d,p,y,v,m,g,b;if(Array.isArray(t)){var w=wu(t,19);n=w[0],e=w[1],u=w[2],c=w[3],l=w[4],r=w[5],i=w[6],o=w[7],a=w[8],s=w[9],h=w[10],f=w[11],d=w[12],p=w[13],y=w[14],v=w[15],m=w[16],g=w[17],b=w[18]}else n=t.symbol,e=t.content,u=t.from,c=t.to,l=t.inSize,r=t.space,i=t.topSpace,o=t.bottomSpace,a=t.height,s=t.yOffset,h=t.scale,f=t.fromScale,d=t.toScale,p=t.fromSpace,y=t.toSpace,v=t.fromOffset,m=t.toOffset,g=t.fullBoundsContent,b=t.useFullBounds;var S=st({},{inSize:!0,space:.05,topSpace:.07,bottomSpace:.07,height:null,yOffset:0,contentScale:1,fromScale:.5,toScale:.5,fromSpace:.04,toSpace:.04,fromOffset:[0,0],toOffset:[0,0],fullBoundsContent:!1,useFullBounds:!1},{space:r,topSpace:i,bottomSpace:o,height:a,yOffset:s,inSize:l,contentScale:h,fromScale:f,toScale:d,fromSpace:p,toSpace:y,fromOffset:v,toOffset:m,fullBoundsContent:g,useFullBounds:b}),x=[{content:c,xPosition:"center",yPosition:"top",xAlign:"center",yAlign:"bottom",offset:ne(S.toOffset).add(0,S.toSpace),scale:S.toScale},{content:u,xPosition:"center",yPosition:"bottom",xAlign:"center",yAlign:"top",offset:ne(S.fromOffset).add(0,-S.fromSpace),scale:S.fromScale}];return this.annotate({content:e,contentScale:S.contentScale,fullBoundsContent:S.fullBoundsContent,useFullBounds:S.useFullBounds,glyphs:{left:{symbol:n,annotations:x,space:r,topSpace:S.topSpace,bottomSpace:S.bottomSpace,yOffset:S.yOffset,height:S.height}},inSize:S.inSize})}},{key:"processComment",value:function(t){var e,n,r,i,o,a,s,l,u;if(Array.isArray(t)){var c=wu(t,9);e=c[0],n=c[1],r=c[2],i=c[3],o=c[4],a=c[5],s=c[6],l=c[7],u=c[8]}else e=t.content,n=t.comment,r=t.symbol,i=t.contentSpace,o=t.commentSpace,a=t.scale,s=t.inSize,l=t.fullContentBounds,u=t.useFullBounds;var h=st({contentSpace:.03,commentSpace:.03,scale:.6,inSize:!0,fullContentBounds:!1,useFullBounds:!1},{contentSpace:i,commentSpace:o,scale:a,inSize:s,useFullBounds:u,fullContentBounds:l});return[e,n,r,h.contentSpace,h.commentSpace,h.scale,h.inSize,h.fullContentBounds,h.useFullBounds]}},{key:"topComment",value:function(){var t=wu(this.processComment.apply(this,arguments),9),e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=[{content:n,xPosition:"center",yPosition:"top",xAlign:"center",yAlign:"bottom",scale:a,offset:[0,o]}];return""===r||null==r?this.annotate({content:e,annotations:c,inSize:s}):this.annotate({content:e,fullContentBounds:l,useFullBounds:u,glyphs:{top:{symbol:r,annotations:c,space:i}},inSize:s})}},{key:"bottomComment",value:function(){var t=wu(this.processComment.apply(this,arguments),9),e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=[{content:n,xPosition:"center",yPosition:"bottom",xAlign:"center",yAlign:"top",scale:a,offset:[0,-o]}];return""===r||null==r?this.annotate({content:e,annotations:c,inSize:s}):this.annotate({content:e,fullContentBounds:l,useFullBounds:u,glyphs:{bottom:{symbol:r,annotations:c,space:i}},inSize:s})}},{key:"strike",value:function(t){var e,n,r,i,o,a,s,l,u,c,h={inSize:!1,space:.02,topSpace:null,bottomSpace:null,leftSpace:null,rightSpace:null,fullContentBounds:!1,useFullBounds:!1};if(Array.isArray(t)){var f=wu(t,10);e=f[0],n=f[1],r=f[2],i=f[3],o=f[4],l=f[5],a=f[6],s=f[7],u=f[8],c=f[9]}else e=t.content,n=t.symbol,r=t.inSize,i=t.space,o=t.topSpace,l=t.rightSpace,a=t.bottomSpace,s=t.leftSpace,u=t.fullContentBounds,c=t.useFullBounds;var d=this.getExistingOrAddSymbol(n);null!=d&&"horizontal"===d.custom.options.style&&(h.space=0,h.leftSpace=.02,h.rightSpace=.02);var p=st(h,{content:e,symbol:n,inSize:r,space:i,topSpace:o,rightSpace:l,bottomSpace:a,leftSpace:s,fullContentBounds:u,useFullBounds:c});return this.annotate({content:e,inSize:p.inSize,fullContentBounds:p.fullContentBounds,useFullBounds:p.useFullBounds,glyphs:{encompass:{symbol:n,topSpace:p.topSpace,bottomSpace:p.bottomSpace,leftSpace:p.leftSpace,rightSpace:p.rightSpace,space:p.space}}})}},{key:"processStrike",value:function(t){var e,n,r,i,o,a,s;if(Array.isArray(t)){var l=wu(t,7);e=l[0],r=l[1],n=l[2],s=l[3],a=l[4],o=l[5],i=l[6]}else e=t.content,n=t.comment,r=t.symbol,s=t.inSize,a=t.space,o=t.scale,i=t.commentSpace;var u=st({space:0,scale:.5,commentSpace:.1,inSize:!0},{inSize:s,commentSpace:i,scale:o,space:a});return[e,r,n,u.inSize,u.commentSpace,u.scale,u.space]}},{key:"topStrike",value:function(){var t=wu(this.processStrike.apply(this,arguments),7),e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=[{content:r,xPosition:"center",yPosition:"top",xAlign:"center",yAlign:"bottom",offset:[0,o],scale:a}];return this.annotate({content:e,inSize:i,glyphs:{encompass:{symbol:n,space:s,annotations:l}}})}},{key:"bottomStrike",value:function(){var t=wu(this.processStrike.apply(this,arguments),7),e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=[{content:r,xPosition:"center",yPosition:"bottom",xAlign:"center",yAlign:"top",offset:[0,-o],scale:a}];return this.annotate({content:e,inSize:i,glyphs:{encompass:{symbol:n,space:s,annotations:l}}})}}]),t}();function Ou(t){return(Ou="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pu(t,e,n){return(Pu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Eu(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Au(t,e){return(Au=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Eu(t){return(Eu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Mu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Au(t,e)}(r,Ol);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Eu(t);if(e){var o=Eu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Ou(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e){var i;return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(i=n.call(this,[])).elements=t,i.collectionMethods=e,i.description=null,i.modifiers={},i.elementMods={},i.translation={},i.subForm="",i}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getNamedElements",value:function(){var t={};return this.collectionMethods.getAllElements().forEach((function(e){t[e.name]=e})),t}},{key:"_dup",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:this.elements,i=1<arguments.length&&void 0!==e?e:this.collectionMethods,o=new r(n,i),a={};i.getAllElements().forEach((function(t){a[t.name]=t}));var s=[];return this.content.forEach((function(t){s.push(t._dup(a))})),o.content=s,lt(this,o,["content","collectionMethods","form","elements"]),o}},{key:"createEq",value:function(t){var e=this,n=[];t.forEach((function(t){if("string"==typeof t)if(t.startsWith("space")){var r=parseFloat(t.replace(/space[_]*/,""))||.03;n.push(new kl(new Tl(r)))}else if(t.startsWith(" ")){var i=.03*t.length;n.push(new kl(new Tl(i)))}else{var o=Tu(e.elements,t);o&&n.push(new kl(o))}else n.push(t._dup());e.content=n}))}},{key:"arrange",value:function(t,e,n,i){var o=0<arguments.length&&void 0!==t?t:1,a=1<arguments.length&&void 0!==e?e:"left",s=2<arguments.length&&void 0!==n?n:"baseline",l=3<arguments.length&&void 0!==i?i:new se(0,0),u=this.collectionMethods.getAllElements().filter((function(t){return t.isShown}));this.collectionMethods.hideAll(),this.collectionMethods.show(),Pu(Eu(r.prototype),"calcSize",this).call(this,new se(0,0),o);var c=new se(0,0);if(l instanceof Wo||l instanceof qo){var h=l.transform.t();null!=h&&(c=h._dup())}else c=new se(-l.x,-l.y);var f=this.width,d=this.height,p=this.ascent,y=this.descent,v=this.location._dup();if(l instanceof Wo||l instanceof qo){var m=l.transform.t(),g=l.transform.s();if(null!=m&&null!=g){var b=l.getBoundingRect("vertex");f=b.width*g.x,d=b.height*g.y,p=b.top*g.y-m.y,y=m.y-b.bottom*g.y,v=m._dup()}}if("right"===a)c.x+=f;else if("center"===a)c.x+=f/2;else if("number"==typeof a)c.x+=a*f;else if(null!=a&&"o"===a.slice(-1)[0]){var w=parseFloat(a);c.x+=w}if("top"===s)c.y+=v.y+p;else if("bottom"===s)c.y+=v.y-y;else if("middle"===s)c.y+=v.y-y+d/2;else if("number"==typeof s)c.y+=v.y-y+s*d;else if(null!=s&&"o"===s.slice(-1)[0]){var S=parseFloat(s);c.y+=v.y+S}var x=new se(0,0).sub(c);0===x.x&&0===x.y||(this.offsetLocation(x),this.setPositions()),this.collectionMethods.showOnly(u)}},{key:"dissolveElements",value:function(t,e,n,r,i){var o=this,a=1<arguments.length&&void 0!==e?e:"in",s=2<arguments.length&&void 0!==n?n:.01,l=3<arguments.length&&void 0!==r?r:1,u=4<arguments.length&&void 0!==i?i:null;if(0===t.length&&u)this.fnMap.exec(u,!1);else{var c=t.length,h=0,f=function(t){(h+=1)===c&&u&&o.fnMap.exec(u,t)};t.forEach((function(t){t.animations.addTo("Equation Color").opacity({dissolve:a,onFinish:f,duration:l,delay:s,completeOnCancel:!0}).start()}))}}},{key:"getElementsToShowAndHide",value:function(){var t=this.collectionMethods.getAllElements().filter((function(t){return t.isShown})),e=this.getAllElements(),n=t.filter((function(t){return-1===e.indexOf(t)}));return{show:e.filter((function(e){return-1===t.indexOf(e)})),hide:n}}},{key:"render",value:function(){this.hideShow(),this.setPositions()}},{key:"showHide",value:function(t,e,n,r){var i=0<arguments.length&&void 0!==t?t:0,o=1<arguments.length&&void 0!==e?e:0,a=2<arguments.length&&void 0!==n?n:null;3<arguments.length&&void 0!==r&&!r||this.collectionMethods.stop(),this.collectionMethods.show();var s=this.getElementsToShowAndHide(),l=s.show,u=s.hide;0===i?l.forEach((function(t){t.showAll()})):this.dissolveElements(l,"in",.01,i,null),0===o?u.forEach((function(t){return t.hide()})):this.dissolveElements(u,"out",i,o,a)}},{key:"hideShow",value:function(t,e,n,r){var i=0<arguments.length&&void 0!==t?t:0,o=1<arguments.length&&void 0!==e?e:0,a=2<arguments.length&&void 0!==n?n:null;3<arguments.length&&void 0!==r&&!r||this.collectionMethods.stop(),this.collectionMethods.show();var s=this.getElementsToShowAndHide(),l=s.show,u=s.hide;0===o?u.forEach((function(t){return t.hide()})):this.dissolveElements(u,"out",.01,o,null),0===i?(l.forEach((function(t){t.showAll()})),null!=a&&a()):this.dissolveElements(l,"in",o,i,a)}},{key:"allHideShow",value:function(t,e,n,r,i){var o=this,a=0<arguments.length&&void 0!==t?t:0,s=1<arguments.length&&void 0!==e?e:.5,l=2<arguments.length&&void 0!==n?n:.5,u=3<arguments.length&&void 0!==r?r:.5,c=4<arguments.length&&void 0!==i?i:null;this.collectionMethods.stop();var h=this.collectionMethods.getAllElements().filter((function(t){return t.isShown})),f=this.getAllElements(),d=f.filter((function(t){return!t.isShown})),p=f.filter((function(t){return t.isShown})),y=a;if(0!==f.length||0!==h.length||null==c){var v=function(){o.setPositions()};0===f.length&&(v=function(t){o.setPositions(),null!=c&&c(t)}),0<h.length?(this.dissolveElements(h,"out",a,s,v),y+=s):this.setPositions(),this.applyElementMods();var m=f.length,g=0,b=function(t){(g+=1)===m-1&&c&&c(t)};d.forEach((function(t){t.animations.addTo("Equation Color").dissolveIn({duration:u,onFinish:b,delay:y+l}).start()})),p.forEach((function(t){t.animations.addTo("Equation Color").dissolveIn({duration:u,onFinish:b,delay:l}).start()}))}else c(!1)}},{key:"applyElementMods",value:function(){var t=this;Object.keys(this.elementMods).forEach((function(e){var n=t.elementMods[e],r=n.element,i=n.mods;null!=r&&null!=i&&(r.setProperties(i),null!=i.color&&r.setColor(i.color),null!=i.opacity&&r.setOpacity(i.opacity))}))}},{key:"animatePositionsTo",value:function(t,e,n,r,i,o,a){var s=4<arguments.length&&void 0!==i?i:null,l=5<arguments.length&&void 0!==o?o:null,u=6<arguments.length&&void 0!==a&&a,c=this.collectionMethods.getAllElements();this.collectionMethods.stop();var h=this.getAllElements();h.forEach((function(t){.001===t.opacity&&t.hide(),t.setOpacity(1)}));var f=c.filter((function(t){return t.isShown})),d=f.filter((function(t){return-1===h.indexOf(t)})),p=h.filter((function(t){return-1===f.indexOf(t)})),y=this.collectionMethods.getElementTransforms();this.setPositions();var v=this.collectionMethods.getElementTransforms(),m=[],g=[],b=[];Object.keys(v).forEach((function(t){var e=y[t],n=v[t];e.isEqualTo(n)||(m.push(t),g.push(e),b.push(n))}));var w,S={};p.forEach((function(t){S[t.name]=t.transform._dup()})),w=null===n?Ie(g,b,0,new se(.35,.35),2*Math.PI/6,new se(.4,.4)):n,this.collectionMethods.setElementTransforms(y),this.collectionMethods.setElementTransforms(S);var x,_=t,T=null,k=null,O=null;u?0===m.length&&0===p.length?O=s:0===m.length?k=s:T=s:0===m.length&&0===p.length?O=s:0===p.length?T=s:k=s,0<d.length?(this.dissolveElements(d,"out",t,e,O),_+=e):null!=O&&this.fnMap.exec(O),this.applyElementMods(),x="fromPrev"===l&&null!=this.fromPrev?st({},this.translation,this.fromPrev):"fromNext"===l&&null!=this.fromNext?st({},this.translation,this.fromNext):st({},this.translation),Object.keys(x).forEach((function(t){var e=x[t],n=e.element,r=e.style,i=e.direction,o=e.mag;n&&(null!=r&&(n.animations.options.translation.style=r),null!=i&&(n.animations.options.translation.direction=i),null!=o&&(n.animations.options.translation.magnitude=o))})),u&&0<p.length&&(this.dissolveElements(p,"in",_,r,k),_+=r+.001);var P=this.collectionMethods.animateToTransforms(v,w,_,0,T);return 0<P&&(_=P),u||0<p.length&&(this.dissolveElements(p,"in",_,r,k),_+=r+.001),_}}]),r}();function ju(t){return(ju="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ru(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Cu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cu(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Du(t,e){return(Du=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Lu(t){return(Lu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Du(t,e)}(r,Bl);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Lu(t);if(e){var o=Lu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==ju(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPoints",value:function(t,e,n){var r,i,o,a,s,l=t.side;if("left"===l||"right"===l){var u=Ru(this.getLeftPoints(t,e,n),4);r=u[0],i=u[1],o=u[2],a=u[3]}else{var c=Ru(this.getLeftPoints(t,n,e),4);r=c[0],i=c[1],o=c[2],a=c[3]}s="right"===l?(new ke).scale(-1,1).translate(o,0):"top"===l?(new ke).translate(0,-a/2).rotate(-Math.PI/2).translate(a/2,o):"bottom"===l?(new ke).translate(0,-a/2).rotate(Math.PI/2).translate(a/2,0):new ke;var h=r.map((function(t){return t.transformBy(s.m())})),f=i.map((function(t){return t.transformBy(s.m())})),d=[];return h.forEach((function(t,e){var n=f[e];d.push(t),d.push(n)})),"top"===l||"bottom"===l?[d,a,o]:[d,o,a]}},{key:"getLeftPoints",value:function(t,e,n){for(var r=t.sides,i=this.getVerticalDefaultValues(n,e,t),o=i.lineWidth,a=i.width,s=i.tipWidth,l=a-o,u=(Math.pow(l,2)+Math.pow(n/2,2))/(2*l),c=a-s,h=(Math.pow(c,2)+Math.pow(n/2,2))/(2*c),f=Math.asin(n/2/u),d=2*f/r,p=Math.asin(n/2/h),y=2*p/r,v=[],m=[],g=0;g<r+1;g+=1)v.push(Me(u,f-d*g+Math.PI).add(u+o,n/2)),m.push(Me(h,p-y*g+Math.PI).add(h,n/2));return[m,v,v[0].x,n]}},{key:"getDefaultValues",value:function(t,e,n){var r={};if("left"===n.side||"right"===n.side)(r=this.getVerticalDefaultValues(t,e,n)).height=t;else{var i=(r=this.getVerticalDefaultValues(e,t,n)).width;r.width=e,r.height=i}return r}},{key:"getVerticalDefaultValues",value:function(t,e,n){var r={};return null==e&&null==n.width&&(r.width=97570.78+-97570.775041292/(1+Math.pow(t/2399858,.9383909))),null!=e&&(r.width=e),null!=n.width&&(r.width=n.width),null==n.lineWidth?r.lineWidth=.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041)):r.lineWidth=n.lineWidth,null==n.tipWidth?r.tipWidth=r.lineWidth/3:r.tipWidth=n.tipWidth,r}}]),r}();function Iu(t){return(Iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fu(t,e){return(Fu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wu(t){return(Wu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var qu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fu(t,e)}(r,Bl);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Wu(t);if(e){var o=Wu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Iu(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPoints",value:function(t,e,n){var r=t.fill,i=this.getDefaultValues(n,e,t),o=i.lineWidth,a=i.width,s=i.height;return[r?[new se(0,0),new se(a,0),new se(0,s),new se(a,s)]:[new se(0,0),new se(o,o),new se(0,s),new se(o,s-o),new se(a,s),new se(a-o,s-o),new se(a,0),new se(a-o,o),new se(0,0),new se(o,o)],a,s]}},{key:"getBounds",value:function(t,e,n,r,i){var o=this.getDefaultValues(i,r,t),a=o.lineWidth,s=o.width,l=o.height,u=new gl;if("static"===t.draw){var c=t.staticWidth,h=t.staticHeight;"first"===c&&(c=s+2*a),"first"===h&&(h=l+2*a),null==c&&(c=1),null==h&&(h=1);var f=a/h,d=a/c;u.width=s/(1-2*d),u.height=l/(1-2*f);var p=u.width*d,y=u.height*f;u.left=e-p,u.right=u.left+u.width,u.bottom=n-y,u.top=u.bottom+u.height,u.ascent=u.height,u.descent=0}else u.left=e+r/2-s/2-a,u.bottom=n+i/2-l/2-a,u.width=s+2*a,u.height=l+2*a,u.right=u.left+u.width,u.top=u.bottom+u.height,u.descent=0,u.ascent=u.height;return u}},{key:"getDefaultValues",value:function(t,e,n){var r={};return null!=n.lineWidth&&"number"==typeof n.lineWidth?r.lineWidth=n.lineWidth:r.lineWidth=.01,!0===n.fill&&(r.lineWidth=0),null!=n.height&&"number"==typeof n.height?r.height=n.height:r.height=null!=t?t:1,null!=n.width&&"number"==typeof n.width?r.width=n.width:r.width=null!=e?e:1,r}},{key:"surround",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:0,o=3<arguments.length&&void 0!==r?r:"local",a=[t];if(null!=e&&0!==e.length&&(a=t.getElements(e)),0!==a.length){var s,l=ne("number"==typeof i?[i,i]:i);(s=t instanceof qo?t.getBoundingRect(o,e):t.getBoundingRect(o)).left-=l.x,s.bottom-=l.y,s.width+=2*l.x,s.height+=2*l.y,s.right=s.left+s.width,s.top=s.bottom+s.height,this.custom.setSize(new se(s.left,s.bottom),s.width,s.height)}}}]),r}();function Nu(t){return(Nu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zu(t,e){return(zu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Hu(t){return(Hu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Vu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zu(t,e)}(r,Bu);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Hu(t);if(e){var o=Hu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Nu(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getLeftPoints",value:function(t,e,n){for(var r=t.sides,i=this.getVerticalDefaultValues(n,e,t),o=i.lineWidth,a=i.width,s=i.tipWidth,l=a/2+o/2,u=l-s,c=l-o,h=(Math.pow(c,2)+Math.pow(u,2))/(2*c),f=[],d=[],p=Math.PI/2/r,y=Math.asin(u/h)/r,v=[],m=[],g=0;g<r+1;g+=1){var b=g*p,w=g*y;m.push(new se(l*Math.cos(b),l*Math.sin(b))),v.push(new se(h*Math.cos(w)-h+l-o,h*Math.sin(w)))}for(var S=(new ke).scale(-1,1).translate(a,n-l).m(),x=0;x<r+1;x+=1)f.push(m[r-x].transformBy(S)),d.push(v[r-x].transformBy(S));S=(new ke).scale(1,-1).translate(0,n/2-s/2+l).m();for(var _=0;_<r+1;_+=1)f.push(v[_].transformBy(S)),d.push(m[_].transformBy(S));S=(new ke).translate(0,n/2+s/2-l).m();for(var T=0;T<r+1;T+=1)f.push(v[r-T].transformBy(S)),d.push(m[r-T].transformBy(S));S=(new ke).scale(-1,-1).translate(a,l).m();for(var k=0;k<r+1;k+=1)f.push(m[k].transformBy(S)),d.push(v[k].transformBy(S));return[f,d,a,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var r={};return null==e&&null==n.width&&(r.width=97570.78+-97570.775041292/(1+Math.pow(t/2399858,.9383909))),null!=e&&(r.width=e),null!=n.width&&(r.width=n.width),null==n.lineWidth?r.lineWidth=.8*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):r.lineWidth=n.lineWidth,null==n.tipWidth?r.tipWidth=r.lineWidth/3:r.tipWidth=n.tipWidth,r}}]),r}();function Uu(t){return(Uu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gu(t,e){return(Gu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Xu(t){return(Xu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Yu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gu(t,e)}(r,Bu);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Xu(t);if(e){var o=Xu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Uu(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getLeftPoints",value:function(t,e,n){var r=t.sides,i=t.radius,o=this.getVerticalDefaultValues(n,e,t),a=o.lineWidth,s=o.width,l=o.tipWidth;if(0===i)return[[new se(s,0),new se(0,0),new se(0,n),new se(s,n)],[new se(s,l),new se(a,l),new se(a,n-l),new se(s,n-l)],s,n];for(var u=Math.min(i,s,n/2),c=u,h=u-a,f=[new se(s,0)],d=[new se(s,a)],p=new se(c,c),y=new se(c,n-c),v=0;v<=r;v+=1){var m=Math.PI/2/r*v;f.push(Me(c,Math.PI/2*3-m).add(p)),d.push(Me(h,Math.PI/2*3-m).add(p))}for(var g=0;g<=r;g+=1){var b=Math.PI/2/r*g;f.push(Me(c,Math.PI-b).add(y)),d.push(Me(h,Math.PI-b).add(y))}return f.push(new se(s,n)),d.push(new se(s,n-a)),[f,d,s,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var r={};return null==e&&null==n.width&&(r.width=.8*(97570.78+-97570.775041292/(1+Math.pow(t/2399858,.9383909)))),null!=e&&(r.width=e),null!=n.width&&(r.width=n.width),null==n.lineWidth?r.lineWidth=.8*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):r.lineWidth=n.lineWidth,null==n.tipWidth?r.tipWidth=.7*r.lineWidth:r.tipWidth=n.tipWidth,r}}]),r}();function $u(t){return($u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ku(t,e){return(Ku=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Qu(t){return(Qu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Zu=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ku(t,e)}(r,Bu);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Qu(t);if(e){var o=Qu(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==$u(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getLeftPoints",value:function(t,e,n){var r=this.getVerticalDefaultValues(n,e,t),i=r.lineWidth,o=r.width,a=new ge(new se(0,0),new se(o,n/2)),s=Math.acos(i/a.distance),l=Math.PI/2-s,u=a.ang+l,c=o-n/2/Math.tan(u);return[[new se(o-c,0),new se(0,n/2),new se(o-c,n)],[new se(o,0),new se(c,n/2),new se(o,n)],o,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var r={};return null==e&&null==n.width&&(r.width=97570.78+-97570.775041292/(1+Math.pow(t/2399858,.9383909))),null!=e&&(r.width=e),null!=n.width&&(r.width=n.width),null==n.lineWidth?r.lineWidth=.7*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):r.lineWidth=n.lineWidth,r}}]),r}();function Ju(t){return(Ju="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tc(t,e){return(tc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ec(t){return(ec=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var nc=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tc(t,e)}(r,Bu);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=ec(t);if(e){var o=ec(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Ju(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getLeftPoints",value:function(t,e,n){var r=this.getVerticalDefaultValues(n,e,t),i=r.lineWidth,o=r.width;return[[new se(0,0),new se(0,n)],[new se(i,0),new se(i,n)],o,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var r={};return null==n.lineWidth?r.lineWidth=.8*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):r.lineWidth=n.lineWidth,r.width=r.lineWidth,r}}]),r}();function rc(t){return(rc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ic(t,e){return(ic=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function oc(t){return(oc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ac=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ic(t,e)}(r,Bl);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=oc(t);if(e){var o=oc(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==rc(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPoints",value:function(t,e,n){var r=t.sides,i=this.getDefaultValues(n,e,t),o=i.lineWidth,a=i.width,s=Math.PI/2*.9,l=Math.PI/2*.95,u=.431*a,c=n/2-o,h=.176*n,f=.153*n,d=h/Math.tan(s),p=f/Math.tan(l),y=o,v=2*o,m=3*o,g=.6*o,b=new ge(new se(0,0),new se(u,c)),w=y/Math.sin(b.ang),S=new ge(new se(w,0),n,b.ang),x=new ge(new se(0,n),new se(u,c)),_=-m/Math.sin(x.ang),T=new ge(new se(_,n),n,x.ang),k=S.intersectsWith(T).intersect,O=new se(a,h),P=new se(a-g,h),A=new se(a-d,0),E=new se(P.x-(h-v)/Math.tan(s),v),M=new se(0,0),j=new se(y/Math.sin(b.ang)+v/Math.tan(b.ang),v),R=new se(u,c),C=k,D=new se(0,n),L=new se(-m/Math.sin(x.ang)-y/Math.tan(x.ang),n-y),B=new se(a-p,n),I=new se(a,n-f),F=new se(a-g,n-f),W=new se(F.x-(f-y)/Math.tan(l),n-y),q=Fe(P,E,new se(E.x-(h-v),v),r),N=[];q.forEach((function(t){N.push(A),N.push(t)}));var z=W,H=Fe(new se(z.x-f+y,n-y),z,F,r),V=[];return H.forEach((function(t){V.push(B),V.push(t)})),[[O,P].concat(N,[M,j,R,C,D,L],V,[I,F]),a,n]}},{key:"getDefaultValues",value:function(t,e,n){var r={lineWidth:.88*t/(25*t+15),width:.88*t,height:t};return null!=n.lineWidth&&(r.lineWidth=n.lineWidth),null!=n.width&&(r.width=n.width),r}}]),r}();function sc(t){return(sc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function uc(t,e){return(uc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function cc(t){return(cc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var hc=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&uc(t,e)}(r,Bl);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=cc(t);if(e){var o=cc(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==sc(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPoints",value:function(t,e,n){var r=t.serif,i=t.sides,o=this.getDefaultValues(n,e,t),a=o.lineWidth,s=o.width,l=i;"false"===r&&(l=2);var u=1.2*a,c=3*a,h=a/2,f=.9*c,d=new se(0,0),p=new se(c+2*f,0),y=new se(d.x,h),v=new se(p.x,h),m=new se(f,y.y),g=new se(f+c,m.y),b=new se(m.x,n-h),w=new se(g.x,n-h),S=new se(y.x,n-h),x=new se(y.x,n),_=new se(v.x,n),T=y,k=m,O=new se(m.x,m.y+f),P=v,A=g,E=new se(g.x,m.y+f),M=Fe(T,k,O,l),j=Fe(P,A,E,l),R=[];M.forEach((function(t,e){R.push(t),R.push(j[e])}));var C=Fe(new se(b.x,b.y-f),b,S,l),D=[];C.forEach((function(t){D.push(t),D.push(new se(w.x,t.y))}));for(var L=[d,p].concat(R,D,[x,_]),B=[],I=L.length-1;0<I;I-=2)B.push(new se(s-L[I-1].x,L[I-1].y)),B.push(new se(s-L[I].x,L[I].y));var F,W=[new se(f+c,n),new se(f+c,n-u),new se(s-f-c,n),new se(s-f-c,n-u)];return[[].concat(function(t){if(Array.isArray(t))return lc(t)}(F=L)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(F)||function(t){if(t){if("string"==typeof t)return lc(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?lc(t,void 0):void 0}}(F)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),W,B),s,n]}},{key:"getDefaultValues",value:function(t,e,n){var r={lineWidth:n.lineWidth||1,width:e||1,height:t};return null==n.lineWidth&&null!=e?r.lineWidth=e/7/3:null==n.lineWidth&&null==e?(r.lineWidth=12902.65+-12902.648946996/(1+Math.pow(t/573148,.9938213)),r.width=1704804+-1704803.997815697/(1+Math.pow(t/2234236,.9967453))):null!=n.lineWidth&&null==e&&(r.width=7*n.lineWidth*3),r}}]),r}();function fc(t){return(fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dc(t){return function(t){if(Array.isArray(t))return pc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return pc(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?pc(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function yc(t,e){return(yc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function vc(t){return(vc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var mc=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yc(t,e)}(r,Bl);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=vc(t);if(e){var o=vc(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==fc(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPoints",value:function(t,e,n){var r=t.sides,i=t.serif,o=t.num,a=t.type,s=t.serifSides,l=t.lineIntegralSides,u=this.getDefaultValues(n,e,t),c=u.lineWidth,h=u.width,f=u.tipWidth,d=h-(o-1)*c*3,p=n,y=.7*c,v=d;i&&(v=d-2*y);var m,g,b=x(-v/2,v/2,v/r),w=.99999999999*n,S=-Math.log(n/w-1)/d/2,_=0,T=[];b.forEach((function(t,e){var r=1/(1+Math.exp(-S*t)),i=p*S*r*(1-r),o=Math.atan(i),a=r*p,s=(c/2-f/2)*Math.pow(Math.cos((a-n/2)/n*Math.PI),2)+f/2,l=s*Math.cos(o+Math.PI/2),u=s*Math.sin(o+Math.PI/2),h=new se(t+l+d/2,a+u),y=new se(t-l+d/2,a-u);0<e&&(T.push(m._dup()),T.push(g._dup()),T.push(y._dup()),T.push(m._dup()),T.push(y._dup()),T.push(h._dup())),m=h,g=y,0===e&&(_=o)}));var k=[];if(!1===i)k=T;else{for(var O=s,P=new se(T[1].x+y*Math.cos(_+Math.PI/2),T[1].y+y*Math.sin(_+Math.PI/2)),A=new se(T[T.length-1].x+y*Math.cos(_-Math.PI/2),T[T.length-1].y+y*Math.sin(_-Math.PI/2)),E=[],M=[],j=2*Math.PI/Math.max(O,3),R=new se(0,0),C=new se(0,0),D=0;D<O+1;D+=1){var L=new se(P.x+y*Math.cos(j*D),P.y+y*Math.sin(j*D)),B=new se(A.x+y*Math.cos(j*D),A.y+y*Math.sin(j*D));0<D&&(E.push(T[1]._dup()),E.push(R._dup()),E.push(L._dup()),M.push(T[T.length-2]._dup()),M.push(C._dup()),M.push(B._dup())),R=L,C=B}k=[].concat(E,T,M)}for(var I=k.length,F=1;F<o;F+=1)for(var W=0;W<I;W+=1)k.push(k[W].add(3*c*F,0));if("line"===a){var q=this.getLineIntegralPoints(c,o,h,n,l);k=[].concat(dc(k),dc(q))}return[k,h,n]}},{key:"getLineIntegralPoints",value:function(t,e,n,r,i){for(var o=6*t,a=Math.max(o,2*(3*t+(e-1)*t*3/2)),s=new se(n/2,r/2),l=2*Math.PI/i,u=new se(0,0),c=new se(0,0),h=t/2,f=[],d=0;d<i+1;d+=1){var p=d*l,y=new se((a/2-h/2)*Math.cos(p),(o/2-h/2)*Math.sin(p)).add(s),v=new se((a/2+h/2)*Math.cos(p),(o/2+h/2)*Math.sin(p)).add(s);0<d&&(f.push(u._dup()),f.push(c._dup()),f.push(y._dup()),f.push(u._dup()),f.push(y._dup()),f.push(v._dup())),u=v,c=y}return f}},{key:"getDefaultValues",value:function(t,e,n){var r=607.73+-607.7295779198/(1+Math.pow(t/5368595,.6370402)),i={lineWidth:r,width:12277.16+-12277.156262281/(1+Math.pow(t/36507180,.6193363))+(n.num-1)*r*3,tipWidth:.01033455+-.010329798066/(1+Math.pow(t/.2588074,2.024942)),height:t};return null!=e&&(i.width=e),null!=n.lineWidth&&(i.lineWidth=n.lineWidth),null!=n.tipWidth?i.tipWidth=n.tipWidth:i.tipWidth=i.lineWidth/3,i}}]),r}();function gc(t){return(gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bc(t,e){return(bc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wc(t){return(wc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Sc=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bc(t,e)}(r,Bu);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=wc(t);if(e){var o=wc(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==gc(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getLeftPoints",value:function(t,e,n){var r=t.direction,i=this.getVerticalDefaultValues(n,e,t),o=i.lineWidth,a=i.arrowWidth,s=i.arrowHeight,l=new se(a/2+o/2,0),u=new se(a/2-o/2,0),c=new se(l.x,n-s),h=new se(u.x,c.y),f=new se(a,c.y),d=new se(0,c.y),p=new se(a/2,n),y=[u._dup(),h._dup(),d._dup(),p._dup()],v=[l._dup(),c._dup(),f._dup(),p._dup()];if("down"===r||"left"===r){var m=(new ke).scale(1,-1).translate(0,n).m();y=y.map((function(t){return t.transformBy(m)})),v=v.map((function(t){return t.transformBy(m)}))}return[y,v,a,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var r={};return null==n.lineWidth?r.lineWidth=.8*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):r.lineWidth=n.lineWidth,null==n.arrowWidth?r.arrowWidth=3*r.lineWidth:r.arrowWidth=n.arrowWidth,null==n.arrowHeight?r.arrowHeight=3*r.lineWidth:r.arrowHeight=n.arrowHeight,r.width=r.arrowWidth,r}}]),r}();function xc(t){return(xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _c(t,e){return(_c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Tc(t){return(Tc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var kc=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_c(t,e)}(r,Bl);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Tc(t);if(e){var o=Tc(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==xc(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPoints",value:function(t,e,n){var r=this.getDefaultValues(n,e,t),i=r.lineWidth,o=r.width,a=r.height;return[[new se(0,0),new se(0,i),new se(o,0),new se(o,i)],o,a]}},{key:"getDefaultValues",value:function(t,e,n){var r={};return null!=n.lineWidth?r.lineWidth=n.lineWidth:r.lineWidth=.01,r.height=r.lineWidth,r.width=null!=e?e:1,r}}]),r}();function Oc(t){return(Oc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pc(t,e){return(Pc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ac(t){return(Ac=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ec=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pc(t,e)}(r,Bl);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Ac(t);if(e){var o=Ac(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Oc(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPoints",value:function(t,e,n){var r=t.style,i=this.getDefaultValues(n,e,t),o=i.lineWidth,a=i.width,s=i.height,l=Math.atan2(s,a),u=Math.PI/2-l,c=o*Math.cos(u),h=o*Math.sin(u),f=new se(0,h),d=new se(c,0),p=new se(0,s-h),y=new se(c,s),v=new se(a-c,s),m=new se(a,s-h),g=new se(a-c,0),b=new se(a,h),w=new se(0,s/2-o/2),S=new se(0,s/2+o/2),x=new se(a,s/2-o/2),_=new se(a,s/2+o/2);return["forward"===r?[f,d,m,f,m,v]:"back"===r?[p,y,b,p,b,g]:"cross"===r?[f,d,m,f,m,v,p,y,b,p,b,g]:[w,x,_,w,_,S],a,s]}},{key:"getBounds",value:function(t,e,n,r,i){var o=this.getDefaultValues(i,r,t),a=o.width,s=o.height,l=new gl;return l.left=e,l.bottom=n,l.width=a,l.height=s,l.right=l.left+l.width,l.top=l.bottom+l.height,l.descent=0,l.ascent=l.height,l}},{key:"getDefaultValues",value:function(t,e,n){var r={};return null!=n.lineWidth&&"number"==typeof n.lineWidth?r.lineWidth=n.lineWidth:r.lineWidth=.015,null!=n.height&&"number"==typeof n.height?r.height=n.height:r.height=null!=t?t:1,null!=n.width&&"number"==typeof n.width?r.width=n.width:r.width=null!=e?e:1,r}}]),r}();function Mc(t){return(Mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jc(t,e){return(jc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Rc(t){return(Rc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Cc=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jc(t,e)}(r,Bl);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Rc(t);if(e){var o=Rc(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Mc(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(){return function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),n.apply(this,arguments)}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"getPoints",value:function(t,e,n){var r=this.getDefaultValues(n,e,t),i=r.lineWidth,o=r.startWidth,a=r.tickWidth,s=r.tickHeight,l=r.downWidth,u=r.startHeight,c=r.lineWidth2,h=r.height,f=r.width,d=new se(0,u-s),p=new se(a,u),y=new se(l+a,0),v=new se(o,h-i),m=new se(f,h-i),g=new ge(d,p),b=new ge(p,y),w=new ge(y,v),S=new ge(v,m),x=g.offset("top",i),_=b.offset("top",c),T=w.offset("top",i),k=S.offset("top",i),O=x.p1._dup(),P=x.intersectsWith(_).intersect,A=_.intersectsWith(T).intersect,E=T.intersectsWith(k).intersect,M=m.add(0,i);return[[d,O,p,P,y,A,v,E,m,M],e,n]}},{key:"getBounds",value:function(t,e,n,r,i){var o=this.getHeightFromContentHeight(i,t),a=this.getDefaultValues(o,r,t),s=a.width,l=a.startWidth,u=a.lineWidth,c=a.startHeight,h=a.downWidth,f=a.tickWidth,d=a.lineWidth2,p=new gl;if("static"===t.draw){var y=t.staticWidth,v=t.staticHeight;"first"===y&&(y=s+l),"first"===v&&(v=o+u),null==y&&(y=1),null==v&&(v=1);var m=u/v,g=l/y,b=c/v;p.width=s/(1-g),p.height=o/(1-m);var w=p.width*g,S=p.height*b,x=p.height*m;p.left=e-w,p.right=p.left+p.width,p.bottom=n,p.top=p.bottom+p.height,p.ascent=p.height,p.descent=0,p.annotations={root:{xPosition:"left",yPosition:"bottom",xAlign:"right",yAlign:"bottom",offset:new se(.5*w,S+2*x)}}}else p.left=e+r/2-s/2-l,p.bottom=n,p.width=s+l,p.height=o,p.right=p.left+p.width,p.top=p.bottom+p.height,p.descent=0,p.ascent=p.height,p.annotations={root:{xPosition:"left",yPosition:"bottom",xAlign:"right",yAlign:"bottom",offset:new se(h+f,c+d)}};return p}},{key:"getHeightFromContentHeight",value:function(t,e){return(null!=t?t:1)+(null!=e.lineWidth&&"number"==typeof e.lineWidth?e.lineWidth:.01)}},{key:"getDefaultValues",value:function(t,e,n){var r={};return null!=n.lineWidth&&"number"==typeof n.lineWidth?r.lineWidth=n.lineWidth:r.lineWidth=.01,null!=n.lineWidth2&&"number"==typeof n.lineWidth2?r.lineWidth2=n.lineWidth2:r.lineWidth2=2*r.lineWidth,null!=n.height&&"number"==typeof n.height?r.height=n.height:r.height=null!=t?t:1,null!=n.startHeight&&"number"==typeof n.startHeight?(r.startHeight=n.startHeight,n.proportionalToHeight&&(r.startHeight=n.startHeight*r.height)):r.startHeight=r.height/3,null!=n.maxStartHeight&&n.maxStartHeight<r.startHeight&&(r.startHeight=n.maxStartHeight),null!=n.tickHeight&&"number"==typeof n.tickHeight?(r.tickHeight=n.tickHeight,n.proportionalToHeight&&(r.tickHeight=n.tickHeight*r.startHeight)):r.tickHeight=.1*r.startHeight,null!=n.startWidth&&"number"==typeof n.startWidth?(r.startWidth=n.startWidth,n.proportionalToHeight&&(r.startWidth=n.startWidth*r.height)):r.startWidth=r.startHeight/2,null!=n.maxStartWidth&&n.maxStartWidth<r.startWidth&&(r.startWidth=n.maxStartWidth),null!=n.tickWidth&&"number"==typeof n.tickWidth?(r.tickWidth=n.tickWidth,n.proportionalToHeight&&(r.tickWidth=n.tickWidth*r.startWidth)):r.tickWidth=r.startWidth/5,null!=n.downWidth&&"number"==typeof n.downWidth?(r.downWidth=n.downWidth,n.proportionalToHeight&&(r.downWidth=n.downWidth*r.startWidth)):r.downWidth=r.startWidth/5*2,null!=n.width&&"number"==typeof n.width?r.width=n.width:r.width=null!=e?e:1,r}}]),r}(),Dc=function(){function t(e,n){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.shapes=e,this.defaultColor=n}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"get",value:function(t,e){return"vinculum"===t?this.vinculum(e):"strike"===t?this.strike(e):"bracket"===t?this.bracket(e):"squareBracket"===t?this.squareBracket(e):"brace"===t?this.brace(e):"bar"===t?this.bar(e):"box"===t?this.box(e):"angleBracket"===t?this.angleBracket(e):"radical"===t?this.radical(e):"sum"===t?this.sum(e):"prod"===t?this.product(e):"int"===t?this.integral(e):"arrow"===t?this.arrow(e):null}},{key:"vinculum",value:function(t){var e=st({color:this.defaultColor,lineWidth:null,staticHeight:null,draw:"dynamic",staticWidth:"first"},t);return new kc(this.shapes.webgl,e.color,new ke("VinculumSymbol").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"box",value:function(t){var e=st({color:this.defaultColor,fill:!1,width:null,height:null,lineWidth:.01,draw:"dynamic",staticHeight:"first",staticWidth:"first"},t);return new qu(this.shapes.webgl,e.color,new ke("Box").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"arrow",value:function(t){var e=st({color:this.defaultColor,direction:"right",lineWidth:.01,arrowWidth:.03,arrowHeight:.04,staticHeight:"first",draw:"static",staticWidth:null},t);return"left"===e.direction||"right"===e.direction?e.side="top":e.side="left",new Sc(this.shapes.webgl,e.color,new ke("ArrowSymbol").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"sum",value:function(t){var e=st({color:this.defaultColor,lineWidth:null,sides:5,staticHeight:"first",draw:"static",staticWidth:null},t);return new ac(this.shapes.webgl,e.color,new ke("sum").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"product",value:function(t){var e=st({color:this.defaultColor,lineWidth:null,sides:5,staticHeight:"first",draw:"static",staticWidth:null},t);return new hc(this.shapes.webgl,e.color,new ke("Sum").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"integral",value:function(t){var e=st({color:this.defaultColor,lineWidth:null,width:null,tipWidth:null,sides:30,serif:!0,staticHeight:"first",draw:"static",staticWidth:null,num:1,type:"generic",serifSides:10,lineIntegralSides:20},t);return new mc(this.shapes.webgl,e.color,new ke("Integral").scale(1,1).translate(0,0),this.shapes.limits,e,"triangles")}},{key:"radical",value:function(t){var e={color:this.defaultColor,lineWidth:.01,staticSize:null,startHeight:.5,startWidth:.5,maxStartWidth:.15,maxStartHeight:.15,proportionalToHeight:!0,draw:"dynamic",staticHeight:"first",staticWidth:"first"};null!=t.proportionalToHeight&&!1===t.proportionalToHeight&&(e.startHeight=.15,e.startWidth=.15);var n=st(e,t);return new Cc(this.shapes.webgl,n.color,new ke("bracket").scale(1,1).translate(0,0),this.shapes.limits,n,"strip")}},{key:"strike",value:function(t){var e=st({style:"cross",color:this.defaultColor,lineWidth:null,draw:"dynamic",staticHeight:"first",width:null,height:null,staticWidth:"first"},t);return new Ec(this.shapes.webgl,e.color,new ke("bracket").scale(1,1).translate(0,0),this.shapes.limits,e,"triangles")}},{key:"bracket",value:function(t){var e=st({side:"left",color:this.defaultColor,lineWidth:null,sides:10,draw:"dynamic",staticHeight:"first",width:null,tipWidth:null,staticWidth:null},t);return new Bu(this.shapes.webgl,e.color,new ke("bracket").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"angleBracket",value:function(t){var e=st({side:"left",lineWidth:null,width:null,color:this.defaultColor,draw:"dynamic",staticHeight:"first"},t);return new Zu(this.shapes.webgl,e.color,new ke("bar").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"brace",value:function(t){var e=st({side:"left",color:this.defaultColor,lineWidth:null,sides:10,draw:"dynamic",staticHeight:"first",width:null,tipWidth:null,staticWidth:null},t);return new Vu(this.shapes.webgl,e.color,new ke("brace").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"bar",value:function(t){var e=st({side:"left",lineWidth:.01,color:this.defaultColor,draw:"dynamic",staticHeight:"first"},t);return new nc(this.shapes.webgl,e.color,new ke("bar").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"squareBracket",value:function(t){var e=st({side:"left",lineWidth:null,color:this.defaultColor,width:null,draw:"dynamic",staticHeight:"first",radius:0,sides:5,tipWidth:null},t);return new Yu(this.shapes.webgl,e.color,new ke("bar").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}}]),t}();function Lc(t){return(Lc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||Fc(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ic(t){return function(t){if(Array.isArray(t))return Wc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Fc(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fc(t,e){if(t){if("string"==typeof t)return Wc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wc(t,e):void 0}}function Wc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function qc(t,e,n){return(qc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Hc(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Nc(t,e){return(Nc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Hc(t){return(Hc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Vc=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nc(t,e)}(r,qo);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Hc(t);if(e){var o=Hc(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Lc(r)&&"function"!=typeof r?zc(this):r});function r(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);var o=i.color;null==o&&(o=[.5,.5,.5,1]);var a=st({},{color:o,fontMath:new bo("Times New Roman","normal",.2,"200","left","alphabetic",o),position:new se(0,0),scale:.7,defaultFormAlignment:{fixTo:new se(0,0),xAlign:"left",yAlign:"baseline"},elements:{},forms:{},formSeries:{},formRestart:null},i);return a.position=ee(a.position,new se(0,0)),a.defaultFormAlignment.fixTo=ee(a.defaultFormAlignment.fixTo,a.defaultFormAlignment.fixTo),null!=a.formRestart&&null!=a.formRestart.pulse&&(a.formRestart.pulse=st({},{scale:1.1,duration:1},a.formRestart.pulse)),(e=n.call(this,new ke("Equation").scale(1,1).rotate(0).translate(0,0),t.limits)).shapes=t,e.setColor(a.color),e.eqn={forms:{},currentForm:"",currentSubForm:"",subFormPriority:["base"],formSeries:{base:[]},currentFormSeries:[],currentFormSeriesName:"",scale:a.scale,defaultFormAlignment:a.defaultFormAlignment,functions:new ku(e.elements,e.addElementFromKey.bind(zc(e)),e.getExistingOrAddSymbol.bind(zc(e))),symbols:new Dc(e.shapes,e.color),fontMath:a.fontMath,isAnimating:!1,descriptionElement:null,descriptionPosition:new se(0,0),formRestart:a.formRestart},e.setPosition(a.position),null!=a.elements&&e.addElements(a.elements),null!=a.forms&&e.addForms(a.forms),null!=a.formSeries&&(Array.isArray(a.formSeries)?(e.eqn.formSeries={base:a.formSeries},e.eqn.currentFormSeries=e.eqn.formSeries.base,e.eqn.currentFormSeriesName="base"):(e.eqn.formSeries=a.formSeries,null!=a.defaultFormSeries?e.setFormSeries(a.defaultFormSeries):e.setFormSeries(Object.keys(e.eqn.formSeries)[0]))),e}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(t){return[].concat(Ic(qc(Hc(r.prototype),"_getStateProperties",this).call(this,t)),["eqn.currentForm","eqn.currentSubForm","eqn.isAnimating","eqn.currentFormSeries","eqn.currentFormSeriesName"])}},{key:"_getStatePropertiesMin",value:function(){return[].concat(Ic(qc(Hc(r.prototype),"_getStatePropertiesMin",this).call(this)),["eqn.currentForm","eqn.currentSubForm"])}},{key:"setFormSeries",value:function(t){null!=this.eqn.formSeries[t]&&(this.eqn.currentFormSeries=this.eqn.formSeries[t],this.eqn.currentFormSeriesName=t)}},{key:"getFormSeries",value:function(){return this.eqn.currentFormSeriesName}},{key:"makeTextElem",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:"";null!=t.text&&(n=t.text);var r,i,o,a=this.eqn.fontMath;null!=t.style?r=t.style:n.match(/[A-Z,a-z,\u03B8]/)&&(r="italic"),null!=t.weight&&(i=t.weight),null!=t.scale&&(o=.2*t.scale),null!=t.size&&(o=t.size),null==r&&null==i&&null==o||(a=new bo("Times New Roman",r||"normal",o||.2,i||"200","left","alphabetic",this.color)),null!=t.font&&(a=t.font);var s=this.shapes.text(n,{position:new se(0,0),font:a});return null!=t.color?s.setColor(t.color):s.setColor(s.drawingObject.text[0].font.color),s}},{key:"getTextFromKey",value:function(t){return t.replace(/^_*/,"").replace(/_.*/,"")}},{key:"getExistingOrAddSymbol",value:function(t){if("string"==typeof t)return this.getExistingOrAddSymbolFromKey(t,{});var e=Bc(Object.entries(t)[0],2),n=e[0],r=e[1];return this.getExistingOrAddSymbolFromKey(n,r)}},{key:"getExistingOrAddSymbolFromKey",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{},r=this.getElement(t);if(null!=r)return r;var i=t.replace(/^_*/,""),o=this.eqn.symbols.get(i,n);if(null!=o)return o.setColor(this.color),this.add(t,o),o;var a=i.match(/_[^_]*$/);return null!=a&&null!=(o=this.eqn.symbols.get(a[0].replace(/_/,""),n))?(o.setColor(this.color),this.add(t.replace(/_[^_]*$/,""),o),o):null}},{key:"addElementFromKey",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{},r=this.getExistingOrAddSymbolFromKey(t,n);if(null!=r)return r;var i=t.replace(/^_*/,"").replace(/_.*/,"");return r=this.makeTextElem(st({text:i},n)),this.add(t,r),r}},{key:"makeSymbolElem",value:function(t){var e=this.eqn.symbols.get(t.symbol,t);return null==e&&(e=this.makeTextElem({text:"Symbol ".concat(t.symbol," not valid")})),null==t.color&&e.setColor(this.color),e}},{key:"addElements",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r=t[n];if("string"==typeof r)n.startsWith("space")&&n.startsWith(" ")||e.add(n,e.makeTextElem({text:r}));else if(r instanceof Wo)e.add(n,r);else if(r instanceof qo)e.add(n,r);else{var i;null!=(i=null!=r.symbol&&"string"==typeof r.symbol?e.makeSymbolElem(r):e.makeTextElem(r,e.getTextFromKey(n)))&&(null!=r.mods&&i.setProperties(r.mods),e.add(n,i))}}));var n=this.makeTextElem({text:"gh"}),r=this.createForm({elem:n});r.content=[this.eqn.functions.contentToElement(n)],r.arrange(this.eqn.scale,"left","baseline",new se(0,0)),this.eqn.functions.fullLineHeight=r,this.setFirstTransform(this.transform)}},{key:"addDescriptionElement",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:null,r=1<arguments.length&&void 0!==e?e:new se(0,0);this.eqn.descriptionElement=n,this.eqn.descriptionPosition=r,this.eqn.descriptionElement&&this.eqn.descriptionElement.setPosition(this.getPosition("diagram").add(r))}},{key:"setPosition",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;qc(Hc(r.prototype),"setPosition",this).call(this,t,n);var i=this.getPosition("diagram");null!=this.eqn.descriptionElement&&this.eqn.descriptionElement.setPosition(i.add(this.eqn.descriptionPosition))}},{key:"addPhrases",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r=t[n];e.eqn.functions.phrases[n]=r}))}},{key:"addForms",value:function(t){function e(t){return"string"==typeof t}function n(t){return Array.isArray(t)}function r(t){if(!e(t)&&!n(t)&&null!=t&&"object"===Lc(t)){var r=Object.keys(t);if(1===r.length&&r[0]in a.eqn.functions)return 1}}function i(t){return t instanceof Ol||t instanceof Ul}function o(t,e){var n=[a.eqn.functions.contentToElement(e.content)],r=e.subForm,i=e.elementMods,o=e.duration,s=e.alignment,l=e.scale,u=e.description,c=e.modifiers,h=e.fromPrev,f=e.fromNext,d={subForm:r,elementMods:i,duration:o,translation:e.translation,alignment:s,scale:l,description:u,modifiers:c,fromPrev:h,fromNext:f};a.addForm(t,n,d)}var a=this;Object.keys(t).forEach((function(s){var l,u,c,h=t[s];e(h)||n(h)||r(h)||i(h)?(u=s,c=[a.eqn.functions.contentToElement(h)],a.addForm(u,c)):e(l=h)||n(l)||r(l)||i(l)||null==l||"object"!==Lc(l)||null==l.content?Object.entries(h).forEach((function(t){var a=Bc(t,2),l=a[0],u=a[1];e(u)||n(u)||r(u)||i(u)?o(s,{content:u,subForm:l}):o(s,st(u,{subForm:l}))})):o(s,h)}))}},{key:"checkFixTo",value:function(t){if("string"!=typeof t)return t instanceof Wo||t instanceof qo||t instanceof se?t:new se(0,0);var e=Tu(this,t);return null!=e?e:new se(0,0)}},{key:"createForm",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.elements;return new Mu(e,{getAllElements:this.getChildren.bind(this),hideAll:this.hideAll.bind(this),show:this.show.bind(this),showOnly:this.showOnly.bind(this),stop:this.stop.bind(this),getElementTransforms:this.getElementTransforms.bind(this),setElementTransforms:this.setElementTransforms.bind(this),animateToTransforms:this.animateToTransforms.bind(this)})}},{key:"addForm",value:function(t,e,n){var r=this,i=2<arguments.length&&void 0!==n?n:{};t in this.eqn.forms||(this.eqn.forms[t]={});var o={subForm:"base",elementMods:{},duration:void 0,description:"",modifiers:{},scale:this.eqn.scale,alignment:this.eqn.defaultFormAlignment,translation:{},fromNext:void 0,fromPrev:void 0},a=o;i&&(a=st({},o,i));var s=a.subForm,l=a.description,u=a.modifiers,c=a.duration;this.eqn.forms[t].name=t;var h=this.eqn.forms[t];h[s]=this.createForm(),h[s].description=l,h[s].modifiers=u,h[s].name=t,h[s].subForm=s,h[s].duration=c,h[s].elementMods={},Object.keys(a.elementMods).forEach((function(t){var e=a.elementMods[t],n=Tu(r,t);null!=n&&(h[s].elementMods[t]={element:n,mods:e})})),h[s].translation={},Object.keys(a.translation).forEach((function(t){var e,n,i,o=a.translation[t],l=Tu(r,t);if(Array.isArray(o)){var u=Bc(o,3);n=u[0],e=u[1],i=u[2]}else n=o.style,e=o.direction,i=o.mag;null!=l&&(h[s].translation[t]={element:l,style:n,direction:e,mag:i})}));var f=a.fromPrev;null!=f&&(h[s].fromPrev={},void 0!==f.duration&&(h[s].fromPrev.duration=f.duration),h[s].fromPrev.translation={},null!=f.translation&&Object.keys(f.translation).forEach((function(t){var e,n,i,o=f.translation[t],a=Tu(r,t);if(Array.isArray(o)){var l=Bc(o,3);n=l[0],e=l[1],i=l[2]}else n=o.style,e=o.direction,i=o.mag;null!=a&&(h[s].fromPrev.translation[t]={element:a,style:n,direction:e,mag:i})})));var d=a.fromNext;if(null!=d&&(h[s].fromNext={},void 0!==d.duration&&(h[s].fromNext.duration=d.duration),h[s].fromNext.translation={},null!=d.translation&&Object.keys(d.translation).forEach((function(t){var e,n,i,o=d.translation[t],a=Tu(r,t);if(Array.isArray(o)){var l=Bc(o,3);n=l[0],e=l[1],i=l[2]}else n=o.style,e=o.direction,i=o.mag;null!=a&&(h[s].fromNext.translation[t]={element:a,style:n,direction:e,mag:i})}))),a.alignment.fixTo=this.checkFixTo(a.alignment.fixTo),h[s].content=e,h[s].arrange(a.scale,a.alignment.xAlign,a.alignment.yAlign,a.alignment.fixTo),void 0===this.eqn.forms[t].base){var p=st({},a);p.subForm="base",this.addForm(t,e,p)}""===this.eqn.currentForm&&(this.eqn.currentForm=t),""===this.eqn.currentSubForm&&(this.eqn.currentSubForm="base")}},{key:"getCurrentForm",value:function(){return null==this.eqn.forms[this.eqn.currentForm]||null==this.eqn.forms[this.eqn.currentForm][this.eqn.currentSubForm]?null:this.eqn.forms[this.eqn.currentForm][this.eqn.currentSubForm]}},{key:"render",value:function(t){var e=!(0<arguments.length&&void 0!==t)||t,n=this.getCurrentForm();null!=n&&(n.setPositions(),n.showHide(0,0,null,e),this.show(),n.applyElementMods())}},{key:"setCurrentForm",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:"base";"string"==typeof t?(this.eqn.currentForm="",this.eqn.currentSubForm="",t in this.eqn.forms&&(this.eqn.currentForm=t,n in this.eqn.forms[t]&&(this.eqn.currentSubForm=n))):(this.eqn.currentForm=t.name,this.eqn.currentSubForm=t.subForm)}},{key:"showForm",value:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:null,i=!(2<arguments.length&&void 0!==n)||n;this.show();var o=t;"string"==typeof t&&(o=this.getForm(t,r)),o&&(this.setCurrentForm(o),this.render(i))}},{key:"getForm",value:function(t,e){var n=this;if(t instanceof Mu)return t;if(t in this.eqn.forms){var r=e;if(null==r){var i=this.eqn.subFormPriority.filter((function(e){return e in n.eqn.forms[t]}));i.length&&(r=i[0])}if(null!=r)return this.eqn.forms[t][r]}return null}},{key:"goToForm",value:function(t){var e,n=this,i=st({duration:null,prioritizeFormDuration:!0,delay:0,fromWhere:null,animate:"dissolve",callback:null,ifAnimating:{skipToTarget:!0,cancelGoTo:!0}},0<arguments.length&&void 0!==t?t:{});if(this.eqn.isAnimating){if(i.ifAnimating.skipToTarget){this.stop("complete");var o=this.getCurrentForm();null!=o&&this.showForm(o)}else this.stop("cancel");if(this.eqn.isAnimating=!1,i.ifAnimating.cancelGoTo)return}if(null!=i.name)e=this.eqn.forms[i.name];else if(null!=i.index)e=this.eqn.forms[this.eqn.currentFormSeries[i.index]];else if(0<this.eqn.currentFormSeries.length){var a=0,s=this.getCurrentForm();null!=s&&(a=this.eqn.currentFormSeries.indexOf(s.name))<0&&(a=0);var l=a+1;l===this.eqn.currentFormSeries.length&&(l=0),e=this.eqn.forms[this.eqn.currentFormSeries[l]]}if(null!=e){var u=null,c=null,h=this.eqn.subFormPriority.filter((function(t){return t in e}));if(h.length&&(c=h[0]),null!=c){u=e[c];var f=i.duration;if(i.prioritizeFormDuration&&("fromPrev"===i.fromWhere&&null!=u.fromPrev&&void 0!==u.fromPrev.duration?f=u.fromPrev.duration:"fromNext"===i.fromWhere&&null!=u.fromNext&&void 0!==u.fromNext.duration?f=u.fromNext.duration:void 0!==u.duration&&(f=u.duration)),null!=f&&0<f&&"dissolve"===i.animate?(null==i.dissolveOutTime&&(i.dissolveOutTime=.4*f),null==i.dissolveInTime&&(i.dissolveInTime=.4*f),null==i.blankTime&&(i.blankTime=.2*f)):(null==i.dissolveOutTime&&(i.dissolveOutTime=.4),null==i.dissolveInTime&&(i.dissolveInTime=.4),null==i.blankTime&&(i.blankTime=.2)),0===f)this.showForm(u),this.fnMap.exec(i.callback);else{this.eqn.isAnimating=!0;var d=function(){n.eqn.isAnimating=!1,n.fnMap.exec(i.callback)};if("move"===i.animate)u.animatePositionsTo(i.delay,i.dissolveOutTime,f,i.dissolveInTime,d,i.fromWhere,!1);else if("dissolveInThenMove"===i.animate)u.animatePositionsTo(i.delay,i.dissolveOutTime,f,i.dissolveInTime,d,i.fromWhere,!0);else if("moveFrom"===i.animate&&null!=this.eqn.formRestart&&null!=this.eqn.formRestart.moveFrom){var p=this.eqn.formRestart.moveFrom,y=this.getPosition(),v=this.getPosition();p instanceof r&&p.showForm(u.name),v=p instanceof qo?p.getPosition():ne(this.eqn.formRestart.moveFrom),this.fnMap.add("_equationShowFormCallback",(function(){n.showForm(u.name,c,!1)})),this.animations.new().dissolveOut({duration:i.dissolveOutTime}).position({target:v,duration:0}).trigger({callback:"showFormCallback",duration:.01}).position({target:y,duration:f}).whenFinished(d).start()}else if("pulse"===i.animate&&null!=this.eqn.formRestart&&null!=this.eqn.formRestart.pulse){var m=this.eqn.formRestart.pulse;u.allHideShow(i.delay,i.dissolveOutTime,i.blankTime,i.dissolveInTime,(function(){n.pulseScaleNow(m.duration,m.scale,0,d),null!=m.element&&m.element instanceof r&&m.element.getCurrentForm().name===u.name&&m.element.pulseScaleNow(m.duration,m.scale)}))}else u.allHideShow(i.delay,i.dissolveOutTime,i.blankTime,i.dissolveInTime,d);this.setCurrentForm(u)}}}}},{key:"getFormIndex",value:function(t){var e=this.getForm(t),n=-1;return null!=e&&(n=this.eqn.currentFormSeries.indexOf(e.name)),n}},{key:"prevForm",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:null,r=1<arguments.length&&void 0!==e?e:0,i=this.getCurrentForm();if(null!=i){var o=this.getFormIndex(i);-1<o&&(--o<0&&(o=this.eqn.currentFormSeries.length-1),this.goToForm({index:o,duration:n,delay:r,fromWhere:"fromNext"}))}}},{key:"nextForm",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:null,r=1<arguments.length&&void 0!==e?e:0,i="move",o=this.getCurrentForm();if(null!=o){var a=this.getFormIndex(o);if(-1<a){if((a+=1)>this.eqn.currentFormSeries.length-1){a=0;var s=this.eqn.formRestart;i=null!=s&&null!=s.moveFrom?"moveFrom":null!=s&&null!=s.pulse?"pulse":"dissolve"}this.goToForm({index:a,duration:n,delay:r,fromWhere:"fromPrev",animate:i})}}}},{key:"replayCurrentForm",value:function(t){if(this.eqn.isAnimating){this.stop("complete"),this.eqn.isAnimating=!1;var e=this.getCurrentForm();null!=e&&this.showForm(e)}else this.stop(),this.eqn.isAnimating=!1,this.prevForm(0),this.nextForm(t,.5)}},{key:"animateToForm",value:function(t,e,n,r){var i=1<arguments.length&&void 0!==e?e:null,o=2<arguments.length&&void 0!==n?n:0,a=3<arguments.length&&void 0!==r?r:null;this.stop();var s=this.getForm(t);null!=s&&s.animatePositionsTo(o,.4,i,.4,a),this.setCurrentForm(t)}},{key:"changeDescription",value:function(t,e,n,r){var i=1<arguments.length&&void 0!==e?e:"",o=2<arguments.length&&void 0!==n?n:{},a=3<arguments.length&&void 0!==r?r:"base",s=this.getForm(t,a);null!=s&&(s.description="".concat(i),s.modifiers=o)}},{key:"getDescription",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:"base",r=this.getForm(t,n);return null!=r&&null!=r.description?ma(r.description,r.modifiers):""}}]),r}();function Uc(t){return(Uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gc(t,e){return(Gc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Xc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yc(t){return(Yc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $c(t,e,n,r,i,o){var a,s=4<arguments.length&&void 0!==i&&i,l=5<arguments.length&&void 0!==o?o:"",u=n;if(null!=u&&null!=(a=t.getCurrentForm()))if(null!=a.description){var c=!s;n&&(s?(n.innerHTML=ma("".concat(l).concat(a.description),a.modifiers),ga(a.modifiers)):n.innerHTML=ma("".concat(l).concat(a.description),a.modifiers,"",c))}else null!=u&&(u.innerHTML="")}function Kc(t){t&&t.classList.remove("figureone__eqn_nav__not_touchable")}function Qc(t){t&&t.classList.add("figureone__eqn_nav__not_touchable")}function Zc(t,e){var n="",r="";1<arguments.length&&void 0!==e&&e&&(n="NEXT: ",r="PREV: ");var i=t.eqn.getCurrentForm();if(null!=i){var o=t.eqn.getFormIndex(i);if(0===o?(Qc(t.refresh),Qc(t.prev),Qc(t.prevDescription),Qc(t.description)):(Kc(t.refresh),Kc(t.prev),Kc(t.prevDescription),Kc(t.description)),1<t.eqn.eqn.currentFormSeries.length)Kc(t.next),Kc(t.nextDescription),"1Button"===t.navType&&Kc(t.description);else if(Qc(t.next),Qc(t.nextDescription),"1Button"===t.navType){var a=t.next;a&&(a.classList.remove("figureone__eqn_nav__next_form"),a.classList.remove("figureone__eqn_nav__reset"),a.classList.remove("interactive_top_right"))}var s=o+1;if(s>t.eqn.eqn.currentFormSeries.length-1){if(t.nextDescription&&(t.nextDescription.innerHTML="RESTART from begining"),"1Button"===t.navType&&1<t.eqn.eqn.currentFormSeries.length){var l=t.next;l&&(l.classList.add("figureone__eqn_nav__reset"),l.classList.remove("figureone__eqn_nav__next_form"))}}else if($c(t.eqn,i.subForm,t.nextDescription,s,!1,n),"1Button"===t.navType&&1<t.eqn.eqn.currentFormSeries.length){var u=t.next;u&&(u.classList.add("figureone__eqn_nav__next_form"),u.classList.remove("figureone__eqn_nav__reset"))}$c(t.eqn,i.subForm,t.description,o,!0);var c=o-1;0<=c?$c(t.eqn,i.subForm,t.prevDescription,c,!1,r):t.prevDescription&&(t.prevDescription.innerHTML="")}}var Jc=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gc(t,e)}(r,qo);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Yc(t);if(e){var o=Yc(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Uc(r)&&"function"!=typeof r?Xc(this):r});function r(t,e){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(i=n.call(this,new ke("Eqn Nav").scale(1,1).translate(0,0),t.limits)).shapes=t,i.prev=null,i.next=null,i.refresh=null,i.description=null,i.nextDescription=null,i.prevDescription=null,i.table=null,i.prevGroup=null,i.currentGroup=null,i.nextGroup=null,i.animateNextFrame=e,i.recorder=new Ki;var a=st({},{offset:new se(0,0),navType:"twoLine",navTypeOptions:{forceTwoLines:!1,arrows:!1},xAlign:"center",yAlign:"middle",interactive:!0,id:ut("id_figureone__equation_navigator_")},o);null!=(i.options=a).equation&&i.connectToEquation(a.equation,a.interactive),i.navType=a.navType;var s,l,u,c,h,f,d,p,y,v,m,g,b,w,S,x,_,T,k,O,P,A,E,M=null;if("3Line"===i.navType&&(s=i.clickPrev.bind(Xc(i)),l=i.clickRefresh.bind(Xc(i)),u=i.clickNext.bind(Xc(i)),c=a.navTypeOptions,h=document.createElement("table"),f=document.createElement("tr"),d=document.createElement("tr"),p=document.createElement("tr"),y=document.createElement("td"),v=document.createElement("td"),m=document.createElement("td"),g=document.createElement("td"),b=document.createElement("td"),w=document.createElement("td"),f.appendChild(y),f.appendChild(g),p.appendChild(m),p.appendChild(w),d.appendChild(v),d.appendChild(b),h.appendChild(f),h.appendChild(d),h.appendChild(p),h.classList.add("figureone__eqn_nav__table"),f.classList.add("figureone__eqn_nav__3line__prevRow"),d.classList.add("figureone__eqn_nav__3line__currentRow"),p.classList.add("figureone__eqn_nav__3line__nextRow"),y.classList.add("figureone__eqn_nav__3line__prevRow__button"),v.classList.add("figureone__eqn_nav__3line__currentRow__button"),m.classList.add("figureone__eqn_nav__3line__nextRow__button"),g.classList.add("figureone__eqn_nav__3line__prevRow__description"),b.classList.add("figureone__eqn_nav__3line__currentRow__description"),b.classList.add("figureone__eqn_nav__description"),w.classList.add("figureone__eqn_nav__3line__nextRow__description"),st({},{forceTwoLines:!1,arrows:!1},c).forceTwoLines&&(f.classList.add("figureone__eqn_nav__3line__prev_twoLines"),d.classList.add("figureone__eqn_nav__3line__current_twoLines"),p.classList.add("figureone__eqn_nav__3line__next_twoLines")),f.onclick=s,d.onclick=l,p.onclick=u,m.innerHTML="Next",y.innerHTML="Prev",v.innerHTML="Refresh",M={table:h,prevGroup:f,currentGroup:d,nextGroup:p,prev:y,refresh:v,next:m,prevDescription:g,description:b,nextDescription:w}),"description"===i.navType&&(S=i.clickNext.bind(Xc(i)),x=document.createElement("table"),_=document.createElement("tr"),T=document.createElement("td"),_.appendChild(T),x.appendChild(_),x.classList.add("figureone__eqn_nav__table"),_.classList.add("figureone__eqn_nav__description_only__currentRow"),T.classList.add("figureone__eqn_nav__description_only__currentRow__description"),T.classList.add("figureone__eqn_nav__description"),_.onclick=S,M={table:x,currentGroup:_,description:T}),"1Line"===i.navType&&(M=function(t,e,n,r){var i=document.createElement("table"),o=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),l=document.createElement("td");o.appendChild(a),o.appendChild(l),o.appendChild(s),i.appendChild(o),i.classList.add("figureone__eqn_nav__table"),o.classList.add("figureone__eqn_nav__1line__currentRow"),a.classList.add("figureone__eqn_nav__1line__prev__button"),s.classList.add("figureone__eqn_nav__1line__next__button"),l.classList.add("figureone__eqn_nav__1line__currentRow__description"),l.classList.add("figureone__eqn_nav__description");var u=st({},{forceTwoLines:!1,arrows:!1},r);if(u.forceTwoLines&&o.classList.add("figureone__eqn_nav__1line__current_twoLines"),a.onclick=t,l.onclick=e,s.onclick=n,u.arrows){var c=document.createElement("div");c.classList.add("figureone__eqn_nav__arrow_right"),s.appendChild(c);var h=document.createElement("div");h.classList.add("figureone__eqn_nav__arrow_left"),a.appendChild(h)}else s.innerHTML="Next",a.innerHTML="Prev";return{table:i,currentGroup:o,prev:a,next:s,description:l}}(i.clickPrev.bind(Xc(i)),i.clickRefresh.bind(Xc(i)),i.clickNext.bind(Xc(i)),a.navTypeOptions)),"1Button"===i.navType&&(k=i.clickNext.bind(Xc(i)),O=document.createElement("table"),P=document.createElement("tr"),A=document.createElement("td"),E=document.createElement("td"),P.appendChild(A),P.appendChild(E),O.appendChild(P),O.classList.add("figureone__eqn_nav__table"),P.classList.add("figureone__eqn_nav__1button__currentRow"),A.classList.add("figureone__eqn_nav__1button__button"),E.classList.add("figureone__eqn_nav__1line__currentRow__description"),E.classList.add("figureone__eqn_nav__description"),A.classList.add("interactive_top_right"),A.onclick=k,E.onclick=k,A.classList.add("figureone__eqn_nav__next_form"),M={table:O,currentGroup:P,next:A,description:E}),"2Line"===i.navType&&(M=function(t,e,n,r){var i=document.createElement("table"),o=document.createElement("tr"),a=document.createElement("tr"),s=document.createElement("tr"),l=document.createElement("td"),u=document.createElement("td"),c=document.createElement("tr"),h=document.createElement("td"),f=document.createElement("td");s.appendChild(h),c.appendChild(f),a.appendChild(s),a.appendChild(c),o.appendChild(l),o.appendChild(a),o.appendChild(u),i.appendChild(o),i.classList.add("figureone__eqn_nav__table"),s.classList.add("figureone__eqn_nav__2lines__currentRow"),c.classList.add("figureone__eqn_nav__2lines__nextRow"),l.classList.add("figureone__eqn_nav__2lines__prev__button"),u.classList.add("figureone__eqn_nav__2lines__next__button"),h.classList.add("figureone__eqn_nav__2lines__currentRow__description"),h.classList.add("figureone__eqn_nav__description"),f.classList.add("figureone__eqn_nav__2lines__nextRow__description");var d=st({},{forceTwoLines:!1,arrows:!1},r);if(-1<d.forceTwoLines&&s.classList.add("figureone__eqn_nav__2lines__current_twoLines"),l.onclick=t,h.onclick=e,u.onclick=n,f.onclick=n,d.arrows){var p=document.createElement("div");p.classList.add("figureone__eqn_nav__arrow_right"),u.appendChild(p);var y=document.createElement("div");y.classList.add("figureone__eqn_nav__arrow_left"),l.appendChild(y)}else u.innerHTML="Next",l.innerHTML="Prev";return{table:i,currentGroup:s,nextGroup:c,prev:l,next:u,nextDescription:f,description:h}}(i.clickPrev.bind(Xc(i)),i.clickRefresh.bind(Xc(i)),i.clickNext.bind(Xc(i)),a.navTypeOptions)),null!=M){var j=ee(a.offset,new se(0,0));Object.assign(Xc(i),M);var R=i.shapes.htmlElement(M.table,"".concat(a.id,"_table"),"",j,a.yAlign,a.xAlign);i.add("table",R)}return i}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"connectToEquation",value:function(t,e){this.eqn=t,e&&(this.eqn.onClick=this.clickNext.bind(this),this.eqn.hasTouchableElements=!0,this.eqn.isTouchable=!0,this.eqn.touchInBoundingRect=!0)}},{key:"clickNext",value:function(){null!==this.onClick&&void 0!==this.onClick&&("recording"===this.recorder.state&&this.recorder.recordEvent("eqnNavClick",["next",this.getPath()]),this.fnMap.exec(this.onClick,this)),this.eqn.nextForm(1.5),this.updateButtons(),this.animateNextFrame()}},{key:"clickPrev",value:function(){null!==this.onClick&&void 0!==this.onClick&&("recording"===this.recorder.state&&this.recorder.recordEvent("eqnNavClick",["prev",this.getPath()]),this.fnMap.exec(this.onClick,this)),this.eqn.prevForm(1.5),this.updateButtons(),this.animateNextFrame()}},{key:"clickRefresh",value:function(){null!==this.onClick&&void 0!==this.onClick&&("recording"===this.recorder.state&&this.recorder.recordEvent("eqnNavClick",["refresh",this.getPath()]),this.fnMap.exec(this.onClick,this));var t=this.eqn.getCurrentForm();null!=t&&0<this.eqn.getFormIndex(t)&&(this.eqn.replayCurrentForm(1.5),this.animateNextFrame()),this.updateButtons()}},{key:"updateButtons",value:function(){"equationOnly"!==this.navType&&("description"===this.navType?function(t){var e=t.eqn.getCurrentForm();if(null!=e){var n=t.eqn.getFormIndex(e);Kc(t.description),$c(t.eqn,e.subForm,t.description,n,!0)}}(this):"2Line"===this.navType?Zc(this,!0):Zc(this))}},{key:"showForm",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:null;this.show(),this.eqn.showForm(t,n),this._table&&(this._table.show(),this.updateButtons())}}]),r}();function th(t,e){if(t){if("string"==typeof t)return eh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?eh(t,e):void 0}}function eh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var nh=function(){function t(e,n){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.webgl=e.webgl,this.draw2D=e.draw2D,this.limits=e.limits,this.shapes=e,this.animateNextFrame=n}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"equation",value:function(t){return new Vc(this.shapes,t)}},{key:"addEquation",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:{},i=new Vc(this.shapes,r);return t.add(e,i),i}},{key:"addNavigator",value:function(t,e,n){var r,i,o=e,a=st({},n);if(null==a.equation){var s=this.addEquation(t,"".concat(e,"Eqn"),n);a.equation=s,o="".concat(e,"Nav")}else if(!(a.equation instanceof Vc)){var l,u,c,h,f;if(Array.isArray(a.equation)){var d=function(t){if(Array.isArray(t))return t}(i=a.equation)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(e.push(o.value),7!==e.length);n=!0);}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}}(i)||th(i,7)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();l=d[1],u=d[3],c=d[4],h=d[6]}else l=a.equation.name,u=a.equation.options,c=a.equation.mods,h=a.equation.scenario;f=Array.isArray(u)?this.addEquation.apply(this,[t,l].concat(function(t){if(Array.isArray(t))return eh(t)}(r=u)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(r)||th(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())):this.addEquation(t,l,u),null!=c&&c!=={}&&f.setProperties(c),null!=h&&h in f.scenarios&&f.setScenario(h),a.equation=f}var p=new Jc(this.shapes,this.animateNextFrame,a);return t.add(o,p),p}}]),t}(),rh=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var r,i=st({},{label:"",color:[0,0,1,1],scale:.7,position:new se(0,0),form:"0",formType:"base",xAlign:"center",yAlign:"middle"},n),o=i.label,a=i.color,s=i.scale,l=i.position,u=i.form,c=i.formType,h=i.yAlign,f=i.xAlign;if("string"==typeof o)(r=e.equation({elements:{base:o},color:a,defaultFormAlignment:{fixTo:new se(0,0),xAlign:f,yAlign:h},scale:s,forms:{base:["base"]},position:l})).setCurrentForm("base");else if(o instanceof Vc)r=o;else if(Array.isArray(o)){var d={},p={};o.forEach((function(t,e){d["_".concat(e)]=t,p[e]=[t]})),(r=e.equation({elements:d,forms:p,color:a,position:l,defaultFormAlignment:{fixTo:new se(0,0),xAlign:f,yAlign:h},scale:s})).setCurrentForm(u,c)}else{var y={color:a,defaultFormAlignment:{fixTo:new se(0,0),xAlign:f,yAlign:h},scale:s,form:u,formType:c};r=e.equation(st(y,o))}this.eqn=r}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"setText",value:function(t){var e=this.eqn.getCurrentForm();if(null!=e){var n=Object.keys(e.elements)[0],r=e.elements[n].drawingObject;null!=r&&r.setText(t),e.arrange(this.eqn.eqn.scale,this.eqn.eqn.defaultFormAlignment.xAlign,this.eqn.eqn.defaultFormAlignment.yAlign,this.eqn.eqn.defaultFormAlignment.fixTo)}}},{key:"getText",value:function(){var t="",e=this.eqn.getCurrentForm();if(null!=e){var n=Object.keys(e.elements)[0],r=e.elements[n].drawingObject;null!=r&&(t=r.text[0].text)}return t}},{key:"updateRotation",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:0,o=3<arguments.length&&void 0!==r?r:0;if(0!==i){var a=0,s=0,l=this.eqn.getCurrentForm();null!=l&&(a=l.width/2+.04,s=l.height/2+.04);var u=a+i,c=s+i,h=u*c/Math.sqrt(Math.pow(c*Math.cos(t-o),2)+Math.pow(u*Math.sin(t-o),2));this.eqn.setPosition(e.add(Me(h,o)))}else this.eqn.setPosition(e);this.eqn.transform.updateRotation(t)}}]),t}();function ih(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function oh(t,e,n){return(oh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dh(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ah(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function sh(t,e,n){return e&&ah(t.prototype,e),n&&ah(t,n),t}function lh(t){return(lh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function uh(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ch(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function hh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,i=dh(t);if(e){var o=dh(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==lh(r)&&"function"!=typeof r?fh(this):r}}function fh(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dh(t){return(dh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ph=function(){ch(e,rh);var t=hh(e);function e(n,r,i,o){var a,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"top",l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"left",u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"horizontal",c=7<arguments.length&&void 0!==arguments[7]?arguments[7]:.5,h=8<arguments.length&&void 0!==arguments[8]?arguments[8]:.7,f=9<arguments.length&&void 0!==arguments[9]?arguments[9]:1;return uh(this,e),(a=t.call(this,n,{label:r,color:i,scale:h})).offset=o,a.location=s,a.subLocation=l,a.orientation=u,a.linePosition=c,a.precision=f,a}return e}();function yh(t,e,n,r,i,o,a,s){var l=t.horizontalLine(r,e,n,0,i,(new ke).scale(1,1).translate(0,0));if(o&&(l=t.dashedLine({position:r,length:o.maxLength,width:n,rotation:0,dashStyle:o.style,color:i,transform:(new ke).scale(1,1).translate(0,0)})),a){var u=0,c=0,h=(s?16:8)*n;"number"==typeof a&&(h=a),"object"===lh(a)&&(null!=a.width&&(h=a.width),null!=a.end&&(u=a.end),null!=a.start&&(c=a.start)),l.drawingObject.border[0]=[l.drawingObject.border[0][0].add(-c,-h),l.drawingObject.border[0][1].add(-c,h),l.drawingObject.border[0][2].add(u,h),l.drawingObject.border[0][3].add(u,-h)]}return l}var vh=function(){ch(e,qo);var t=hh(e);function e(n,r,i,o){var a,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};uh(this,e);var l=st({},{position:new se(0,0),length:1,angle:0,width:.01,vertexSpaceStart:"start",color:[0,0,1,1],showLine:!0,largerTouchBorder:!0,touchBorder:null,offset:0,dashStyle:null,mods:{},pulse:{line:6,label:2,arrow:3,collection:1}},s),u=l.dashStyle;if(u){var c=l.length;null!=l.p1&&null!=l.p2&&(l.p1=ne(l.p1),l.p2=ne(l.p2),c=fe(l.p1,l.p2)),u=st({},{maxLength:c,dashStyle:[.1]},s.dashStyle)}if((a=t.call(this,new ke("Line").scale(1,1).rotate(0).translate(0,0),n.limits)).setColor(l.color),a.shapes=n,a.equation=r,a.largerTouchBorder=l.largerTouchBorder,a.isTouchDevice=i,a.animateNextFrame=o,a.dashStyle=u,a.animateLengthToOptions={initialLength:0,deltaLength:1,finishOnCancel:!0,callback:null,onStepCallback:null},a.pulseWidthOptions={oldCallback:null,oldTransformMethod:null},a.animateLengthToStepFunctionName="_animateToLengthStep",a.fnMap.add(a.animateLengthToStepFunctionName,a.animateLengthToStep.bind(fh(a))),a.animateLengthToDoneFunctionName="_animateToLengthDone",a.fnMap.add(a.animateLengthToDoneFunctionName,a.animateLengthToDone.bind(fh(a))),a.pulseWidthDoneCallbackName="_pulseWidthDone",a.fnMap.add(a.pulseWidthDoneCallbackName,a.pulseWidthDone.bind(fh(a))),a.offset=l.offset,a.width=l.width,a.position=ne(l.position),a.length=l.length,a.angle=l.angle,a.transform.updateTranslation(a.position),a.transform.updateRotation(a.angle),a.vertexSpaceLength=1,a.vertexSpaceStart=new se(0,0),"end"===l.vertexSpaceStart?a.vertexSpaceStart=new se(-1,0):"center"===l.vertexSpaceStart?a.vertexSpaceStart=new se(-.5,0):"number"==typeof l.vertexSpaceStart?a.vertexSpaceStart=new se(-l.vertexSpaceStart,0):l.vertexSpaceStart instanceof se&&(a.vertexSpaceStart=l.vertexSpaceStart),a.multiMove={vertexSpaceMidLength:0,bounds:new oe(-1,-1,2,2)},a._midLine=null,a.scaleTransformMethodName="_transformMethod",a._line=null,l.showLine){var h=yh(a.shapes,a.vertexSpaceLength,a.width,a.vertexSpaceStart,l.color,a.dashStyle,l.largerTouchBorder,i);h.fnMap.add(a.scaleTransformMethodName,(function(t){return(new ke).scale(1,t)})),a.add("line",h)}a.arrow1=null,a.arrow2=null,a._arrow1=null,a._arrow2=null,a.label=null,a._label=null,a.showRealLength=!1,a.setLength(a.length),null!=l.p1&&null!=l.p2&&a.setEndPoints(l.p1,l.p2);var f={width:4*a.width,height:4*a.width};if(l.arrowStart){var d=st({},f,l.arrowStart);a.addArrowStart(d.height,d.width)}if(l.arrowEnd){var p=st({},f,l.arrowEnd);a.addArrowEnd(p.height,p.width)}if(l.arrows){var y={};"object"===lh(l.arrows)&&(y=l.arrows);var v=st({},f,y);a.addArrows(v.height,v.width)}var m={text:null,offset:0,location:"top",subLocation:"left",orientation:"horizontal",linePosition:.5,scale:.7,color:l.color,precision:1};if(l.label){var g=st({},m,l.label);null===g.text&&(g.text="",a.showRealLength=!0),a.addLabel(g.text,g.offset,g.location,g.subLocation,g.orientation,g.linePosition,g.scale,g.color,g.precision)}var b={type:"rotation",middleLengthPercent:.22,translationBounds:a.diagramLimits};if(l.move){var w=st({},b,l.move);a.setMovable(!0,w.type,w.middleLengthPercent,w.translationBounds)}return a.pulseDefaultSettings={line:l.pulse.line||1,label:l.pulse.label||1,arrow:l.pulse.arrow||1,collection:l.pulse.collection||1},a.pulseDefault=function(t){a.pulseWidth({line:a.pulseDefaultSettings.line,label:a.pulseDefaultSettings.label,arrow:a.pulseDefaultSettings.arrow,done:t}),1!==a.pulseDefaultSettings.collection&&a.pulseScaleNow(1,a.pulseDefaultSettings.collection)},null!=l.mods&&l.mods!=={}&&a.setProperties(l.mods),a}return sh(e,[{key:"calculateFromP1LengthAngle",value:function(t,e,n){var r=(new ke).scale(e,1).rotate(n),i=this.vertexSpaceStart.transformBy(r.matrix());return{length:e,angle:n,position:t.sub(i)}}},{key:"calculateFromP1P2",value:function(t,e){var n=new ge(t,e),r=n.length(),i=n.angle(),o=(new ke).scale(r,1).rotate(i),a=this.vertexSpaceStart.transformBy(o.matrix());return{length:r,angle:i,position:t.sub(a)}}}]),sh(e,[{key:"_getStateProperties",value:function(t){return[].concat(function(t){if(Array.isArray(t))return ih(t)}(n=oh(dh(e.prototype),"_getStateProperties",this).call(this,t))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(n)||function(t){if(t){if("string"==typeof t)return ih(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ih(t,void 0):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["offset","angle","length","position","animateLengthToOptions","pulseWidthOptions"]);var n}},{key:"_fromState",value:function(t){return st(this,t),this.setLineDimensions(),this}},{key:"pulseWidthDone",value:function(){var t=this._line;null!=t&&(this.pulseWidthOptions.oldTransformMethod&&(t.pulseSettings.transformMethod=this.pulseWidthOptions.oldTransformMethod),t.pulseSettings.callback=this.pulseWidthOptions.oldCallback)}},{key:"pulseWidth",value:function(t){var e=st({line:3,label:1.5,arrow:2,done:null,duration:1,when:"nextFrame"},0<arguments.length&&void 0!==t?t:{}),n=e.done,r=this._line;null!=r&&(r.stopPulsing(),this.pulseWidthOptions={oldTransformMethod:r.pulseSettings.transformMethod,oldCallback:r.pulseSettings.callback},r.pulseSettings.callback=this.pulseWidthDoneCallbackName,r.pulseSettings.transformMethod=this.scaleTransformMethodName,r.pulseScale({duration:e.duration,scale:e.line,frequency:0,callback:n,when:e.when}),n=null);var i=this._arrow1,o=this._arrow2;null!=i&&(i.pulseScale({duration:e.duration,scale:e.arrow,frequency:0,callback:n,when:e.when}),n=null),null!=o&&(o.pulseScale({duration:e.duration,scale:e.arrow,frequency:0,callback:n,when:e.when}),n=null);var a=this._label;null!=a&&(a.pulseScale({duration:e.duration,scale:e.label,frequency:0,callback:n,when:e.when}),n=null),null!=n&&n(),this.animateNextFrame()}},{key:"addArrow",value:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:4*this.width,i=2<arguments.length&&void 0!==n?n:r,o=Math.PI/2;2===t&&(o=Math.PI/2*3);var a=this.shapes.arrow({width:i,legWidth:0,height:r,legHeight:0,color:this.color,transform:(new ke).translate(this.vertexSpaceStart.x,0),tip:new se(0,0),rotation:o});this["arrow".concat(t)]={height:r},this.add("arrow".concat(t),a),this.setLength(this.currentLength)}},{key:"addArrows",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,r=1<arguments.length&&void 0!==e?e:n;this.addArrow1(n,r),this.addArrow2(n,r)}},{key:"addArrow1",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,r=1<arguments.length&&void 0!==e?e:n;this.addArrow(1,n,r)}},{key:"addArrow2",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,r=1<arguments.length&&void 0!==e?e:n;this.addArrow(2,n,r)}},{key:"addArrowStart",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,r=1<arguments.length&&void 0!==e?e:n;this.addArrow1(n,r)}},{key:"addArrowEnd",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,r=1<arguments.length&&void 0!==e?e:n;this.addArrow2(n,r)}},{key:"setMovable",value:function(t,n,r,i){var o=!(0<arguments.length&&void 0!==t)||t,a=1<arguments.length&&void 0!==n?n:this.move.type,s=2<arguments.length&&void 0!==r?r:.333,l=3<arguments.length&&void 0!==i?i:this.diagramLimits._dup();o?"translation"===a||"rotation"===a||"scale"===a||"scaleX"===a||"scaleY"===a?(this.move.type=a,oh(dh(e.prototype),"setMovable",this).call(this,!0),this.hasTouchableElements=!0,null!=this._line&&(this._line.isTouchable=!0,this._line.isMovable=!1),this._midLine&&(this._midLine.isMovable=!1),this.multiMove.bounds=l):this.setMultiMovable(s,l):(this.isMovable=!1,this.isTouchable=!1,null!=this._line&&(this._line.isTouchable=!1,this._line.isMovable=!1))}},{key:"setMultiMovable",value:function(t,e){this.multiMove.vertexSpaceMidLength=t*this.vertexSpaceLength;var n=new se(this.vertexSpaceStart.x+this.vertexSpaceLength/2-this.multiMove.vertexSpaceMidLength/2,0),r=yh(this.shapes,this.multiMove.vertexSpaceMidLength,this.width,n,this.color,null,this.largerTouchBorder,this.isTouchDevice);r.isTouchable=!0,r.move.type="translation",r.move.element=this,r.isMovable=!0,r.move.canBeMovedAfterLosingTouch=!0,this.add("midLine",r),this._line&&(this._line.isTouchable=!0,this._line.move.type="rotation",(this._line.move.element=this)._line.isMovable=!0,this._line.move.canBeMovedAfterLosingTouch=!0),this.hasTouchableElements=!0,this.isTouchable=!1,this.isMovable=!1,this.multiMove.bounds=e,this.setLength(this.currentLength)}},{key:"updateMoveTransform",value:function(t){var e=(0<arguments.length&&void 0!==t?t:this.transform._dup()).r(),n=this.multiMove.bounds;if(null!=e){var r=Math.abs(this.currentLength/2*Math.cos(e)),i=Math.abs(this.currentLength/2*Math.sin(e));this.move.bounds instanceof Ue&&this.move.bounds.updateTranslation(new Ne({left:n.left+r,bottom:n.bottom+i,right:n.right-r,top:n.top-i})),e>2*Math.PI&&this.transform.updateRotation(e-2*Math.PI),e<0&&this.transform.updateRotation(e+2*Math.PI)}}},{key:"addLabel",value:function(t,e,n,r,i,o,a,s,l){var u=2<arguments.length&&void 0!==n?n:"top",c=3<arguments.length&&void 0!==r?r:"left",h=4<arguments.length&&void 0!==i?i:"horizontal",f=5<arguments.length&&void 0!==o?o:.5,d=6<arguments.length&&void 0!==a?a:.7,p=7<arguments.length&&void 0!==s?s:this.color,y=8<arguments.length&&void 0!==l?l:1;this.label=new ph(this.equation,t,p,e,u,c,h,f,d,y),null!=this.label&&this.add("label",this.label.eqn),this.updateLabel()}},{key:"getLength",value:function(){return this.length}},{key:"getAngle",value:function(t){return"deg"===(0<arguments.length&&void 0!==t?t:"rad")?180*this.angle/Math.PI:this.angle}},{key:"setLabel",value:function(t){this.showRealLength=!1,null!=this.label&&this.label.setText(t),this.updateLabel()}},{key:"getLabel",value:function(){return null!=this.label?this.label.getText():""}},{key:"setLabelToRealLength",value:function(){this.showRealLength=!0,this.updateLabel()}},{key:"updateLabel",value:function(t){var e=0<arguments.length&&void 0!==t?t:0,n=this.label;if(null!=n){var r=ye(this.transform.r()||0),i=0;this.showRealLength&&this._label&&n.setText(h(this.currentLength,2).toFixed(n.precision));var o=new se(this.vertexSpaceStart.x*this.currentLength+n.linePosition*this.currentLength,0),a=Math.PI/2,s=n.offset;if("end1"===n.location||"end2"===n.location)"end1"===n.location&&(o.x=this.vertexSpaceStart.x*this.currentLength-n.offset,a=-Math.PI),"end2"===n.location&&(o.x=this.vertexSpaceStart.x*this.currentLength+this.currentLength+n.offset,a=0);else{var l=Math.cos(r)<0?-Math.PI/2:Math.PI/2,u=-l,c=0<Math.sin(r)?Math.PI/2:-Math.PI/2,f=-c;"top"===n.location&&(a=l),"bottom"===n.location&&(a=u),"right"===n.location&&(a=f),"left"===n.location&&(a=c),0!==h(Math.sin(r),4)||"left"!==n.location&&"right"!==n.location||("top"===n.subLocation&&(a=l),"bottom"===n.subLocation&&(a=u)),0!==h(Math.cos(r),4)||"top"!==n.location&&"bottom"!==n.location||("right"===n.subLocation&&(a=f),"left"===n.subLocation&&(a=c)),"inside"===n.location&&(a=-Math.PI/2),"outside"===n.location&&(a=Math.PI/2)}"horizontal"===n.orientation&&(i=-r),"baseToLine"===n.orientation&&o.y<0&&(i=Math.PI),"baseAway"===n.orientation&&0<o.y&&(i=Math.PI),"baseUpright"===n.orientation&&Math.cos(r)<0&&(i=Math.PI),n.updateRotation(i-e,o,s,a)}}},{key:"setLength",value:function(t){var e=this.vertexSpaceStart.x*t,n=t,r=n,i=0;this.arrow1&&this._arrow1&&(r-=this.arrow1.height,i=this.arrow1.height,this._arrow1.setPosition(e)),this.arrow2&&this._arrow2&&(r-=this.arrow2.height,this._arrow2.setPosition(e+n,0));var o=this._line;if(o)if(this.dashStyle)o.lengthToDraw=r,o.setPosition(e+i-this.vertexSpaceStart.x,0);else{o.transform.updateScale(r,1);var a=e+i-this.vertexSpaceStart.x*r;o.setPosition(a,0)}var s=this._midLine;s&&s.transform.updateScale(t,1),this.length=t,this.updateLineGeometry(),this.currentLength=t,this.updateLabel()}},{key:"updateLineGeometry",value:function(){var t=this.transform.t(),e=this.transform.r();if(null!=t&&null!=e){this.position=t,this.angle=e;var n=this.vertexSpaceStart.transformBy((new ke).scale(this.length).rotate(this.angle).translate(this.position).m()),r=new ge(n,this.length,this.angle);this.p1=r.getPoint(1),this.p2=r.getPoint(2),this.line=r}}},{key:"setLineDimensions",value:function(){var t=Me(this.offset,this.angle+Math.PI/2);this.transform.updateTranslation(this.position.add(t)),this.transform.updateRotation(this.angle),this.setLength(this.length),this.updateLabel()}},{key:"setEndPoints",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:this.offset;this.offset=r;var i=this.calculateFromP1P2(ne(t),ne(e)),o=i.length,a=i.angle,s=i.position;this.angle=a,this.length=o,this.position=s,this.setLineDimensions()}},{key:"animateLengthToStep",value:function(t){var e=this.animateLengthToOptions,n=e.initialLength,r=e.deltaLength,i=e.onStepCallback;this.setLength(n+r*t),null!=i&&this.fnMap.exec(i,t,n+r*t)}},{key:"animateLengthToDone",value:function(){var t=this.animateLengthToOptions,e=t.initialLength,n=t.callback,r=t.deltaLength;t.finishOnCancel&&this.setLength(e+r),this.fnMap.exec(n)}},{key:"animateLengthTo",value:function(t,e,n,r,i,o){var a=0<arguments.length&&void 0!==t?t:1,s=1<arguments.length&&void 0!==e?e:1,l=!(2<arguments.length&&void 0!==n)||n,u=3<arguments.length&&void 0!==r?r:null,c=4<arguments.length&&void 0!==i?i:null;5<arguments.length&&void 0!==o&&!o||this.stop(),this.animateLengthToOptions={initialLength:this.currentLength,deltaLength:a-this.currentLength,callback:u,onStepCallback:c,finishOnCancel:l},this.animations.new("Line Length").custom({callback:this.animateLengthToStepFunctionName,duration:s}).whenFinished(this.animateLengthToDoneFunctionName).start(),this.animateNextFrame()}},{key:"grow",value:function(t,e,n,r,i){var o=0<arguments.length&&void 0!==t?t:0,a=1<arguments.length&&void 0!==e?e:1,s=!(2<arguments.length&&void 0!==n)||n,l=3<arguments.length&&void 0!==r?r:null,u=4<arguments.length&&void 0!==i?i:null;this.stop();var c=this.currentLength;this.setLength(o),this.animateLengthTo(c,a,s,l,u)}},{key:"showLineOnly",value:function(){this.show(),this._line&&this._line.show(),this._arrow1&&this._arrow1.show(),this._arrow2&&this._arrow2.show(),this._label&&this._label.hideAll()}},{key:"getP1",value:function(){var t=this.transform.matrix();return this.p1.transformBy(t)}},{key:"getP2",value:function(){var t=this.transform.matrix();return this.p2.transformBy(t)}}]),e}();function mh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function gh(t,e,n){return(gh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kh(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function bh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wh(t,e,n){return e&&bh(t.prototype,e),n&&bh(t,n),t}function Sh(t){return(Sh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xh(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function Th(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,i,o=kh(t);if(e){var a=kh(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return r=this,!(i=n)||"object"!==Sh(i)&&"function"!=typeof i?function(){if(void 0!==r)return r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():i}}function kh(t){return(kh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Oh=function(){_h(e,rh);var t=Th(e);function e(n,r,i,o){var a,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,u=6<arguments.length&&void 0!==arguments[6]&&arguments[6],c=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"degrees",h=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0,f=9<arguments.length&&void 0!==arguments[9]?arguments[9]:null,d=10<arguments.length&&void 0!==arguments[10]?arguments[10]:null,p=11<arguments.length&&void 0!==arguments[11]?arguments[11]:"horizontal",y=12<arguments.length&&void 0!==arguments[12]?arguments[12]:.7;return xh(this,e),(a=t.call(this,n,{label:r,color:i,scale:y})).radius=o,a.curvePosition=s,a.curveOffset=l,a.showRealAngle=u,a.units=c,a.orientation=p,a.precision=h,a.autoHide=f,a.autoHideMax=d,a}return e}(),Ph=function(){_h(e,qo);var t=Th(e);function e(n,r,i,o){var a,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};xh(this,e);var l={position:new se(0,0),rotation:0,angle:1,color:[0,1,0,1],direction:1,autoRightAngle:!1,rightAngleRange:.001,curve:null,corner:null,sides:null,sideStart:null,sideStop:null,arrows:null,arrow1:null,arrow2:null,label:null,p1:null,p2:null,p3:null,pulse:{curve:1,label:1,arrow:1,side:1,collection:1.8},mods:{}},u=st({},l,s);if((a=t.call(this,new ke("Line").scale(1,1).rotate(0).translate(0,0),n.limits)).setColor(u.color),a.shapes=n,a.equation=r,a.largerTouchBorder=u.largerTouchBorder,a.isTouchDevice=i,a.animateNextFrame=o,a.nextPosition=ne(u.position),a.nextRotation=u.rotation,a.direction=u.direction,a.angle=u.angle,a.lastLabelRotationOffset=0,a.autoRightAngle=u.autoRightAngle,a.rightAngleRange=u.rightAngleRange,null!=u.p1&&null!=u.p2&&null!=u.p3){var c=a.calculateFromP1P2P3(ne(u.p1),ne(u.p2),ne(u.p3),a.direction),h=c.position,f=c.rotation,d=c.angle;a.angle=d,a.nextRotation=f,a.nextPosition=ne(h)}a.setNextPositionAndRotation(),a.side1=null,a.side2=null,a.arrow1=null,a.arrow2=null,a.curve=null,a.label=null,a._curve=null,u.curve&&a.addCurve(u.curve),(u.arrow1||u.arrows)&&a.addArrow(1,st({},u.arrow1,u.arrows)),(u.arrow2||u.arrows)&&a.addArrow(2,st({},u.arrow2,u.arrows)),u.label&&a.addLabel(u.label);var p=.5;a.curve&&(p=2*a.curve.radius);var y=.01;a.curve&&(y=a.curve.width);var v={length:p,width:y,color:a.color};if(u.side1){var m=st({},v,u.side1);a.addSide(1,m.length,m.width,m.color)}if(u.side2){var g=st({},v,u.side2);a.addSide(2,g.length,g.width,g.color)}if(null!=u.corner){var b=st({},v,{style:"fill"},u.corner);a.addCorner(b)}if(u.sides){var w={};"object"===Sh(u.sides)&&(w=u.sides);var S=st({},v,w);a.addSide(1,S.length,S.width,S.color),a.addSide(2,S.length,S.width,S.color)}return"number"==typeof u.pulse?a.pulseDefaultSettings={curve:l.pulse.curve,label:l.pulse.label,arrow:l.pulse.arrow,side:l.pulse.side,collection:u.pulse}:a.pulseDefaultSettings={curve:u.pulse.curve||1,label:u.pulse.label||1,arrow:u.pulse.arrow||1,side:u.pulse.side||1,collection:u.pulse.collection||1},a.pulseDefault=function(t){var e=t,n=a.pulseDefaultSettings;if("number"==typeof n.curve)1!==n.curve&&null!=a._curve&&(a._curve.pulseScaleNow(1,n.curve,0,e),e=null);else if(null!=a._curve&&null!=n.curve){var r=st({width:2,num:5},n.curve);a._curve.pulseThickNow(1,r.width,r.num,e),e=null}1!==n.label&&null!=a._label&&(a._label.pulseScaleNow(1,n.label,0,e),e=null),1!==n.arrow&&(null!=a._arrow1&&(a._arrow1.pulseScaleNow(1,n.arrow,0,e),e=null),null!=a._arrow2&&(a._arrow2.pulseScaleNow(1,n.arrow,0,e),e=null)),1!==n.side&&(null!=a._side1&&(a._side1.pulseScaleNow(1,n.side,0,e),e=null),null!=a._side2&&(a._side2.pulseScaleNow(1,n.side,0,e),e=null)),1!==n.collection&&a.pulseScaleNow(1,n.collection,0,e)},a.update(),null!=u.mods&&u.mods!=={}&&a.setProperties(u.mods),a}return wh(e,[{key:"calculateFromP1P2P3",value:function(t,e,n,r){var i=3<arguments.length&&void 0!==r?r:1,o=e._dup(),a=Ce(t,e,n);return 1===i?{position:o,rotation:new ge(e,t).angle(),angle:a}:{position:o,rotation:new ge(e,t).angle(),angle:Jt(2*Math.PI-a,"0to360")}}}]),wh(e,[{key:"_getStateProperties",value:function(t){return[].concat(function(t){if(Array.isArray(t))return mh(t)}(n=gh(kh(e.prototype),"_getStateProperties",this).call(this,t))||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(n)||function(t){if(t){if("string"==typeof t)return mh(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?mh(t,void 0):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["angle","lastLabelRotationOffset"]);var n}},{key:"_fromState",value:function(t){return st(this,t),this.setAngle({angle:this.angle,rotationOffset:this.lastLabelRotationOffset}),this}},{key:"setNextPositionAndRotation",value:function(){null!=this.nextPosition&&this.transform.updateTranslation(this.nextPosition),null!=this.nextRotation&&this.transform.updateRotation(this.nextRotation),this.nextPosition=null,this.nextRotation=null}},{key:"setAngle",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};null!=e.position&&(this.nextPosition=ne(e.position)),null!=e.rotation&&(this.nextRotation=e.rotation),null!=e.angle&&(this.angle=e.angle);var n=e.p1,r=e.p2,i=e.p3;if(null!=n&&null!=r&&null!=i){var o=this.calculateFromP1P2P3(ne(n),ne(r),ne(i),this.direction),a=o.position,s=o.rotation,l=o.angle;this.angle=l,this.nextRotation=s,this.nextPosition=ne(a)}var u=this.corner,c=this._corner;if(null!=u&&null!=c){var h=this.getCornerPoints(u.length);c.custom.updatePoints(h)}null!=e.rotationOffset?this.update(e.rotationOffset):this.update()}},{key:"getCornerPoints",value:function(t){return[new se(t,0),new se(0,0),new se(t*Math.cos(this.angle),t*Math.sin(this.angle))]}},{key:"addCorner",value:function(t){var e=t.width,n=t.color,r=t.length,i=t.style,o=this.shapes.polyline({width:e,color:n,points:this.getCornerPoints(r),cornerStyle:i});this.corner={length:r,width:e,color:n,style:i},this.add("corner",o)}},{key:"addSide",value:function(t,e,n,r){var i=1<arguments.length&&void 0!==e?e:null,o=2<arguments.length&&void 0!==n?n:null,a=3<arguments.length&&void 0!==r?r:this.color,s=this.shapes.horizontalLine(new se(0,0),1,o,0,a,(new ke).scale(1,1).rotate(0));this["side".concat(t)]={length:i,width:o},this.add("side".concat(t),s)}},{key:"addLabel",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},n={text:null,radius:.4,curvePosition:.5,curveOffset:0,showRealAngle:!1,units:"degrees",precision:0,orientation:"horizontal",autoHide:null,autoHideMax:null,scale:.7,color:this.color};this.curve&&(n.radius=this.curve.radius);var r=st({},n,e);null===r.text&&(r.text="",r.showRealAngle=!0),this.label=new Oh(this.equation,r.text,r.color,r.radius,r.curvePosition,r.curveOffset,r.showRealAngle,r.units,r.precision,r.autoHide,r.autoHideMax,r.orientation,r.scale),null!=this.label&&this.add("label",this.label.eqn)}},{key:"addCurve",value:function(t){for(var e=st({},{width:.01,sides:50,radius:.5,num:1,step:0,autoHideMin:null,autoHideMax:null},0<arguments.length&&void 0!==t?t:{}),n=0;n<e.num;n+=1){var r=this.shapes.polygonSweep({sides:e.sides,radius:e.radius+n*e.step,width:e.width,color:this.color,fill:!1,transform:new ke("AngleCurve").rotate(0)});this.curve=e;var i="curve";0<n&&(i="".concat(i).concat(n)),this.add(i,r)}if(this.autoRightAngle){var o=this.shapes.collection(),a=.707*e.radius;o.add("line1",this.shapes.horizontalLine(new se(a,0),a+e.width/2,e.width,Math.PI/2,this.color)),o.add("line2",this.shapes.horizontalLine(new se(0,a),a-e.width/2,e.width,0,this.color)),this.add("curveRight",o)}}},{key:"change",value:function(t){null!=this._curve&&null!=t.radius&&this._curve.custom.update({radius:t.radius}),null!=this.label&&(null!=t.curveRadius&&(this.label.radius=t.curveRadius),null!=t.curvePosition&&(this.label.curvePosition=t.curvePosition),null!=t.curveOffset&&(this.label.curveOffset=t.curveOffset))}},{key:"addArrow",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{},r=.04;this.curve&&(r=4*this.curve.width);var i=.1;this.curve&&(i=this.curve.radius);var o={};null!=n&&(o=n);var a=st({},{width:r,height:r,radius:i,autoHide:!0,curveOverlap:.3},o),s=a.width,l=a.height,u=Math.PI/2;2===t&&(u=Math.PI/2*3);var c=this.shapes.arrowLegacy(s,0,l,0,this.color,(new ke).rotate(0).translate(0,0),new se(0,0),u);this["arrow".concat(t)]=a,this.add("arrow".concat(t),c),this.update()}},{key:"updateCurve",value:function(t,e,n,r){var i=this.curve;if(i)for(var o=0;o<i.num;o+=1){var a="_curve";0<o&&(a="_curve".concat(o));var s=this[a];if(s)if(r)if(s.show(),0===o){var l=0;if(this.curve){var u=2*Math.PI/this.curve.sides;l=t-Math.floor(h(t/u))*u}s.angleToDraw=t,s.transform.updateRotation(n+l/2)}else{var c=0;this.curve&&(c=e%(2*Math.PI/this.curve.sides)),s.angleToDraw=e,s.transform.updateRotation(c/2)}else s.hide()}}},{key:"update",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,n=this._arrow1,r=this.arrow1,i=this._arrow2,o=this.arrow2,a=!1,s=!1,l=0,u=this.angle,c=this.angle,h=0,f=0;if(r&&this.arrow1&&(u-=h=r.height/r.radius*(1-this.arrow1.curveOverlap),c-=r.height/r.radius),o&&this.arrow2&&(u-=f=o.height/o.radius*(1-this.arrow2.curveOverlap),c-=o.height/o.radius),c<0&&(r&&r.autoHide&&(a=!0,c+=r.height/r.radius,u+=h),o&&o.autoHide&&(s=!0,c+=o.height/o.radius,u+=f)),n&&r)if(a)n.hide();else{n.show(),n.transform.updateTranslation(r.radius,0);var d=r.height/r.radius;n.transform.updateRotation(Math.PI/2+d),l=h}if(i&&o)if(s)i.hide();else{i.show(),i.transform.updateTranslation(Me(o.radius,this.angle));var p=o.height/o.radius;i.transform.updateRotation(this.angle+Math.PI/2-p)}null!=e&&(this.lastLabelRotationOffset=e),this.setNextPositionAndRotation();var y=this._curve,v=this.curve,m=this._curveRight;null!=y&&null!=v&&(null!=v.autoHideMin&&this.angle<v.autoHideMin||null!=v.autoHideMax&&this.angle>v.autoHideMax?(null!=m&&m.hide(),y.hide(),null!=n&&n.hide(),null!=i&&i.hide()):this.autoRightAngle&&this.angle>=Math.PI/2-this.rightAngleRange/2&&this.angle<=Math.PI/2+this.rightAngleRange/2?(null!=m&&m.showAll(),y.hide(),null!=n&&n.hide(),null!=i&&i.hide()):(null!=m&&m.hide(),null!=n&&!1===a&&n.show(),null!=i&&!1===s&&i.show(),u=Math.max(u,0),this.updateCurve(u,this.angle,l,!0))),this.updateLabel();var g=this._side1,b=this.side1;g&&b&&g.transform.updateScale(b.length,1);var w=this._side2,S=this.side2;w&&S&&(w.transform.updateRotation(this.angle),w.transform.updateScale(S.length,1))}},{key:"checkLabelForRightAngle",value:function(){if(!1!==this.autoRightAngle){var t=this.label,e=!1;if(null!=t&&90===parseFloat(t.getText())&&(e=!0),!1!==e){var n=this._curveRight,r=this._curve,i=this._arrow1,o=this._arrow2;null!=n&&n.showAll(),null!=r&&r.hide(),null!=i&&i.hide(),null!=o&&o.hide()}}}},{key:"getAngle",value:function(t){return"deg"===(0<arguments.length&&void 0!==t?t:"rad")?180*this.angle/Math.PI:this.angle}},{key:"setLabel",value:function(t){var e=this.label;null!=e&&(e.setText(t),e.showRealAngle=!1),this.updateLabel()}},{key:"getLabel",value:function(){return null!=this.label?this.label.getText():""}},{key:"setLabelToRealAngle",value:function(){var t=this.label;null!=t&&(t.showRealAngle=!0),this.updateLabel()}},{key:"updateLabel",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;null!=e&&(this.lastLabelRotationOffset=e);var n=this._label,r=this.label;if(n&&r)if(null!=r.autoHide&&r.autoHide>this.angle||null!=r.autoHideMax&&this.angle>r.autoHideMax)n.hide();else{if(n.show(),r.showRealAngle){var i=h(this.angle,r.precision).toFixed(r.precision);if("degrees"===r.units){var o=h(180*this.angle/Math.PI,r.precision);360===o&&(o=0),i=o.toFixed(r.precision),i="".concat(i,"")}r.setText(i)}var a=Me(r.radius,this.angle*r.curvePosition+r.curveOffset);"horizontal"===r.orientation&&r.updateRotation(-this.getRotation()-this.lastLabelRotationOffset,a,r.radius/5,this.angle*r.curvePosition+r.curveOffset),"tangent"===r.orientation&&r.updateRotation(this.angle*r.curvePosition+r.curveOffset-Math.PI/2,a,r.radius/50,this.angle*r.curvePosition+r.curveOffset)}}},{key:"showAll",value:function(){gh(kh(e.prototype),"showAll",this).call(this),this.update()}}]),e}();function Ah(t){return function(t){if(Array.isArray(t))return Eh(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return Eh(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Eh(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Eh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Mh(t,e,n){return(Mh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Rh(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function jh(t,e){return(jh=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Rh(t){return(Rh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ch(t){return(Ch="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dh(t,e){if(Array.isArray(t)){if(e===t.length)return t;for(var n=[],r=0;r<e;r+=1)n.push(t[r%t.length]);return n}var i=[],o=[];if("object"===Ch(t)&&null!=t&&null!=t.label&&null!=t.label.text&&Array.isArray(t.label.text)){o=t.label.text.slice();for(var a=0;a<e;a+=1){var s={label:{text:o[a%o.length]}};i.push(st({},t,s))}return i}for(var l=0;l<e;l+=1)i.push(t);return i}var Lh=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jh(t,e)}(r,qo);var t,e,n=(t=r,e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var n,r,i=Rh(t);if(e){var o=Rh(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return!(r=n)||"object"!==Ch(r)&&"function"!=typeof r?function(){if(void 0!==this)return this;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():r});function r(t,e,i,o,a){var s,l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};!function(t){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this);var u={position:null,color:[0,1,0,1],points:[new se(1,0),new se(0,0),new se(0,1)],close:!1,showLine:!0,width:.01,reverse:!1,transform:new ke("PolyLine").scale(1,1).rotate(0).translate(0,0),makeValid:null};null!=l.makeValid&&null!=l.makeValid.shape&&"triangle"===l.makeValid.shape&&(u.makeValid={shape:"triangle",hide:{minAngle:null,maxAngle:null,minSide:null}});var c={showLine:!1,offset:0,width:.01,color:null==l.color?[0,1,0,1]:l.color},h={color:null==l.color?[0,1,0,1]:l.color,curve:{},autoRightAngle:!0},f={sides:20,radius:.1,color:null==l.color?[0,1,0,1]:l.color,fill:!0,isMovable:!1,boundary:"diagram",touchRadiusInBoundary:!1};null!=l.side&&(u.side=c,null!=l.side.label&&(u.side.label={offset:.1,text:null,location:"outside",subLocation:"top",orientation:"horizontal",linePosition:.5,scale:.7})),null!=l.angle&&(u.angle=h,null!=l.angle.label&&(u.angle.label={text:null})),null!=l.pad&&(u.pad=f);var d=st({},u,l);if(Array.isArray(l.side)&&(d.side=l.side.map((function(t){return st({},u.side,t)}))),Array.isArray(l.angle)&&(d.angle=l.angle.map((function(t){return st({},u.angle,t)}))),(s=n.call(this,d.transform,t.limits)).setColor(d.color),s.shapes=t,s.equation=e,s.objects=i,s.largerTouchBorder=d.largerTouchBorder,s.isTouchDevice=o,s.animateNextFrame=a,(s.updatePointsCallback=null)!=d.position&&s.transform.updateTranslation(ne(d.position)),s.position=s.getPosition(),s.close=d.close,s.options=d,s.reverse=d.reverse,s.makeValid=d.makeValid,s.points=d.points.map((function(t){return ne(t)})),d.pad)for(var p=d.pad,y=s.points.length,v=Dh(p,y),m=function(e){var n="pad".concat(e),r=st({},{transform:(new ke).translate(s.points[e])},v[e]),i=s.shapes.polygon(r);if(v[e].isMovable){if(i.isMovable=!0,i.isTouchable=!0,null!=v[e].touchRadius){var o=v[e].touchRadius/v[e].radius;i.increaseBorderSize(o)}var a=0;!0===v[e].touchRadiusInBoundary&&null!=v[e].touchRadius&&(a=v[e].touchRadius-v[e].radius);var l=v[e].radius,u=v[e].boundary;if("diagram"===u)u=t.limits._dup(),u=new Ne({left:t.limits.left+l+a,bottom:t.limits.bottom+l+a,right:t.limits.right-l-a,top:t.limits.top-l-a});else if(Array.isArray(u)&&4===u.length)u=new Ne({left:u[0]+l+a,bottom:u[1]+l+a,right:u[2]-l-a,top:u[3]-l-a});else if(!(u instanceof We))if((u=He(u))instanceof qe){var c=u.boundary.max,h=u.boundary.min;null!=c&&(c+=-l-a),null!=h&&(h+=l+a),u=new Ne({left:h,right:c,bottom:h,top:c})}else u instanceof Ne||(u=null);i.setMoveBounds({translation:u});var f="_polyline_pad".concat(e);i.fnMap.add(f,(function(t){var e=parseInt(i.name.slice(3),10),n=t.t();null!=n&&(s.points[e]=n._dup(),s.updatePoints(s.points))})),i.setTransformCallback=f}s.add(n,i)},g=0;g<y;g+=1)m(g);if(d.angle){var b=d.angle,w=s.points.length;!1===d.close&&(w-=2);var S=Dh(b,w),x=0;!1===d.close&&(x=1);for(var _=x;_<w+x;_+=1){var T=_+1,k=_-1;_===w-1&&d.close&&(T=0),0===_&&d.close&&(k=w-1);var O="angle".concat(_);if(s.reverse){var P=k;k=T,T=P}var A=st({},{p1:s.points[k],p2:s.points[_],p3:s.points[T]},S[_-x]),E=s.objects.angle(A);s.add(O,E)}}if(d.showLine){var M=s.shapes.polyline({points:s.points,width:l.width,close:l.close,widthIs:l.widthIs,cornerStyle:l.cornerStyle,cornerSize:l.cornerSize,cornerSides:l.cornerSides,minAutoCornerAngle:l.minAutoCornerAngle,dash:l.dash,color:l.color,pulse:l.pulse});s.add("line",M)}if(d.side){var j=d.side,R=s.points.length-1;d.close&&(R+=1);for(var C=Dh(j,R),D=0;D<R;D+=1){var L=D+1;D===R-1&&d.close&&(L=0);var B="side".concat(D).concat(L),I=st({},{p1:s.points[D],p2:s.points[L]},C[D]);s.reverse&&(I=st({},{p1:s.points[L],p2:s.points[D]},C[D]));var F=s.objects.line(I);s.add(B,F)}}return s}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(r.prototype,[{key:"_getStateProperties",value:function(t){return[].concat(Ah(Mh(Rh(r.prototype),"_getStateProperties",this).call(this,t)),["points"])}},{key:"_fromState",value:function(t){return st(this,t),this.updatePoints(this.points),this}},{key:"updateSideLabels",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;if(null!=this.options.side){var n=this.points.length-1;this.close&&(n+=1);for(var r=0;r<n;r+=1){var i=r+1;r===n-1&&this.close&&(i=0);var o="side".concat(r).concat(i);if(null!=this.elements[o]){var a=!this.elements[o].isShown;this.elements[o].updateLabel(e),a&&this.elements[o].hide()}}}}},{key:"updateAngleLabels",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;if(null!=this.options.angle){var n=this.points.length;!1===this.close&&(n-=2);var r=0;!1===this.close&&(r=1);for(var i=r;i<n+r;i+=1){var o="angle".concat(i);if(null!=this.elements[o]){var a=!this.elements[o].isShown;this.elements[o].updateLabel(e),a&&this.elements[o].hide()}}}}},{key:"updatePoints",value:function(t,e){var n=1<arguments.length&&void 0!==e&&e,r=t.map((function(t){return ne(t)}));null!=this._line&&this._line.custom.updatePoints(r);var i=this.points.length;if(this.options.pad)for(var o=0;o<i;o+=1){var a="pad".concat(o);this.elements[a]&&this.elements[a].transform.updateTranslation(r[o])}if(null!=this.options.side){i=this.points.length-1,this.close&&(i+=1);for(var s=0;s<i;s+=1){var l=s+1;s===i-1&&this.close&&(l=0);var u="side".concat(s).concat(l);if(null!=this.elements[u]){var c=!this.elements[u].isShown;this.reverse?this.elements[u].setEndPoints(r[l],r[s]):this.elements[u].setEndPoints(r[s],r[l]),c&&this.elements[u].hide()}}}if(null!=this.options.angle){i=this.points.length,!1===this.close&&(i-=2);var h=0;!1===this.close&&(h=1);for(var f=h;f<i+h;f+=1){var d=f+1,p=f-1;f===i-1&&this.close&&(d=0),0===f&&this.close&&(p=i-1);var y="angle".concat(f);if(null!=this.elements[y]){var v=!this.elements[y].isShown;if(this.reverse){var m=p;p=d,d=m}this.elements[y].setAngle({p1:r[p],p2:r[f],p3:r[d]}),v&&this.elements[y].hide()}}}this.points=r,null==this.makeValid||"triangle"!==this.makeValid.shape||n||this.makeValidTriangle(),null==this.updatePointsCallback||n||this.fnMap.exec(this.updatePointsCallback)}},{key:"updateRotation",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0,r=this["_angle".concat(n)];null!=r;)r.update(this.getRotation()+e),r=this["_angle".concat(n+=1)];for(var i=this["_side".concat(n=0).concat(n+1)];null!=i;)i.updateLabel(this.getRotation()+e),i=this["_side".concat(n+=1).concat(n+1)];null!=(i=this["_side".concat(n,0)])&&i.updateLabel(this.getRotation()+e)}},{key:"reversePoints",value:function(t){for(var e=!(0<arguments.length&&void 0!==t)||t,n=[],r=0;r<this.points.length;r+=1)n.push(this.points[this.points.length-1-r]);this.updatePoints(n,e)}},{key:"setPositionWithoutMoving",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,r=new se(0,0);"number"==typeof t?(r.x=t,r.y=n):r=t;var i=this.getPosition().sub(r);this.setPosition(r);var o=this.points.map((function(t){return t.add(i)}));this.updatePoints(o)}},{key:"setRotationWithoutMoving",value:function(t){var e=this.getRotation()-t,n=(new ke).rotate(e).m();this.setRotation(t);var r=this.points.map((function(t){return t.transformBy(n)}));this.updatePoints(r)}},{key:"setScaleWithoutMoving",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,r=new se(0,0);"number"==typeof t?(r.x=t,r.y=n):r=t;var i=this.getScale(),o=new se(i.x/r.x,i.y/r.y),a=(new ke).scale(o).m();this.setScale(r);var s=this.points.map((function(t){return t.transformBy(a)}));this.updatePoints(s)}},{key:"setShow",value:function(t,e){for(var n=0;n<this.drawOrder.length;n+=1){var r=this.elements[this.drawOrder[n]];r.name.startsWith(t)&&(e?r.showAll():r.hide())}}},{key:"hideAngles",value:function(){this.setShow("angle",!1)}},{key:"hideSides",value:function(){this.setShow("side",!1)}},{key:"showAngles",value:function(){this.setShow("angle",!0)}},{key:"showSides",value:function(){this.setShow("side",!0)}},{key:"updateLabels",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.getRotation();this.updateAngleLabels(e),this.updateSideLabels(e)}},{key:"makeValidTriangle",value:function(){var t=this._angle0,e=this._angle1,n=this._angle2,r=this._side01,i=this._side12,o=this._side20,a=t.label.precision,s=r.label.precision,l=180*Jt(t.getAngle(),"0to360")/Math.PI,u=180*Jt(e.getAngle(),"0to360")/Math.PI,c=180*Jt(n.getAngle(),"0to360")/Math.PI,h=f(l,a),d=f(u,a),p=f(c,a),y=f(r.getLength(),s),v=f(i.getLength(),s),m=f(o.getLength(),s);90<h&&90<d&&90<p&&(this.reverse=!this.reverse,this.updatePoints(this.points,!1),h=f(180*Jt(t.getAngle(),"0to360")/Math.PI,a),d=f(180*Jt(e.getAngle(),"0to360")/Math.PI,a),p=f(180*Jt(n.getAngle(),"0to360")/Math.PI,a)),180<h&&(h=360-t),180<d&&(d=360-e),180<p&&(p=360-n);var g=h+d+p,b=g-180,w=[f(l,a+1),f(u,a+1),f(c,a+1)].map((function(t){return t-Math.floor(t*Math.pow(10,a))/Math.pow(10,a)})),S=[h,d,p],x=0;if(180<g?x=w.reduce((function(t,e,n,r){return e>r[t]?n:t}),0):g<180&&(x=w.reduce((function(t,e,n,r){return e<r[t]?n:t}),1)),S[x]-=b,h=S[0],d=S[1],p=S[2],t.setLabel("".concat(h.toFixed(a),"")),e.setLabel("".concat(d.toFixed(a),"")),n.setLabel("".concat(p.toFixed(a),"")),t.checkLabelForRightAngle(),e.checkLabelForRightAngle(),n.checkLabelForRightAngle(),null!=this.makeValid){var _=this.makeValid.hide.minSide,T=this.makeValid.hide,k=T.minAngle,O=T.maxAngle,P=!1;null!=k&&(h<(k*=180/Math.PI)||d<k||p<k)&&(P=!0),null!=O&&((O*=180/Math.PI)<h||O<d||O<p)&&(P=!0),null!=_&&(y<_||v<_||m<_)&&(P=!0),P&&this.hideAngles()}if((r.isShown||i.isShown||o.isShown)&&0<h&&h<180&&0<d&&d<180&&0<p&&p<180){var A=1/Math.pow(10,s);60===h&&60===d&&60===p?m=v=y:h===d?y===(m=v)&&(f(r.getLength(),s+1)<y?y-=A:y+=A):h===p?m===(y=v)&&(f(o.getLength(),s+1)<m?m-=A:m+=A):d===p&&v===(m=y)&&(f(i.getLength(),s+1)<v?v-=A:v+=A)}r.setLabel("".concat(y.toFixed(s))),i.setLabel("".concat(v.toFixed(s))),o.setLabel("".concat(m.toFixed(s)))}},{key:"_dup",value:function(t){var e=0<arguments.length&&void 0!==t?t:[];return Mh(Rh(r.prototype),"_dup",this).call(this,[].concat(Ah(e),["shapes","objects","equation"]))}}]),r}(),Bh=function(){function t(e,n,r,i){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.webgl=e.webgl,this.draw2D=e.draw2D,this.limits=e.limits,this.shapes=e,this.isTouchDevice=r,this.animateNextFrame=i,this.equation=n}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"line",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=st.apply(void 0,[{}].concat(e));return new vh(this.shapes,this.equation,this.isTouchDevice,this.animateNextFrame,r)}},{key:"angle",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=st.apply(void 0,[{}].concat(e));return new Ph(this.shapes,this.equation,this.isTouchDevice,this.animateNextFrame,r)}},{key:"label",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=st.apply(void 0,[{}].concat(e));return new rh(this.equation,r)}},{key:"polyline",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=st.apply(void 0,[{}].concat(e));return new Lh(this.shapes,this.equation,this,this.isTouchDevice,this.animateNextFrame,r)}}]),t}();function Ih(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fh(t,e,n,r,i,o){function a(t,e){return e[0]in t?1===e.length?t[e[0]]:a(t[e[0]],e.slice(1)):null}Array.isArray(i)&&i.forEach((function(i,s){if(null==i)throw Error("Add elements index ".concat(s," does not exist in layout"));var l,u=i.name,c=i.path,h=i.options,f=i[o],d=i.method,p=i.mods,y=i.scenario;if(l=null==c||""===c?r:r.getElement(c),null==u||""===u)throw new Error("Diagram addElement ERROR  at index ".concat(s," in collection ").concat(r.name,": missing name property in ").concat(i));if(null==d||""===d)throw new Error("Diagram addElement ERROR  at index ".concat(s," in collection ").concat(r.name,": missing method property in ").concat(i));if(!(l instanceof qo))throw new Error("Diagram addElement ERROR at index ".concat(s," in collection ").concat(r.name,": missing or incorrect path property in ").concat(i));var v,m=d.split("/"),g=function(r){var i={collection:t.collection.bind(t),polyline:n.polyline.bind(n),polygon:t.polygon.bind(t),arrow:t.arrow.bind(t),fan:t.fan.bind(t),text:t.text.bind(t),textGL:t.textGL.bind(t),textHTML:t.htmlText.bind(t),htmlImage:t.htmlImage.bind(t),axes:t.axes.bind(t),radialLines:t.radialLines.bind(t),rectangle:t.rectangle.bind(t),grid:t.grid.bind(t),dashedLine:t.dashedLine.bind(t),parallelMarks:t.parallelMarks.bind(t),marks:t.marks.bind(t),box:t.box.bind(t),line:n.line.bind(n),angle:n.angle.bind(n),addEquation:e.addEquation.bind(e),equation:e.equation.bind(e),addNavigator:e.addNavigator.bind(e)};if(r in i)return i[r];var o={shapes:t,objects:n,equation:e},s=r.split("."),l=a(o,s);return null==l?null:l=l.bind(a(o,s.slice(0,-1)))}(d);if("function"==typeof g){if("function"!=typeof g)throw new Error("Layout addElement at index ".concat(s," in collection ").concat(r.name,": incorrect method property"));var b;if(m.slice(-1)[0].startsWith("add")){if(null==(b=g(l,u,h)))return}else{if(null==(b=Array.isArray(h)?g.apply(void 0,function(t){if(Array.isArray(t))return Ih(t)}(v=h)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(v)||function(t){if(t){if("string"==typeof t)return Ih(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Ih(t,void 0):void 0}}(v)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()):g(h)))return;l instanceof qo&&l.add(u,b)}null!=p&&p!=={}&&b.setProperties(p),null!=y&&y in b.scenarios&&b.setScenario(y),"_".concat(u)in r&&null!=f&&f!=={}&&Fh(t,e,n,r["_".concat(u)],f,o)}}))}function Wh(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return qh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qh(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Nh=function(){function t(e){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var n={htmlId:"figureOneContainer",limits:new oe(-1,-1,2,2),fontScale:1};this.fnMap=new V,this.isPaused=!1,this.scrolled=!1,this.cursorElementName="cursor",this.setStateCallback=null;var r=st({},n,e),i=r.htmlId,o=r.limits;if(this.htmlId=i,this.animationFinishedCallback=null,"string"==typeof i){var a=document.getElementById(i);if(a instanceof HTMLElement){for(var s=(this.container=a).children,l=0;l<s.length;l+=1){var u=s[l];u instanceof HTMLCanvasElement&&u.classList.contains("figureone__gl")&&(this.canvasLow=u),u instanceof HTMLCanvasElement&&u.classList.contains("figureone__gl__offscreen")&&(this.canvasOffscreen=u),u instanceof HTMLCanvasElement&&u.classList.contains("figureone__text")&&(this.textCanvasLow=u),u instanceof HTMLCanvasElement&&u.classList.contains("figureone__text__offscreen")&&(this.textCanvasOffscreen=u),u.classList.contains("figureone__html")&&(this.htmlCanvas=u)}null==this.canvasLow&&(this.canvasLow=document.createElement("canvas"),this.canvasLow.classList.add("figureone__gl","figureone__canvas"),a.appendChild(this.canvasLow)),null==this.textCanvasLow&&(this.textCanvasLow=document.createElement("canvas"),this.textCanvasLow.classList.add("figureone__text","figureone__canvas"),a.appendChild(this.textCanvasLow)),null==this.htmlCanvas&&(this.htmlCanvas=document.createElement("div"),this.htmlCanvas.classList.add("figureone__html","figureone__canvas"),a.appendChild(this.htmlCanvas));var c=document.createElement("style");c.type="text/css",a.classList.add("figureone__container"),c.innerHTML="\n          .figureone__container {\n            position: relative;\n            pointer-events: none;\n          }\n          .figureone__canvas {\n            width: 100%;\n            height: 100%;\n            position: absolute;\n          }\n          .figureone__html {\n            pointer-events: auto;\n          }\n        ",document.getElementsByTagName("head")[0].appendChild(c),this.backgroundColor=[1,1,1,1];var h=new nn(this.canvasLow,this.backgroundColor);if(this.webglLow=h,this.canvasOffscreen){var f=new nn(this.canvasOffscreen,this.backgroundColor);this.webglOffscreen=f}if(this.draw2DLow=new lo(this.textCanvasLow),this.textCanvasOffscreen){var d=new lo(this.textCanvasOffscreen);this.draw2DOffscreen=d}}}if(null!=r.gestureCanvas){var p=document.getElementById(r.gestureCanvas);null!=p&&(this.gestureCanvas=p)}null==this.gestureCanvas&&(this.gestureCanvas=this.htmlCanvas),this instanceof t&&(this.gesture=new Qo(this)),this.previousCursorPoint=new se(0,0),this.isTouchDown=!1,this.fontScale=r.fontScale,this.updateLimits(o),this.drawQueued=!1,this.lastDrawTime=0,this.inTransition=!1,this.beingMovedElements=[],this.beingTouchedElements=[],this.moveTopElementOnly=!0,this.globalAnimation=new sn,this.subscriptions=new jt(this.fnMap),this.recorder=new Ki,(this.recorder.diagram=this).bindRecorder(),this.pauseTime=this.globalAnimation.now()/1e3,this.shapesLow=this.getShapes(),this.shapes=this.shapesLow,this.primitive=this.shapes,this.equationLow=this.getEquations(),this.equation=this.equationLow,this.objectsLow=this.getObjects(),this.objects=this.objectsLow,this.createDiagramElements(),""===this.elements.name&&(this.elements.name="diagramRoot"),this.state={pause:"unpaused",preparingToStop:!1,preparingToSetState:!1},this.stateTime=this.globalAnimation.now()/1e3,window.addEventListener("resize",this.resize.bind(this)),this.sizeHtmlText(),this.initialize(),this.isTouchDevice=ct(),this.animateNextFrame(!0,"first frame"),r.elements&&(this.elements=new r.elements(this),this.elements.diagramLimits=this.limits),this.waitForFrames=0,this.scrollingFast=!1,this.scrollTimeoutId=null,this.drawTimeoutId=null,this.oldScroll=window.pageYOffset,this.drawAnimationFrames=0,this.cursorShown=!1}return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,[{key:"bindRecorder",value:function(){var t=this;this.recorder.addEventType("cursor",(function(e){var n=Wh(e,3),r=n[0],i=n[1],o=n[2];"show"===r?t.showCursor("up",new se(i,o)):t.showCursor("hide")})),this.recorder.addEventType("cursorMove",(function(e){var n=Wh(e,2),r=n[0],i=n[1];t.setCursor(new se(r,i))})),this.recorder.addEventType("touch",(function(e){var n=Wh(e,3),r=n[0],i=n[1],o=n[2];t.isCursorShown()&&("down"===r?t.showCursor("down",new se(i,o)):t.showCursor("up"))})),this.recorder.addEventType("moved",(function(e){var n=Wh(e,2),r=n[0],i=n[1],o=t.getElement(r);null!=o&&o.moved(Oe(i))})),this.recorder.addEventType("stopBeingMoved",(function(e){var n=Wh(e,3),r=n[0],i=n[1],o=n[2],a=t.getElement(r);null!=a&&(a.stopBeingMoved(),a.state.movement.velocity=Oe(o),a.transform=Oe(i))})),this.recorder.addEventType("startMovingFreely",(function(e){var n=Wh(e,3),r=n[0],i=n[1],o=n[2],a=t.getElement(r);null!=a&&(a.transform=Oe(i),a.state.movement.velocity=Oe(o),a.startMovingFreely())})),this.recorder.addEventType("startBeingMoved",(function(e){var n=Wh(e,1)[0],r=t.getElement(n);null!=r&&r.startBeingMoved()})),this.recorder.addEventType("click",(function(t){var e=Wh(t,1)[0],n=document.getElementById(e);null!=n&&n.click()})),this.recorder.addEventType("elementClick",(function(e){var n=Wh(e,1)[0],r=t.getElement(n);null!=r&&r.click()})),this.recorder.addEventType("eqnNavClick",(function(e){var n=Wh(e,2),r=n[0],i=n[1],o=t.getElement(i);null!=o&&("next"===r&&o.clickNext(),"prev"===r&&o.clickPrev(),"refresh"===r&&o.clickRefresh())}))}},{key:"scrollEvent",value:function(){this.scrolled=!0,this.animateNextFrame(!1,"scroll event")}},{key:"enableScrolling",value:function(){document.addEventListener("scroll",this.scrollEvent.bind(this),!1)}},{key:"disableScrolling",value:function(){document.removeEventListener("scroll",this.scrollEvent.bind(this),!1)}},{key:"getState",value:function(t){return this.stateTime=this.globalAnimation.now()/1e3,an(this,["lastDrawTime","elements","stateTime"],t)}},{key:"setState",value:function(t,e){function n(){a=!0,r.state.preparingToSetState=!1,st(r,o),r.elements.setTimeDelta(r.globalAnimation.now()/1e3-r.stateTime),r.elements.setPointsFromDefinition(),r.elements.setPrimitiveColors(),null!=r.setStateCallback&&r.fnMap.exec(r.setStateCallback),r.animateNextFrame(),r.subscriptions.publish("stateSet")}var r=this,i=1<arguments.length&&void 0!==e?e:"instant",o=function t(e,n){if("number"==typeof e)return e;if("string"==typeof e)return e;if("boolean"==typeof e)return e;if(null==e)return e;if(Array.isArray(e)){var r=[];return e.forEach((function(e){r.push(t(e,n))})),r}if(null!=e.f1Type){if("rect"===e.f1Type)return ae(e);if("p"===e.f1Type)return ne(e);if("tf"===e.f1Type)return Oe(e);if("t"===e.f1Type)return new _e(e);if("s"===e.f1Type)return new Te(e);if("r"===e.f1Type)return new xe(e);if("l"===e.f1Type)return Se(e);if("rangeBounds"===e.f1Type)return He(e);if("rectBounds"===e.f1Type)return He(e);if("lineBounds"===e.f1Type)return He(e);if("transformBounds"===e.f1Type)return He(e);if("de"===e.f1Type)return null!=(i=n.getElement(e.state))&&(i._assignAsLinkOnly=!0),i;if("positionAnimationStep"===e.f1Type)return(new wn)._fromState(t(e.state,n),n.getElement.bind(n));if("rotationAnimationStep"===e.f1Type)return(new Gr)._fromState(t(e.state,n),n.getElement.bind(n));if("scaleAnimationStep"===e.f1Type)return(new Zr)._fromState(t(e.state,n),n.getElement.bind(n));if("transformAnimationStep"===e.f1Type)return(new Dr)._fromState(t(e.state,n),n.getElement.bind(n));if("scenarioAnimationStep"===e.f1Type)return(new Zn)._fromState(t(e.state,n),n.getElement.bind(n));if("colorAnimationStep"===e.f1Type)return(new ur)._fromState(t(e.state,n),n.getElement.bind(n));if("opacityAnimationStep"===e.f1Type)return(new Tr)._fromState(t(e.state,n),n.getElement.bind(n));if("pulseAnimationStep"===e.f1Type)return(new ii)._fromState(t(e.state,n),n.getElement.bind(n));if("customAnimationStep"===e.f1Type)return(new Si)._fromState(t(e.state,n),n.getElement.bind(n));if("delayAnimationStep"===e.f1Type)return(new Ii)._fromState(t(e.state,n),n.getElement.bind(n));if("parallelAnimationStep"===e.f1Type)return(new Vn)._fromState(t(e.state,n),n.getElement.bind(n));if("serialAnimationStep"===e.f1Type)return(new Mi)._fromState(t(e.state,n),n.getElement.bind(n));if("triggerAnimationStep"===e.f1Type)return(new fi)._fromState(t(e.state,n),n.getElement.bind(n));if("animationBuilder"===e.f1Type)return(new Ko)._fromState(t(e.state,n),n.getElement.bind(n))}var i,o={};return Object.keys(e).forEach((function(r){o[r]=t(e[r],n)})),o}(t,this),a=!1,s={how:"instant",maxDuration:6,allDurationsSame:!(this.state.preparingToSetState=!1),zeroDurationThreshold:1e-5,duration:0};if(null!=i.velocity&&(s.velocity={position:2,rotation:2*Math.PI/2,scale:1,opacity:.8,color:.8}),"string"==typeof i?s.how=i:s=st({},s,i),"dissolve"===s.how){var l={dissolveIn:.8,dissolveOut:.8,delay:.2};0===s.duration?s.duration=l:"number"==typeof s.duration?s.duration={dissolveOut:s.duration/10*4.5,dissolveIn:s.duration/10*4.5,delay:s.duration/10*1}:s.duration=st({},l,s.duration)}else null!=s.duration&&"number"!=typeof s.duration&&(s.duration={dissolveOut:0,dissolveIn:0,delay:0});"instant"===s.how||this.elements.isStateSame(o.elements,!0,["cursor"])?n():"animate"===s.how?(this.elements.stop("freeze"),this.animateToState(o,s,n,"now")):(this.elements.stop("freeze"),this.dissolveToState({state:o,dissolveInDuration:s.duration.dissolveIn,dissolveOutDuration:s.duration.dissolveOut,done:n,delay:s.duration.delay,startTime:"now"})),a||(this.state.preparingToSetState=!0,this.subscriptions.publish("preparingToSetState")),this.animateNextFrame()}},{key:"animateToState",value:function(t,e,n,r){var i=1<arguments.length&&void 0!==e?e:{},o=2<arguments.length?n:void 0,a=3<arguments.length&&void 0!==r?r:null,s=this.elements.animateToState(t.elements,i,!0,a);null!=o&&(0===s?this.fnMap.exec(o):null!=o&&this.subscriptions.add("animationsFinished",o,1))}},{key:"dissolveToState",value:function(t){var e=this,n=st({},{dissolveOutDuration:.8,dissolveInDuration:.8,delay:.2,done:null,startTime:null},t);this.elements.animations.new().opacity({duration:n.dissolveOutDuration,start:1,target:.001}).trigger({callback:function(){e.elements.hideAll(),e.elements.show()}}).delay({duration:n.delay}).trigger({callback:function(){e.dissolveInToState({state:n.state,duration:n.dissolveInDuration,done:n.done,startTime:n.startTime})},duration:0}).start(n.startTime)}},{key:"dissolveInToState",value:function(t){var e=st({},{duration:.8,done:null,startTime:null},t),n=e.state,r=e.duration,i=e.done,o=e.startTime,a=this.elements.dissolveInToState(n.elements,r,o);this.elements.getAllElements().forEach((function(t){t.isShown&&!1===t.dependantTransform&&t.setTransform(t.transform)})),null!=i&&(0===a?this.fnMap.exec(i):null!=i&&this.subscriptions.add("animationsFinished",i,1))}},{key:"addElements",value:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:this.elements,i=2<arguments.length&&void 0!==n?n:"addElements";Fh(this.shapes,this.equation,this.objects,r,t,i)}},{key:"addElement",value:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:this.elements,i=2<arguments.length&&void 0!==n?n:"addElements";Fh(this.shapes,this.equation,this.objects,r,[t],i)}},{key:"getElement",value:function(t){return t===this.elements.name?this.elements:this.elements.getElement(t)}},{key:"setTouchable",value:function(t){var e=!(0<arguments.length&&void 0!==t)||t;this.elements.hasTouchableElements=!!e}},{key:"getShapes",value:function(){var t=[this.webglLow];this.webglOffscreen&&t.push(this.webglOffscreen);var e=[this.draw2DLow];return this.draw2DOffscreen&&e.push(this.draw2DOffscreen),new ml(t,e,this.htmlCanvas,this.limits,this.spaceTransforms,this.animateNextFrame.bind(this,!0,"getShapes"))}},{key:"getEquations",value:function(){var t=this.shapesLow;return new nh(t,this.animateNextFrame.bind(this,!0,"equations"))}},{key:"getObjects",value:function(){var t=this.shapesLow,e=this.equationLow;return new Bh(t,e,this.isTouchDevice,this.animateNextFrame.bind(this,!0,"objects"))}},{key:"sizeHtmlText",value:function(){var t=this.container.getBoundingClientRect(),e=t.width/35,n=document.getElementById("".concat(this.htmlId,"_measure"));if(null!=n){n.style.fontSize="".concat(e,"px");var r=(n.clientWidth+1)/t.width;e=t.width<500?Math.floor(.84/r*e*1e4)/1e4:Math.floor(.85/r*e*1e4)/1e4}this.htmlCanvas.style.fontSize="".concat(e,"px")}},{key:"destroy",value:function(){this.gesture.destroy(),this.webglLow.gl.getExtension("WEBGL_lose_context").loseContext()}},{key:"setSpaceTransforms",value:function(){var t={x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},e={x:{bottomLeft:this.limits.left,width:this.limits.width},y:{bottomLeft:this.limits.bottom,height:this.limits.height}},n=this.canvasLow.getBoundingClientRect(),r={x:{bottomLeft:0,width:n.width},y:{bottomLeft:n.height,height:-n.height}};this.spaceTransforms={diagramToGL:Pe(e,t,"Diagram"),glToDiagram:Pe(t,e),pixelToDiagram:Pe(r,e),diagramToPixel:Pe(e,r),pixelToGL:Pe(r,t),glToPixel:Pe(t,r),diagramToCSSPercent:Pe(e,{x:{bottomLeft:0,width:1},y:{bottomLeft:1,height:-1}})}}},{key:"initialize",value:function(){var t=this;this.elements.getAllElements().forEach((function(e){e.diagram=t,e.recorder=t.recorder,e.animationFinishedCallback=t.animationFinished.bind(t,e)})),this.setFirstTransform(),this.animateNextFrame()}},{key:"getRemainingAnimationTime",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.globalAnimation.now()/1e3,n=this.elements.getAllElements(),r=e;"paused"===this.state.pause&&(r=this.pauseTime);var i=0;return n.forEach((function(t){var e=t.animations.getRemainingTime(r);i<e&&(i=e);var n=t.getRemainingPulseTime(r);i<n&&(i=n);var o=t.getRemainingMovingFreelyTime(r);i<o&&(i=o)})),i}},{key:"setAnimationFinishedCallback",value:function(t){this.animationFinishedCallback=t}},{key:"animationFinished",value:function(){this.isAnimating()||(this.fnMap.exec(this.animationFinishedCallback),this.subscriptions.publish("animationsFinished"))}},{key:"setFirstTransform",value:function(){this.elements.setFirstTransform(this.spaceTransforms.diagramToGL)}},{key:"updateLimits",value:function(t){var e=ae(t);this.limits=e._dup(),this.setSpaceTransforms()}},{key:"renderAllElementsToTiedCanvases",value:function(t){var e=this,n=0<arguments.length&&void 0!==t&&t;if(null!=this.canvasOffscreen){var r=!1;Object.keys(this.elements.elements).forEach((function(t){var i=e.elements.elements[t];i.isShown&&(!1===i.isRenderedAsImage||n)&&null!=i.tieToHTML.element&&(i.isRenderedAsImage=!0,e.renderElementToTiedCanvas(t),r=!0)})),r&&(this.drawQueued=!0,this.clearContext(),this.draw2DLow.ctx.clearRect(0,0,this.textCanvasLow.width,this.textCanvasLow.height),this.draw(-1))}}},{key:"renderElementToTiedCanvas",value:function(t){var e=this,n={};Object.keys(this.elements.elements).forEach((function(t){var r=e.elements.elements[t];n[t]=r.isShown})),Object.keys(this.elements.elements).forEach((function(t){e.elements.elements[t].hide()}));var r=this.elements.elements[t];r.show();var i=r.getPosition(),o=r.getScale(),a=document.getElementById(r.tieToHTML.element);a instanceof HTMLElement&&(this.canvasOffscreen.style.width="".concat(a.clientWidth,"px"),this.canvasOffscreen.style.height="".concat(a.clientHeight,"px"),this.textCanvasOffscreen.style.width="".concat(a.clientWidth,"px"),this.textCanvasOffscreen.style.height="".concat(a.clientHeight,"px"),this.webglOffscreen.resize(),this.draw2DOffscreen.resize()),r.updateHTMLElementTie(this.canvasOffscreen);var s=r.getScale();r.setPosition(0-s.x*(r.tieToHTML.window.left+r.tieToHTML.window.width/2),0-s.y*(r.tieToHTML.window.bottom+r.tieToHTML.window.height/2)),r.isRenderedAsImage=!1,r.stop("complete"),this.renderToCanvas(r.tieToHTML.element),r.isRenderedAsImage=!0,r.setPosition(i),r.setScale(o),Object.keys(this.elements.elements).forEach((function(t){var r=e.elements.elements[t];!0===n[t]?r.show():r.hide()}))}},{key:"renderToCanvas",value:function(t){var e=0<arguments.length&&void 0!==t?t:"",n=e;if("string"==typeof e&&(n=document.getElementById(e)),n instanceof HTMLElement){this.drawQueued=!0,this.draw(-1,1);var r=document.getElementById("".concat(e,"_webgl"));r instanceof HTMLImageElement&&(r.src=this.webglOffscreen.gl.canvas.toDataURL("image/png",.5),r.style.display="block");var i=document.getElementById("".concat(e,"_2d"));i instanceof HTMLImageElement&&(i.src=this.draw2DOffscreen.canvas.toDataURL("image/png",.5),i.style.display="block"),this.clearContext(1)}}},{key:"unrenderAll",value:function(){for(var t=0;t<this.elements.drawOrder.length;t+=1)this.elements.elements[this.elements.drawOrder[t]].unrender()}},{key:"resize",value:function(t){var e=0<arguments.length&&void 0!==t&&t;this.webglLow.resize(),this.draw2DLow.resize(),this.setSpaceTransforms(),null!=this.elements&&this.elements.updateLimits(this.limits,this.spaceTransforms),this.sizeHtmlText(),e?this.elements.resize():this.elements.resize(this.canvasLow),this.oldWidth!==this.canvasLow.clientWidth&&(this.renderAllElementsToTiedCanvases(),this.oldWidth=this.canvasLow.clientWidth),this.animateNextFrame(!0,"resize"),this.drawAnimationFrames=2}},{key:"updateHTMLElementTie",value:function(){null!=this.elements&&this.elements.updateHTMLElementTie(this.canvasLow)}},{key:"toggleCursor",value:function(){this.cursorShown=!this.cursorShown,"recording"===this.recorder.state&&(this.cursorShown?(this.recorder.recordEvent("cursor",["show",this.previousCursorPoint.x,this.previousCursorPoint.y]),this.isTouchDown?this.showCursor("down"):this.showCursor("up"),this.setCursor(this.previousCursorPoint)):(this.recorder.recordEvent("cursor",["hide"]),this.showCursor("hide")))}},{key:"showCursor",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:null,r=this.getElement(this.cursorElementName);if(null!=r){var i=r.getElement("up"),o=r.getElement("down");null!=i&&null!=o&&("up"===t?(i.showAll(),o.hide()):"down"===t?(i.hide(),o.showAll()):r.hide(),null!=n&&this.setCursor(n),this.animateNextFrame())}}},{key:"isCursorShown",value:function(){var t=this.getElement(this.cursorElementName);return null!=t&&t.isShown}},{key:"touchDownHandler",value:function(t){if("recording"===this.recorder.state){var e=this.clientToPixel(t).transformBy(this.spaceTransforms.pixelToDiagram.matrix());this.recorder.recordEvent("touch",["down",e.x,e.y]),this.cursorShown&&this.showCursor("down")}if(this.isPaused&&this.unpause(),"playing"===this.recorder.state&&(this.recorder.pausePlayback(),this.showCursor("hide")),this.inTransition)return!1;this.isTouchDown=!0;var n=this.clientToPixel(t).transformBy(this.spaceTransforms.pixelToGL.matrix());this.beingTouchedElements=this.elements.getTouched(n),this.moveTopElementOnly?0<this.beingTouchedElements.length&&this.beingTouchedElements[0].click():this.beingTouchedElements.forEach((function(t){return t.click()})),this.beingMovedElements=[];for(var r=0;r<this.beingTouchedElements.length;r+=1){var i=this.beingTouchedElements[r];i.isMovable&&(this.beingMovedElements.push(i),i.startBeingMoved())}return 0<this.beingMovedElements.length&&this.animateNextFrame(!0,"touch down handler"),0<this.beingTouchedElements.length}},{key:"touchUpHandler",value:function(){"recording"===this.recorder.state&&(this.recorder.recordEvent("touch",["up"]),this.cursorShown&&this.showCursor("up"));for(var t=0;t<this.beingMovedElements.length;t+=1){var e=this.beingMovedElements[t];e.state.isBeingMoved&&(e.stopBeingMoved(),e.startMovingFreely())}this.isTouchDown=!1,this.beingMovedElements=[],this.beingTouchedElements=[]}},{key:"setCursor",value:function(t){var e=this.getElement(this.cursorElementName);null!=e&&(e.setPosition(t),this.animateNextFrame())}},{key:"touchFreeHandler",value:function(t){if("recording"===this.recorder.state){var e=this.clientToPixel(t).transformBy(this.spaceTransforms.pixelToDiagram.matrix());this.previousCursorPoint=e,this.cursorShown&&(this.recorder.recordEvent("cursorMove",[e.x,e.y]),this.setCursor(e))}}},{key:"rotateElement",value:function(t,e,n){var r=t.getPosition("diagram");null==r&&(r=new se(0,0));var i=r.transformBy(this.spaceTransforms.diagramToPixel.matrix()),o=this.clientToPixel(e),a=this.clientToPixel(n),s=Math.atan2(a.y-i.y,a.x-i.x),l=-pe(Math.atan2(o.y-i.y,o.x-i.x),s),u=t.transform._dup(),c=u.r();null==c&&(c=0);var h=c-l;u.updateRotation(h),t.moved(u._dup())}},{key:"translateElement",value:function(t,e,n){var r=this.clientToPixel(e),i=this.clientToPixel(n),o=r.transformBy(this.spaceTransforms.pixelToDiagram.matrix()),a=i.transformBy(this.spaceTransforms.pixelToDiagram.matrix()),s=t.diagramSpaceToVertexSpaceTransformMatrix(),l=a.transformBy(s),u=o.transformBy(s),c=l.sub(u),h=t.transform._dup(),f=h.t();if(null!=f){var d=f.add(c);h.updateTranslation(d),t.moved(h)}}},{key:"scaleElement",value:function(t,e,n,r){var i=3<arguments.length&&void 0!==r?r:"",o=this.clientToPixel(e),a=this.clientToPixel(n),s=t.getPosition("diagram").transformBy(this.spaceTransforms.diagramToPixel.matrix()),l=o.sub(s).distance(),u=a.sub(s).distance(),c=t.transform.s();if(null!=c){var h=t.transform._dup(),f=c.x*u/l,d=c.y*u/l;"x"===i?h.updateScale(f,1):"y"===i?h.updateScale(1,d):h.updateScale(f,d),t.moved(h)}}},{key:"getIsInTransition",value:function(){return this.inTransition}},{key:"touchMoveHandler",value:function(t,e){if("recording"===this.recorder.state){var n=this.clientToPixel(e).transformBy(this.spaceTransforms.pixelToDiagram.matrix());this.recorder.recordEvent("cursorMove",[n.x,n.y]),this.cursorShown&&this.setCursor(n)}if(this.inTransition)return!1;if(0===this.beingMovedElements.length)return!1;for(var r=this.clientToPixel(t).transformBy(this.spaceTransforms.pixelToGL.matrix()),i=0;i<this.beingMovedElements.length;i+=1){var o=this.beingMovedElements[i];if(o!==this.elements&&(o.isBeingTouched(r)||o.move.canBeMovedAfterLosingTouch)){var a=null==o.move.element?o:o.move.element;!1===a.state.isBeingMoved&&a.startBeingMoved(),-1===this.beingMovedElements.indexOf(a)&&this.beingMovedElements.push(a),"rotation"===o.move.type?this.rotateElement(a,t,e):"scale"===o.move.type?this.scaleElement(a,t,e):"scaleX"===o.move.type?this.scaleElement(a,t,e,"x"):"scaleY"===o.move.type?this.scaleElement(a,t,e,"y"):this.translateElement(a,t,e)}this.moveTopElementOnly&&(i=this.beingMovedElements.length)}return this.animateNextFrame(!0,"touch move handler"),!0}},{key:"stop",value:function(t){function e(){n.subscriptions.publish("stopped"),n.state.preparingToStop=!1}var n=this,r=0<arguments.length&&void 0!==t?t:"cancel";if(this.elements.isAnimating()){if("freeze"===r||"cancel"===r||"complete"===r)return this.elements.stop(r),void e();if(this.state.preparingToStop=!1,"animateToComplete"===r){this.elements.stop(r);var i=this.elements.getAllElements(),o=0,a=function(){0<o&&--o,0===o&&e()};return i.forEach((function(t){t.state.preparingToStop&&(o+=1,t.subscriptions.add("stopped",a,1))})),void(0===o?a():0<o&&(this.subscriptions.publish("preparingToStop"),this.state.preparingToStop=!0))}var s=this.getState({});this.elements.stop("complete");var l=this.getState({});this.setState(s),this.elements.stop("freeze"),this.setState(l,"dissolve"),this.state.preparingToSetState?(this.subscriptions.add("stateSet",e,1),this.subscriptions.publish("preparingToStop"),this.state.preparingToStop=!0):e()}else e()}},{key:"createDiagramElements",value:function(){this.elements=this.primitive.collection(),this.elements.diagramLimits=this.limits}},{key:"add",value:function(t,e){this.elements.add(t,e)}},{key:"setElementsToCollection",value:function(t){this.elements=t,this.setFirstTransform()}},{key:"clearContext",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;0===e?(this.webglLow.gl.clearColor(0,0,0,0),this.webglLow.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT)):(this.webglOffscreen.gl.clearColor(0,0,0,0),this.webglOffscreen.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT)),this.elements.clear(e)}},{key:"drawNow",value:function(t){var e=0<arguments.length&&void 0!==t?t:-1;this.drawQueued=!0,this.draw(e)}},{key:"pause",value:function(){this.state.pause="paused",this.pauseTime=this.globalAnimation.now()/1e3}},{key:"unpause",value:function(){this.state.pause="unpaused",this.isPaused=!1,this.elements.setTimeDelta(this.globalAnimation.now()/1e3-this.pauseTime),this.animateNextFrame(),this.subscriptions.publish("unpaused")}},{key:"draw",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;if("paused"!==this.state.pause){var r=t;-1===t&&(r=this.lastDrawTime),this.lastDrawTime=r,!0===this.scrolled&&(this.scrolled=!1,Math.abs(window.pageYOffset-this.oldScroll)>this.webglLow.gl.canvas.clientHeight/4&&(this.renderAllElementsToTiedCanvases(),this.scrollingFast=!0,this.scrollTimeoutId&&(clearTimeout(this.scrollTimeoutId),this.scrollTimeoutId=null),this.scrollTimeoutId=setTimeout(this.centerDrawingLens.bind(this,!0),100))),!1!==this.drawQueued&&(this.drawQueued=!1,this.clearContext(n),this.elements.setupDraw(r,n),this.elements.draw(r,[this.spaceTransforms.diagramToGL],1,n),this.elements.isAnyElementMoving()&&this.animateNextFrame(!0,"is moving"),0<this.drawAnimationFrames&&(--this.drawAnimationFrames,this.animateNextFrame(!0,"queued frames")))}}},{key:"centerDrawingLens",value:function(t){0<arguments.length&&void 0!==t&&t&&(this.scrollingFast=!1);var e=window.innerHeight||0;null!=document.documentElement&&(e=Math.max(document.documentElement.clientHeight,window.innerHeight||0));var n=window.pageYOffset+e/2-this.webglLow.gl.canvas.clientHeight/2;n<0&&(n=0);var r="".concat(n,"px");this.webglLow.gl.canvas.style.top!==r&&(this.webglLow.gl.canvas.style.top="".concat(n,"px"),this.draw2DLow.canvas.style.top="".concat(n,"px"),this.updateHTMLElementTie()),this.oldScroll=window.pageYOffset}},{key:"animateNextFrame",value:function(t,e){var n=!(0<arguments.length&&void 0!==t)||t,r=1<arguments.length&&void 0!==e?e:"";this.fromWhere=r,this.drawQueued||(n&&(this.drawQueued=!0),this.globalAnimation.queueNextFrame(this.draw.bind(this)))}},{key:"isAnimating",value:function(){return this.elements.isAnimating()}},{key:"clientToPixel",value:function(t){var e=this.canvasLow.getBoundingClientRect();return new se(t.x-e.left,t.y-e.top)}},{key:"pixelToClient",value:function(t){var e=this.canvasLow.getBoundingClientRect();return new se(t.x+e.left,t.y+e.top)}}]),t}();function zh(t){return(zh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hh(t,e,n){return(Hh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Gh(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Vh(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function Uh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,i,o=Gh(t);if(e){var a=Gh(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return r=this,!(i=n)||"object"!==zh(i)&&"function"!=typeof i?function(){if(void 0!==r)return r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():i}}function Gh(t){return(Gh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Xh(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yh(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $h(t,e,n){return e&&Yh(t.prototype,e),n&&Yh(t,n),t}var Kh=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";Xh(this,t),this.id=e,Array.isArray(n)?this.classes=n:0<n.length?this.classes=n.split(" "):this.classes=[]}return $h(t,[{key:"render",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:0,r=1<arguments.length&&void 0!==e?e:"";return function(t,e,n,r){var i=" ".repeat(3<arguments.length&&void 0!==r?r:0),o=t?' id="'.concat(t,'"'):"",a=e?" ".concat(e.join(" ")):"",s="".concat(i,"<div").concat(o,' class="equation_element').concat(a,'">\n');return(s+="".concat(n,"\n"))+"".concat(i,"</div>")}(this.id,this.classes,r,n)}}]),t}(),Qh=function(){Vh(e,Kh);var t=Uh(e);function e(n){var r,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return Xh(this,e),(r=t.call(this,i,o)).classes.push("equation_text"),r.text=n,r}return $h(e,[{key:"render",value:function(t){var n=0<arguments.length&&void 0!==t?t:0;return Hh(Gh(e.prototype),"render",this).call(this,n,"".concat(" ".repeat(n+2)).concat(this.text))}}]),e}(),Zh=function(){Vh(e,Kh);var t=Uh(e);function e(n){var r,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];Xh(this,e),r=t.call(this,i,o);var a=[];return n.forEach((function(t){null!==t&&a.push(t)})),r.content=a,r}return $h(e,[{key:"render",value:function(t){var n=0<arguments.length&&void 0!==t?t:0;return Hh(Gh(e.prototype),"render",this).call(this,n,this.content.map((function(t){return t.render(n+2)})).join("\n"))}}]),e}(),Jh=function(){Vh(e,Kh);var t=Uh(e);function e(n,r){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return Xh(this,e),(i=t.call(this,o,a)).classes.push("fraction"),i.numerator=n,i.denominator=r,i}return $h(e,[{key:"render",value:function(t){var n=0<arguments.length&&void 0!==t?t:0,r=" ".repeat(n+2),i="";return i+="".concat(r,'<div class="numerator">\n'),i+=this.numerator.render(n+4),i+="\n".concat(r,"</div>\n"),i+="".concat(r,'<div class="fraction_line"> </div>\n'),i+="".concat(r,'<div class="denominator">\n'),i+=this.denominator.render(n+4),i+="\n".concat(r,"</div>"),Hh(Gh(e.prototype),"render",this).call(this,n,i)}}]),e}(),tf=function(){Vh(e,Kh);var t=Uh(e);function e(n,r,i){var o,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"";return Xh(this,e),(o=t.call(this,a,s)).classes.push("supersub"),o.superscript=r,o.subscript=i,o.content=n,o}return $h(e,[{key:"render",value:function(t){var n=0<arguments.length&&void 0!==t?t:0,r=" ".repeat(n+2),i="";return i+="".concat(r,'<div class="supsub_content element">\n'),i+=this.content.render(n+2),i+="\n".concat(r,"</div>\n"),i+="".concat(r,'<div class="super_sub element">\n'),i+="".concat(r,'<div class="super_sub_super superscript_text element">\n'),null!==this.superscript&&(i+=this.superscript.render(n+4)),i+="\n".concat(r,"</div>\n"),i+="".concat(r,'<div class="super_sub_sub subscript_text element">\n'),null!==this.subscript&&(i+=this.subscript.render(n+4)),i+="\n".concat(r,"</div>"),i+="\n".concat(r,"</div>\n"),Hh(Gh(e.prototype),"render",this).call(this,n,i)}}]),e}(),ef=function(){Vh(e,tf);var t=Uh(e);function e(n,r){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";Xh(this,e);var s=(i=t.call(this,n,null,r,o,a)).classes.indexOf("supersub");return-1<s&&i.classes.splice(s,1),i.classes.push("subscript"),i}return e}(),nf=function(){Vh(e,tf);var t=Uh(e);function e(n,r){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";Xh(this,e);var s=(i=t.call(this,n,r,null,o,a)).classes.indexOf("supersub");return-1<s&&i.classes.splice(s,1),i.classes.push("superscript"),i}return e}(),rf=function(){Vh(e,Kh);var t=Uh(e);function e(n){var r,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return Xh(this,e),(r=t.call(this,i,o)).content=n,r}return $h(e,[{key:"render",value:function(t){var n=0<arguments.length&&void 0!==t?t:0,r=" ".repeat(n+2),i="";return i+="".concat(r,'<div class="square_root element">\n'),i+="".concat(r,'  <div class="equation_element radical element">\n'),i+="".concat(r,"    &radic;\n"),i+="".concat(r,"  </div>\n"),i+=this.content.render(n+4),i+="\n".concat(r,"</div>"),Hh(Gh(e.prototype),"render",this).call(this,n,i)}}]),e}();function of(t){if(t instanceof Zh)return t;if(t instanceof Qh||t instanceof Kh)return new Zh([t]);if("string"==typeof t)return new Zh([new Qh(t)]);var e=[];return t.forEach((function(t){"string"==typeof t?e.push(new Qh(t)):e.push(t)})),new Zh(e)}var af={tools:{math:r,g2:o,color:a,css:c,html:l,misc:i,lines:u},Diagram:Nh,Recorder:Ki,FunctionMap:V,GlobalFunctionMap:H,DiagramElement:Fo,DiagramElementCollection:qo,DiagramElementPrimitive:Wo,DrawContext2D:lo,WebGLInstance:nn,DrawingObject:Qi,VertexObject:so,TextObject:So,DiagramText:wo,DiagramFont:bo,HTMLObject:eo,DiagramObjectAngle:Ph,DiagramObjectLine:vh,DiagramObjectPolyLine:Lh,EqnNavigator:Jc,EquationLabel:rh,EquationForm:Mu,Equation:Vc,HTMLEquation:function(){Vh(e,Zh);var t=Uh(e);function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Xh(this,e),t.call(this,[],n,r)}return $h(e,[{key:"createEq",value:function(t){var e=this,n=[];t.forEach((function(t){"string"==typeof t?n.push(new Qh(t)):n.push(t),e.content=n}))}},{key:"htmlElement",value:function(){var t=document.createElement("div");return t.setAttribute("id",this.id),t.innerHTML=this.render(),this.classes.forEach((function(e){e&&t.classList.add(e)})),t}},{key:"el",value:function(t,e,n){return new Qh(t,1<arguments.length&&void 0!==e?e:"",2<arguments.length&&void 0!==n?n:[])}},{key:"supsub",value:function(t,e,n,r,i){var o=3<arguments.length&&void 0!==r?r:"",a=4<arguments.length&&void 0!==i?i:[];return new tf(of(t),of(e),of(n),o,a)}},{key:"sub",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:"",o=3<arguments.length&&void 0!==r?r:[];return new ef(of(t),of(e),i,o)}},{key:"sup",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:"",o=3<arguments.length&&void 0!==r?r:[];return new nf(of(t),of(e),i,o)}},{key:"frac",value:function(t,e,n,r){var i=2<arguments.length&&void 0!==n?n:"",o=3<arguments.length&&void 0!==r?r:[];return new Jh(of(t),of(e),i,o)}},{key:"sqrt",value:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:"",i=2<arguments.length&&void 0!==n?n:[];return new rf(of(t),r,i)}}]),e}(),Point:se,Line:ge,Rect:oe,Transform:ke,Translation:_e,Scale:Te,Rotation:xe,parsePoint:ne,LineBounds:ze,TransformBounds:Ue,RectBounds:Ne,RangeBounds:qe};e.default=af}],t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},t.p="",t(t.s=1).default;function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var e,n}));