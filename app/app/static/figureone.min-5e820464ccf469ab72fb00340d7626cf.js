!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Fig",[],e):"object"==typeof exports?exports.Fig=e():t.Fig=e()}(window,(function(){return n={},t.m=e=[function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"round",(function(){return f})),n.d(i,"roundNum",(function(){return h})),n.d(i,"decelerate",(function(){return v})),n.d(i,"easeinout",(function(){return y})),n.d(i,"easeout",(function(){return g})),n.d(i,"easein",(function(){return w})),n.d(i,"sinusoid",(function(){return b})),n.d(i,"linear",(function(){return m})),n.d(i,"clipMag",(function(){return d})),n.d(i,"clipValue",(function(){return p})),n.d(i,"range",(function(){return x})),n.d(i,"randInt",(function(){return S})),n.d(i,"rand",(function(){return O})),n.d(i,"randElement",(function(){return k})),n.d(i,"removeRandElement",(function(){return T})),n.d(i,"randElements",(function(){return P})),n.d(i,"rand2D",(function(){return A})),n.d(i,"randSign",(function(){return _}));var r={};n.r(r),n.d(r,"point",(function(){return tt})),n.d(r,"Point",(function(){return Y})),n.d(r,"line",(function(){return ut})),n.d(r,"Line",(function(){return lt})),n.d(r,"distance",(function(){return nt})),n.d(r,"minAngleDiff",(function(){return rt})),n.d(r,"deg",(function(){return it})),n.d(r,"normAngle",(function(){return ot})),n.d(r,"Transform",(function(){return pt})),n.d(r,"TransformLimit",(function(){return dt})),n.d(r,"Rect",(function(){return X})),n.d(r,"Translation",(function(){return ht})),n.d(r,"Scale",(function(){return ft})),n.d(r,"Rotation",(function(){return ct})),n.d(r,"spaceToSpaceTransform",(function(){return vt})),n.d(r,"getBoundingRect",(function(){return bt})),n.d(r,"linearPath",(function(){return Z})),n.d(r,"curvedPath",(function(){return $})),n.d(r,"quadraticBezier",(function(){return G})),n.d(r,"translationPath",(function(){return J})),n.d(r,"polarToRect",(function(){return gt})),n.d(r,"rectToPolar",(function(){return wt})),n.d(r,"getDeltaAngle",(function(){return st})),n.d(r,"normAngleTo90",(function(){return at})),n.d(r,"threePointAngle",(function(){return xt})),n.d(r,"threePointAngleMin",(function(){return _t})),n.d(r,"randomPoint",(function(){return St})),n.d(r,"getMaxTimeFromVelocity",(function(){return Ot})),n.d(r,"getMoveTime",(function(){return kt})),n.d(r,"parsePoint",(function(){return Q})),n.d(r,"clipAngle",(function(){return U})),n.d(r,"spaceToSpaceScale",(function(){return mt})),n.d(r,"getPoint",(function(){return K})),n.d(r,"quadBezierPoints",(function(){return Tt}));var o={};n.r(o),n.d(o,"divide",(function(){return Wt})),n.d(o,"mulToString",(function(){return It})),n.d(o,"add",(function(){return Dt})),n.d(o,"Console",(function(){return Ft})),n.d(o,"classify",(function(){return qt})),n.d(o,"extractFrom",(function(){return zt})),n.d(o,"ObjectKeyPointer",(function(){return Ht})),n.d(o,"getElement",(function(){return Nt})),n.d(o,"addToObject",(function(){return Vt})),n.d(o,"duplicateFromTo",(function(){return Qt})),n.d(o,"isTouchDevice",(function(){return Zt})),n.d(o,"generateUniqueId",(function(){return Kt})),n.d(o,"joinObjects",(function(){return Yt})),n.d(o,"cleanUIDs",(function(){return te})),n.d(o,"loadRemote",(function(){return $t})),n.d(o,"loadRemoteCSS",(function(){return Jt})),n.d(o,"deleteKeys",(function(){return ee})),n.d(o,"copyKeysFromTo",(function(){return ne})),n.d(o,"generateRandomString",(function(){return ie})),n.d(o,"duplicate",(function(){return Gt})),n.d(o,"assignObjectFromTo",(function(){return Ut})),n.d(o,"joinObjectsWithOptions",(function(){return Xt}));var a={};n.r(a),n.d(a,"RGBToArray",(function(){return qe})),n.d(a,"HexToArray",(function(){return He})),n.d(a,"cssColorToArray",(function(){return ze})),n.d(a,"colorArrayToRGB",(function(){return Ve})),n.d(a,"colorArrayToRGBA",(function(){return Ne})),n.d(a,"getCSSColors",(function(){return We}));var s={};n.r(s),n.d(s,"PositionAnimationStep",(function(){return an})),n.d(s,"AnimationBuilder",(function(){return ar})),n.d(s,"ParallelAnimationStep",(function(){return Li})),n.d(s,"SerialAnimationStep",(function(){return Hi})),n.d(s,"TransformAnimationStep",(function(){return Hn})),n.d(s,"AnimationStep",(function(){return Ue})),n.d(s,"DelayStep",(function(){return Qi})),n.d(s,"TriggerStep",(function(){return vi})),n.d(s,"inParallel",(function(){return Ci})),n.d(s,"inSerial",(function(){return zi})),n.d(s,"trigger",(function(){return mi})),n.d(s,"delay",(function(){return Ki})),n.d(s,"ColorAnimationStep",(function(){return mn})),n.d(s,"DissolveInAnimationStep",(function(){return Mn})),n.d(s,"dissolveIn",(function(){return Ln})),n.d(s,"DissolveOutAnimationStep",(function(){return Cn})),n.d(s,"dissolveOut",(function(){return Bn})),n.d(s,"CustomAnimationStep",(function(){return Si})),n.d(s,"custom",(function(){return Oi})),n.d(s,"AnimationManager",(function(){return $i})),n.d(s,"RotationAnimationStep",(function(){return Yn})),n.d(s,"ScaleAnimationStep",(function(){return ei})),n.d(s,"PulseAnimationStep",(function(){return li})),n.d(s,"OpacityAnimationStep",(function(){return jn})),n.d(s,"DimAnimationStep",(function(){return yn})),n.d(s,"dim",(function(){return gn})),n.d(s,"UndimAnimationStep",(function(){return wn})),n.d(s,"undim",(function(){return bn}));var l={};n.r(l),n.d(l,"actionWord",(function(){return Gr})),n.d(l,"click",(function(){return Nr})),n.d(l,"highlight",(function(){return Ir})),n.d(l,"addClass",(function(){return Hr})),n.d(l,"addId",(function(){return zr})),n.d(l,"onClickId",(function(){return Ur})),n.d(l,"highlightWord",(function(){return qr})),n.d(l,"centerV",(function(){return Mr})),n.d(l,"centerH",(function(){return Cr})),n.d(l,"centerVH",(function(){return Lr})),n.d(l,"toHTML",(function(){return Dr})),n.d(l,"itemSelector",(function(){return Rr})),n.d(l,"unit",(function(){return Fr})),n.d(l,"applyModifiers",(function(){return Xr})),n.d(l,"setOnClicks",(function(){return Yr})),n.d(l,"setHTML",(function(){return Qr})),n.d(l,"withClass",(function(){return jr})),n.d(l,"style",(function(){return Br})),n.d(l,"clickW",(function(){return Vr})),n.d(l,"link",(function(){return Wr}));var u={};n.r(u),n.d(u,"joinLinesInPoint",(function(){return Ga})),n.d(u,"lineSegmentsToPoints",(function(){return Va})),n.d(u,"joinLinesInTangent",(function(){return Ua})),n.d(u,"makePolyLine",(function(){return Ka})),n.d(u,"makePolyLineCorners",(function(){return Za}));var c={};n.r(c),n.d(c,"getCSSVariables",(function(){return Re})),n.d(c,"getDefinedCSSVariables",(function(){return Be})),n.d(c,"searchObject",(function(){return Le})),n.d(c,"getCSSColors",(function(){return We}));var h=function(t,e){var n,i,r=1<arguments.length&&void 0!==e?e:5,o=Math.pow(10,r),a=Math.round(t*o)/o;return((n=a)===(i=-0)?0!==n||1/n==1/i:n!=n&&i!=i)&&(a=0),a};function f(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5,n=0;return Array.isArray(t)?t.map((function(t){return f(t,e)})):("number"==typeof t?n=h(t,e):null!=t&&null!=t.round&&(n=t.round(e)),n)}function d(t,e,n){var i=t,r=e,o=n;return null===r&&(r=0),r<0&&(r=-r),null===o||(o<0&&(o=-o),-r<=t&&t<=r&&(i=0),o<t&&(i=o),t<-o&&(i=-o)),i}function p(t,e,n){var i=t;return null!==e&&t<e&&(i=e),null!==n&&n<t&&(i=n),i}var v=function(t,e,n,i,r){var o=0;null!==r&&(o=r);var a=0;if(null!==n&&(a=n),0===d(e,o,e))return{p:t,v:0};var s=a;a<0&&(s=-s);var l=e/Math.abs(e),u=e-l*s*i,c=i;if(0===(u=u/Math.abs(u)!=l?0:d(u,o,u))){var h=o;h/Math.abs(h)!=l&&(h=-h),c=Math.abs((h-e)/s)}return{p:t+e*c-.5*l*s*c*c,v:u}},m=function(t,e){return t},y=function(t,e){if(1<arguments.length&&void 0!==e&&e){var n=t;return(2*n-Math.sqrt(-4*n*n+4*n))/(4*n-2)}var i=t;return Math.pow(i,2)/(Math.pow(i,2)+Math.pow(1-i,2))};function g(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var e=t;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)}var n=.5+t/2;return 2*(Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))-.5)}function w(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var e=t;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)}var n=t/2;return Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))*2}function b(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;return(2<arguments.length&&void 0!==arguments[2]?arguments[2]:0)+(3<arguments.length&&void 0!==arguments[3]?arguments[3]:1)*Math.sin(t*e*2*Math.PI+n)}function x(t,e){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=[],r=t;r<=e+.5*n;r+=n)i.push(r);return i}function _(){return.5<Math.random()?1:-1}function S(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=0;if(null!=e){var r=t;i=Math.floor(Math.random()*Math.floor(e-r)+Math.floor(r))}else i=Math.floor(Math.random()*Math.floor(t));return n&&(i*=_()),i}function O(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=0;if(null!=e){var r=t;i=Math.random()*(e-r)+r}else i=Math.random()*t;return n&&(i*=_()),i}function k(t){return t[S(t.length)]}function T(t){var e=O(t.length);return t.splice(e,1)[0]}function P(t,e){for(var n=x(0,e.length-1,1),i=[],r=0;r<t;r+=1){var o=T(n);i.push(e[o])}return i}function A(t,e,n,i){return{x:O(t,n),y:O(e,i)}}function E(t,e){return[t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]]}function j(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}function M(t,e){return[1,0,t,0,1,e,0,0,1]}function L(t,e,n){return E(t,M(e,n))}function C(t){var e=Math.cos(t),n=Math.sin(t);return[e,-n,0,n,e,0,0,0,1]}function B(t,e){return E(t,C(e))}function R(t,e){return[t,0,0,0,e,0,0,0,1]}function F(t,e,n){return E(t,R(e,n))}function D(t){var e=1/(t[0]*(t[4]*t[8]-t[7]*t[5])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]));return[(t[4]*t[8]-t[7]*t[5])*e,(t[2]*t[7]-t[1]*t[8])*e,(t[1]*t[5]-t[2]*t[4])*e,(t[5]*t[6]-t[3]*t[8])*e,(t[0]*t[8]-t[2]*t[6])*e,(t[3]*t[2]-t[0]*t[5])*e,(t[3]*t[7]-t[6]*t[4])*e,(t[6]*t[1]-t[0]*t[7])*e,(t[0]*t[4]-t[3]*t[1])*e]}function I(t,e){return!e||"object"!==H(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function q(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function V(t,e,n){return e&&N(t.prototype,e),n&&N(t,n),t}function G(t,e,n,i){return(1-i)*((1-i)*t+i*e)+i*((1-i)*e+i*n)}function U(t,e){var n=t;return"0to360"===e&&(n<0&&(n+=2*Math.PI),n>=2*Math.PI&&(n-=2*Math.PI)),"-180to180"===e&&(n<-Math.PI&&(n+=2*Math.PI),n>=Math.PI&&(n-=2*Math.PI)),n}var X=function(){function t(e,n,i,r){z(this,t),this.left=e,this.width=i,this.height=r,this.bottom=n,this.top=n+r,this.right=e+i}return V(t,[{key:"_dup",value:function(){return new t(this.left,this.bottom,this.width,this.height)}}]),t}(),Y=function(){function t(e,n){z(this,t),this.x=e,this.y=n,this._type="point"}return V(t,null,[{key:"zero",value:function(){return new t(0,0)}},{key:"Unity",value:function(){return new t(1,1)}}]),V(t,[{key:"_dup",value:function(){return new t(this.x,this.y)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"sub",value:function(e,n){var i=1<arguments.length&&void 0!==n?n:0;return e instanceof t?new t(this.x-e.x,this.y-e.y):new t(this.x-e,this.y-i)}},{key:"add",value:function(e,n){var i=1<arguments.length&&void 0!==n?n:0;return e instanceof t?new t(this.x+e.x,this.y+e.y):new t(this.x+e,this.y+i)}},{key:"distance",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8;return new t(h(this.x,n),h(this.y,n))}},{key:"clip",value:function(e,n){var i,r,o,a;return r=e instanceof t?(i=e.x,e.y):i=e,a=n instanceof t?(o=n.x,n.y):o=n,new t(p(this.x,i,o),p(this.y,r,a))}},{key:"transformBy",value:function(e){var n,i,r,o=(n=e,i=this.x,r=this.y,[n[0]*i+n[1]*r+n[2],n[3]*i+n[4]*r+n[5]]);return new t(o[0],o[1])}},{key:"quadraticBezier",value:function(e,n,i){return new t(G(this.x,e.x,n.x,i),G(this.y,e.y,n.y,i))}},{key:"rotate",value:function(e,n){var i=1<arguments.length&&void 0!==n?n:new t(0,0),r=Math.cos(e),o=Math.sin(e),a=[r,-o,o,r],s=i,l=this.sub(s);return new t(a[0]*l.x+a[1]*l.y+s.x,a[2]*l.x+a[3]*l.y+s.y)}},{key:"isEqualTo",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,i=this,r=t;return"number"==typeof n&&(i=this.round(n),r=r.round(n)),i.x===r.x&&i.y===r.y}},{key:"isNotEqualTo",value:function(t,e){return!this.isEqualTo(t,e)}},{key:"isOnLine",value:function(t,e){return t.hasPointOn(this,e)}},{key:"getShaddowOnLine",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,i=new lt(this,1,t.angle()+Math.PI/2).intersectsWith(t).intersect;return null!=i&&i.isOnLine(t,n)?i:null}},{key:"shaddowIsOnLine",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8;return null!=this.getShaddowOnLine(t,n)}},{key:"isOnUnboundLine",value:function(t,e){return t.hasPointAlong(this,e)}},{key:"isInPolygon",value:function(e){var n=0,i=e.length-1,r=e.slice(),o=this,a=!1;r[0].isNotEqualTo(r[i])&&(r.push(r[0]),a=!0,i+=1);for(var s=0;s<i;s+=1)r[s].y<=o.y?r[s+1].y>o.y&&0<t.isLeft(r[s],r[s+1],o)&&(n+=1):r[s+1].y<=o.y&&t.isLeft(r[s],r[s+1],o)<0&&--n;return a&&r.pop(),0!==n}},{key:"isOnPolygon",value:function(t){var e=!1,n=t.length-1,i=t.slice();i[0].isNotEqualTo(i[n])&&(i.push(i[0]),e=!0,n+=1);for(var r=0;r<n;r+=1){var o=ut(i[r],i[r+1]);if(this.isOnLine(o))return e&&i.pop(),!0}return this.isInPolygon(t)?(e&&i.pop(),!0):(e&&i.pop(),!1)}},{key:"toPolar",value:function(){return{mag:Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)),angle:Math.atan2(this.y,this.x)}}},{key:"toDelta",value:function(t,e,n,i){var r=3<arguments.length&&void 0!==i?i:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""};return J(2<arguments.length&&void 0!==n?n:"linear",this._dup(),t,e,r)}}],[{key:"isLeft",value:function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}}]),t}();function Q(t,e){if(t instanceof Y)return t;var n=e;if(null==n&&(n=null),Array.isArray(t))return 2===t.length?new Y(t[0],t[1]):n;if("number"==typeof t)return new Y(t,t);if("object"===H(t)){var i=Object.keys(t);if(-1<i.indexOf("x")&&-1<i.indexOf("y"))return new Y(t.x,t.y)}return n}function K(t){var e=Q(t);return null==e&&(e=new Y(0,0)),e}function Z(t,e,n){return t.add(e.x*n,e.y*n)}function $(t,e,n,i){var r=i,o=Math.atan2(e.y,e.x),a=t.add(new Y(e.x*r.offset,e.y*r.offset)),s=e.toPolar().mag*r.magnitude,l=i.controlPoint;if(null==l){var u=i.direction,c=Math.cos(o+r.rot*Math.PI/2),h=Math.sin(o+r.rot*Math.PI/2);"up"===u?h<0&&(h=Math.sin(o+r.rot*Math.PI/2+Math.PI)):"down"===u?0<h&&(h=Math.sin(o+r.rot*Math.PI/2+Math.PI)):"left"===u?0<c&&(c=Math.cos(o+r.rot*Math.PI/2+Math.PI)):"right"===u&&c<0&&(c=Math.cos(o+r.rot*Math.PI/2+Math.PI)),l=new Y(a.x+s*c,a.y+s*h)}var f=t,d=l,p=t.add(e),v=G(f.x,d.x,p.x,n),m=G(f.y,d.y,p.y,n);return new Y(v,m)}function J(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"linear",e=1<arguments.length?arguments[1]:void 0,n=2<arguments.length?arguments[2]:void 0,i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length?arguments[4]:void 0;return"linear"===t?Z(e,n,i):"curved"===t?$(e,n,i,r):new Y(0,0)}function tt(t,e){return new Y(t,e)}function et(t,e,n,i){if(null==i){if(t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x)&&t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y))return 1}else if(h(t.x,i)>=h(Math.min(e.x,n.x),i)&&h(t.x,i)<=h(Math.max(e.x,n.x),i)&&h(t.y,i)>=h(Math.min(e.y,n.y),i)&&h(t.y,i)<=h(Math.max(e.y,n.y),i))return 1}function nt(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function it(t){return 180*t/Math.PI}function rt(t,e){return t===e?0:Math.atan2(Math.sin(t-e),Math.cos(t-e))}function ot(t){for(var e=t;e>=2*Math.PI;)e-=2*Math.PI;for(;e<0;)e+=2*Math.PI;return e}function at(t){var e=ot(t);return e>Math.PI/2&&e<Math.PI&&(e+=Math.PI),e===Math.PI&&(e=0),e>Math.PI&&e<3*Math.PI/2&&(e-=Math.PI),e}function st(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=ot(t),r=ot(e),o=n;return i===r?0:(2===o&&(o=r<i?-1:1),0===n?rt(r,i):1===n&&r<i?2*Math.PI-i+r:-1===n&&i<r?-i-(2*Math.PI-r):r-i)}var lt=function(){function t(e,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;z(this,t),this.p1=K(e),n instanceof Y||Array.isArray(n)?(this.p2=K(n),this.ang=Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x)):(this.p2=this.p1.add(n*Math.cos(i),n*Math.sin(i)),this.ang=i),this.setupLine()}return V(t,[{key:"setupLine",value:function(){this.A=this.p2.y-this.p1.y,this.B=this.p1.x-this.p2.x,this.C=this.A*this.p1.x+this.B*this.p1.y,this.distance=nt(this.p1,this.p2)}},{key:"_dup",value:function(){return new t(this.p1,this.p2)}},{key:"setP1",value:function(t){this.p1=K(t),this.ang=Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x),this.setupLine()}},{key:"setP2",value:function(t){this.p2=K(t),this.ang=Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x),this.setupLine()}},{key:"getPoint",value:function(t){return 2===(0<arguments.length&&void 0!==t?t:1)?this.p2:this.p1}},{key:"getYFromX",value:function(t){return 0!==this.B?(this.C-this.A*t)/this.B:null}},{key:"getXFromY",value:function(t){return 0!==this.A?(this.C-this.B*t)/this.A:null}},{key:"angle",value:function(){return this.ang}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8,i=new t(this.p1,this.p2);return i.A=h(i.A,n),i.B=h(i.B,n),i.C=h(i.C,n),i.ang=h(i.ang,n),i.distance=h(i.distance,n),i}},{key:"length",value:function(){return this.distance}},{key:"midPoint",value:function(){return this.pointAtPercent(.5)}},{key:"pointAtPercent",value:function(t){var e=this.length(),n=this.p2.sub(this.p1),i=Math.atan2(n.y,n.x);return tt(this.p1.x+e*t*Math.cos(i),this.p1.y+e*t*Math.sin(i))}},{key:"pointAtLength",value:function(t){var e=this.p2.sub(this.p1),n=Math.atan2(e.y,e.x);return tt(this.p1.x+t*Math.cos(n),this.p1.y+t*Math.sin(n))}},{key:"hasPointAlong",value:function(t,e){if(null==e){if(this.C===this.A*t.x+this.B*t.y)return!0}else if(h(this.C,e)===h(this.A*t.x+this.B*t.y,e))return!0;return!1}},{key:"distanceToPoint",value:function(t,e){return h(Math.abs(this.A*t.x+this.B*t.y-this.C)/Math.sqrt(Math.pow(this.A,2)+Math.pow(this.B,2)),e)}},{key:"hasPointOn",value:function(t,e){return!(!this.hasPointAlong(t,e)||!et(t,this.p1,this.p2,e))}},{key:"isEqualTo",value:function(t,e){var n=this,i=t;return"number"==typeof e&&(n=n.round(e),i=i.round(e),n.p1=n.p1.round(e),n.p2=n.p2.round(e),i.p1=i.p1.round(e),i.p2=i.p2.round(e)),!(n.A!==i.A||n.B!==i.B||n.C!==i.C||n.p1.isNotEqualTo(i.p1)&&n.p1.isNotEqualTo(i.p2)||n.p2.isNotEqualTo(i.p1)&&n.p2.isNotEqualTo(i.p2))}},{key:"isOnSameLineAs",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8,i=this.round(n),r=t.round(n);if(0===i.A&&0===i.B||0===r.A&&0===r.B)return!1;if(0!==i.A){var o=r.A/i.A;return i.B*o===r.B&&i.C*o===r.C}if(0!==r.A){var a=i.A/r.A;return r.B*a===i.B&&r.C*a===i.C}if(0!==i.B){var s=r.B/i.B;return i.A*s===r.A&&i.C*s===r.C}if(0===r.B)return!0;var l=i.B/r.B;return r.A*l===i.A&&r.C*l===i.C}},{key:"offset",value:function(e,n){var i=this.ang;i>=Math.PI&&(i-=Math.PI),i<0&&(i+=Math.PI);var r=i-Math.PI/2;return"positive"===e?r=U(this.ang,"0to360")+Math.PI/2:"negative"===e?r=U(this.ang,"0to360")-Math.PI/2:i<Math.PI/2?"left"!==e&&"top"!==e||(r=i+Math.PI/2):"left"!==e&&"bottom"!==e||(r=i+Math.PI/2),new t(new Y(this.p1.x+n*Math.cos(r),this.p1.y+n*Math.sin(r)),new Y(this.p2.x+n*Math.cos(r),this.p2.y+n*Math.sin(r)))}},{key:"intersectsWith",value:function(e,n){var i=1<arguments.length&&void 0!==n?n:8,r=e,o=this,a=o.A*r.B-r.A*o.B;if(0!==h(a,i)){var s=tt(0,0);return s.x=(r.B*o.C-o.B*r.C)/a,s.y=(o.A*r.C-r.A*o.C)/a,et(s,o.p1,o.p2,i)&&et(s,r.p1,r.p2,i)?{onLine:!0,inLine:!0,intersect:s}:{onLine:!0,inLine:!1,intersect:s}}if(0==a&&o.isOnSameLineAs(r,i)){if(o.p1.isOnLine(r,i)||o.p2.isOnLine(r,i)||r.p1.isOnLine(o,i)||r.p2.isOnLine(o,i))return o.p1.isOnLine(r,i)&&o.p2.isOnLine(r,i)&&(!r.p1.isOnLine(o,i)||!r.p2.isOnLine(o,i))||r.p1.isOnLine(o,i)&&r.p2.isOnLine(o,i)&&(!o.p1.isOnLine(r,i)||!o.p2.isOnLine(r,i))?{onLine:!0,inLine:!0,intersect:new t(o.midPoint(),r.midPoint()).midPoint()}:(o.p1.isOnLine(r,i)&&!o.p2.isOnLine(r,i)&&r.p1.isOnLine(o,i)&&!r.p2.isOnLine(o,i)&&(l=new t(o.p1,r.p1)),o.p1.isOnLine(r,i)&&!o.p2.isOnLine(r,i)&&!r.p1.isOnLine(o,i)&&r.p2.isOnLine(o,i)&&(l=new t(o.p1,r.p2)),!o.p1.isOnLine(r,i)&&o.p2.isOnLine(r,i)&&r.p1.isOnLine(o,i)&&!r.p2.isOnLine(o,i)&&(l=new t(o.p2,r.p1)),!o.p1.isOnLine(r,i)&&o.p2.isOnLine(r,i)&&!r.p1.isOnLine(o,i)&&r.p2.isOnLine(o,i)&&(l=new t(o.p2,r.p2)),l instanceof t&&(u=l.midPoint()),{onLine:!0,inLine:!0,intersect:u});var l,u,c=new t(o.p1,r.p1),f=new t(o.p1,r.p2),d=new t(o.p2,r.p1),p=new t(o.p2,r.p2),v=c.midPoint(),m=c.length();return f.length()<m&&(v=f.midPoint(),m=f.length()),d.length()<m&&(v=d.midPoint(),m=d.length()),p.length()<m&&(v=p.midPoint(),m=p.length()),{onLine:!0,inLine:!1,intersect:v}}return{onLine:!1,inLine:!1,intersect:void 0}}}]),t}();function ut(t,e){return new lt(t,e)}var ct=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";z(this,t),this.r=e,this.name=n}return V(t,[{key:"matrix",value:function(){return C(this.r)}},{key:"sub",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t(0,this.name);return new t(this.r-n.r,this.name)}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8;return new t(h(this.r,n),this.name)}},{key:"add",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t(0,this.name);return new t(this.r+n.r,this.name)}},{key:"mul",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t(1,this.name);return new t(this.r*n.r,this.name)}},{key:"_dup",value:function(){return new t(this.r,this.name)}}]),t}(),ht=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return z(this,t),(n=I(this,e instanceof Y?W(t).call(this,e.x,e.y):W(t).call(this,e,i))).name=r,I(n)}return q(t,Y),V(t,[{key:"matrix",value:function(){return M(this.x,this.y)}},{key:"sub",value:function(e,n){var i=0<arguments.length&&void 0!==e?e:new t(0,0),r=1<arguments.length&&void 0!==n?n:0,o=new Y(0,0);return o="number"==typeof i?new t(i,r):i,new t(this.x-o.x,this.y-o.y,this.name)}},{key:"add",value:function(e,n){var i=0<arguments.length&&void 0!==e?e:new t(0,0),r=1<arguments.length&&void 0!==n?n:0,o=new Y(0,0);return o="number"==typeof i?new t(i,r):i,new t(this.x+o.x,this.y+o.y,this.name)}},{key:"mul",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t(1,1);return new t(this.x*n.x,this.y*n.y,this.name)}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8;return new t(h(this.x,n),h(this.y,n),this.name)}},{key:"_dup",value:function(){return new t(this.x,this.y,this.name)}}]),t}(),ft=function(){function t(e,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return z(this,t),(i=I(this,e instanceof Y?W(t).call(this,e.x,e.y):W(t).call(this,e,n))).name=r,I(i)}return q(t,Y),V(t,[{key:"matrix",value:function(){return R(this.x,this.y)}},{key:"sub",value:function(e,n){var i=0<arguments.length&&void 0!==e?e:new t(0,0),r=1<arguments.length&&void 0!==n?n:0,o=new Y(0,0);return o="number"==typeof i?new t(i,r):i,new t(this.x-o.x,this.y-o.y,this.name)}},{key:"round",value:function(e){var n=0<arguments.length&&void 0!==e?e:8;return new t(h(this.x,n),h(this.y,n),this.name)}},{key:"add",value:function(e,n){var i=0<arguments.length&&void 0!==e?e:new t(0,0),r=1<arguments.length&&void 0!==n?n:0,o=new Y(0,0);return o="number"==typeof i?new t(i,r):i,new t(this.x+o.x,this.y+o.y,this.name)}},{key:"mul",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t(1,1);return n instanceof t||n instanceof Y?new t(this.x*n.x,this.y*n.y):new t(this.x*n,this.y*n,this.name)}},{key:"_dup",value:function(){return new t(this.x,this.y,this.name)}}]),t}(),dt=function(){function t(e,n,i){z(this,t),this.scale=e,this.rotation=n,this.translation=i}return V(t,[{key:"_dup",value:function(){return new t(this.scale,this.rotation,this.translation)}}]),t}(),pt=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";z(this,t),"string"==typeof e?(this.order=[],this.name=e):(this.order=e.map((function(t){return t._dup()})),this.name=n),this.index=this.order.length,this._type="transform",this.calcMatrix()}return V(t,[{key:"standard",value:function(){return this.scale(1,1).rotate(0).translate(0,0)}},{key:"translate",value:function(e,n){var i=new ht(e,1<arguments.length&&void 0!==n?n:0,this.name),r=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=i,this.index+=1,this.calcMatrix(),this):(r.push(i),new t(r,this.name))}},{key:"rotate",value:function(e){var n=new ct(e,this.name);n.name=this.name;var i=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=n,this.index+=1,this.calcMatrix(),this):(i.push(n),new t(i,this.name))}},{key:"scale",value:function(e){var n=new ft(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,this.name),i=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=n,this.index+=1,this.calcMatrix(),this):(i.push(n),new t(i,this.name))}},{key:"remove",value:function(e){var n,i=[];return n="string"==typeof e?[e]:e,this.order.forEach((function(t){-1===n.indexOf(t.name)&&i.push(t._dup())})),new t(i,this.name)}},{key:"calcMatrix",value:function(){for(var t=[1,0,0,0,1,0,0,0,1],e=this.order.length-1;0<=e;--e)t=E(t,this.order[e].matrix());this.mat=t}},{key:"update",value:function(t){return t<this.order.length&&(this.index=t),this}},{key:"t",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=0;n<this.order.length;n+=1){var i=this.order[n];if(i instanceof ht){if(e===t)return new Y(i.x,i.y);e+=1}}return null}},{key:"clipRotation",value:function(t){for(var e=0;e<this.order.length;e+=1){var n=this.order[e];n instanceof ct&&(n.r=U(n.r,t))}}},{key:"updateTranslation",value:function(t,e,n){var i=1<arguments.length&&void 0!==e?e:0,r=0,o=2<arguments.length&&void 0!==n?n:0;t instanceof Y&&(o=i);for(var a=0;a<this.order.length;a+=1)if(this.order[a]instanceof ht){if(r===o)return this.order[a]=new ht(t,i,this.name),void this.calcMatrix();r+=1}}},{key:"s",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0,i=0;i<this.order.length;i+=1){var r=this.order[i];if(r instanceof ft){if(n===e)return new Y(r.x,r.y);n+=1}}return null}},{key:"toDelta",value:function(t,e,n,i){for(var r=this._dup(),o=0;o<this.order.length;o+=1){var a=this.order[o],s=t.order[o];a instanceof ft&&s instanceof ft&&(r.order[o]=a.add(s.mul(e))),a instanceof ct&&s instanceof ct&&(r.order[o]=new ct(a.r+s.r*e)),a instanceof ht&&s instanceof ht&&(r.order[o]=new ht(J(n,a,s,e,i)))}return r}},{key:"updateScale",value:function(t,e,n){var i=1<arguments.length&&void 0!==e?e:0,r=0,o=2<arguments.length&&void 0!==n?n:0;t instanceof Y&&(o=i);for(var a=0;a<this.order.length;a+=1)if(this.order[a]instanceof ft){if(r===o)return this.order[a]=new ft(t,i,this.name),void this.calcMatrix();r+=1}}},{key:"r",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0,i=0;i<this.order.length;i+=1){var r=this.order[i];if(r instanceof ct){if(n===e)return r.r;n+=1}}return null}},{key:"updateRotation",value:function(t,e){for(var n=1<arguments.length&&void 0!==e?e:0,i=0,r=0;r<this.order.length;r+=1)if(this.order[r]instanceof ct){if(i===n)return this.order[r]=new ct(t,this.name),void this.calcMatrix();i+=1}}},{key:"m",value:function(){return this.mat}},{key:"matrix",value:function(){return this.mat}},{key:"isSimilarTo",value:function(t){if(t.order.length!==this.order.length)return!1;for(var e=0;e<this.order.length;e+=1)if(this.order[e].constructor.name!==t.order[e].constructor.name)return!1;return!0}},{key:"isEqualTo",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:8;if(!this.isSimilarTo(t))return!1;for(var i=0;i<this.order.length;i+=1){var r=t.order[i],o=this.order[i];if(o.constructor.name!==r.constructor.name)return!1;if((o instanceof ht&&r instanceof ht||o instanceof ft&&r instanceof ft)&&r.isNotEqualTo(o,n))return!1;if(o instanceof ct&&r.r!==o.r)return!1}return!0}},{key:"sub",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t;if(!this.isSimilarTo(n))return new t(this.order,this.name);for(var i=[],r=0;r<this.order.length;r+=1)i.push(this.order[r].sub(n.order[r]));return new t(i,this.name)}},{key:"add",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t;if(!this.isSimilarTo(n))return new t(this.order,this.name);for(var i=[],r=0;r<this.order.length;r+=1)i.push(this.order[r].add(n.order[r]));return new t(i,this.name)}},{key:"mul",value:function(e){var n=0<arguments.length&&void 0!==e?e:new t;if(!this.isSimilarTo(n))return new t(this.order,this.name);for(var i=[],r=0;r<this.order.length;r+=1)i.push(this.order[r].mul(n.order[r]));return new t(i,this.name)}},{key:"transform",value:function(e){var n=new t([],this.name);return n.order=e.order.concat(this.order),n.mat=E(this.matrix(),e.matrix()),n}},{key:"transformBy",value:function(e){var n=new t([],this.name);return n.order=this.order.concat(e.order),n.mat=E(e.matrix(),this.matrix()),n}},{key:"round",value:function(e){for(var n=0<arguments.length&&void 0!==e?e:8,i=[],r=0;r<this.order.length;r+=1)i.push(this.order[r].round(n));return new t(i,this.name)}},{key:"clip",value:function(e,n,i){if(!this.isSimilarTo(e)||!this.isSimilarTo(n))return this._dup();for(var r=[],o=0;o<this.order.length;o+=1){var a=this.order[o],s=e.order[o],l=n.order[o];if(a instanceof ht&&s instanceof ht&&l instanceof ht){var u=p(a.x,s.x,l.x),c=p(a.y,s.y,l.y);r.push(new ht(u,c,this.name))}else if(a instanceof ct&&s instanceof ct&&l instanceof ct)r.push(new ct(p(a.r,s.r,l.r),this.name));else if(a instanceof ft&&s instanceof ft&&l instanceof ft){var h=p(a.x,s.x,l.x),f=p(a.y,s.y,l.y);r.push(new ft(h,f,this.name))}}var d=new t(r,this.name);if(null!=i){var v=d.t();if(null!=v){var m=new lt(v,1,i.angle()+Math.PI/2).intersectsWith(i).intersect;m&&(m.isOnLine(i,4)?d.updateTranslation(m):nt(m,i.p1)<nt(m,i.p2)?d.updateTranslation(i.p1):d.updateTranslation(i.p2))}}return d}},{key:"clipMag",value:function(e,n,i){for(var r=!(2<arguments.length&&void 0!==i)||i,o=[],a=e,s=n,l=0;l<this.order.length;l+=1){var u=this.order[l];if(u instanceof ht)if(r){var c=u.toPolar(),h=c.mag,f=c.angle,p=d(h,a.translation,s.translation);o.push(new ht(p*Math.cos(f),p*Math.sin(f),this.name))}else{var v=d(u.x,a.translation,s.translation),m=d(u.y,a.translation,s.translation);o.push(new ht(v,m,this.name))}else if(u instanceof ct){var y=d(u.r,a.rotation,s.rotation);o.push(new ct(y,this.name))}else if(u instanceof ft)if(r){var g=u.toPolar(),w=g.mag,b=g.angle,x=d(w,a.scale,s.scale);o.push(new ft(x*Math.cos(b),x*Math.sin(b),this.name))}else{var _=d(u.x,a.scale,s.scale),S=d(u.y,a.scale,s.scale);o.push(new ft(_,S,this.name))}}return new t(o,this.name)}},{key:"constant",value:function(e){for(var n=0<arguments.length&&void 0!==e?e:0,i=[],r=0;r<this.order.length;r+=1){var o=this.order[r];o instanceof ht?i.push(new ht(n,n,this.name)):o instanceof ct?i.push(new ct(n,this.name)):o instanceof ft&&i.push(new ft(n,n,this.name))}return new t(i,this.name)}},{key:"zero",value:function(){return this.constant(0)}},{key:"isZero",value:function(){for(var t=0;t<this.order.length;t+=1){var e=this.order[t];if(e instanceof ht||e instanceof ft){if(0!==e.x||0!==e.y)return!1}else if(e instanceof ct&&0!==e.r)return!1}return!0}},{key:"_dup",value:function(){var e=new t(this.order,this.name);return e.index=this.index,e}},{key:"decelerate",value:function(e,n,i,r){for(var o=new t,a=new t,s=r,l=n,u=0;u<this.order.length;u+=1){var c=this.order[u],h=e.order[u];if(c instanceof ht&&h instanceof ht){var f=h.toPolar(),d=f.mag,p=f.angle,m=v(0,d,l.translation,i,s.translation);o=o.translate(m.v*Math.cos(p),m.v*Math.sin(p)),a=a.translate(c.x+m.p*Math.cos(p),c.y+m.p*Math.sin(p))}else if(c instanceof ct&&h instanceof ct){var y=v(c.r,h.r,l.rotation,i,s.rotation);o=o.rotate(y.v),a=a.rotate(y.p)}else{if(!(c instanceof ft&&h instanceof ft))return{v:new t,t:new t};var g=h.toPolar(),w=g.mag,b=g.angle,x=v(0,w,l.scale,i,s.scale);o=o.scale(x.v*Math.cos(b),x.v*Math.sin(b)),a=a.scale(c.x+x.p*Math.cos(b),c.y+x.p*Math.sin(b))}}return{v:o,t:a}}},{key:"velocity",value:function(e,n,i,r){var o=[];if(!this.isSimilarTo(e))return this.zero();for(var a=this.sub(e),s=0;s<a.order.length;s+=1){var l=a.order[s];l instanceof ht?o.push(new ht(l.x/n,l.y/n)):l instanceof ct?o.push(new ct(l.r/n)):l instanceof ft&&o.push(new ft(l.x/n,l.y/n))}return new t(o).clipMag(i,r)}}]),t}();function vt(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=e.x.width/t.x.width,r=e.y.height/t.y.height;return new pt(n).scale(i,r).translate(e.x.bottomLeft-t.x.bottomLeft*i,e.y.bottomLeft-t.y.bottomLeft*r)}function mt(t,e){var n=e.x.width/t.x.width,i=e.y.height/t.y.height;return new Y(n,i)}function yt(t,e,n,i){var r=new Y(0,0),o=new Y(0,0);return i?(r.x=t.x,r.y=t.y,o.x=t.x,o.y=t.y):(r.x=t.x<e.x?t.x:e.x,r.y=t.y<e.y?t.y:e.y,o.x=t.x>n.x?t.x:n.x,o.y=t.y>n.y?t.y:n.y),{min:r,max:o}}function gt(t,e){return new Y(t*Math.cos(e),t*Math.sin(e))}function wt(t){var e,n=(e="number"==typeof t?new Y(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0):t).distance(),i=Math.atan2(e.y,e.x);return i<0&&(i+=2*Math.PI),{mag:n,angle:i}}function bt(t){var e=!0,n={min:new Y(0,0),max:new Y(0,0)};return t.forEach((function(t){Array.isArray(t)?t.forEach((function(t){n=yt(t,n.min,n.max,e),e=!1})):n=yt(t,n.min,n.max,e),e=!1})),new X(n.min.x,n.min.y,n.max.x-n.min.x,n.max.y-n.min.y)}function xt(t,e,n){var i=t.sub(e),r=n.sub(e),o=i.toPolar().angle,a=r.toPolar().angle;return a-=o,o=0,U(a,"0to360")}function _t(t,e,n){var i=U(Math.atan2(t.y-e.y,t.x-e.x),"0to360"),r=U(Math.atan2(n.y-e.y,n.x-e.x),"0to360")-i;return r>Math.PI?r=-(2*Math.PI-r):r<-Math.PI&&(r=2*Math.PI+r),r}function St(t){var e=A(t.left,t.bottom,t.right,t.top);return new Y(e.x,e.y)}function Ot(t,e,n){var i,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=e.sub(t),a=0;return i="number"==typeof n?t._dup().constant(n):n,o.order.forEach((function(n,o){if(n instanceof ht||n instanceof ft){var s=i.order[o];if((s instanceof ht||s instanceof ft)&&0!==s.x&&0!==s.y){var l=Math.abs(n.x)/s.x,u=Math.abs(n.y)/s.y;a=(a=a<l?l:a)<u?u:a}}var c=t.order[o],h=e.order[o];if(n instanceof ct&&c instanceof ct&&h instanceof ct){var f=st(c.r,h.r,r);n.r=f;var d=i.order[o];if(d instanceof ct&&0!==d){var p=Math.abs(n.r/d.r);a=a<p?p:a}}})),a}function kt(t,e){var n,i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new Y(.25,.25),a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2*Math.PI/6,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new Y(1,1);if(n=t instanceof pt?[t]:t,(i=e instanceof pt?[e]:e).length!==n.length)return 0;var l=0;return n.forEach((function(t,e){for(var n=i[e],u=t._dup(),c=0;c<u.order.length;c+=1){var h=u.order[c];h instanceof ht?(h.x=o.x,h.y=o.y):h instanceof ct?h.r=a:(h.x=s.x,h.y=s.y)}var f=Ot(t,n,u,r);l<f&&(l=f)})),l}function Tt(t,e,n,i){var r=1/i;if(0===i||1===i||2===i)return[t,e,n];for(var o=[],a=0;a<i+1;a+=1){var s=0+a*r;o.push(new Y(Math.pow(1-s,2)*t.x+2*(1-s)*s*e.x+s*s*n.x,Math.pow(1-s,2)*t.y+2*(1-s)*s*e.y+s*s*n.y))}return o}var Pt={simple:{source:"attribute vec2 a_position;uniform mat3 u_matrix;uniform float u_z;void main() {gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);}",varNames:["a_position","u_matrix","u_z"]},withTexture:{source:"attribute vec2 a_position;attribute vec2 a_texcoord;uniform mat3 u_matrix;uniform float u_z;varying vec2 v_texcoord;void main() {gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);v_texcoord = a_texcoord;}",varNames:["a_position","a_texcoord","u_matrix","u_z"]}},At={simple:{source:"precision mediump float;uniform vec4 u_color;void main() {gl_FragColor = u_color;}",varNames:["u_color"]},withTexture:{source:"precision mediump float;uniform vec4 u_color;uniform int u_use_texture;uniform sampler2D u_texture;varying vec2 v_texcoord;void main() {if ( u_use_texture == 1) {gl_FragColor = texture2D(u_texture, v_texcoord);} else {gl_FragColor = u_color;}}",varNames:["u_color","u_use_texture","u_texture"]},text:{source:"precision mediump float;uniform vec4 u_color;uniform sampler2D u_texture;varying vec2 v_texcoord;void main() {vec4 c = texture2D(u_texture, v_texcoord);gl_FragColor = vec4(c.a * u_color.rgb, c.a * u_color.a);}",varNames:["u_color","u_texture"]}};function Et(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function jt(t,e,n){return e&&Et(t.prototype,e),n&&Et(t,n),t}var Mt={TRIANGLES:1,TRIANGLE_STRIP:2,TRIANGLE_FAN:3,LINES:4,LINK_STATUS:1,VERTEX_SHADER:1,COMPILE_STATUS:1,FRAGMENT_SHADER:1,SRC_ALPHA:1,ONE_MINUS_SRC_ALPHA:1,BLEND:1,COLOR_BUFFER_BIT:1,TEXTURE_2D:1,RGBA:1,UNSIGNED_BYTE:1,TEXTURE_WRAP_S:1,CLAMP_TO_EDGE:1,TEXTURE_WRAP_T:1,TEXTURE_MIN_FILTER:1,LINEAR:1,ARRAY_BUFFER:1,STATIC_DRAW:1,FLOAT:1,UNPACK_PREMULTIPLY_ALPHA_WEBGL:1,createBuffer:function(){},bindBuffer:function(){},bufferData:function(){},enableVertexAttribArray:function(){},vertexAttribPointer:function(){},disableVertexAttribArray:function(){},uniformMatrix3fv:function(){},uniform4f:function(){},uniform1f:function(){},uniform1i:function(){},texParameteri:function(){},drawArrays:function(){},clearColor:function(){},clear:function(){},createTexture:function(){},activeTexture:function(){},bindTexture:function(){},pixelStorei:function(){},texImage2D:function(){},blendFunc:function(){},attachShader:function(){},linkProgram:function(){},getProgramParameter:function(){},createProgram:function(){},deleteProgram:function(){},createShader:function(){},shaderSource:function(){},compileShader:function(){},getShaderParameter:function(){},getAttribLocation:function(){},getUniformLocation:function(){},enable:function(){},map:function(){},getExtension:function(){return{loseContext:function(){}}},disable:function(){},deleteShader:function(){},useProgram:function(){},viewport:function(){},canvas:{toDataURL:function(){return""},width:100,clientHeight:100,height:100,style:{top:0,visibility:"visible"}}};function Lt(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(t.deleteShader(i),null)}var Ct=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i=e.getContext("webgl",{antialias:!0});null==i&&(i=Mt),this.programs=[],this.lastUsedProgram=null,this.textures={},null!=i&&(this.gl=i,this.resize(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.disable(this.gl.DEPTH_TEST),this.gl.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.gl.enable(i.BLEND))}return jt(t,[{key:"addTexture",value:function(t,e,n){if(this.textures[t]&&null!=this.textures[t].glTexture)return this.textures[t].index;var i;return i=this.textures[t]?this.textures[t].index:Object.keys(this.textures).length,this.textures[t]={glTexture:e,index:i,type:n,state:"loaded",onLoad:[]},i}},{key:"onLoad",value:function(t){this.textures[t].onLoad.forEach((function(t){return t()})),this.textures[t].onLoad=[]}},{key:"getProgram",value:function(t,e){for(var n=0;n<this.programs.length;n+=1){var i=this.programs[n];if(i.vertexShader===t&&i.fragmentShader===e)return n}var r,o,a,s,l,u,c,h,f,d=function(t,e){var n=0<arguments.length&&void 0!==t?t:"simple",i=1<arguments.length&&void 0!==e?e:"simple";return Object.hasOwnProperty.call(Pt,n)&&Object.hasOwnProperty.call(At,i)?{vertexSource:Pt[n].source,fragmentSource:At[i].source,varNames:Pt[n].varNames.concat(At[i].varNames)}:{vertexSource:"",fragmentSource:"",varNames:[]}}(t,e),p=(r=this.gl,o=d.vertexSource,a=d.fragmentSource,h=Lt(r,r.VERTEX_SHADER,o),f=Lt(r,r.FRAGMENT_SHADER,a),h&&f?(l=h,u=f,c=(s=r).createProgram(),s.attachShader(c,l),s.attachShader(c,u),s.linkProgram(c),s.getProgramParameter(c,s.LINK_STATUS)?c:(s.deleteProgram(c),null)):null),v={vertexShader:t,fragmentShader:e,program:p,locations:function(t,e,n){var i,r,o={};for(i=0;i<n.length;i+=1)"a"===(r=n[i])[0]&&(o[r]=t.getAttribLocation(e,r)),"u"===r[0]&&(o[r]=t.getUniformLocation(e,r));return o}(this.gl,p,d.varNames)};return this.programs.push(v),this.programs.length-1}},{key:"useProgram",value:function(t){var e=this.programs[t];return this.lastUsedProgram!==e&&(this.gl.useProgram(e.program),this.lastUsedProgram=e.program),e.locations}}]),jt(t,[{key:"resize",value:function(){var t=window.devicePixelRatio,e=Math.floor(this.gl.canvas.clientWidth*t),n=Math.floor(this.gl.canvas.clientHeight*t);this.gl.canvas.width===e&&this.gl.canvas.height===n||(this.gl.canvas.width=e,this.gl.canvas.height=n),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}}]),t}();function Bt(t){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ft=function(t){console.log(t)};function Dt(t,e){return t+e}function It(t,e){return(t*e).toString()}var Wt=function(t,e){return t/e},qt=function(t,e){var n=e||t,i="-"===n[0]||n.startsWith("".concat(t,"-"))?"".concat(t," ").concat(n):n,r=" ".concat(t,"-");return"".concat(i.split(" -").join(r))},Ht=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.object=e,this.key="",n in e&&(this.key=n)}var e,n;return e=t,(n=[{key:"setValue",value:function(t){this.key&&(this.object[this.key]=t)}},{key:"execute",value:function(){if(this.key){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.object[this.key].apply(null,e)}}},{key:"value",value:function(){if(this.key)return this.object[this.key]}}])&&Rt(e.prototype,n),t}();function zt(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=[];if("string"!=typeof e)return Array.isArray(e)?e.forEach((function(e){var r=zt(t,e,n);void 0!==r&&i.push(r)})):Object.keys(e).forEach((function(r){n+r in t&&i.push({obj:new Ht(t,n+r),value:e[r]})})),i;if(n+e in t)return new Ht(t,n+e);var r=e.split("_").filter((function(t){return 0<t.length}));if(1<r.length){if(n+r[0]in t)return zt(t[n+r[0]],r.slice(1).join("_"),n)}else if(1===r.length&&n+r[0]in t)return new Ht(t,n+r[0])}function Nt(t,e){return zt(t,e,"_")}function Vt(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"-",r=e.split(i),o=t;r.forEach((function(t,e){e!==r.length-1?(Object.prototype.hasOwnProperty.call(o,t)||(o[t]={}),o=o[t]):o[t]=n}))}function Gt(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t||"function"==typeof t)return t;if("function"==typeof t._dup)return t._dup();if(Array.isArray(t)){var e=[];return t.forEach((function(t){return e.push(Gt(t))})),e}if("object"!==Bt(t))return t;var n={};return Object.keys(t).forEach((function(e){var i=Gt(t[e]);n[e]=i})),n}function Ut(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"",o="string"==typeof n?[n]:n;Object.keys(t).forEach((function(n){var a=""!==r?"".concat(r,".").concat(n):n;if(-1===o.indexOf(a)){var s=t[n];if("number"==typeof s||"boolean"==typeof s||"string"==typeof s||null==s||"function"==typeof s||"function"==typeof s._dup||Array.isArray(s))void 0===s&&void 0!==e[n]||(e[n]=i?Gt(s):s);else{var l=e[n];"number"!=typeof l&&"boolean"!=typeof l&&"string"!=typeof l&&null!=l&&"function"!=typeof l&&!Array.isArray(l)||(e[n]={}),Ut(s,e[n],o,i,a)}}}))}function Xt(t){var e=t.except,n=t.duplicate;null==e&&(e=[]),null==n&&(n=!1);for(var i=arguments.length<=1?0:arguments.length-1,r=arguments.length<=1?void 0:arguments[1],o=1;o<i;o+=1){var a=o+1<1||arguments.length<=o+1?void 0:arguments[o+1];null!=a&&Ut(a,r,e,n,"")}return r}function Yt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Xt.apply(void 0,[{}].concat(e))}function Qt(t,e){Xt({except:2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],duplicate:!0},e,t)}function Kt(){function t(t){return"".concat(t).concat(Math.floor(1e6*Math.random()))}var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";0===e.length&&(e="id_random_");for(var n=!0,i=t(e);n;)i=t(e),null==document.getElementById(i)&&(n=!1);return i}function Zt(){var t,e=" -webkit- -moz- -o- -ms- ".split(" ");return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||(t=["(",e.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(t).matches)}function $t(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(document.getElementById(t))null!=n&&n(t,e);else{var i=document.createElement("script");i.type="text/javascript",i.src=e,i.id=t,document.body&&document.body.appendChild(i),i.onload=function(){null!=n&&n(t,e)}}}function Jt(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(document.getElementById(t))null!=n&&n(t,e);else{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.id=t,document.body&&document.body.appendChild(i),i.onload=function(){null!=n&&n(t,e)}}}var te=function t(e){var n="0000000000";if(null!=e){if("uid"in e){if(e.uid===n)return;e.uid=n}for(var i=Object.keys(e),r=0;r<i.length;r+=1){var o=e[i[r]];"object"!==Bt(o)||Array.isArray(o)||null==o||"function"==typeof o||"number"==typeof o||"boolean"==typeof o||"string"==typeof o||t(o)}}};function ee(t,e){e.forEach((function(e){void 0!==t[e]&&delete t[e]}))}function ne(t,e,n){n.forEach((function(n){void 0!==t[n]&&(e[n]=t[n])}))}function ie(){return(1e18*Math.random()).toString(36)}function re(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var oe=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.location=new Y(0,0),this.border=[[]],this.holeBorder=[[]],this.onLoad=null,this.type="drawingObject",this.state="loading"}var e,n;return e=t,(n=[{key:"_dup",value:function(){return this}},{key:"setText",value:function(){}},{key:"update",value:function(){}},{key:"getGLBoundaries",value:function(t){var e=[];return this.border.forEach((function(n){var i=[];n.forEach((function(e){i.push(e.transformBy(t))})),e.push(i)})),e}},{key:"getGLBoundaryHoles",value:function(t){var e=[];return this.holeBorder.forEach((function(n){var i=[];n.forEach((function(e){i.push(e.transformBy(t))})),e.push(i)})),e}},{key:"drawWithTransformMatrix",value:function(){}},{key:"getGLBoundingRect",value:function(t){return bt(this.getGLBoundaries(t))}},{key:"getVertexSpaceBoundingRect",value:function(){return bt(this.border)}},{key:"getLocation",value:function(){return this.location}},{key:"getGLLocation",value:function(t){return this.getLocation().transformBy(t)}},{key:"getRelativeGLBoundingRect",value:function(t){var e=this.getGLLocation(t),n=this.getGLBoundingRect(t);return new X(n.left-e.x,n.bottom-e.y,n.width,n.height)}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){var t=this.getVertexSpaceBoundingRect();return new X(t.left-this.location.x,t.bottom-this.location.y,t.width,t.height)}},{key:"change",value:function(){}}])&&re(e.prototype,n),t}();function ae(t){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function se(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function le(t,e){return!e||"object"!==ae(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ue(t){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ce(t,e){return(ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var he=function(){function t(e,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"middle",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"center";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=le(this,ue(t).call(this));var s=document.getElementById(n);return s&&(r.element=s),r.id=n,r.location=i,r.yAlign=o,r.xAlign=a,r.parentDiv=e,r.show=!0,r.setBorder(),r}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ce(t,e)}(t,oe),e=t,(n=[{key:"_dup",value:function(){var e=new t(this.parentDiv,this.id,this.location._dup(),this.yAlign,this.xAlign);return e.show=this.show,e.border=this.border.map((function(t){return t.map((function(t){return t._dup()}))})),e}},{key:"setBorder",value:function(){var t=this.parentDiv.getBoundingClientRect(),e=this.element.getBoundingClientRect(),n=e.left-t.left,i=n+e.width,r=e.top-t.top,o=r+e.height,a=[];a.push(new Y(n,r)),a.push(new Y(i,r)),a.push(new Y(i,o)),a.push(new Y(n,o)),this.border=[],this.border.push(a)}},{key:"getGLBoundaries",value:function(){var t=this.parentDiv.getBoundingClientRect(),e=vt({x:{bottomLeft:0,width:t.width},y:{bottomLeft:t.height,height:-t.height}},{x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}}),n=this.element.getBoundingClientRect(),i=n.left-t.left,r=i+n.width,o=n.top-t.top,a=o+n.height,s=[];return s.push(new Y(i,o)),s.push(new Y(r,o)),s.push(new Y(r,a)),s.push(new Y(i,a)),[s.map((function(t){return t.transformBy(e.matrix())}))]}},{key:"glToPixelSpace",value:function(t){var e=(t.x- -1)/2*this.parentDiv.clientWidth,n=(1-t.y)/2*this.parentDiv.clientHeight;return new Y(e,n)}},{key:"change",value:function(t,e){var n=t;"string"==typeof t&&((n=document.createElement("div")).innerHTML=t),n instanceof HTMLElement&&(this.element.innerHTML="",this.element.appendChild(n),this.transformHtml(e))}},{key:"transformHtml",value:function(t){if(this.show){var e=this.location.transformBy(t),n=this.glToPixelSpace(e),i=this.element.clientWidth,r=this.element.clientHeight,o=0,a=0;"center"===this.xAlign?o=-i/2:"right"===this.xAlign&&(o=-i),"middle"===this.yAlign?a=-r/2:"bottom"===this.yAlign&&(a=-r);var s=n.x+o,l=n.y+a;this.element.style.position="absolute",this.element.style.left="".concat(s,"px"),this.element.style.top="".concat(l,"px"),this.element.style.visibility="visible"}else this.element.style.position="absolute",this.element.style.left="-10000px",this.element.style.top="-10000px",this.element.style.visibility="hidden"}},{key:"drawWithTransformMatrix",value:function(t){this.transformHtml(t)}}])&&se(e.prototype,n),t}();function fe(t){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function de(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function pe(t,e){return!e||"object"!==fe(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ve(t){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function me(t,e){return(me=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ye=function(){function t(e){var n,i,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"simple",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"simple";return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(n=pe(this,ve(t).call(this))).numPoints=0,i=Array.isArray(e)?e:[e],n.gl=i.map((function(t){return t.gl})),n.webgl=i,n.glPrimitive=i[0].gl.TRIANGLES,n.points=[],n.z=0,n.buffer=i.map((function(){return null})),n.texture=null,n.programIndex=i.map((function(t){return t.getProgram(r,o)})),n.type="vertexPrimitive",n}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&me(t,e)}(t,oe),e=t,(n=[{key:"addTextureToBuffer",value:function(t,e,n,i){function r(t){return 0==(t&t-1)}var o=this.gl[t],a=this.webgl[t],s=this.texture;if(null!=s){var l=a.textures[s.id].index;o.activeTexture(o.TEXTURE0+l),o.bindTexture(o.TEXTURE_2D,e),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),r(n.width)&&r(n.height)?(o.generateMipmap(o.TEXTURE_2D),null!=i&&!0===i?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE))):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE))}}},{key:"setupBuffer",value:function(t){for(var e=this,n=0<arguments.length&&void 0!==t?t:0,i=function(t){var i=e.gl[t],r=e.webgl[t];e.state="loaded",e.numPoints=0===n?e.points.length/2:n;var o=e.texture;if(null!=o)if(null==o.points&&(o.points=[]),0===o.points.length&&e.createTextureMap(),null==o.buffer&&(o.buffer=e.gl.map((function(){return null}))),o.buffer[t]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,o.buffer[t]),i.bufferData(i.ARRAY_BUFFER,new Float32Array(o.points),i.STATIC_DRAW),!(o.id in r.textures)||o.id in r.textures&&null==r.textures[o.id].glTexture){var a=i.createTexture();r.addTexture(o.id,a,o.type),i.activeTexture(i.TEXTURE0+r.textures[o.id].index),i.bindTexture(i.TEXTURE_2D,a);var s=o.src;if(s){i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,255,100]));var l=new Image;l.src=s,e.state="loading",r.textures[o.id].state="loading",r.textures[o.id].onLoad.push(e.executeOnLoad.bind(e)),l.addEventListener("load",(function(){o.data=l,e.addTextureToBuffer(t,a,o.data,o.repeat),r.onLoad(o.id),e.state="loaded",r.textures[o.id].state="loaded"}))}else null!=o.data&&e.addTextureToBuffer(t,a,o.data,o.repeat)}else o.id in r.textures&&("loading"===r.textures[o.id].state?(e.state="loading",r.textures[o.id].onLoad.push(e.executeOnLoad.bind(e))):e.state="loaded");e.buffer[t]=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,e.buffer[t]),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e.points),i.STATIC_DRAW)},r=0;r<this.webgl.length;r+=1)i(r)}},{key:"executeOnLoad",value:function(){null!=this.onLoad&&this.onLoad()}},{key:"resetBuffer",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0;n<this.webgl.length;n+=1){var i=this.gl[n],r=this.webgl[n],o=this.texture;o&&(null!=r.textures[o.id].glTexture&&(i.deleteTexture(r.textures[o.id].glTexture),r.textures[o.id].glTexture=null),null!=o.buffer&&(i.deleteBuffer(o.buffer[n]),o.buffer[n]=null)),i.deleteBuffer(this.buffer[n]),this.setupBuffer(e)}}},{key:"change",value:function(){this.resetBuffer()}},{key:"update",value:function(){this.resetBuffer()}},{key:"changeVertices",value:function(t,e){var n=this,i=1<arguments.length&&void 0!==e?e:[];this.points=[],this.border=[];var r=null,o=null,a=null,s=null;t.forEach((function(t){n.points.push(t.x),n.points.push(t.y),(null===r||t.x<r)&&(r=t.x),(null===o||t.y<o)&&(o=t.y),(null===s||t.y>s)&&(s=t.y),(null===a||t.x>a)&&(a=t.x)})),0===i.length?null!=r&&null!=o&&null!=a&&null!=s&&(this.border[0]=[new Y(r,o),new Y(r,s),new Y(a,s),new Y(a,o)]):this.border=i,this.resetBuffer()}},{key:"getPointCountForAngle",value:function(t){return 0<arguments.length&&void 0!==t||Math.PI,this.numPoints}},{key:"getPointCountForLength",value:function(){return this.numPoints}},{key:"createTextureMap",value:function(t,e,n,i,r,o,a,s){var l=0<arguments.length&&void 0!==t?t:-1,u=2<arguments.length&&void 0!==n?n:-1,c=4<arguments.length&&void 0!==r?r:0,h=6<arguments.length&&void 0!==a?a:0,f=(1<arguments.length&&void 0!==e?e:1)-l,d=(3<arguments.length&&void 0!==i?i:1)-u,p=(5<arguments.length&&void 0!==o?o:1)-c,v=(7<arguments.length&&void 0!==s?s:1)-h,m=this.texture;if(null!=m){m.points=[];for(var y=0;y<this.points.length;y+=2){var g=(this.points[y]-l)/f,w=(this.points[y+1]-u)/d;m.points.push(g*p+c),m.points.push(w*v+h)}}}},{key:"draw",value:function(t,e,n,i,r,o){var a=5<arguments.length&&void 0!==o?o:0,s=[1,0,0,0,1,0,0,0,1];s=F(s=B(s=L(s,t.x,t.y),e),n.x,n.y),this.drawWithTransformMatrix(j(s),r,a,i)}},{key:"drawWithTransformMatrix",value:function(t,e,n,i){var r=this.gl[n],o=this.webgl[n],a=r.FLOAT,s=o.useProgram(this.programIndex[n]);this.texture&&o.textures[this.texture.id].type,r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enableVertexAttribArray(s.a_position),r.bindBuffer(r.ARRAY_BUFFER,this.buffer[n]),r.vertexAttribPointer(s.a_position,2,a,!1,0,0),r.uniformMatrix3fv(s.u_matrix,!1,j(t)),r.uniform1f(s.u_z,this.z),r.uniform4f(s.u_color,e[0],e[1],e[2],e[3]);var l=this.texture;if(null!=l){var u=r.FLOAT;r.enableVertexAttribArray(s.a_texcoord),r.bindBuffer(r.ARRAY_BUFFER,l.buffer[n]),r.vertexAttribPointer(s.a_texcoord,2,u,!1,0,0)}if(l){r.uniform1i(s.u_use_texture,1);var c=o.textures[l.id].index;r.uniform1i(s.u_texture,c)}else r.uniform1i(s.u_use_texture,0);r.drawArrays(this.glPrimitive,0,i),l&&r.disableVertexAttribArray(s.a_texcoord)}},{key:"transform",value:function(t){for(var e=0;e<this.points.length;e+=2){var n=new Y(this.points[e],this.points[e+1]);n=n.transformBy(t),this.points[e]=n.x,this.points[e+1]=n.y}for(var i=0;i<this.border.length;i+=1)for(var r=0;r<this.border[i].length;r+=1)this.border[i][r]=this.border[i][r].transformBy(t)}}])&&de(e.prototype,n),t}();function ge(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var we=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.ctx=this.canvas.getContext("2d");var n=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,i=window.devicePixelRatio||1;1===i&&(i=2),this.ratio=i/n,this.resize()}var e,n;return e=t,(n=[{key:"resize",value:function(){this.ctx.setTransform(1,0,0,1,0,0),this.canvas.width=this.canvas.clientWidth*this.ratio,this.canvas.height=this.canvas.clientHeight*this.ratio,this.ctx.scale(this.ratio,this.ratio)}},{key:"_dup",value:function(){return this}}])&&ge(e.prototype,n),t}();function be(t){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xe(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _e(t,e){return!e||"object"!==be(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Se(t){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Oe(t,e){return(Oe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Te(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Pe(t,e,n){return e&&Te(t.prototype,e),n&&Te(t,n),t}var Ae=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Helvetica Neue",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"200",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"center",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"middle",s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;ke(this,t),this.family=e,this.style=n,this.size=i,this.weight=r,this.xAlign=o,this.yAlign=a,this.opacity=1,this.setColor(s)}return Pe(t,[{key:"setColor",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.color=e}},{key:"set",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:1;t.font="".concat(this.style," ").concat(this.weight," ").concat(this.size*n,"px ").concat(this.family),t.textAlign=this.xAlign,t.textBaseline=this.yAlign}},{key:"_dup",value:function(){return new t(this.family,this.style,this.size,this.weight,this.xAlign,this.yAlign,this.color)}}]),t}(),Ee=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Y(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Ae;ke(this,t),this.location=e._dup(),this.text=n.slice(),this.font=i._dup()}return Pe(t,[{key:"_dup",value:function(){return new t(this.location._dup(),this.text,this.font._dup())}}]),t}(),je=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(ke(this,t),n=_e(this,Se(t).call(this)),Array.isArray(e)?n.drawContext2D=e:n.drawContext2D=[e],n.text=i,n.scalingFactor=1,n.lastDraw=[],n.lastDrawTransform=[],0<i.length){var r=n.text[0].font.size;if(n.text.forEach((function(t){0<t.font.size&&t.font.size<r&&(r=t.font.size)})),r<20&&(n.scalingFactor=50*r),r<1){var o=-Math.log(r)/Math.LN10+2;n.scalingFactor=Math.pow(10,o)}}return n.setBorder(),n.state="loaded",n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Oe(t,e)}(t,oe),Pe(t,[{key:"setText",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;this.text[n].text=t,this.setBorder()}},{key:"_dup",value:function(){var e=new t(this.drawContext2D,this.text);return Qt(this,e),e.scalingFactor=this.scalingFactor,e.border=this.border.map((function(t){return t.map((function(t){return t._dup()}))})),e}},{key:"setFont",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.size=t;this.setBorder()}},{key:"setOpacity",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.opacity=t}},{key:"setColor",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.color=t}},{key:"draw",value:function(t,e,n,i,r){var o=[1,0,0,0,1,0,0,0,1];o=F(o=B(o=L(o,t.x,t.y),e),n.x,n.y),this.drawWithTransformMatrix(j(o),r)}},{key:"drawWithTransformMatrix",value:function(t,e,n){var i=this,r=1<arguments.length&&void 0!==e?e:[1,1,1,1],o=2<arguments.length&&void 0!==n?n:0,a=this.drawContext2D[o],s=this.drawContext2D[o].ctx,l=this.scalingFactor,u="rgba(\n      ".concat(Math.floor(255*r[0]),",\n      ").concat(Math.floor(255*r[1]),",\n      ").concat(Math.floor(255*r[2]),",\n      ").concat(Math.floor(255*r[3]),")");s.save();var c=a.canvas.offsetWidth/2/l,h=a.canvas.offsetHeight/2/l,f=E([c,0,a.canvas.offsetWidth/2,0,h,a.canvas.offsetHeight/2,0,0,1],[t[0],-t[1],t[2]*l,-t[3],t[4],t[5]*-l,0,0,1]);s.transform(f[0],f[3],f[1],f[4],f[2],f[5]),this.lastDrawTransform=f.slice(),this.text.forEach((function(t){if(t.font.set(s,l),null!=t.font.color){var e=[].concat(xe(t.font.color.slice(0,3)),[t.font.color[3]*t.font.opacity]);s.fillStyle=(n=e,"rgba(".concat(Math.floor(255*n[0]),",").concat(Math.floor(255*n[1]),",").concat(Math.floor(255*n[2]),",").concat(n[3],")"))}else s.fillStyle=u;var n;i.recordLastDraw(s,t,l,t.location.x*l,t.location.y*-l),s.fillText(t.text,t.location.x*l,t.location.y*-l)})),s.restore()}},{key:"recordLastDraw",value:function(t,e,n,i,r){var o=1.2*t.measureText(e.text).width,a=e.font.size*n*1.2,s=r+.1*a,l=i-.1*o;"baseline"===e.font.yAlign?s=r+.2*a:"top"===e.font.yAlign?s=r+a:"middle"===e.font.yAlign&&(s=r+a/2),"center"===e.font.xAlign?l-=o/2:"right"===e.font.xAlign&&(l-=o),this.lastDraw.push({width:o,height:-a,x:l,y:s})}},{key:"clear",value:function(t){var e=0<arguments.length&&void 0!==t?t:0,n=this.lastDraw;if(0<n.length){var i=this.drawContext2D[e].ctx,r=this.lastDrawTransform;i.save(),i.transform(r[0],r[3],r[1],r[4],r[2],r[5]),n.forEach((function(t){var e=t.x-t.width,n=t.y-t.height;i.clearRect(e,n,3*t.width,3*t.height)})),i.restore()}this.lastDraw=[]}},{key:"getGLBoundaries",value:function(t){var e=this,n=[];return this.text.forEach((function(i){n.push(e.getGLBoundaryOfText(i,t))})),n}},{key:"setBorder",value:function(){var t=this;this.border=[],this.text.forEach((function(e){t.border.push(t.getBoundaryOfText(e))}))}},{key:"measureText",value:function(t,e){var n,i=t.font.match(/[^ ]*px/),r=1.4*(n=null!=i?parseFloat(i[0])/2:t.measureText("a").width),o=.08*n,a=e.text.match(/[acemnorsuvwxz*gyqp]/g);Array.isArray(a)&&a.length===e.text.length&&(r=.95*n);var s=e.text.match(/[;,$]/g);Array.isArray(s)&&0<s.length&&(o=.2*n);var l=e.text.match(/[gjyqp@Q(){}[\]|]/g);Array.isArray(l)&&0<l.length&&(o=.5*n);var u=r+o,c=t.measureText(e.text).width,h=0,f=0,d=0,p=0;return"left"===e.font.xAlign&&(p=c),"center"===e.font.xAlign&&(p=d=c/2),"right"===e.font.xAlign&&(d=c),"alphabetic"!==e.font.yAlign&&"baseline"!==e.font.yAlign||(h=r,f=o),"top"===e.font.yAlign&&(h=0,f=u),"bottom"===e.font.yAlign&&(h=u,f=0),"middle"===e.font.yAlign&&(f=h=u/2),{actualBoundingBoxLeft:d,actualBoundingBoxRight:p,fontBoundingBoxAscent:h,fontBoundingBoxDescent:f}}},{key:"getBoundaryOfText",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,i=[],r=this.scalingFactor;t.font.set(this.drawContext2D[n].ctx,r);var o=this.measureText(this.drawContext2D[n].ctx,t),a=t.location;return[new Y(-o.actualBoundingBoxLeft/r,o.fontBoundingBoxAscent/r).add(a),new Y(o.actualBoundingBoxRight/r,o.fontBoundingBoxAscent/r).add(a),new Y(o.actualBoundingBoxRight/r,-o.fontBoundingBoxDescent/r).add(a),new Y(-o.actualBoundingBoxLeft/r,-o.fontBoundingBoxDescent/r).add(a)].forEach((function(t){i.push(t)})),i}},{key:"getGLBoundaryOfText",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:0,r=[];return this.getBoundaryOfText(t,i).forEach((function(t){r.push(t.transformBy(e))})),r}}]),t}();function Me(t){return(Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Le(t,e,n){var i=[];return Object.keys(t).forEach((function(r){var o="".concat(e,".").concat(r);if(r.includes(n))i.push(o);else if("object"===Me(t[r])){var a=Le(t[r],o,n);a&&(i=i.concat(a))}else"string"==typeof t[r]&&t[r].includes(n)&&i.push(o)})),i}function Ce(t,e){function n(t){return t[1].toUpperCase()}var i=new RegExp(e,"g");return t.replace(i,"").replace(/-[a-z]/g,n).replace(/_[a-z]/g,n).replace(/-/g,"")}function Be(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:function(t){return t},o={},a=t;if("string"==typeof t&&(a=document.getElementById(t)),a instanceof HTMLElement){var s=window.getComputedStyle(a);s&&e.forEach((function(t){var e=s.getPropertyValue(t);if(null!=e){e=e.trim();var a=parseFloat(e),l=e;if(Number.isNaN(a)||(l=a),l=r(l),i){var u=Ce(t,n);o[u]=l}else{var c=new RegExp(n,"g"),h=t.replace(c,"");Vt(o,h,l,"-")}}}))}return o}function Re(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i={},r=t;if("string"==typeof t&&(r=document.getElementById(t)),r instanceof HTMLElement){var o=window.getComputedStyle(r);if(o)for(var a=o.length,s=0;s<a;s+=1){var l=o[s];if(""===e||l.startsWith(e)){var u=o.getPropertyValue(l);if(null!=u){u=u.trim();var c=parseFloat(u),h=u;if(Number.isNaN(c)||(h=c),n)i[Ce(l,e)]=h;else{var f=new RegExp(e,"g");Vt(i,l.replace(f,""),h,"-")}}}}}return i}var Fe=["base","lighter","light","dark","darker","higher","high","low","lower"],De=[];["blue","red","yellow","green","cyan","brown","orange","violet","grey","black","white"].forEach((function(t){Fe.forEach((function(e){De.push("--palette-".concat(t,"-").concat(e))}))}));var Ie=["--diagram-background","--diagram-primary","--diagram-warning","--diagram-safe","--diagram-passive","--diagram-construction1","--diagram-construction2","--diagram-construction3","--diagram-construction4","--diagram-construction5","--diagram-construction6","--diagram-construction7","--diagram-construction8","--diagram-construction9","--diagram-disabled","--diagram-disabledDark","--diagram-disabledDarker","--diagram-disabledDarkest","--diagram-push","--diagram-action","--diagram-text-base","--diagram-text-warning","--diagram-text-plot","--diagram-text-keyword","--diagram-text-keyword2","--diagram-text-latin","--diagram-text-greek","--diagram-text-english","--diagram-text-note","--diagram-qr-background"];function We(){var t={},e={},n={},i=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).map((function(t){return"--colors-".concat(t)})),r=document.body;return r&&(t=Be(r,i,"--colors-",!1,ze),e=Be(r,De,"--palette-",!1,ze),n=Be(r,Ie,"--diagram-",!1,ze)),t.palette=e,t.diagram=n,t}function qe(t){var e=t.replace(/.*\(/i,"").replace(/\)/i,"").split(",").map((function(t,e){return e<3?parseInt(t,10)/255:parseFloat(t)}));return 3===e.length&&e.push(1),e}function He(t){var e=t.slice(1);return e.length<6&&(e="".concat(e[0]).concat(e[0]).concat(e[1]).concat(e[1]).concat(e[2]).concat(e[2])),[parseInt(e.slice(0,2),16)/255,parseInt(e.slice(2,4),16)/255,parseInt(e.slice(4,6),16)/255,1]}function ze(t){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},n=t.slice(0);n in e&&(n=e[n]);var i=[];return n.toLowerCase().startsWith("rgb")?i=qe(n):n.startsWith("#")&&(i=He(n)),0<i.length?i:null}function Ne(t){return"rgba(".concat(Math.floor(255*t[0]),",").concat(Math.floor(255*t[1]),",").concat(Math.floor(255*t[2]),",").concat(t[3],")")}function Ve(t){return"rgb(".concat(Math.floor(255*t[0]),",").concat(Math.floor(255*t[1]),",").concat(Math.floor(255*t[2]),")")}function Ge(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ue=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=Yt({},{onFinish:null,completeOnCancel:null,removeOnFinish:!0,name:ie(),duration:0,delay:0,beforeFrame:null,afterFrame:null},e);return this.onFinish=n.onFinish,this.completeOnCancel=n.completeOnCancel,this.duration=n.duration,this.startTime=-1,this.state="idle",this.name=n.name,this.afterFrame=n.afterFrame,this.beforeFrame=n.beforeFrame,this.startDelay=n.delay,this.removeOnFinish=n.removeOnFinish,this.startTimeOffset=0,this}var e,n;return e=t,(n=[{key:"nextFrame",value:function(t){-1===this.startTime&&(this.startTime=t-this.startTimeOffset);var e=t-this.startTime,n=-(this.duration+this.startDelay-e);if(e>=this.startDelay){var i=e-this.startDelay;i>=this.duration&&(n=i-this.duration,i=this.duration),this.beforeFrame&&this.beforeFrame(i/this.duration),this.setFrame(i),this.afterFrame&&this.afterFrame(i/this.duration),0<=n&&this.finish()}return n}},{key:"setFrame",value:function(){}},{key:"startWaiting",value:function(){this.state="waitingToStart"}},{key:"start",value:function(t){var e=0<arguments.length&&void 0!==t?t:-1;this.startTime=e,this.state="animating"}},{key:"finishIfZeroDuration",value:function(){0===this.duration&&0===this.startDelay&&this.finish()}},{key:"setToEnd",value:function(){}},{key:"finish",value:function(t,e){var n=0<arguments.length&&void 0!==t&&t,i=1<arguments.length&&void 0!==e?e:null;if("idle"!==this.state&&"finished"!==this.state){var r=this.state;this.state="finished",n&&("complete"===i||null==i&&!0===this.completeOnCancel?("waitingToStart"===r&&this.start(),this.setToEnd()):"waitingToStart"===r&&this.cancelledWithNoComplete()),!1===n&&("waitingToStart"===r&&this.start(),this.setToEnd()),null!=this.onFinish&&this.onFinish(n)}}},{key:"cancelledWithNoComplete",value:function(){}},{key:"cancel",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.finish(!0,e)}},{key:"_dup",value:function(){var e=new t;return Qt(this,e),e}},{key:"whenFinished",value:function(t){return this.onFinish=t,this}},{key:"ifCanceledThenComplete",value:function(){return this.completeOnCancel=!0,this}},{key:"ifCanceledThenStop",value:function(){return this.completeOnCancel=!1,this}}])&&Ge(e.prototype,n),t}();function Xe(t){return(Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ye(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Qe(t,e){return!e||"object"!==Xe(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Ke(t){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ze(t,e){return(Ze=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var $e=function(){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=Qe(this,Ke(t).call(this,n));var i="easeinout";"color"!==n.type&&"custom"!==n.type||(i="linear");var r=Yt({},{element:null,type:"custom",progression:i,duration:0},n);return e.element=r.element,e.type=r.type,e.onFinish=r.onFinish,e.duration=r.duration,"linear"===r.progression?e.progression=m:"easein"===r.progression?e.progression=w:"easeout"===r.progression?e.progression=g:"easeinout"===r.progression?e.progression=y:e.progression=r.progression,e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ze(t,e)}(t,Ue),e=t,(n=[{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&Ye(e.prototype,n),t}();function Je(t){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function en(t,e){return!e||"object"!==Je(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function nn(t,e,n){return(nn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=rn(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function rn(t){return(rn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function on(t,e){return(on=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var an=function(){function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{},{type:"position"}].concat(i));ee(o,["start","delta","target","translationStyle","translationOptions","velocity","maxTime"]);var a={start:null,target:null,delta:null,translationStyle:"linear",translationOptions:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:"",maxTime:null},velocity:null};if((e=en(this,rn(t).call(this,o))).element&&e.element.animations.options.tranlsation){var s=e.element.animations.options.tranlsation;null!=s.style&&(a.style=s.style),Yt(a.translationOptions,s)}var l=Yt.apply(void 0,[{},a].concat(i));return null!=l.start&&(l.start=K(l.start)),null!=l.target&&(l.target=K(l.target)),null!=l.delta&&(l.delta=K(l.delta)),e.position={translationOptions:{}},ne(l,e.position,["start","delta","target","translationStyle","velocity","maxTime"]),Qt(l.translationOptions,e.position.translationOptions),e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&on(t,e)}(t,$e),e=t,(n=[{key:"start",value:function(e){if(nn(rn(t.prototype),"start",this).call(this,e),null===this.position.start){if(null==this.element)return void(this.duration=0);this.position.start=this.element.getPosition()}if(null==this.position.delta&&null!=this.position.target&&null!=this.position.start){var n=this.position.target.sub(this.position.start);this.position.delta=n}else null!=this.position.delta&&null!=this.position.start?this.position.target=this.position.start.add(this.position.delta):this.duration=0;var i=this.position,r=i.target,o=i.start,a=i.velocity;if(null!=a&&null!=o&&null!=r){var s=K(a);this.duration=Ot((new pt).translate(o),(new pt).translate(r),(new pt).translate(s))}null!=this.position.maxTime&&this.duration>this.position.maxTime&&(this.duration=this.position.maxTime)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e);if(null!=this.position.delta&&null!=this.position.start){var i=this.position.start.toDelta(this.position.delta,n,this.position.translationStyle,this.position.translationOptions);null!=this.element&&this.element.setPosition(i)}}},{key:"setToEnd",value:function(){null!=this.element&&this.element.setPosition(this.position.target)}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&tn(e.prototype,n),t}();function sn(t){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ln(t,e,n){return(ln=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&vn(r,n.prototype),r}).apply(null,arguments)}function un(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function hn(t,e){return!e||"object"!==sn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function fn(t,e,n){return(fn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dn(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function dn(t){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vn(t,e)}function vn(t,e){return(vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var mn=function(){function t(){var e;un(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{}].concat(i,[{type:"color"}]));ee(o,["start","delta","target","dissolve"]),e=hn(this,dn(t).call(this,o));var a=Yt.apply(void 0,[{},{start:null,target:null,delta:null,dissolve:null}].concat(i));return e.color={},ne(a,e.color,["start","delta","target","dissolve"]),"dim"===e.color.target?(null!=e.element&&(e.color.target=e.element.dimColor.slice()),e.color.setDefault=!1):"undim"===e.color.target?(null!=e.element&&(e.color.target=e.element.defaultColor.slice()),e.color.setDefault=!1):e.color.setDefault=!0,e}var e,n;return pn(t,$e),e=t,(n=[{key:"start",value:function(e){var n,i,r,o,a=this.element;null!=a?(fn(dn(t.prototype),"start",this).call(this,e),null==this.color.start&&(this.color.start=a.color.slice()),null==this.color.delta&&null==this.color.target?this.color.target=this.color.start.slice():null!=this.color.delta&&(this.color.target=(r=this.color.start,o=this.color.delta,r.map((function(t,e){return Math.min(t+o[e],1)})))),this.color.whenComplete=this.color.target.slice(),"out"===this.color.dissolve&&(this.color.target[3]=.001),"in"===this.color.dissolve&&(this.color.start[3]=.001,a.setColor(this.color.start,this.color.setDefault),a.showAll()),this.color.delta=(n=this.color.target,i=this.color.start,n.map((function(t,e){return t-i[e]})))):this.duration=0}},{key:"setFrame",value:function(t){var e=this,n=t/this.duration,i=this.progression(n),r=this.color.start.map((function(t,n){var r=t+e.color.delta[n]*i;return 1<r&&(r=1),r<0&&(r=0),r}));null!=this.element&&this.element.setColor(r,this.color.setDefault)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.setColor(this.color.whenComplete,this.color.setDefault),"out"===this.color.dissolve&&t.hide())}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&cn(e.prototype,n),t}(),yn=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};un(this,t);for(var n={},i={duration:1,target:"dim",completeOnCancel:!0},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n=Yt.apply(void 0,"number"==typeof e?[{},i,{duration:e}].concat(o):[{},i,e].concat(o)),hn(this,dn(t).call(this,n))}return pn(t,mn),t}();function gn(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return ln(yn,[t].concat(n))}var wn=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};un(this,t);for(var n={},i={duration:1,target:"undim",completeOnCancel:!0},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n=Yt.apply(void 0,"number"==typeof e?[{},i,{duration:e}].concat(o):[{},i,e].concat(o)),hn(this,dn(t).call(this,n))}return pn(t,mn),t}();function bn(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return ln(wn,[t].concat(n))}function xn(t){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _n(t,e,n){return(_n=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&En(r,n.prototype),r}).apply(null,arguments)}function Sn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function On(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function kn(t,e){return!e||"object"!==xn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Tn(t,e,n){return(Tn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Pn(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Pn(t){return(Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function An(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&En(t,e)}function En(t,e){return(En=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var jn=function(){function t(){var e;Sn(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{}].concat(i,[{type:"color"}]));ee(o,["start","delta","target","dissolve"]),e=kn(this,Pn(t).call(this,o));var a=Yt.apply(void 0,[{},{start:null,target:null,delta:null,dissolve:null}].concat(i));return e.opacity={},ne(a,e.opacity,["start","delta","target","dissolve"]),e}var e,n;return An(t,$e),e=t,(n=[{key:"start",value:function(e){var n=this.element;null!=n?(Tn(Pn(t.prototype),"start",this).call(this,e),null==this.opacity.start&&(this.opacity.start=n.opacity),null==this.opacity.delta&&null==this.opacity.target?this.opacity.target=this.opacity.start:null!=this.opacity.delta&&(this.opacity.target=this.opacity.start+this.opacity.delta),this.opacity.whenComplete=this.opacity.target,"out"===this.opacity.dissolve&&(this.opacity.target=.001,this.opacity.whenComplete=1,n.setOpacity(this.opacity.start)),"in"===this.opacity.dissolve&&(this.opacity.start=.001,this.opacity.target=1,this.opacity.whenComplete=1,n.showAll(),n.setOpacity(this.opacity.start)),this.opacity.delta=this.opacity.target-this.opacity.start):this.duration=0}},{key:"cancelledWithNoComplete",value:function(){var t=this.element;null!=t&&.001===t.opacity&&(t.hide(),t.opacity=1)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e),i=this.opacity.start+this.opacity.delta*n;1<i&&(i=1),i<0&&(i=0),null!=this.element&&this.element.setOpacity(i)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.setOpacity(this.opacity.whenComplete),"out"===this.opacity.dissolve&&t.hide())}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&On(e.prototype,n),t}(),Mn=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Sn(this,t);for(var n={},i={duration:1,dissolve:"in",completeOnCancel:!0},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n=Yt.apply(void 0,"number"==typeof e?[{},i,{duration:e}].concat(o):[{},i,e].concat(o)),kn(this,Pn(t).call(this,n))}return An(t,jn),t}();function Ln(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return _n(Mn,[t].concat(n))}var Cn=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Sn(this,t);for(var n={},i={duration:1,dissolve:"out",completeOnCancel:!0},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n=Yt.apply(void 0,"number"==typeof e?[{},i,{duration:e}].concat(o):[{},i,e].concat(o)),kn(this,Pn(t).call(this,n))}return An(t,jn),t}();function Bn(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return _n(Cn,[t].concat(n))}function Rn(t){return(Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Dn(t,e){return!e||"object"!==Rn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function In(t,e,n){return(In="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wn(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Wn(t){return(Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qn(t,e){return(qn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Hn=function(){function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{},{type:"transform"}].concat(i));ee(o,["start","delta","target","rotDirection","translationStyle","translationOptions","velocity","clipRotationTo","maxTime"]);var a={start:null,target:null,delta:null,translationStyle:"linear",rotDirection:0,translationOptions:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""},velocity:null,clipRotationTo:null,maxTime:null};if((e=Dn(this,Wn(t).call(this,o))).element&&e.element.animations.options.translation){var s=e.element.animations.options.translation;null!=s.style&&(a.translationStyle=s.style),Yt(a.translationOptions,s)}var l=Yt.apply(void 0,[{},a].concat(i));return e.transform={translationOptions:{}},ne(l,e.transform,["start","delta","target","translationStyle","velocity","rotDirection","clipRotationTo","maxTime"]),Qt(l.translationOptions,e.transform.translationOptions),e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qn(t,e)}(t,$e),e=t,(n=[{key:"start",value:function(e){var n=this;if(In(Wn(t.prototype),"start",this).call(this,e),null===this.transform.start){if(null==this.element)return void(this.duration=0);this.transform.start=this.element.transform._dup()}if(null==this.transform.delta&&null!=this.transform.target){var i=this.transform.target.sub(this.transform.start);i.order.forEach((function(t,e){var i=n.transform.start.order[e],r=n.transform.target.order[e];if(t instanceof ct&&i instanceof ct&&r instanceof ct){var o=st(i.r,r.r,n.transform.rotDirection);t.r=o}})),this.transform.delta=i}else null!=this.transform.delta?this.transform.target=this.transform.start.add(this.transform.delta):this.duration=0;null!=this.transform.velocity&&(this.duration=Ot(this.transform.start,this.transform.target,this.transform.velocity,this.transform.rotDirection)),null!=this.transform.maxTime&&this.duration>this.transform.maxTime&&(this.duration=this.transform.maxTime)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e),i=this.transform.start.toDelta(this.transform.delta,n,this.transform.translationStyle,this.transform.translationOptions);null!==this.transform.clipRotationTo&&i.clipRotation(this.transform.clipRotationTo),null!=this.element&&this.element.setTransform(i)}},{key:"setToEnd",value:function(){null!=this.element&&this.element.setTransform(this.transform.target)}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&Fn(e.prototype,n),t}();function zn(t){return(zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Vn(t,e){return!e||"object"!==zn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Gn(t,e,n){return(Gn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Un(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Un(t){return(Un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Xn(t,e){return(Xn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Yn=function(){function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{},{type:"rotation"}].concat(i));ee(o,["start","delta","target","direction","velocity","clipTo","maxTime"]),e=Vn(this,Un(t).call(this,o));var a=Yt.apply(void 0,[{},{start:null,target:null,delta:null,direction:0,velocity:null,clipTo:null,maxTime:null}].concat(i));return e.rotation={},ne(a,e.rotation,["start","delta","target","velocity","direction","clipTo","maxTime"]),e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xn(t,e)}(t,$e),e=t,(n=[{key:"start",value:function(e){if(Gn(Un(t.prototype),"start",this).call(this,e),null===this.rotation.start){if(null==this.element)return void(this.duration=0);this.rotation.start=this.element.transform.r()||0}if(null==this.rotation.delta&&null!=this.rotation.target){var n=st(this.rotation.start,this.rotation.target,this.rotation.direction);this.rotation.delta=n}else null!=this.rotation.delta?this.rotation.target=this.rotation.start+this.rotation.delta:this.duration=0;var i=this.rotation.velocity;null!=i&&(this.duration=Ot((new pt).rotate(this.rotation.start),(new pt).rotate(this.rotation.target),(new pt).rotate(i),this.rotation.direction)),null!=this.rotation.maxTime&&this.duration>this.rotation.maxTime&&(this.duration=this.rotation.maxTime)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e),i=this.rotation.start+this.rotation.delta*n;i=U(i,this.rotation.clipTo);var r=this.element;null!=r&&r.setRotation(i)}},{key:"setToEnd",value:function(){var t=this.element;null!=t&&(t.transform.updateRotation(U(this.rotation.target,this.rotation.clipTo)),t.setTransformCallback(t.transform))}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&Nn(e.prototype,n),t}();function Qn(t){return(Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zn(t,e){return!e||"object"!==Qn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function $n(t,e,n){return($n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Jn(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Jn(t){return(Jn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ti(t,e){return(ti=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ei=function(){function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{},{type:"position"}].concat(i));ee(o,["start","delta","target","velocity","maxTime"]),e=Zn(this,Jn(t).call(this,o));var a=Yt.apply(void 0,[{},{start:null,target:null,delta:null,velocity:null,maxTime:null}].concat(i));return e.scale={},null!=a.start&&(a.start=K(a.start)),null!=a.target&&(a.target=K(a.target)),null!=a.delta&&(a.delta=K(a.delta)),ne(a,e.scale,["start","delta","target","translationStyle","velocity","maxTime"]),e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ti(t,e)}(t,$e),e=t,(n=[{key:"start",value:function(e){if($n(Jn(t.prototype),"start",this).call(this,e),null===this.scale.start){if(null==this.element)return void(this.duration=0);this.scale.start=this.element.getScale()}if(null==this.scale.delta&&null!=this.scale.target&&null!=this.scale.start){var n=this.scale.target.sub(this.scale.start);this.scale.delta=n}else null!=this.scale.delta&&null!=this.scale.start?this.scale.target=this.scale.start.add(this.scale.delta):this.duration=0;var i=this.scale,r=i.target,o=i.start,a=i.velocity;if(null!=a&&null!=r&&null!=o){var s=K(a);this.duration=Ot((new pt).scale(o),(new pt).scale(r),(new pt).scale(s))}null!=this.scale.maxTime&&this.duration>this.scale.maxTime&&(this.duration=this.scale.maxTime)}},{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e);if(null!=this.scale.start&&null!=this.scale.delta){var i=this.scale.start.toDelta(this.scale.delta,n);null!=this.element&&this.element.setScale(i)}}},{key:"setToEnd",value:function(){null!=this.element&&this.element.setScale(this.scale.target)}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&Kn(e.prototype,n),t}();function ni(t){return(ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ii(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ri(t,e){return!e||"object"!==ni(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function oi(t,e,n){return(oi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ai(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function ai(t){return(ai=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function si(t,e){return(si=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var li=function(){function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{},{scale:1.5,numLines:1,type:"pulse",duration:1,frequency:0,stopAfterDuration:!0}].concat(i));return(e=ri(this,ai(t).call(this,o))).scale=o.scale,e.numLines=o.numLines,e.duration=o.duration,e.frequency=o.frequency,e.stopAfterDuration=o.stopAfterDuration,e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&si(t,e)}(t,$e),e=t,(n=[{key:"start",value:function(e){oi(ai(t.prototype),"start",this).call(this,e);var n=this.element;null!=n&&(1===this.numLines?n.pulseScaleNow(this.duration,this.scale,this.frequency):n.pulseThickNow(this.duration,this.scale,this.numLines))}},{key:"setToEnd",value:function(){null!=this.element&&this.stopAfterDuration&&this.element.stopPulsing(!0)}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&ii(e.prototype,n),t}();function ui(t){return(ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ci(t,e,n){return(ci=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&pi(r,n.prototype),r}).apply(null,arguments)}function hi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function fi(t,e){return!e||"object"!==ui(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function di(t){return(di=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pi(t,e){return(pi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var vi=function(){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i,r={payload:null,duration:0},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return"function"==typeof n?(i=Yt.apply(void 0,[{},r].concat(a))).callback=n:i=Yt.apply(void 0,[{},r,n].concat(a)),(e=fi(this,di(t).call(this,i))).callback=i.callback,e.payload=i.payload,e.duration=i.duration,e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pi(t,e)}(t,Ue),e=t,(n=[{key:"setFrame",value:function(){null!=this.callback&&(this.callback(this.payload),this.callback=null)}},{key:"setToEnd",value:function(){null!=this.callback&&(this.callback(this.payload),this.callback=null)}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e}}])&&hi(e.prototype,n),t}();function mi(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return ci(vi,[t].concat(n))}function yi(t){return(yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gi(t,e,n){return(gi=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&_i(r,n.prototype),r}).apply(null,arguments)}function wi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function bi(t,e){return!e||"object"!==yi(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function xi(t){return(xi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _i(t,e){return(_i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Si=function(){function t(){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{}].concat(i));e=bi(this,xi(t).call(this,o));var a=Yt.apply(void 0,[{},{callback:null,startPercent:0,progression:"linear"}].concat(i));return"linear"===a.progression?e.progression=m:"easein"===a.progression?e.progression=w:"easeout"===a.progression?e.progression=g:"easeinout"===a.progression?e.progression=y:e.progression=a.progression,e.callback=a.callback,e.startPercent=a.startPercent,"function"==typeof e.progression&&(e.startTimeOffset=e.progression(a.startPercent,!0)*a.duration),e.duration=a.duration,e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_i(t,e)}(t,Ue),e=t,(n=[{key:"setFrame",value:function(t){var e=t/this.duration,n=this.progression(e);null!=this.callback&&this.callback(n)}},{key:"setToEnd",value:function(){null!=this.callback&&this.callback(1)}},{key:"_dup",value:function(){var e=new t;return Qt(this,e),e}}])&&wi(e.prototype,n),t}();function Oi(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return gi(Si,e)}function ki(t){return(ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ti(t,e,n){return(Ti=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&Mi(r,n.prototype),r}).apply(null,arguments)}function Pi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ai(t,e){return!e||"object"!==ki(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Ei(t,e,n){return(Ei="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ji(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function ji(t){return(ji=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mi(t,e){return(Mi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Li=function(){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i,r={steps:[]},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return Array.isArray(n)?(i=Yt.apply(void 0,[{},r].concat(a))).steps=n:i=Yt.apply(void 0,[{},r,n].concat(a)),(e=Ai(this,ji(t).call(this,i))).steps=[],Array.isArray(i.steps)||null==i.steps?null!=i.steps&&(e.steps=i.steps):e.steps=[i.steps],e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mi(t,e)}(t,Ue),e=t,(n=[{key:"with",value:function(t){return this.steps.push(t),this}},{key:"nextFrame",value:function(t){var e=null;return null!=this.beforeFrame&&this.beforeFrame(t-this.startTime),this.steps.forEach((function(n){if("animating"===n.state||"waitingToStart"===n.state){var i=n.nextFrame(t);null===e&&(e=i),i<e&&(e=i)}})),null!=this.afterFrame&&this.afterFrame(t-this.startTime),null===e&&(e=0),0<=e&&this.finish(),e}},{key:"finishIfZeroDuration",value:function(){var t="finished";this.steps.forEach((function(e){"finished"!==e.state&&(t="animating")})),"finished"===t&&this.finish()}},{key:"startWaiting",value:function(){Ei(ji(t.prototype),"startWaiting",this).call(this),this.steps.forEach((function(t){t.startWaiting()}))}},{key:"start",value:function(e){this.startWaiting(),Ei(ji(t.prototype),"start",this).call(this,e),this.steps.forEach((function(t){t.start(e),t.finishIfZeroDuration()}))}},{key:"finish",value:function(t,e){var n=0<arguments.length&&void 0!==t&&t,i=1<arguments.length&&void 0!==e?e:null;if("idle"!==this.state&&"finished"!==this.state){this.state="finished";var r=null;!0===this.completeOnCancel&&(r="complete"),!1===this.completeOnCancel&&(r="noComplete"),null!=i&&(r=i),this.steps.forEach((function(t){"idle"!==t.state&&"finished"!==t.state&&t.finish(n,r)})),null!=this.onFinish&&this.onFinish(n)}}},{key:"_dup",value:function(){var e=new t;return Qt(this,e),e}}])&&Pi(e.prototype,n),t}();function Ci(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return Ti(Li,[t].concat(n))}function Bi(t){return(Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ri(t,e,n){return(Ri=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&qi(r,n.prototype),r}).apply(null,arguments)}function Fi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Di(t,e){return!e||"object"!==Bi(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Ii(t,e,n){return(Ii="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wi(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Wi(t){return(Wi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qi(t,e){return(qi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Hi=function(){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i,r={steps:[]},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return Array.isArray(n)?(i=Yt.apply(void 0,[{},r].concat(a))).steps=n:i=Yt.apply(void 0,[{},r,n].concat(a)),(e=Di(this,Wi(t).call(this,i))).index=0,e.steps=[],Array.isArray(i.steps)||null==i.steps?null!=i.steps&&(e.steps=i.steps):e.steps=[i.steps],e}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qi(t,e)}(t,Ue),e=t,(n=[{key:"then",value:function(t){return this.steps.push(t),this}},{key:"startWaiting",value:function(){Ii(Wi(t.prototype),"startWaiting",this).call(this),this.steps.forEach((function(t){t.startWaiting()}))}},{key:"start",value:function(e){"animating"!==this.state&&(this.startWaiting(),Ii(Wi(t.prototype),"start",this).call(this,e),(this.index=0)<this.steps.length&&(this.steps[0].start(e),this.steps[0].finishIfZeroDuration())),this.finishIfZeroDuration()}},{key:"finishIfZeroDuration",value:function(){for(var t=0,e=this.steps[0];t<this.steps.length&&"finished"===e.state;)(t+=1)<this.steps.length&&(this.index=t,(e=this.steps[t]).start(this.steps[t-1].startTime),e.finishIfZeroDuration());t===this.steps.length&&this.finish()}},{key:"nextFrame",value:function(t){var e=-1;return null!=this.beforeFrame&&this.beforeFrame(t-this.startTime),this.index<=this.steps.length-1&&(e=this.steps[this.index].nextFrame(t),null!=this.afterFrame&&this.afterFrame(t-this.startTime),0<=e)?this.index===this.steps.length-1?(this.finish(),e):(this.index+=1,this.steps[this.index].start(t-e),this.nextFrame(t)):e}},{key:"finish",value:function(t,e){var n=0<arguments.length&&void 0!==t&&t,i=1<arguments.length&&void 0!==e?e:null;if("idle"!==this.state&&"finished"!==this.state){this.state="finished";var r=null;!0===this.completeOnCancel&&(r="complete"),!1===this.completeOnCancel&&(r="noComplete"),null!=i&&(r=i),this.steps.forEach((function(t){"idle"!==t.state&&"finished"!==t.state&&t.finish(n,r)})),null!=this.onFinish&&this.onFinish(n)}}},{key:"_dup",value:function(){var e=new t;return Qt(this,e),e}}])&&Fi(e.prototype,n),t}();function zi(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return Ri(Hi,[t].concat(n))}function Ni(t){return(Ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vi(t,e,n){return(Vi=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&Yi(r,n.prototype),r}).apply(null,arguments)}function Gi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ui(t,e){return!e||"object"!==Ni(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Xi(t){return(Xi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Yi(t,e){return(Yi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Qi=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n={},i={duration:0},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n=Yt.apply(void 0,"number"==typeof e?[{},i,{duration:e}].concat(o):[{},i,e].concat(o)),Ui(this,Xi(t).call(this,n))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yi(t,e)}(t,Ue),e=t,(n=[{key:"_dup",value:function(){var e=new t;return Qt(this,e),e}}])&&Gi(e.prototype,n),t}();function Ki(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return Vi(Qi,[t].concat(n))}function Zi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var $i=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n,i={},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return e instanceof _r?(n=Yt.apply(void 0,[{},i].concat(o))).element=e:n=Yt.apply(void 0,[{},i,e].concat(o)),this.element=n.element,this.animations=[],this.state="idle",this.options={translation:{}},this}var e,n;return e=t,(n=[{key:"willStartAnimating",value:function(){if("animating"===this.state)return!0;var t=!1;return this.animations.forEach((function(e){"waitingToStart"!==e.state&&"animating"!==e.state||(t=!0)})),t}},{key:"nextFrame",value:function(t){var e=[],n=null,i=!1;this.animations.forEach((function(r,o){var a=!1;if("waitingToStart"===r.state||"animating"===r.state){var s=r.nextFrame(t);null===n&&(n=s),s<n&&(n=s),a=!0}"finished"===r.state&&r.removeOnFinish&&(a=!1,e.push(o)),a&&(i=!0)})),this.state=i?"animating":"idle";for(var r=e.length-1;0<=r;--r)this.animations.splice(e[r],1);return n}},{key:"cleanAnimations",value:function(){for(var t=[],e=!1,n=0;n<this.animations.length;n+=1){var i=this.animations[n];"finished"===i.state&&i.removeOnFinish?t.push(n):e=!0}for(var r=t.length-1;0<=r;--r)this.animations.splice(t[r],1);this.state=e?"animating":"idle"}},{key:"cancel",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:null;if(null==t)this.cancelAll(n);else{for(var i=0;i<this.animations.length;i+=1){var r=this.animations[i];r.name===t&&r.cancel(n)}this.cleanAnimations()}}},{key:"cancelAll",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:null,n=0;n<this.animations.length;n+=1)this.animations[n].cancel(e);this.cleanAnimations()}},{key:"start",value:function(t){if(null==t)this.startAll();else for(var e=0;e<this.animations.length;e+=1){var n=this.animations[e];n.name===t&&"animating"!==n.state&&(n.start(),n.finishIfZeroDuration(),"animating"===n.state&&(this.state="animating"))}}},{key:"startAll",value:function(){for(var t=0;t<this.animations.length;t+=1){var e=this.animations[t];"animating"!==e.state&&(e.start(),e.finishIfZeroDuration(),"animating"===e.state&&(this.state="animating"))}}},{key:"addTo",value:function(t){for(var e=0;e<this.animations.length;e+=1){var n=this.animations[e];if(n.name===t)return n}return this.new(t)}},{key:"new",value:function(t){if("string"!=typeof t&&null!=t)return null!=t&&this.animations.push(t),t;var e={};null!=this.element&&(e.element=this.element),null!=t&&(e.name=t);var n=new ar(e);return this.animations.push(n),n}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&Zi(e.prototype,n),t}();function Ji(t){return(Ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tr(t,e,n){return(tr=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&or(r,n.prototype),r}).apply(null,arguments)}function er(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nr(t,e){return!e||"object"!==Ji(e)&&"function"!=typeof e?rr(t):e}function ir(t){return(ir=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function or(t,e){return(or=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ar=function(){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i,r={},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n instanceof _r?(i=Yt.apply(void 0,[{},r].concat(a))).element=n:i=Yt.apply(void 0,[{},r,n].concat(a)),(e=nr(this,ir(t).call(this,i))).element=i.element,nr(e,rr(e))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&or(t,e)}(t,Hi),e=t,(n=[{key:"custom",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.then(tr(Si,e)),this}},{key:"rotation",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));this.then(new Yn(r))}return this}},{key:"position",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));this.then(new an(r))}return this}},{key:"scale",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));this.then(new ei(r))}return this}},{key:"transform",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));this.then(new Hn(r))}return this}},{key:"scenario",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));this.then(r.element.anim.scenario(r))}return this}},{key:"scenarios",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));this.then(r.element.anim.scenarios(r))}return this}},{key:"color",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));this.then(new mn(r))}return this}},{key:"opacity",value:function(){if(null!=this.element){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));this.then(new jn(r))}return this}},{key:"dissolveOut",value:function(t){for(var e,n=0<arguments.length&&void 0!==t?t:{},i={element:this.element},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return e=Yt.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(o):[{},i,n].concat(o)),this.then(Bn(e)),this}},{key:"dissolveIn",value:function(t){for(var e,n=0<arguments.length&&void 0!==t?t:{},i={element:this.element},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return e=Yt.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(o):[{},i,n].concat(o)),this.then(Ln(e)),this}},{key:"dim",value:function(t){for(var e,n=0<arguments.length&&void 0!==t?t:{},i={element:this.element},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return e=Yt.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(o):[{},i,n].concat(o)),this.then(gn(e)),this}},{key:"undim",value:function(t){for(var e,n=0<arguments.length&&void 0!==t?t:{},i={element:this.element},r=arguments.length,o=new Array(1<r?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return e=Yt.apply(void 0,"number"==typeof n?[{},i,{duration:n}].concat(o):[{},i,n].concat(o)),this.then(bn(e)),this}},{key:"delay",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.then(Ki.apply(s,[e].concat(i))),this}},{key:"trigger",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.then(mi.apply(s,[e].concat(i))),this}},{key:"inParallel",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.then(Ci.apply(s,[e].concat(i))),this}},{key:"inSerial",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.then(zi.apply(s,[e].concat(i))),this}},{key:"pulse",value:function(){for(var t={element:this.element},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));return this.then(new li(r)),this}},{key:"reset",value:function(){this.steps=[],this.state="idle"}},{key:"_dup",value:function(){var e=new t;return Qt(this,e,["element"]),e.element=this.element,e}}])&&er(e.prototype,n),t}();function sr(t){return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lr(t,e){return!e||"object"!==sr(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ur(t,e,n){return(ur="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cr(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function cr(t){return(cr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gr(t,e)}function fr(t,e){return mr(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||pr()}function dr(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||vr(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pr(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function vr(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function mr(t){if(Array.isArray(t))return t}function yr(t,e,n){return(yr=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),1}catch(t){return}}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&gr(r,n.prototype),r}).apply(null,arguments)}function gr(t,e){return(gr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function br(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function xr(t,e,n){return e&&br(t.prototype,e),n&&br(t,n),t}var _r=function(){function t(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pt,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new X(-1,-1,2,2),r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;wr(this,t),this.name="",this.uid=(1e18*Math.random()).toString(36),this.isShown=!0,this.transform=n._dup(),this.isMovable=!1,this.isTouchable=!1,this.isInteractive=void 0,this.hasTouchableElements=!1,this.color=[1,1,1,1],this.dimColor=[.5,.5,.5,1],this.defaultColor=this.color.slice(),this.opacity=1,this.setTransformCallback=function(){},this.beforeDrawCallback=null,this.afterDrawCallback=null,this.internalSetTransformCallback=function(){},this.lastDrawTransform=this.transform._dup(),this.lastDrawPulseTransform=this.transform._dup(),this.onClick=null,this.lastDrawElementTransformPosition={parentCount:0,elementCount:0},this.custom={},this.parent=r,this.drawPriority=1,this.noRotationFromParent=!1,this.pulseDefault={frequency:0,scale:2,time:1},this.anim={rotation:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},{element:e}].concat(n));return new Yn(r)},scale:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},{element:e}].concat(n));return new ei(r)},trigger:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Yt.apply(void 0,[{}].concat(e));return new vi(i)},position:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},{element:e}].concat(n));return new an(r)},color:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},{elements:e}].concat(n));return new mn(r)},opacity:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},{elements:e}].concat(n));return new jn(r)},transform:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},{element:e}].concat(n));return new Hn(r)},pulse:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Yt.apply(void 0,[{},{element:this}].concat(e));return new li(i)},dissolveIn:function(t){for(var n,i=0<arguments.length&&void 0!==t?t:{},r={element:e},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n=Yt.apply(void 0,"number"==typeof i?[{},r,{duration:i}].concat(a):[{},r,i].concat(a)),new Mn(n)},dissolveOut:function(t){for(var n,i=0<arguments.length&&void 0!==t?t:{},r={element:e},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n=Yt.apply(void 0,"number"==typeof i?[{},r,{duration:i}].concat(a):[{},r,i].concat(a)),new Cn(n)},dim:function(t){for(var n,i=0<arguments.length&&void 0!==t?t:{},r={element:e},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n=Yt.apply(void 0,"number"==typeof i?[{},r,{duration:i}].concat(a):[{},r,i].concat(a)),new yn(n)},undim:function(t){for(var n,i=0<arguments.length&&void 0!==t?t:{},r={element:e},o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return n=Yt.apply(void 0,"number"==typeof i?[{},r,{duration:i}].concat(a):[{},r,i].concat(a)),new wn(n)},builder:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return yr(ar,[e].concat(n))},scenario:function(){for(var t={element:e},n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{},t].concat(i));if(null!=o.target&&o.target in o.element.scenarios){var a=o.element.getScenarioTarget(o.target);o.target=a}if(null!=o.start&&o.start in o.element.scenarios){var s=o.element.getScenarioTarget(o.start);o.start=s}if(null!=o.delta&&o.delta in o.element.scenarios){var l=o.element.getScenarioTarget(o.delta);o.delta=l}return new Hn(o)},scenarios:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},{}].concat(n)),o=e.getAllElementsWithScenario(r.target),a=[],s={};return Qt(r,s,["steps","element"]),o.forEach((function(t){a.push(t.anim.scenario(s))})),new Li(s,{steps:a})}},this.diagramLimits=i,this.move={maxTransform:this.transform.constant(1e3),minTransform:this.transform.constant(-1e3),boundary:null,maxVelocity:new dt(5,5,5),freely:{zeroVelocityThreshold:new dt(.001,.001,.001),deceleration:new dt(5,5,5),callback:null},bounce:!0,canBeMovedAfterLosingTouch:!1,type:"translation",element:null,limitLine:null,transformClip:null},this.scenarios={},this.pulseSettings={time:1,frequency:.5,A:1,B:.5,C:0,style:b,num:1,delta:new Y(0,0),transformMethod:function(t,e){return null==e||0===e.x&&0===e.y?(new pt).scale(t,t):(new pt).translate(-e.x,-e.y).scale(t,t).translate(e.x,e.y)},callback:function(){}},this.state={isBeingMoved:!1,isMovingFreely:!1,movement:{previousTime:-1,previousTransform:this.transform._dup(),velocity:this.transform.zero()},isPulsing:!1,pulse:{startTime:-1}},this.interactiveLocation=new Y(0,0),this.animations=new $i(this),this.tieToHTML={element:null,scale:"fit",window:this.diagramLimits,updateOnResize:!0},this.isRenderedAsImage=!1,this.unrenderNextDraw=!1,this.renderedOnNextDraw=!1}return xr(t,[{key:"setProperties",value:function(t,e){Xt({except:1<arguments.length&&void 0!==e?e:[]},this,t)}},{key:"updateHTMLElementTie",value:function(t){var e;if("string"==typeof this.tieToHTML.element&&(e=document.getElementById(this.tieToHTML.element)),null!=e){var n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),r=this.diagramLimits,o=this.tieToHTML.window,a=i.width/i.height,s=r.width/r.height,l=n.width/n.height,u=o.width/o.height,c=new Y(n.left-i.left,n.top-i.top),h=c.add(new Y(n.width,n.height)),f=this.diagramTransforms.pixelToDiagram,d=c.transformBy(f.m()),p=h.transformBy(f.m()),v=p.x-d.x,m=d.y-p.y,y=d.add(new Y(v/2,-m/2)),g=this.tieToHTML.scale.trim().toLowerCase(),w=1,b=1,x=r.width/o.width,_=r.height/o.height;if(g.endsWith("em")){var S=parseFloat(g),O=parseFloat(getComputedStyle(e).fontSize),k=r.width/.2;w=S*O*k/i.width,b=S*O*k/s/i.height}if(g.endsWith("px")){var T=parseFloat(g);if(1<u){var P=T/i.width;w=P*x,b=P*a/s*x}else{var A=T/i.height;w=A/a*s*_,b=A*_}}if("stretch"===g&&(w=n.width/i.width*x,b=n.height/i.height*_),"max"===g||"fit"===g){var E=new Y(n.height/i.height/a*s*_,n.height/i.height*_),j=new Y(n.width/i.width*x,n.width/i.width*a/s*x);b="max"===g&&u<l||"fit"===g&&l<u?(w=j.x,j.y):(w=E.x,E.y)}this.setScale(w,b),this.setPosition(y.x-w*(this.tieToHTML.window.left+this.tieToHTML.window.width/2),y.y-b*(this.tieToHTML.window.bottom+this.tieToHTML.window.height/2)),this.setFirstTransform(this.getParentLastDrawTransform())}}},{key:"setFirstTransform",value:function(){}},{key:"exec",value:function(t){var e,n,i;if(Array.isArray(t)){var r=mr(i=t)||vr(i)||pr();e=r[0],n=r.slice(1)}else e=t;null!=this[e]&&"function"==typeof this[e]&&(void 0===n?this[e]():this[e].apply(this,dr(n)))}},{key:"pulse",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,n={frequency:0,time:1,scale:2};"function"!=typeof this.pulseDefault&&(n.frequency=this.pulseDefault.frequency,n.time=this.pulseDefault.time,n.scale=this.pulseDefault.scale);var i,r={x:"center",y:"middle",space:"diagram",centerOn:null,frequency:n.frequency,time:n.time,scale:n.scale,done:null},o=r;"function"==typeof e?(o=r,i=e):null==e?(o=r,i=null):i=(o=Yt({},r,e)).done,"function"==typeof this.pulseDefault?this.pulseDefault(i):this.pulseScaleRelativeTo(o.centerOn,o.x,o.y,o.space,o.time,o.scale,o.frequency,i)}},{key:"pulseLegacy",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;if("function"==typeof this.pulseDefault)this.pulseDefault(e);else{var n=this.pulseDefault,i=n.frequency,r=n.time,o=n.scale;this.pulseScaleNow(r,o,i,e)}}},{key:"getElement",value:function(){return this}},{key:"getElements",value:function(){return[this]}},{key:"highlight",value:function(){this.undim()}},{key:"setPosition",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,i=K(t);"number"==typeof t&&(i=new Y(t,n));var r=this.transform._dup();r.updateTranslation(i),this.setTransform(r)}},{key:"setRotation",value:function(t){var e=this.transform._dup();e.updateRotation(t),this.setTransform(e)}},{key:"setScale",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:null,i=K(t);"number"==typeof t&&(i=new Y(t,null==n?t:n));var r=this.transform._dup();r.updateScale(i),this.setTransform(r)}},{key:"setTransform",value:function(t){null!=this.move.transformClip?this.transform=this.move.transformClip(t):this.transform=t._dup().clip(this.move.minTransform,this.move.maxTransform,this.move.limitLine),this.internalSetTransformCallback&&this.internalSetTransformCallback(this.transform),this.setTransformCallback&&this.setTransformCallback(this.transform)}},{key:"nextMovingFreelyFrame",value:function(t){if(this.state.isMovingFreely){if(this.state.movement.previousTime<0)return void(this.state.movement.previousTime=t);var e=t-this.state.movement.previousTime,n=this.decelerate(e);this.state.movement.velocity=n.velocity,this.state.movement.previousTime=t,this.state.movement.velocity.isZero()&&(this.state.movement.velocity=this.state.movement.velocity.zero(),this.stopMovingFreely(!1)),this.setTransform(n.transform)}}},{key:"clear",value:function(){}},{key:"willStartAnimating",value:function(){return!!this.animations.willStartAnimating()}},{key:"setColor",value:function(t,e){var n=!(1<arguments.length&&void 0!==e)||e;this.color=null!=t?t.slice():[0,0,0,0],n&&(this.defaultColor=this.color.slice())}},{key:"dim",value:function(){this.setColor(this.dimColor,!1)}},{key:"setDimColor",value:function(t){this.dimColor=null!=t?t.slice():[0,0,0,0]}},{key:"undim",value:function(){this.setColor(this.defaultColor,!0)}},{key:"setOpacity",value:function(t){this.opacity=t}},{key:"getScenarioTarget",value:function(t){var e=this.transform._dup();if(t in this.scenarios){var n=this.scenarios[t];null!=n.position&&e.updateTranslation(K(n.position)),null!=n.rotation&&e.updateRotation(n.rotation),null!=n.scale&&e.updateScale(K(n.scale))}return e}},{key:"setScenario",value:function(t){if(null!=this.scenarios[t]){var e=this.getScenarioTarget(t);this.setTransform(e._dup())}}},{key:"setScenarios",value:function(t){null!=this.scenarios[t]&&this.setScenario(t)}},{key:"getAllElementsWithScenario",value:function(t){return null!=this.scenarios[t]?[this]:[]}},{key:"getTimeToMoveToScenario",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,i=this.getScenarioTarget(t),r=this.transform.constant(0);return r.updateTranslation(new Y(.5,.5)),r.updateRotation(2*Math.PI/6),r.updateScale(1,1),Ot(this.transform._dup(),i,r,n)}},{key:"decelerate",value:function(t){var e=this.transform.decelerate(this.state.movement.velocity,this.move.freely.deceleration,t,this.move.freely.zeroVelocityThreshold);if(0<t){for(var n=0;n<e.t.order.length;n+=1){var i=e.t.order[n],r=this.move.minTransform.order[n],o=this.move.maxTransform.order[n],a=e.v.order[n];if(i instanceof ht&&a instanceof ht&&o instanceof ht&&r instanceof ht||i instanceof ft&&a instanceof ft&&o instanceof ft&&r instanceof ft){var s=!0;null!=this.move.limitLine&&(s=i.shaddowIsOnLine(this.move.limitLine,4)),(r.x>=i.x||o.x<=i.x||!s)&&(this.move.bounce?a.x=.5*-a.x:a.x=0),(r.y>=i.y||o.y<=i.y||!s)&&(this.move.bounce?a.y=.5*-a.y:a.y=0),e.v.order[n]=a}i instanceof ct&&a instanceof ct&&o instanceof ct&&r instanceof ct&&((r.r>=i.r||o.r<=i.r)&&(this.move.bounce?a.r=.5*-a.r:a.r=0),e.v.order[n]=a)}e.v.calcMatrix()}return{velocity:e.v,transform:e.t}}},{key:"updateLastDrawTransform",value:function(){var t=this,e=this.lastDrawElementTransformPosition.parentCount,n=this.lastDrawTransform.order.length;this.getTransform().order.forEach((function(i,r){t.lastDrawTransform.order[n-e-r-1]=i._dup()})),this.lastDrawTransform.calcMatrix()}},{key:"getParentLastDrawTransform",value:function(){var t=this.lastDrawElementTransformPosition.parentCount;return new pt(this.lastDrawTransform.order.slice(-t))}},{key:"startBeingMoved",value:function(){this.animations.cancelAll("noComplete"),this.stopMovingFreely(),this.state.movement.velocity=this.transform.zero(),this.state.movement.previousTransform=this.transform._dup(),this.state.movement.previousTime=Date.now()/1e3,this.state.isBeingMoved=!0,this.unrender()}},{key:"moved",value:function(t){this.calcVelocity(t),this.setTransform(t._dup())}},{key:"stopBeingMoved",value:function(){var t=Date.now()/1e3;-1!==this.state.movement.previousTime&&.05<t-this.state.movement.previousTime&&(this.state.movement.velocity=this.transform.zero()),this.state.isBeingMoved=!1,this.state.movement.previousTime=-1}},{key:"calcVelocity",value:function(t){var e=Date.now()/1e3;if(this.state.movement.previousTime<0)this.state.movement.previousTime=e;else{var n=e-this.state.movement.previousTime;n<1e-4||(this.state.movement.velocity=t.velocity(this.transform,n,this.move.freely.zeroVelocityThreshold,this.move.maxVelocity),this.state.movement.previousTime=e)}}},{key:"startMovingFreely",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.animations.cancelAll("noComplete"),this.stopBeingMoved(),e&&(this.move.freely.callback=e),this.state.isMovingFreely=!0,this.state.movement.previousTime=-1,this.state.movement.velocity=this.state.movement.velocity.clipMag(this.move.freely.zeroVelocityThreshold,this.move.maxVelocity)}},{key:"stopMovingFreely",value:function(t){var e=!(0<arguments.length&&void 0!==t)||t;this.state.isMovingFreely=!1,this.state.movement.previousTime=-1,this.move.freely.callback&&(this.move.freely.callback(e),this.move.freely.callback=null)}},{key:"transformWithPulse",value:function(t,e){var n=[];if(this.state.isPulsing){-1===this.state.pulse.startTime&&(this.state.pulse.startTime=t);var i=t-this.state.pulse.startTime;i>this.pulseSettings.time&&0!==this.pulseSettings.time&&(this.stopPulsing(!0),i=this.pulseSettings.time);for(var r=0;r<this.pulseSettings.num;r+=1){var o=this.pulseSettings.style(i,this.pulseSettings.frequency,this.pulseSettings.A instanceof Array?this.pulseSettings.A[r]:this.pulseSettings.A,this.pulseSettings.B instanceof Array?this.pulseSettings.B[r]:this.pulseSettings.B,this.pulseSettings.C instanceof Array?this.pulseSettings.C[r]:this.pulseSettings.C),a=this.pulseSettings.transformMethod(o,K(this.pulseSettings.delta));n.push(e.transform(a))}}else n.push(e._dup());return n}},{key:"pulseScaleNow",value:function(t,e,n,i,r){var o=2<arguments.length&&void 0!==n?n:0,a=3<arguments.length&&void 0!==i?i:null,s=4<arguments.length&&void 0!==r?r:new Y(0,0);this.pulseSettings.time=t,0===o&&0===t&&(this.pulseSettings.frequency=1),0!==o&&(this.pulseSettings.frequency=o),0!==t&&0===o&&(this.pulseSettings.frequency=1/(2*t)),this.pulseSettings.A=1,this.pulseSettings.B=e-1,this.pulseSettings.C=0,this.pulseSettings.num=1,this.pulseSettings.delta=K(s),this.pulseSettings.callback=a,this.pulseNow()}},{key:"pulseScaleRelativeToPoint",value:function(t,e,n,i,r,o){var a=4<arguments.length&&void 0!==r?r:0,s=5<arguments.length&&void 0!==o?o:null,l=this.getPosition(e),u=K(t).sub(l);this.pulseScaleNow(n,i,a,s,u)}},{key:"pulseScaleRelativeToElement",value:function(t,e,n,i,r,o,a,s){var l,u=6<arguments.length&&void 0!==a?a:0,c=7<arguments.length&&void 0!==s?s:null;l=null==t?this.getPositionInBounds(i,e,n):t.getPositionInBounds(i,e,n),this.pulseScaleRelativeToPoint(l,i,r,o,u,c)}},{key:"pulseScaleRelativeTo",value:function(e,n,i,r,o,a,s,l){var u=6<arguments.length&&void 0!==s?s:0,c=7<arguments.length&&void 0!==l?l:null;null==e||e instanceof t?this.pulseScaleRelativeToElement(e,n,i,r,o,a,u,c):this.pulseScaleRelativeToPoint(e,r,o,a,u,c)}},{key:"pulseThickNow",value:function(t,e,n,i){var r=2<arguments.length&&void 0!==n?n:3,o=3<arguments.length&&void 0!==i?i:null,a=[e];if(this.pulseSettings.num=r,1<this.pulseSettings.num){var s=Math.abs(1-e),l=s,u=(l- -s)/(this.pulseSettings.num-1);a=[];for(var c=0;c<this.pulseSettings.num;c+=1)a.push(l-c*u)}this.pulseSettings.time=t,this.pulseSettings.frequency=1/(2*t),this.pulseSettings.A=1,this.pulseSettings.B=a,this.pulseSettings.C=0,this.pulseSettings.callback=o,this.pulseNow()}},{key:"pulseNow",value:function(){this.state.isPulsing=!0,this.state.pulse.startTime=-1,this.unrender()}},{key:"stopPulsing",value:function(t){if(this.state.isPulsing=!1,this.pulseSettings.callback){var e=this.pulseSettings.callback;this.pulseSettings.callback=null,e(t)}}},{key:"stop",value:function(t,e){var n=!(0<arguments.length&&void 0!==t)||t,i=1<arguments.length&&void 0!==e&&e;!0===i||"complete"===i?this.animations.cancelAll("complete"):!1===i||"noComplete"===i?this.animations.cancelAll("noComplete"):this.animations.cancelAll(null),this.stopMovingFreely(n),this.stopBeingMoved(),this.stopPulsing(n)}},{key:"cancel",value:function(t){var e=0<arguments.length&&void 0!==t&&t;this.stop(!0,e)}},{key:"updateLimits",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:this.diagramTransforms;this.diagramLimits=t,this.diagramTransforms=n}},{key:"resize",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;e&&this.tieToHTML.updateOnResize&&this.updateHTMLElementTie(e)}},{key:"getVertexSpaceBoundaries",value:function(){return[[]]}},{key:"getGLBoundaries",value:function(){return[[]]}},{key:"getLocalBoundaries",value:function(){return[[]]}},{key:"getDiagramBoundaries",value:function(){return[[]]}},{key:"getBoundaries",value:function(t){var e=0<arguments.length&&void 0!==t?t:"local";return"local"===e?this.getLocalBoundaries():"diagram"===e?this.getDiagramBoundaries():"vertex"===e?this.getVertexSpaceBoundaries():"gl"===e?this.getGLBoundaries():[[]]}},{key:"getGLBoundingRect",value:function(){return new X(0,0,1,1)}},{key:"getLocalBoundingRect",value:function(){return new X(0,0,1,1)}},{key:"getVertexSpaceBoundingRect",value:function(){return new X(0,0,1,1)}},{key:"getDiagramBoundingRect",value:function(){var t=this.getGLBoundingRect(),e=new Y(this.diagramLimits.width/2,this.diagramLimits.height/2);return new X(t.left*e.x,t.bottom*e.y,t.width*e.x,t.height*e.y)}},{key:"getBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:"local";return"local"===e?this.getLocalBoundingRect():"diagram"===e?this.getDiagramBoundingRect():"vertex"===e?this.getVertexSpaceBoundingRect():"gl"===e?this.getGLBoundingRect():new X(0,0,1,1)}},{key:"getRelativeBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:"local",n=this.getBoundingRect(e),i=this.getPosition(e);return new X(n.left-i.x,n.bottom-i.y,n.width,n.height)}},{key:"getRelativeGLBoundingRect",value:function(){return new X(0,0,1,1)}},{key:"getRelativeDiagramBoundingRect",value:function(){var t=this.getRelativeGLBoundingRect(),e=new Y(this.diagramLimits.width/2,this.diagramLimits.height/2);return new X(t.left*e.x,t.bottom*e.y,t.width*e.x,t.height*e.y)}},{key:"getCenterDiagramPosition",value:function(){var t=this.getDiagramBoundingRect();return new Y(t.left+t.width/2,t.bottom+t.height/2)}},{key:"getScale",value:function(){var t=this.transform.s(),e=new Y(0,0);return null!=t&&(e=t._dup()),e}},{key:"getRotation",value:function(t){var e=0<arguments.length&&void 0!==t?t:"",n=this.transform.r(),i=0;return null!=n&&(i=n),""!==e&&null!=n&&(i=U(n,e)),i}},{key:"getVertexSpaceDiagramPosition",value:function(t){var e=t.transformBy(this.lastDrawTransform.matrix()),n=vt({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}});return e.transformBy(n.matrix())}},{key:"getLocalPosition",value:function(){var t=this.transform.t(),e=new Y(0,0);return null!=t&&(e=t._dup()),e}},{key:"getPositionInBounds",value:function(t,e,n){var i=0<arguments.length&&void 0!==t?t:"local",r=1<arguments.length?e:void 0,o=2<arguments.length?n:void 0,a=this.getBoundingRect(i),s=this.getPosition(i);return"left"===r?s.x=a.left:"right"===r?s.x=a.right:"center"===r?s.x=a.left+a.width/2:"number"==typeof r&&(s.x=a.left+a.width*r),"top"===o?s.y=a.top:"bottom"===o?s.y=a.bottom:"middle"===o?s.y=a.bottom+a.height/2:"number"==typeof o&&(s.y=a.bottom+a.height*o),s}},{key:"getPosition",value:function(t,e,n){var i=0<arguments.length&&void 0!==t?t:"local",r=1<arguments.length&&void 0!==e?e:"origin",o=2<arguments.length&&void 0!==n?n:"origin";return"origin"===r&&"origin"===o||this.getPositionInBounds(i,r,o),"vertex"===i?new Y(0,0):"local"===i?this.getLocalPosition():"diagram"===i?this.getVertexSpaceDiagramPosition(new Y(0,0)):"gl"===i?new Y(0,0).transformBy(this.lastDrawTransform.matrix()):new Y(0,0)}},{key:"getPixelToVertexSpaceScale",value:function(){var t=this.diagramTransforms.pixelToDiagram.matrix(),e=this.diagramSpaceToVertexSpaceTransformMatrix(),n=t[0]*e[0],i=t[4]*e[4];return new Y(n,i)}},{key:"getVertexToPixelSpaceScale",value:function(){var t=this.getPixelToVertexSpaceScale();return new Y(1/t.x,1/t.y)}},{key:"getDiagramPositionInVertexSpace",value:function(t){return t.transformBy(this.diagramSpaceToVertexSpaceTransformMatrix())}},{key:"diagramSpaceToVertexSpaceTransformMatrix",value:function(){return D(new pt(this.lastDrawTransform.order.slice(this.lastDrawElementTransformPosition.elementCount,this.lastDrawTransform.order.length-2)).matrix())}},{key:"vertexToDiagramSpaceTransformMatrix",value:function(){return new pt(this.lastDrawTransform.order.slice(0,this.lastDrawTransform.order.length-2)).matrix()}},{key:"setDiagramPosition",value:function(t){var e=vt({x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}},{x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}}),n=t.transformBy(e.matrix()),i=new pt(this.lastDrawTransform.order.slice(this.transform.order.length)),r=n.transformBy(D(i.matrix()));this.setPosition(r._dup())}},{key:"setDiagramPositionToElement",value:function(t){var e=t.getPosition("diagram");this.setDiagramPosition(e._dup())}},{key:"setPositionToElement",value:function(t){var e=t.transform.t();null!=e&&this.setPosition(e._dup())}},{key:"setMoveBoundaryToDiagram",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:this.move.boundary,i=1<arguments.length&&void 0!==e?e:new Y(1,1);if(this.isMovable&&(null!=n&&(this.move.boundary=n),null!=this.move.boundary)){var r;if(Array.isArray(this.move.boundary)){var o=fr(this.move.boundary,4),a=o[0],s=o[1],l=o[2],u=o[3];r=new X(a,s,l,u)}else r="diagram"===this.move.boundary?this.diagramLimits:this.move.boundary;var c=vt({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}}),h=this.getRelativeGLBoundingRect(),f=[c.matrix()[0],0,0,0,c.matrix()[4],0,0,0,1],d=new Y(h.left,h.bottom).transformBy(f),p=new Y(h.right,h.top).transformBy(f),v=new Y(0,0),m=new Y(0,0);v.x=r.left-d.x*i.x,v.y=r.bottom-d.y*i.y,m.x=r.right-p.x*i.x,m.y=r.top-p.y*i.y,this.move.maxTransform.updateTranslation(m.x,m.y),this.move.minTransform.updateTranslation(v.x,v.y)}}},{key:"show",value:function(){this.isShown=!0,this.setOpacity(1),null!=this.parent&&(this.parent.isShown||this.parent.show())}},{key:"makeTouchable",value:function(t){0<arguments.length&&void 0!==t&&!t?this.hasTouchableElements=!0:this.isTouchable=!0,null!=this.parent&&this.parent.makeTouchable(!1)}},{key:"setMovable",value:function(t){0<arguments.length&&void 0!==t&&!t?(this.isMovable=!1,this.isTouchable=!1):(this.isMovable=!0,this.makeTouchable(!0))}},{key:"clearRender",value:function(){var t,e="";if("string"==typeof this.tieToHTML.element&&(e=this.tieToHTML.element,t=document.getElementById(this.tieToHTML.element)),t){var n=document.getElementById("".concat(e,"_webgl"));null!=n&&(n.style.display="none");var i=document.getElementById("".concat(e,"_2d"));null!=i&&(i.style.display="none")}}},{key:"setRenderedOnNextDraw",value:function(){this.renderedOnNextDraw=!0}},{key:"unrender",value:function(){this.isRenderedAsImage&&(this.unrenderNextDraw=!0,this.isRenderedAsImage=!1),null!=this.parent&&this.parent.unrender()}},{key:"showAll",value:function(){this.show()}},{key:"hide",value:function(){this.isShown=!1}},{key:"hideAll",value:function(){this.hide()}},{key:"toggleShow",value:function(){this.isShown?this.hide():this.show()}},{key:"click",value:function(){null!==this.onClick&&void 0!==this.onClick&&this.onClick(this)}},{key:"getTransform",value:function(){return this.transform}}]),t}(),Sr=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new pt,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[.5,.5,.5,1],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new X(-1,-1,2,2),a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;return wr(this,t),(n=lr(this,cr(t).call(this,i,o,a))).drawingObject=e,n.color=null!=r?r.slice():[0,0,0,0],n.defaultColor=n.color.slice(),n.dimColor=[.5,.5,.5,1],n.pointsToDraw=-1,n.angleToDraw=-1,n.lengthToDraw=-1,n.cannotTouchHole=!1,n.type="primitive",n}return hr(t,_r),xr(t,[{key:"setAngleToDraw",value:function(t){var e=0<arguments.length&&void 0!==t?t:-1;this.angleToDraw=e}},{key:"isBeingTouched",value:function(t){if(!this.isTouchable)return!1;for(var e=this.drawingObject.getGLBoundaries(this.lastDrawTransform.matrix()),n=this.drawingObject.getGLBoundaryHoles(this.lastDrawTransform.matrix()),i=0;i<e.length;i+=1){var r=e[i];if(t.isInPolygon(r)){var o=!0;if(this.cannotTouchHole)for(var a=0;a<n.length;a+=1){var s=n[a];Array.isArray(s)&&2<s.length&&t.isInPolygon(s)&&(o=!1,a=n.length)}if(o)return!0}}return!1}},{key:"_dup",value:function(e){var n=0<arguments.length&&void 0!==e?e:null,i=new t(this.drawingObject._dup());return Qt(this,i,["parent"]),null!=n&&(i.transform=n._dup()),i}},{key:"clear",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;this.drawingObject instanceof je&&this.drawingObject.clear(e)}},{key:"resize",value:function(e){var n=0<arguments.length&&void 0!==e?e:null;if(this.resizeHtmlObject(),ur(cr(t.prototype),"resize",this).call(this,n),"vertexText"===this.drawingObject.type){var i=this.getPixelToVertexSpaceScale();this.drawingObject.drawTextIntoBuffer(new Y(i.x,Math.abs(i.y)))}}},{key:"setColor",value:function(e,n){var i=!(1<arguments.length&&void 0!==n)||n;this.color=null!=e?e.slice():[0,0,0,0],i&&(this.defaultColor=this.color.slice()),this instanceof t&&(this.drawingObject instanceof je&&this.drawingObject.setColor(this.color),this.drawingObject instanceof he&&(this.drawingObject.element.style.color=Ne(this.color)))}},{key:"setOpacity",value:function(e){this.opacity=e,this instanceof t&&(this.drawingObject instanceof je&&this.drawingObject.setOpacity(e),this.drawingObject instanceof he&&(this.drawingObject.element.style.opacity="".concat(e)))}},{key:"show",value:function(){ur(cr(t.prototype),"show",this).call(this),this.drawingObject instanceof he&&(this.drawingObject.show=!0,this.drawingObject.transformHtml(this.lastDrawTransform.matrix()))}},{key:"hide",value:function(){ur(cr(t.prototype),"hide",this).call(this),this.drawingObject instanceof he&&(this.drawingObject.show=!1,this.drawingObject.transformHtml(this.lastDrawTransform.matrix()))}},{key:"getTouched",value:function(t){return this.isTouchable&&this.isBeingTouched(t)?[this]:[]}},{key:"setFont",value:function(t){this.drawingObject instanceof je&&this.drawingObject.setFont(t)}},{key:"resizeHtmlObject",value:function(){this.drawingObject instanceof he&&this.drawingObject.transformHtml(this.lastDrawTransform.matrix())}},{key:"draw",value:function(t,e,n){var i=this,r=0<arguments.length&&void 0!==t?t:new pt,o=1<arguments.length&&void 0!==e?e:0,a=2<arguments.length&&void 0!==n?n:0;if(this.isShown){if(!0===this.isRenderedAsImage){if(!this.willStartAnimating())return;this.unrender()}if(null!=this.beforeDrawCallback&&this.beforeDrawCallback(o),this.animations.nextFrame(o),this.nextMovingFreelyFrame(o),!this.isShown)return;this.lastDrawElementTransformPosition={parentCount:r.order.length,elementCount:this.transform.order.length};var s=r.transform(this.getTransform());this.lastDrawTransform=s._dup();var l=this.transformWithPulse(o,s);this.lastDrawPulseTransform=l[0];var u=-1;this.drawingObject instanceof ye?(u=this.drawingObject.numPoints,-1!==this.angleToDraw&&(u=this.drawingObject.getPointCountForAngle(this.angleToDraw)),-1!==this.lengthToDraw&&(u=this.drawingObject.getPointCountForLength(this.lengthToDraw)),-1!==this.pointsToDraw&&(u=this.pointsToDraw)):u=1;var c=[].concat(dr(this.color.slice(0,3)),[this.color[3]*this.opacity]);0<u&&l.forEach((function(t){i.drawingObject.drawWithTransformMatrix(t.matrix(),c,a,u)})),this.unrenderNextDraw&&(this.clearRender(),this.unrenderNextDraw=!1),this.renderedOnNextDraw&&(this.isRenderedAsImage=!0,this.renderedOnNextDraw=!1),null!=this.afterDrawCallback&&this.afterDrawCallback(o)}}},{key:"setFirstTransform",value:function(t){var e=0<arguments.length&&void 0!==t?t:new pt;this.lastDrawElementTransformPosition={parentCount:e.order.length,elementCount:this.transform.order.length};var n=e.transform(this.getTransform());this.lastDrawTransform=n,this.drawingObject instanceof he&&this.drawingObject.transformHtml(n.matrix()),this.setMoveBoundaryToDiagram()}},{key:"isMoving",value:function(){return!!(this.state.isMovingFreely||this.state.isBeingMoved||this.state.isPulsing||this.animations.willStartAnimating())}},{key:"getVertexSpaceBoundaries",value:function(){return this.drawingObject.border}},{key:"getLocalBoundaries",value:function(){return this.drawingObject.getGLBoundaries(this.getTransform().matrix())}},{key:"getDiagramBoundaries",value:function(){return this.drawingObject.getGLBoundaries(this.vertexToDiagramSpaceTransformMatrix())}},{key:"getGLBoundaries",value:function(){return this.drawingObject.getGLBoundaries(this.lastDrawTransform.matrix())}},{key:"getVertexSpaceBoundingRect",value:function(){return this.drawingObject.getVertexSpaceBoundingRect()}},{key:"getLocalBoundingRect",value:function(){return this.drawingObject.getGLBoundingRect(this.getTransform().matrix())}},{key:"getGLBoundingRect",value:function(){return this.drawingObject.getGLBoundingRect(this.lastDrawTransform.matrix())}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){return this.drawingObject.getRelativeVertexSpaceBoundingRect()}},{key:"getRelativeGLBoundingRect",value:function(){return this.drawingObject.getRelativeGLBoundingRect(this.lastDrawTransform.matrix())}},{key:"getRelativeLocalBoundingRect",value:function(){return this.drawingObject.getRelativeGLBoundingRect(this.getTransform().matrix())}},{key:"increaseBorderSize",value:function(t,e){var n,i,r=0<arguments.length&&void 0!==t?t:1,o=1<arguments.length&&void 0!==e?e:null;if(i=r instanceof Y?(n=r.x,r.y):(n=r,null==o?n:o),this.drawingObject instanceof ye)for(var a=0;a<this.drawingObject.border.length;a+=1)for(var s=this.drawingObject.border[a],l=0;l<s.length;l+=1)s[l].x*=n,s[l].y*=i}}]),t}(),Or=function(){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new pt,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new X(-1,1,2,2),r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return wr(this,t),(e=lr(this,cr(t).call(this,n,i,r))).elements={},e.drawOrder=[],e.touchInBoundingRect=!1,e.eqns={},e.type="collection",e}return hr(t,_r),xr(t,[{key:"_dup",value:function(){var e=new t,n=this.drawOrder.map((function(t){return"_".concat(t)}));Qt(this,e,["elements","drawOrder","parent"].concat(dr(n)));for(var i=0;i<this.drawOrder.length;i+=1){var r=this.drawOrder[i];e.add(r,this.elements[r]._dup())}return e}},{key:"toFront",value:function(t){var e=[];t.forEach((function(t){"string"==typeof t?e.push(t):e.push(t.name)}));var n=[];this.drawOrder.forEach((function(t){-1===e.indexOf(t)&&n.push(t)})),this.drawOrder=[].concat(n,e)}},{key:"toBack",value:function(t){var e=[];t.forEach((function(t){"string"==typeof t?e.push(t):e.push(t.name)}));var n=[];this.drawOrder.forEach((function(t){-1===e.indexOf(t)&&n.push(t)})),this.drawOrder=[].concat(dr(e.reverse()),n)}},{key:"isMoving",value:function(){if(!1===this.isShown)return!1;if(this.state.isMovingFreely||this.state.isBeingMoved||this.state.isPulsing||"animating"===this.animations.state)return!0;for(var e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];if(n instanceof t){if(n.isMoving())return!0}else if(n.isShown&&0<n.color[3]&&n.isMoving())return!0}return!1}},{key:"add",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:-1;(e.parent=this).elements[t]=e,this.elements[t].name=t,this["_".concat(t)]=this.elements[t],-1!==i?this.drawOrder=[].concat(dr(this.drawOrder.slice(0,i)),[t],dr(this.drawOrder.slice(i))):this.drawOrder.push(t)}},{key:"willStartAnimating",value:function(){if(ur(cr(t.prototype),"willStartAnimating",this).call(this))return!0;for(var e=0,n=this.drawOrder.length;e<n;e+=1)if(this.elements[this.drawOrder[e]].willStartAnimating())return!0;return!1}},{key:"draw",value:function(t,e,n){var i=0<arguments.length&&void 0!==t?t:new pt,r=1<arguments.length&&void 0!==e?e:0,o=2<arguments.length&&void 0!==n?n:0;if(this.isShown){if(!0===this.isRenderedAsImage){if(!this.willStartAnimating())return;this.unrender()}if(null!=this.beforeDrawCallback&&this.beforeDrawCallback(r),this.animations.nextFrame(r),this.nextMovingFreelyFrame(r),!this.isShown)return;this.lastDrawElementTransformPosition={parentCount:i.order.length,elementCount:this.transform.order.length};var a=i.transform(this.getTransform());this.lastDrawTransform=a._dup();var s=this.transformWithPulse(r,a);this.lastDrawPulseTransform=s[0];for(var l=0;l<s.length;l+=1)for(var u=0,c=this.drawOrder.length;u<c;u+=1)this.elements[this.drawOrder[u]].draw(s[l],r,o);this.unrenderNextDraw&&(this.clearRender(),this.unrenderNextDraw=!1),this.renderedOnNextDraw&&(this.isRenderedAsImage=!0,this.renderedOnNextDraw=!1),null!=this.afterDrawCallback&&this.afterDrawCallback(r)}}},{key:"exec",value:function(e,n){var i=this,r=1<arguments.length&&void 0!==n?n:null;null!=r?Array.isArray(r)&&0===r.length||r.forEach((function(t){var n;null!=(n="string"==typeof t?i.getElement(t):t)&&n.exec(e)})):ur(cr(t.prototype),"exec",this).call(this,e)}},{key:"pulse",value:function(e,n){var i=this,r=0<arguments.length&&void 0!==e?e:null,o=1<arguments.length&&void 0!==n?n:null;if(null!=r&&"function"!=typeof r){var a={frequency:0,time:1,scale:2};"function"!=typeof this.pulseDefault&&(a.frequency=this.pulseDefault.frequency,a.time=this.pulseDefault.time,a.scale=this.pulseDefault.scale);var s,l,u,c={x:"center",y:"middle",space:"diagram",centerOn:null,frequency:a.frequency,time:a.time,scale:a.scale,done:null,elements:null};if(Array.isArray(r)?(l=c,s=o,u=r):(l=Yt({},c,r),u=l.elements,s=l.done,null==r.scale&&(l.scale=void 0),null==r.frequency&&(l.frequency=void 0),null==r.time&&(l.time=void 0)),(l.elements=null)!=u&&0!==u.length){var h=0;l.done=function(){(h+=1)===u.length&&null!=s&&s()},u.forEach((function(t){var e;null!=(e="string"==typeof t?i.getElement(t):t)&&e.pulse(l)}))}else ur(cr(t.prototype),"pulse",this).call(this,r)}else ur(cr(t.prototype),"pulse",this).call(this,r)}},{key:"pulseLegacy",value:function(e,n){var i=this;if(null!=e&&"function"!=typeof e){var r=1<arguments.length&&void 0!==n?n:null;e.forEach((function(t){var e;null!=(e="string"==typeof t?i.getElement(t):t)&&(e.pulse(r),r=null)})),null!=r&&r()}else ur(cr(t.prototype),"pulse",this).call(this,e)}},{key:"getElement",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(null==t)return this;if("string"!=typeof t)return t;function e(t,n){var i=t.split("."),r=n.elements[i[0]];return null==r&&(r=n[i[0]]),null==r?null:1<i.length?e(i.slice(1).join("."),r):r}return e(t,this)}},{key:"getElements",value:function(t){var e=this,n=[];return t.forEach((function(t){var i=e.getElement(t);null!=i&&n.push(i)})),n}},{key:"show",value:function(e){var n=0<arguments.length&&void 0!==e?e:[];ur(cr(t.prototype),"show",this).call(this),n.forEach((function(e){e instanceof t?e.showAll():e.show()}))}},{key:"hide",value:function(e){var n=0<arguments.length&&void 0!==e?e:[];ur(cr(t.prototype),"hide",this).call(this),n.forEach((function(e){e instanceof t?e.hideAll():e.show()}))}},{key:"showAll",value:function(){this.show();for(var t=0,e=this.drawOrder.length;t<e;t+=1){var n=this.elements[this.drawOrder[t]];n.show(),"function"==typeof n.hideAll&&n.showAll()}}},{key:"hideAll",value:function(){this.hide();for(var t=0,e=this.drawOrder.length;t<e;t+=1){var n=this.elements[this.drawOrder[t]];n.hide(),"function"==typeof n.hideAll&&n.hideAll()}}},{key:"showOnly",value:function(t){this.hideAll(),this.show();for(var e=0,n=t.length;e<n;e+=1){var i=t[e];if(!i)throw Error("Diagram Element Error: Element does not exist at position ".concat(e));i.show()}}},{key:"hideOnly",value:function(t){this.showAll();for(var e=0,n=t.length;e<n;e+=1)t[e].hide()}},{key:"isBeingTouched",value:function(t){if(!this.isTouchable)return!1;if(this.touchInBoundingRect){var e=this.getGLBoundingRect();if(t.x>=e.left&&t.x<=e.right&&t.y<=e.top&&t.y>=e.bottom)return!0}for(var n=0,i=this.drawOrder.length;n<i;n+=1){var r=this.elements[this.drawOrder[n]];if(!0===r.isShown&&r.isBeingTouched(t))return!0}return!1}},{key:"resizeHtmlObject",value:function(){for(var t=0;t<this.drawOrder.length;t+=1)this.elements[this.drawOrder[t]].resizeHtmlObject()}},{key:"resize",value:function(e){var n=0<arguments.length&&void 0!==e?e:null;ur(cr(t.prototype),"resize",this).call(this,n);for(var i=0;i<this.drawOrder.length;i+=1)this.elements[this.drawOrder[i]].resize(n)}},{key:"clear",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].clear(e)}},{key:"setFirstTransform",value:function(t){var e=(0<arguments.length&&void 0!==t?t:new pt).transform(this.getTransform());this.lastDrawTransform=e;for(var n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].setFirstTransform(e);this.setMoveBoundaryToDiagram()}},{key:"getAllBoundaries",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:"local",n=[],i=0;i<this.drawOrder.length;i+=1){var r=this.elements[this.drawOrder[i]];if(r.isShown){var o=r.getBoundaries(e);n=n.concat(o)}}return n}},{key:"getBoundaries",value:function(t,e){var n=this,i=0<arguments.length&&void 0!==t?t:"local",r=1<arguments.length&&void 0!==e?e:null,o=[];return null==r?this.getAllBoundaries(i):(r.forEach((function(t){var e=n.getElement(t);if(null!=e){var r=e.getBoundaries(i);o=o.concat(r)}})),o)}},{key:"getGLBoundaries",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];if(n.isShown){var i=n.getGLBoundaries();t=t.concat(i)}}return t}},{key:"getVertexSpaceBoundaries",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];if(n.isShown){var i=n.getVertexSpaceBoundaries();t=t.concat(i)}}return t}},{key:"getPositionInBounds",value:function(t,e,n,i){var r=0<arguments.length&&void 0!==t?t:"local",o=1<arguments.length?e:void 0,a=2<arguments.length?n:void 0,s=3<arguments.length&&void 0!==i?i:null,l=this.getBoundingRect(r,s),u=this.getPosition(r);return"left"===o?u.x=l.left:"right"===o?u.x=l.right:"center"===o?u.x=l.left+l.width/2:"number"==typeof o&&(u.x=l.left+l.width*o),"top"===a?u.y=l.top:"bottom"===a?u.y=l.bottom:"middle"===a?u.y=l.bottom+l.height/2:"number"==typeof a&&(u.y=l.bottom+l.height*a),u}},{key:"getBoundingRect",value:function(t,e){var n=this,i=0<arguments.length&&void 0!==t?t:"local",r=1<arguments.length&&void 0!==e?e:null;if(null==r)return bt(this.getBoundaries(i));var o=[];return r.forEach((function(t){var e=n.getElement(t);if(null!=e){var i=e.getBoundingRect();o.push(new Y(i.left,i.bottom)),o.push(new Y(i.right,i.top))}})),bt(o)}},{key:"getGLBoundingRect",value:function(){return bt(this.getGLBoundaries())}},{key:"getVertexSpaceBoundingRect",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:null;if(null==n)return bt(this.getVertexSpaceBoundaries());var i=[];return n.forEach((function(t){var n=e.getElement(t);if(null!=n){var r=n.getBoundingRect();i.push(new Y(r.left,r.bottom)),i.push(new Y(r.right,r.top))}})),bt(i)}},{key:"getRelativeGLBoundingRect",value:function(){var t=this.getGLBoundingRect(),e=new Y(0,0).transformBy(this.lastDrawTransform.matrix());return new X(t.left-e.x,t.bottom-e.y,t.width,t.height)}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){var t=this.getVertexSpaceBoundingRect(),e=new Y(0,0);return new X(t.left-e.x,t.bottom-e.y,t.width,t.height)}},{key:"updateLimits",value:function(t,e){for(var n=1<arguments.length&&void 0!==e?e:this.diagramTransforms,i=0;i<this.drawOrder.length;i+=1)this.elements[this.drawOrder[i]].updateLimits(t,n);this.diagramLimits=t,this.diagramTransforms=n}},{key:"updateHTMLElementTie",value:function(e){ur(cr(t.prototype),"updateHTMLElementTie",this).call(this,e);for(var n=0;n<this.drawOrder.length;n+=1)this.elements[this.drawOrder[n]].updateHTMLElementTie(e)}},{key:"getTouched",value:function(t){if(!this.isTouchable&&!this.hasTouchableElements)return[];var e=[];(this.touchInBoundingRect||this.isTouchable)&&this.isBeingTouched(t)&&e.push(this);for(var n=this.drawOrder.length-1;0<=n;--n){var i=this.elements[this.drawOrder[n]];!0===i.isShown&&(e=e.concat(i.getTouched(t)))}return e}},{key:"stop",value:function(e,n){var i=!(0<arguments.length&&void 0!==e)||e,r=1<arguments.length&&void 0!==n&&n;ur(cr(t.prototype),"stop",this).call(this,i,r);for(var o=0;o<this.drawOrder.length;o+=1)this.elements[this.drawOrder[o]].stop(i,r)}},{key:"setFont",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setFont(t)}},{key:"setColor",value:function(t,e){for(var n=0<arguments.length&&void 0!==t?t:[0,0,0,1],i=!(1<arguments.length&&void 0!==e)||e,r=null!=n?n:[0,0,0,0],o=0;o<this.drawOrder.length;o+=1)this.elements[this.drawOrder[o]].setColor(r,i);this.color=r.slice(),i&&(this.defaultColor=this.color.slice())}},{key:"setDimColor",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:[0,0,0,1],n=null!=e?e:[0,0,0,0],i=0;i<this.drawOrder.length;i+=1)this.elements[this.drawOrder[i]].setDimColor(n);this.dimColor=n.slice()}},{key:"undim",value:function(){this.color=this.defaultColor.slice();for(var t=0;t<this.drawOrder.length;t+=1)this.elements[this.drawOrder[t]].undim()}},{key:"dim",value:function(t){if(null==t||Array.isArray(t)&&0===t.length){this.color=this.dimColor.slice();for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].dim()}else this.exec("dim",t)}},{key:"highlight",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;null!=e?Array.isArray(e)&&0===e.length||(this.dim(),this.exec("undim",e)):this.undim()}},{key:"getDiagramBoundingRect",value:function(e){var n=this,i=0<arguments.length&&void 0!==e?e:null;if(null==i)return ur(cr(t.prototype),"getDiagramBoundingRect",this).call(this);var r=[];return i.forEach((function(t){var e;if(null!=(e="string"==typeof t?n.getElement(t):t)){var i=e.getDiagramBoundingRect();r.push(new Y(i.left,i.bottom)),r.push(new Y(i.right,i.top))}})),bt(r)}},{key:"setOpacity",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setOpacity(t);this.opacity=t}},{key:"getElementTransforms",value:function(){for(var t={},e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];t[n.name]=n.transform._dup()}return t}},{key:"setElementTransforms",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];n.name in t&&(n.transform=t[n.name],n.internalSetTransformCallback&&n.internalSetTransformCallback(n.transform))}}},{key:"reorder",value:function(){var e=this;this.drawOrder.sort((function(t,n){var i=e.elements[t];return e.elements[n].drawPriority-i.drawPriority}));for(var n=0;n<this.drawOrder.length;n+=1){var i=this.elements[this.drawOrder[n]];i instanceof t&&i.reorder()}}},{key:"animateToTransforms",value:function(t,e,n,i,r,o){for(var a=1<arguments.length&&void 0!==e?e:1,s=2<arguments.length&&void 0!==n?n:0,l=3<arguments.length&&void 0!==i?i:0,u=5<arguments.length&&void 0!==o?o:y,c=4<arguments.length&&void 0!==r?r:null,h=0,f=0;f<this.drawOrder.length;f+=1){var d=this.elements[this.drawOrder[f]];d.name in t&&(d.isShown?t[d.name].isEqualTo(d.transform)||(d.animations.new().delay(s).transform({target:t[d.name],duration:a,rotDirection:l,progression:u,onFinish:c}).start(),c=null,h=a+s):(d.transform=t[d.name]._dup(),d.internalSetTransformCallback&&d.internalSetTransformCallback(d.transform)))}return 0===h&&null!=c&&c(!0),h}},{key:"getAllPrimitives",value:function(){for(var e=[],n=0;n<this.drawOrder.length;n+=1){var i=this.elements[this.drawOrder[n]];i instanceof t?e=[].concat(dr(e),dr(i.getAllElements())):e.push(i)}return e}},{key:"getAllElements",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];t.push(n)}return t}},{key:"getAllElementsWithScenario",value:function(e){for(var n=ur(cr(t.prototype),"getAllElementsWithScenario",this).call(this,e),i=0;i<this.drawOrder.length;i+=1){var r=this.elements[this.drawOrder[i]];null!=r.scenarios[e]&&n.push(r),r instanceof t&&(n=[].concat(dr(n),dr(r.getAllElementsWithScenario(e))))}return n}},{key:"getAllPossiblyInteractiveElements",value:function(){for(var e=[],n=0;n<this.drawOrder.length;n+=1){var i=this.elements[this.drawOrder[n]];i instanceof t&&(i.isTouchable||i.isMovable||!i.hasTouchableElements||i.isInteractive&&null!=i.isInteractive||(e=[].concat(dr(e),dr(i.getAllPossiblyInteractiveElements())))),(void 0!==i.isInteractive||i.isTouchable||i.isMovable)&&e.push(i)}return e}},{key:"goToStep",value:function(t){var e=document.getElementById("id__figureone_item_selector_0"),n=[];if(null!=e&&0<e.children.length)for(var i=0;i<e.children.length;i+=1)n.push(e.children[i]);n.forEach((function(e,n){n===t?e.classList.add("figureone__item_selector_selected"):e.classList.remove("figureone__item_selector_selected")}))}},{key:"setMovable",value:function(e){var n=!(0<arguments.length&&void 0!==e)||e;ur(cr(t.prototype),"setMovable",this).call(this,n),n&&(this.hasTouchableElements=!0)}},{key:"setupWebGLBuffers",value:function(t){for(var e=0;e<this.drawOrder.length;e+=1)this.elements[this.drawOrder[e]].setupWebGLBuffers(t)}},{key:"changeWebGLInstance",value:function(t){for(var e,n=0;n<this.drawOrder.length;n+=1)e=this.elements[this.drawOrder[n]].changeWebGLInstance(t);return e}},{key:"getLoadingElements",value:function(){for(var t=[],e=0;e<this.drawOrder.length;e+=1){var n=this.elements[this.drawOrder[e]];n instanceof Sr?"loading"===n.drawingObject.state&&t.push(n):t=[].concat(dr(t),dr(n.getLoadingElements()))}return t}},{key:"unrenderAll",value:function(){this.unrender();for(var t=0;t<this.drawOrder.length;t+=1){var e=this.elements[this.drawOrder[t]];e instanceof Sr?e.unrender():e.unrenderAll()}}},{key:"setScenarios",value:function(e,n){var i=1<arguments.length&&void 0!==n&&n;ur(cr(t.prototype),"setScenarios",this).call(this,e);for(var r=0;r<this.drawOrder.length;r+=1){var o=this.elements[this.drawOrder[r]];(i&&o.isShown||!1===i)&&o.setScenarios(e,i)}}}]),t}();function kr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Tr=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.instance||(this.requestNextAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,(t.instance=this).drawQueue=[],this.nextDrawQueue=[]),t.instance}var e,n;return e=t,(n=[{key:"draw",value:function(t){this.drawQueue=this.nextDrawQueue,this.nextDrawQueue=[];for(var e=.001*t,n=0;n<this.drawQueue.length;n+=1)this.drawQueue[n](e);this.drawQueue=[]}},{key:"queueNextFrame",value:function(t){this.nextDrawQueue.push(t),1===this.nextDrawQueue.length&&this.animateNextFrame()}},{key:"animateNextFrame",value:function(){cancelAnimationFrame(this.animationId);var t=this.requestNextAnimationFrame.call(window,this.draw.bind(this));this.animationId=t}}])&&kr(e.prototype,n),t}();function Pr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Ar=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.diagram=e,this.addEvent("mousedown",this.mouseDownHandler,!1),this.addEvent("mouseup",this.mouseUpHandler,!1),this.addEvent("mousemove",this.mouseMoveHandler,!1),this.addEvent("touchstart",this.touchStartHandler,!1),this.addEvent("touchend",this.touchEndHandler,!1),this.addEvent("touchmove",this.touchMoveHandler,!1),this.enable=!0,this.start=this.diagram.touchDownHandler.bind(this.diagram),this.end=this.diagram.touchUpHandler.bind(this.diagram),this.move=this.diagram.touchMoveHandler.bind(this.diagram)}var e,n;return e=t,(n=[{key:"addEvent",value:function(t,e,n){this.diagram.gestureCanvas.addEventListener(t,e.bind(this),n)}},{key:"removeEvent",value:function(t,e,n){this.diagram.gestureCanvas.removeEventListener(t,e.bind(this),n)}},{key:"startHandler",value:function(t){return!!this.enable&&(this.mouseDown=!0,this.previousPoint=t,this.start(t))}},{key:"endHandler",value:function(){this.mouseDown=!1,this.end()}},{key:"moveHandler",value:function(t,e){this.enable&&this.mouseDown&&(this.move(this.previousPoint,e)&&t.preventDefault(),this.previousPoint=e)}},{key:"touchStartHandler",value:function(t){var e=t.touches[0];this.startHandler(new Y(e.clientX,e.clientY))&&t.preventDefault()}},{key:"mouseDownHandler",value:function(t){this.startHandler(new Y(t.clientX,t.clientY))&&t.preventDefault()}},{key:"touchMoveHandler",value:function(t){var e=t.touches[0];this.moveHandler(t,new Y(e.clientX,e.clientY))}},{key:"mouseMoveHandler",value:function(t){this.moveHandler(t,new Y(t.clientX,t.clientY))}},{key:"mouseUpHandler",value:function(){this.endHandler()}},{key:"touchEndHandler",value:function(){this.endHandler()}},{key:"destroy",value:function(){this.removeEvent("mousedown",this.mouseDownHandler,!1),this.removeEvent("mouseup",this.mouseUpHandler,!1),this.removeEvent("mousemove",this.mouseMoveHandler,!1),this.removeEvent("touchstart",this.touchStartHandler,!1),this.removeEvent("touchend",this.touchEndHandler,!1),this.removeEvent("touchmove",this.touchMoveHandler,!1)}}])&&Pr(e.prototype,n),t}();function Er(t,e){var n=1<arguments.length&&void 0!==e?e:null,i="",r="";return null!=n&&(r=' style="margin-top:'.concat(n,'%"')),Array.isArray(t)?t.forEach((function(t,e){t.startsWith("<")?i+=t:i+=0===e?'<p style="margin-top:'.concat(r,'">').concat(t,"</p>"):"<p>".concat(t,"</p>")})):i=t,i}function jr(){var t=1<arguments.length?arguments[1]:void 0,e=Er(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"");return'<div class="'.concat(t,'">').concat(e,"</div>")}function Mr(){var t=Er(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",0);return'<div style="display: table; height: 100%; width: 100%;">\n        <div style="display: table-cell; vertical-align: middle; height: 100%; width: 100%;">\n        '.concat(t,"</div></div>")}function Lr(){var t=Er(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",0);return'<div style="display: table; height: 100%; text-align:center; width:100%;">\n        <div style="display: table-cell; vertical-align: middle; height: 100%; width: 100%;">\n        '.concat(t,"</div></div>")}function Cr(){var t=Er(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"");return'<div style="text-align:center;">\n        '.concat(t,"</div>")}function Br(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n="",i="",r="",o="",a="",s="",l="",u="";"number"==typeof t?r="margin-top:".concat(t,"%"):(null!=t.left&&(n="margin-left:".concat(t.left,"%;")),null!=t.right&&(i="margin-right:".concat(t.right,"%;")),t.centerV&&(r="margin-top:0;"),null!=t.top&&(r="margin-top:".concat(t.top,"%;")),null!=t.line&&(o="margin-top:".concat(t.line,"%;")),null!=t.size&&(a="font-size:".concat(t.size,"em;")),t.className&&(s='class="'.concat(t.className,'"')),t.color&&(l="color:".concat(Ne(t.color),";")),t.listStyleType&&(u="list-style-type:".concat(t.listStyleType,";")));var c,h='<p style="'.concat(n).concat(i).concat(o).concat(a).concat(l,'"').concat(s,">"),f='<p style="'.concat(n).concat(i).concat(r).concat(a).concat(l,'"').concat(s,">"),d='<li style="'.concat(n).concat(i).concat(o).concat(a).concat(l).concat(u,'"').concat(s,">"),p='<ul style="'.concat(n).concat(i).concat(r).concat(a).concat(l,'"').concat(s,">"),v='<ol style="'.concat(n).concat(i).concat(r).concat(a).concat(l,'"').concat(s,">");return c=null!=t.list?(c=Array.isArray(e)?e.join("</li>".concat(d)):e,"unordered"===t.list?"".concat(p).concat(d).concat(c,"</ul>"):"".concat(v).concat(d).concat(c,"</ol>")):(c=Array.isArray(e)?e.join("</p>".concat(h)):e,"".concat(f).concat(c,"</p>")),t.centerH&&(c=Cr(c)),t.centerV&&(c=Mr(c)),c}function Rr(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[""],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n='<ul id="id__figureone_item_selector_'.concat(2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,'" \n                    class=').concat(e,">");return t.forEach((function(t,e){n+='<li id="id__figureone_item_selector_'.concat(e,'">').concat(t,"</li>")})),n+="</ul>"}var Fr=function(t,e){return'<span class="figureone__unit_deg">'.concat(t,'</span><span class="figureone__unit_rad">').concat(e,"</span>\n  ")};function Dr(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r="";e&&(r=' id="'.concat(e,'"'));var o="";n&&(o=' class="'.concat(n,'"'));var a="";return i&&(a=' style="color:'.concat(Ne(i),';"')),{replacementText:"<span".concat(r).concat(o,'"').concat(a,">").concat(t.replace(RegExp(/_/,"gi")," ").trim(),"</span>")}}function Ir(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e="highlight_word";"string"==typeof t&&(e="".concat(t," ").concat(e));var n=null;return Array.isArray(t)&&(n=t),{replacementText:function(t){return Dr(t,"",e,n)}}}function Wr(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n="action_word interactive_word",i=null,r={color:null,id:"figureone__id_".concat(Kt()),interactive:!0,classes:"",text:null,newTab:!0},o=r;Array.isArray(e)?i=e:null!=e&&(o=Yt(r,e));var a=o.color,s=o.id,l=o.classes,u=o.text;null!=a&&(i=a),""!==l&&(n="".concat(n," ").concat(l));var c=o.newTab?' target="_blank"':"";return{replacementText:function(e){var r=s?' id="'.concat(s,'"'):"",o=i?' style="color:'.concat(Ne(i),';"'):"";return{replacementText:"<a href=".concat(t).concat(r,'class="').concat(n,'"').concat(o,' rel="noreferrer noopener"').concat(c,">").concat((u||e).trim(),"</a>")}},id:function(){return s}}}function qr(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n="highlight_word";"string"==typeof e&&(n="".concat(e," ").concat(n));var i=null;return Array.isArray(e)&&(i=e),{replacementText:Dr(t,"",n,i).replacementText}}function Hr(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return{replacementText:function(e){return Dr(e,"",t)}}}function zr(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return{replacementText:function(e){return Dr(e,t)}}}function Nr(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i="action_word",r=null,o={color:null,id:"figureone__id_".concat(Kt()),interactive:!0,classes:"",text:null},a=o;Array.isArray(n)?r=n:null!=n&&(a=Yt(o,n));var s=a.interactive,l=a.color,u=a.id,c=a.classes,h=a.text;function f(){return u}return null!=l&&(r=l),s&&(i="".concat(i," interactive_word")),""!==c&&(i="".concat(i," ").concat(c)),{replacementText:function(t){return Dr(h||t,f(),i,r)},id:f,actionMethod:t,bind:e}}function Vr(t,e,n){return Nr(e,n,{color:3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,text:t})}function Gr(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Kt(),n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i="action_word";3<arguments.length&&void 0!==arguments[3]&&!arguments[3]||(i="".concat(i," interactive_word")),"string"==typeof n&&(i="".concat(n," ").concat(i));var r=null;return Array.isArray(n)&&(r=n),{replacementText:Dr(t,e,i,r).replacementText,id:e}}function Ur(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",r=document.getElementById(t);r&&(r.classList.add("action_word_enabled"),i.split(" ").forEach((function(t){t&&r.classList.add(t)})),1===n.length&&(r.onclick=e.bind(n[0])),2===n.length&&(r.onclick=e.bind(n[0],n[1])),3===n.length&&(r.onclick=e.bind(n[0],n[1],n[2])),4===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3])),5===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4])),6===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5])),7===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6])),8===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7])),9===n.length&&(r.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])))}function Xr(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"highlight_word",i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],r=t;Object.keys(e).forEach((function(t){var n,i,o,a,s,l=e[t];n=r,i=t,o=l,a=new RegExp("\\|".concat(i,"\\|"),"gi"),s="string"==typeof o?o:"string"==typeof o.replacementText?o.replacementText:o.replacementText(i).replacementText,r=n.replace(a,s)}));var o=RegExp(/\|([^|]*)\|/gi);if(r=r.replace(o,'<span class="'.concat(n,'">$1</span>')),i){var a=RegExp(/style="color:rgba\([^)]*\);"/gi);r=r.replace(a,"");var s=RegExp(/highlight_word/gi);r=r.replace(s,"");var l=RegExp(/interactive_word/gi);r=r.replace(l,"");var u=RegExp(/id="[^"]*"/gi);r=r.replace(u,"")}return r}function Yr(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";Object.keys(t).forEach((function(n){var i=t[n];"string"!=typeof i&&"actionMethod"in i&&Ur(i.id(n),i.actionMethod,i.bind,e)}))}function Qr(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",r=Xr(e,n);t.innerHTML=r,Yr(n,i)}function Kr(t){return(Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zr(t){return(Zr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $r(t,e){return($r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Jr=function(){function t(e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(t,e){return!e||"object"!==Kr(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Zr(t).call(this,e))).glPrimitive=e[0].gl.TRIANGLE_FAN,i.points=[],n.forEach((function(t){i.points.push(t.x),i.points.push(t.y),i.border[0].push(t)})),i.setupBuffer(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$r(t,e)}(t,ye),t}(),to=function(t,e,n,i,r){var o=new Jr(t,e),a=new pt;return a=i instanceof Y?a.translate(i.x,i.y):i._dup(),new Sr(o,a,n,r)};function eo(t){return(eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function no(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function io(t,e){return!e||"object"!==eo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ro(t){return(ro=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function oo(t,e){return(oo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ao=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.05,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Math.PI/4,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(n=io(this,ro(t).call(this,e))).innerRadius=i,n.outerRadius=r,n.dAngle=a,n.maxAngle=s;for(var l=0,u=-1,c=-1,h=[i,-o/2,r,-o/2,r,o/2,i,-o/2,r,o/2,i,o/2];l<=s;){for(var f=0;f<6;f+=1){var d=new Y(h[2*f],h[2*f+1]).rotate(l);n.points[u+=1]=d.x,n.points[u+=1]=d.y}var p=[new Y(n.points[u-11],n.points[u-10]),new Y(n.points[u-9],n.points[u-8]),new Y(n.points[u-7],n.points[u-6]),new Y(n.points[u-1],n.points[+u]),new Y(n.points[u-11],n.points[u-10])];n.border[c+=1]=p,l+=a}return n.setupBuffer(),n}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oo(t,e)}(t,ye),e=t,(n=[{key:"drawToAngle",value:function(t,e,n,i,r){var o=6*Math.floor(i/this.dAngle)+6;i>=this.maxAngle&&(o=this.numPoints),this.draw(t,e,n,o,r)}},{key:"getPointCountForAngle",value:function(t){var e=0<arguments.length&&void 0!==t?t:2*Math.PI,n=6*Math.floor(e/this.dAngle)+6;return e>=2*Math.PI&&(n=this.numPoints),n}}])&&no(e.prototype,n),t}(),so=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.05,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Math.PI/4,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI,a=6<arguments.length?arguments[6]:void 0,s=7<arguments.length?arguments[7]:void 0,l=8<arguments.length?arguments[8]:void 0,u=new ao(t,e,n,i,r,o),c=new pt;return c=s instanceof Y?c.translate(s.x,s.y):s._dup(),new Sr(u,c,a,l)};function lo(t){return(lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function uo(t,e){return!e||"object"!==lo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function co(t){return(co=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ho(t,e){return(ho=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var fo=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Y(0,0),r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var s=0-o/2,l=[];(n=uo(this,co(t).call(this,e))).glPrimitive=n.gl[0].TRIANGLE_STRIP,l.push(new Y(0,s)),l.push(new Y(0,s+o)),l.push(new Y(0+r,s)),l.push(new Y(0+r,s+o));var u=(new pt).rotate(a).translate(i.x,i.y),c=l.map((function(t){return t.transformBy(u.matrix())}));return c.forEach((function(t){n.points.push(t.x),n.points.push(t.y)})),n.border[0]=[c[0],c[1],c[c.length-1],c[c.length-2]],n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ho(t,e)}(t,ye),t}(),po=function(t,e,n,i,r,o,a,s){var l=new fo(t,e,n,i,r),u=new pt;return u=a instanceof Y?u.translate(a.x,a.y):a._dup(),new Sr(l,u,o,s)};function vo(t){return(vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mo(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function yo(t,e){return!e||"object"!==vo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function go(t){return(go=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wo(t,e){return(wo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var bo=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Y(0,0),r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[1];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(n=yo(this,go(t).call(this,e))).glPrimitive=n.gl[0].TRIANGLES,n.dashCumLength=[],n.maxLength=r;for(var l,u,c,h,f,d,p=[],v=0,m=new Y(0,0-o/2),y=!1;v<r;)for(var g=0;g<s.length&&v<r;g+=1){var w=s[g];r<w+v&&(w=r-v),y||(u=w,c=o,h=(l=m)._dup(),f=l.add(new Y(0,c)),d=l.add(new Y(u,c)),[h,f,d,h,d,l.add(new Y(u,0))]).forEach((function(t){p.push(t)})),v+=w,m.x+=w,y=!y,n.dashCumLength.push(v)}var b=(new pt).rotate(a).translate(i.x,i.y),x=p.map((function(t){return t.transformBy(b.matrix())}));return x.forEach((function(t){n.points.push(t.x),n.points.push(t.y)})),n.border[0]=[x[0],x[1],x[x.length-2],x[x.length-1]],n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wo(t,e)}(t,ye),e=t,(n=[{key:"getPointCountForLength",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.maxLength;if(e>=this.maxLength)return this.numPoints;if(e<this.dashCumLength[0])return 0;for(var n=0;n<this.dashCumLength.length;n+=1)if(e<this.dashCumLength[n])return 6*(Math.floor((n-1)/2)+1);return this.numPoints}}])&&mo(e.prototype,n),t}(),xo=function(t,e,n,i,r,o,a,s,l){var u=new bo(t,e,n,i,r,o),c=new pt;return c=s instanceof Y?c.translate(s.x,s.y):s._dup(),new Sr(u,c,a,l)};function _o(t){return(_o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function So(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Oo(t,e){return!e||"object"!==_o(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ko(t){return(ko=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function To(t,e){return(To=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Po=function(){function t(e,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:20;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Oo(this,ko(t).call(this,e))).glPrimitive=r.gl[0].TRIANGLE_FAN;var u=[];function c(t,e,n,i){var r=[];if(0===t||0===e)r.push(i);else for(var o=Math.PI/2/e,a=0;a<e+1;a+=1)r.push(new Y(t*Math.cos(a*o+n)+i.x,t*Math.sin(a*o+n)+i.y));return r}u.push(new Y(0,0));var h=Math.min(s,o/2,a/2),f=l;return 0===f&&(h=0),u=[].concat(So(u),So(c(h,f,0,new Y(o/2-h,a/2-h)))),u=[].concat(So(u),So(c(h,f,Math.PI/2,new Y(-o/2+h,a/2-h)))),u=[].concat(So(u),So(c(h,f,Math.PI,new Y(-o/2+h,-a/2+h)))),u=[].concat(So(u),So(c(h,f,Math.PI/2*3,new Y(o/2-h,-a/2+h)))),u="top"===i?u.map((function(t){return t.add(0,-a/2)})):"bottom"===i?u.map((function(t){return t.add(0,a/2)})):"middle"===i?u.map((function(t){return t.add(0,0)})):u.map((function(t){return t.add(0,i)})),(u="left"===n?u.map((function(t){return t.add(o/2,0)})):"right"===n?u.map((function(t){return t.add(-o/2,0)})):"center"===n?u.map((function(t){return t.add(0,0)})):u.map((function(t){return t.add(n,n)}))).forEach((function(t){r.points.push(t.x),r.points.push(t.y)})),r.points.push(r.points[2]),r.points.push(r.points[3]),r.border[0]=u.slice(1),r.setupBuffer(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&To(t,e)}(t,ye),t}();function Ao(t){return(Ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Eo(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function jo(t,e){return!e||"object"!==Ao(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Mo(t){return(Mo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lo(t,e){return(Lo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Co=function(){function t(e,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.01,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:20;function c(t,e,n,i){var r=[];if(0===t||0===e)r.push(i);else for(var o=Math.PI/2/e,a=0;a<e+1;a+=1)r.push(new Y(t*Math.cos(a*o+n)+i.x,t*Math.sin(a*o+n)+i.y));return r}!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(r=jo(this,Mo(t).call(this,e))).glPrimitive=r.gl[0].TRIANGLE_STRIP;var h=[],f=Math.min(l,o/2,a/2),d=Math.max(l-s,1e-4),p=u;0===p&&(d=f=0);var v=[].concat(Eo(c(f,p,0,new Y(o/2-f,a/2-f))),Eo(c(f,p,Math.PI/2,new Y(-o/2+f,a/2-f))),Eo(c(f,p,Math.PI,new Y(-o/2+f,-a/2+f))),Eo(c(f,p,Math.PI/2*3,new Y(o/2-f,-a/2+f)))),m=[].concat(Eo(c(d,p,0,new Y(o/2-d-s,a/2-d-s))),Eo(c(d,p,Math.PI/2,new Y(-o/2+d+s,a/2-d-s))),Eo(c(d,p,Math.PI,new Y(-o/2+d+s,-a/2+d+s))),Eo(c(d,p,Math.PI/2*3,new Y(o/2-d-s,-a/2+d+s))));return v.forEach((function(t,e){h.push(t),h.push(m[e])})),h="top"===i?h.map((function(t){return t.add(0,-a/2)})):"bottom"===i?h.map((function(t){return t.add(0,a/2)})):"middle"===i?h.map((function(t){return t.add(0,0)})):h.map((function(t){return t.add(0,i)})),(h="left"===n?h.map((function(t){return t.add(o/2,0)})):"right"===n?h.map((function(t){return t.add(-o/2,0)})):"center"===n?h.map((function(t){return t.add(0,0)})):h.map((function(t){return t.add(n,n)}))).forEach((function(t){r.points.push(t.x),r.points.push(t.y)})),r.points.push(r.points[0]),r.points.push(r.points[1]),r.points.push(r.points[2]),r.points.push(r.points[3]),r.border[0]=h.slice(1),r.setupBuffer(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Lo(t,e)}(t,ye),t}();function Bo(t){return(Bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ro(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Fo(t,e){return!e||"object"!==Bo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Do(t){return(Do=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Io(t,e){return(Io=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Wo=function(){function t(e,n,i,r,o){var a,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"",l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:new X(-1,-1,2,2),u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:new X(0,0,1,1),c=8<arguments.length&&void 0!==arguments[8]&&arguments[8];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a=Fo(this,""!==s?Do(t).call(this,e,"withTexture","withTexture"):Do(t).call(this,e)),"lines"===o?a.glPrimitive=a.gl[0].LINES:"strip"===o?a.glPrimitive=a.gl[0].TRIANGLE_STRIP:"fan"===o&&(a.glPrimitive=a.gl[0].TRIANGLE_FAN),a.setupPoints(n,i,r),a.setupTexture(s,l,u,c),a.setupBuffer(),Fo(a)}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Io(t,e)}(t,ye),e=t,(n=[{key:"change",value:function(t,e,n){this.setupPoints(t,e,n),this.resetBuffer()}},{key:"setupTexture",value:function(t,e,n,i){var r=0<arguments.length&&void 0!==t?t:"",o=1<arguments.length&&void 0!==e?e:new X(-1,-1,2,2),a=2<arguments.length&&void 0!==n?n:new X(0,0,1,1),s=3<arguments.length&&void 0!==i&&i;r&&(this.texture={id:r,src:r,type:"image",points:[],repeat:s},this.createTextureMap(o.left,o.right,o.bottom,o.top,a.left,a.right,a.bottom,a.top))}},{key:"setupPoints",value:function(t,e,n){var i=this;if(this.points=[],t.forEach((function(t){i.points.push(t.x),i.points.push(t.y)})),null==e){var r=bt(t);this.border[0]=[new Y(r.left,r.bottom),new Y(r.right,r.bottom),new Y(r.right,r.top),new Y(r.left,r.top)]}else this.border=e;null!=n&&(this.holeBorder=n)}}])&&Ro(e.prototype,n),t}();function qo(t){return(qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ho(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zo(t,e){return!e||"object"!==qo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function No(t){return(No=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vo(t,e){return(Vo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Go=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.01,a=4<arguments.length&&void 0!==arguments[4]&&arguments[4];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(n=zo(this,No(t).call(this,e))).glPrimitive=n.gl[0].TRIANGLE_STRIP,n.lineWidth=o,n.fill=a;var s=n.getPoints(i,r,o,a);return n.updatePoints(s,i,r,!0),n}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vo(t,e)}(t,ye),e=t,(n=[{key:"updatePoints",value:function(t,e,n,i){var r=this,o=3<arguments.length&&void 0!==i&&i;this.points=[],t.forEach((function(t){r.points.push(t.x),r.points.push(t.y)})),this.border[0]=[new Y(-e/2,-n/2),new Y(e/2,-n/2),new Y(e/2,n/2),new Y(-e/2,n/2)],o?this.setupBuffer():this.resetBuffer()}},{key:"updateBox",value:function(t,e,n,i){var r=2<arguments.length&&void 0!==n?n:this.lineWidth,o=3<arguments.length&&void 0!==i?i:this.fill,a=this.getPoints(t,e,r,o);this.updatePoints(a,t,e,!1)}},{key:"getPoints",value:function(t,e,n,i){var r=2<arguments.length&&void 0!==n?n:this.lineWidth;return(3<arguments.length&&void 0!==i?i:this.fill)?[new Y(-t/2,-e/2),new Y(-t/2+t,-e/2),new Y(-t/2,-e/2+e),new Y(-t/2+t,-e/2+e)]:[new Y(-t/2,-e/2),new Y(-t/2+r,-e/2+r),new Y(-t/2,-e/2+e),new Y(-t/2+r,-e/2+e-r),new Y(-t/2+t,-e/2+e),new Y(-t/2+t-r,-e/2+e-r),new Y(-t/2+t,-e/2),new Y(-t/2+t-r,-e/2+r),new Y(-t/2,-e/2),new Y(-t/2+r,-e/2+r)]}}])&&Ho(e.prototype,n),t}();function Uo(t){return(Uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Yo(t,e){return!e||"object"!==Uo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Qo(t){return(Qo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ko(t,e){return(Ko=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Zo=function(){function t(e,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(i=Yo(this,Qo(t).call(this,e))).glPrimitive=i.gl[0].LINES,i.points=[],n.forEach((function(t){for(var e=Xo(t,2),n=e[0],o=e[1],a=new lt(n,o).angle()+Math.PI/2,s=-.003*(r-1)/2,l=0;l<r;l+=1){var u=s+.003*l;i.points.push(n.x+u*Math.cos(a)),i.points.push(n.y+u*Math.sin(a)),i.points.push(o.x+u*Math.cos(a)),i.points.push(o.y+u*Math.sin(a))}})),i.border=[],i.setupBuffer(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ko(t,e)}(t,ye),t}(),$o=function(t,e,n,i,r,o){var a=new Zo(t,e,n),s=new pt;return s=r instanceof Y?s.translate(r.x,r.y):r._dup(),new Sr(a,s,i,o)};function Jo(t){return(Jo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ta(t,e){return!e||"object"!==Jo(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ea(t){return(ea=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function na(t,e){return(na=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ia=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new Y(0,0),l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ta(this,ea(t).call(this,e))).glPrimitive=n.gl[0].TRIANGLE_FAN;var u=(n.height=o)-a,c=[];c.push(new Y(0,0)),c.push(new Y(-i/2,-u)),a&&(c.push(new Y(-r/2,-u)),c.push(new Y(-r/2,-o)),c.push(new Y(r/2,-o)),c.push(new Y(r/2,-u))),c.push(new Y(i/2,-u));var h=(new pt).rotate(l).translate(s);return c.map((function(t){return t.transformBy(h.matrix())})).forEach((function(t){n.points.push(t.x),n.points.push(t.y),n.border[0].push(t)})),n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&na(t,e)}(t,ye),t}();function ra(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new Y(0,0),a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[1,1,1,1],l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:new Y(0,0),u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:new X(-1,-1,2,2),c=new ia(t,e,n,i,r,o,a),h=new pt;return h=l instanceof Y?h.translate(l.x,l.y):l._dup(),new Sr(c,h,s,u)}function oa(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function aa(t){return(aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sa(t){return(sa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function la(t,e){return(la=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ua(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ca(){ua(this,ca),this.length=1,this.width=.01,this.color=ha,this.mode="on",this.offset=0}var ha=[.7,.7,.7,1],fa=function(){function t(){var e;return ua(this,t),(e=function(t,e){return!e||"object"!==aa(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,sa(t).call(this))).start=0,e.step=.1,e.length=.05,e.width=.01,e.offset=0,e.labelOffset=new Y(0,0),e.color=ha,e.labels=[],e.labelMode="auto",e.labelsHAlign="center",e.labelsVAlign="middle",e.mode="on",e.fontFamily="Helvetica Neue",e.fontWeight="400",e.fontSize=.1,e.fontColor=ha,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&la(t,e)}(t,ca),t}(),da=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;ua(this,t),this.name=e,this.start=new Y(0,0),this.length=1,this.width=.01,this.rotation=n,this.color=[.5,.5,.5,1],this.title="",this.titleOffset=new Y(this.length/2,-.1),this.titleRotation=0,this.limits={min:0,max:1},this.logarithmic=!1,this.majorTicks=new fa,this.minorTicks=new fa,this.minorTicks.labelMode="off",this.majorGrid=new ca,this.minorGrid=new ca,this.titleFontFamily="Helvetica Neue",this.titleFontWeight="400",this.titleFontSize=.13,this.titleFontColor=ha}var e,n;return e=t,(n=[{key:"getNum",value:function(t,e){return Math.floor((this.limits.max-t)/e)+1}},{key:"getMajorNum",value:function(){return this.getNum(this.majorTicks.start,this.majorTicks.step)}},{key:"getMinorNum",value:function(){return this.getNum(this.minorTicks.start,this.minorTicks.step)}},{key:"generateAuto",value:function(t){var e=0<arguments.length&&void 0!==t?t:10,n=(this.limits.max-this.limits.min)/e,i=h(Math.floor(Math.log10(n)),0);n=h(n,-i);var r=h(this.limits.min,-i);return r<this.limits.min&&(r+=Math.pow(10,i)),11<this.getNum(r,n)&&(n*=2),{start:r,step:n}}},{key:"generateAutoMajorTicks",value:function(t){var e=0<arguments.length&&void 0!==t?t:10,n=this.generateAuto(e),i=n.start,r=n.step;this.majorTicks.start=i,this.majorTicks.step=r}},{key:"generateAutoMinorTicks",value:function(t){var e=0<arguments.length&&void 0!==t?t:50,n=this.generateAuto(e),i=n.start,r=n.step;this.minorTicks.start=i,this.minorTicks.step=r}},{key:"toClip",value:function(t){return t*(this.length/(this.limits.max-this.limits.min))}},{key:"valueToClip",value:function(t){return this.toClip(t-this.limits.min)+this.start.x}},{key:"getMajorLabels",value:function(){for(var t=[],e=0,n=this.getMajorNum();e<n;e+=1){var i=this.majorTicks.start+e*this.majorTicks.step;t.push(i.toString())}return t}},{key:"generateMajorLabels",value:function(){this.majorTicks.labels=this.getMajorLabels()}},{key:"getMinorLabels",value:function(){for(var t=[],e=0,n=this.getMinorNum();e<n;e+=1){var i=this.minorTicks.start+e*this.minorTicks.step;t.push(i.toString())}return t}},{key:"generateMinorLabels",value:function(){this.minorTicks.labels=this.getMinorLabels()}}])&&oa(e.prototype,n),t}(),pa=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Y(0,0),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=(new pt).rotate(i).translate(t.x,t.y),o=[new Y(0,0-n/2),new Y(0+e,0-n/2),new Y(0+e,0+n/2),new Y(0,0-n/2),new Y(0+e,0+n/2),new Y(0,0+n/2)],a=o.map((function(t){return t.transformBy(r.matrix())})),s=[];a.map((function(t){return s.push(t.x),s.push(t.y),!0}));var l=[o[0],o[1],o[2],o[5]];return{points:s,border:l}};function va(t){return(va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ma(t,e){return!e||"object"!==va(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ya(t){return(ya=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ga(t,e){return(ga=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var wa=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new da;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=ma(this,ya(t).call(this,e));var r=i,o=(new pt).rotate(r.rotation).translate(r.start.x,r.start.y).matrix();if(0<r.width){var a=pa(new Y(0,0),r.length,r.width,0),s=a.points,l=a.border;n.points=s,n.border=[l]}return n.transform(o),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ga(t,e)}(t,ye),t}();function ba(t){return(ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xa(t){return(xa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _a(t,e){return(_a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Sa=function(){function t(e,n,i,r,o,a,s,l){var u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),u=function(t,e){return!e||"object"!==ba(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,xa(t).call(this,e));var c=(new pt).rotate(i).translate(0,0).matrix(),h=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Y(0,0),i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.01,o=5<arguments.length&&void 0!==arguments[5]&&arguments[5],a=[],s=[],l=1;6<arguments.length&&void 0!==arguments[6]&&arguments[6]&&(l=-1);for(var u=n.y,c=0;c<t;c+=1){var h=void 0;h=o?n.x+e*Math.floor(c/10)+Math.log10(c%10)*e:n.x+e*c,h-=r/2,a.push(h,l*u),a.push(h+r,l*u),a.push(h+r,l*(u+i)),a.push(h,u),a.push(h+r,l*(u+i)),a.push(h,l*(u+i)),s.push([new Y(h,l*u),new Y(h+r,l*u),new Y(h+r,l*(u+i)),new Y(h,l*(u+i))])}return{points:a,border:s}}(r,o,new Y(n.x,n.y+l),a,s,!1,!1),f=h.points,d=h.border;return u.points=f,u.border=d,u.transform(c),u.setupBuffer(),u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_a(t,e)}(t,ye),t}();function Oa(t){return(Oa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ka(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ta(t,e){return!e||"object"!==Oa(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Pa(t){return(Pa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Aa(t,e){return(Aa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ea=function(){function t(e,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new da,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new pt,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new X(-1,1,2,2);return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(i=Ta(this,Pa(t).call(this,o,a))).props=r,i.webgl=e,i.diagramLimits=a,i.drawContext2D=n,i.build(),i}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Aa(t,e)}(t,Or),e=t,(n=[{key:"rebuild",value:function(){this.drawOrder=[],this.build()}},{key:"build",value:function(){var t=this.props,e=t.minorTicks,n=t.majorTicks,i=t.minorGrid,r=t.majorGrid;"auto"===n.mode&&this.props.generateAutoMajorTicks(),"auto"===e.mode&&this.props.generateAutoMinorTicks();var o=2/this.diagramLimits.width,a=this.props.valueToClip(n.start),s=this.props.valueToClip(e.start),l=this.props.getMajorNum(),u=this.props.getMinorNum();this.addTicksOrGrid("minorGrid",this.webgl,i,u,e.step,s,o,this.diagramLimits),this.addTicksOrGrid("majorGrid",this.webgl,r,l,n.step,a,o,this.diagramLimits),this.addTicksOrGrid("minorTicks",this.webgl,e,u,e.step,s,o,this.diagramLimits),this.addTicksOrGrid("majorTicks",this.webgl,n,l,n.step,a,o,this.diagramLimits);var c=new wa(this.webgl,this.props);this.add("line",new Sr(c,new pt,this.props.color,this.diagramLimits));var h=new Ae(this.props.titleFontFamily,"normal",this.props.titleFontSize,this.props.titleFontWeight,"center","middle",this.props.titleFontColor),f=[new Ee(new Y(0,0).transformBy((new pt).rotate(this.props.rotation).matrix()),this.props.title,h)],d=new je(this.drawContext2D[0],f);this.add("title",new Sr(d,(new pt).rotate(this.props.rotation).translate(this.props.titleOffset.x,this.props.titleOffset.y),[.5,.5,.5,1],this.diagramLimits)),this.addTickLabels("major",this.drawContext2D[0],n,this.props.generateMajorLabels.bind(this.props),this.diagramLimits,this.props.majorTicks.labelOffset),this.addTickLabels("minor",this.drawContext2D[0],e,this.props.generateMinorLabels.bind(this.props),this.diagramLimits,this.props.minorTicks.labelOffset)}},{key:"toClip",value:function(t){return this.props.toClip(t)}},{key:"valueToClip",value:function(t){return this.props.valueToClip(t)}},{key:"addTicksOrGrid",value:function(t,e,n,i,r,o,a,s){if("off"!==n.mode){var l=new Sa(e,new Y(o,this.props.start.y),this.props.rotation,i,this.toClip(r),n.length,n.width,n.offset);this.add(t,new Sr(l,(new pt).scale(1,1).rotate(0).translate(0,0),n.color,s))}}},{key:"addTickLabels",value:function(t,e,n,i,r,o){"auto"===n.labelMode&&i();var a=new Ae(n.fontFamily,"normal",n.fontSize,n.fontWeight,n.labelsHAlign,n.labelsVAlign,n.fontColor);this.props.rotation>Math.PI/2*.95&&(a.yAlign="middle",a.xAlign="right");for(var s=[],l=0;l<n.labels.length;l+=1)s.push(new Ee(new Y(this.valueToClip(n.start+l*n.step),0).transformBy((new pt).rotate(this.props.rotation).matrix()),n.labels[l],a));var u=new je(e,s);this.add("label_".concat(t),new Sr(u,(new pt).scale(1,1).rotate(0).translate(o.x,o.y),[.5,.5,.5,1],r))}}])&&ka(e.prototype,n),t}();function ja(t){return(ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ma(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function La(t){return(La=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ca(t,e){return(Ca=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ba=function(){function t(e,n){var i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(t,e){return!e||"object"!==ja(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,La(t).call(this,e,"withTexture","text"))).glPrimitive=e[0].gl.TRIANGLE_FAN;var r=Yt({},{text:"DEFAULT_TEXT",size:"20px",family:"Helvetica",style:"normal",weight:400,xAlign:"center",yAlign:"alphabetic",id:Kt("vertexText")},n);return i.size=r.size,i.text=r.text,i.family=r.family,i.xAlign=r.xAlign,i.yAlign=r.yAlign,i.style=r.style,i.weight=r.weight,i.canvas=document.createElement("canvas"),i.canvas.id=r.id,i.ctx=i.canvas.getContext("2d"),i.texture={id:r.id,points:[],type:"canvasText"},i.type="vertexText",i.drawTextIntoBuffer(),i}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ca(t,e)}(t,ye),e=t,(n=[{key:"resizeText",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:new Y(1,1),i=this.canvas.width*n.x,r=this.canvas.height*n.y,o=new Y(0,0);"center"===this.xAlign?o.x=-i/2:"right"===this.xAlign&&(o.x=-i),"baseline"===this.yAlign?o.y=.25*-r:"top"===this.yAlign?o.y=-r:"middle"===this.yAlign&&(o.y=-r/2);var a=[o,new Y(o.x,o.y+r),new Y(o.x+i,o.y+r),new Y(o.x+i,o.y)];this.width=i,this.height=r,this.calcAscentDescent(),this.points=[],a.forEach((function(t){e.points.push(t.x),e.points.push(t.y)})),this.border=[[new Y(o.x,-this.descent),new Y(o.x,this.ascent),new Y(o.x+i,this.ascent),new Y(o.x+i,-this.descent)]];var s=this.texture;null!=s&&(s.points=[0,0,0,1,1,1,1,0],s.data=this.ctx.canvas,s.buffer?this.resetBuffer():this.setupBuffer())}},{key:"calcAscentDescent",value:function(){var t=.75,e=0,n=this.text.match(/[,.]/g);Array.isArray(n)&&n.length===this.text.length&&(t=.1);var i=this.text.match(/[acemnorsuvwxz*gyq:><;p=]/g);Array.isArray(i)&&i.length===this.text.length&&(t=.5);var r=this.text.match(/[;,$]/g);Array.isArray(r)&&0<r.length&&(e=.1);var o=this.text.match(/[gjyqp@Q(){}[\]|]/g);Array.isArray(o)&&0<o.length&&(e=.25),this.ascent=t*this.height,this.descent=e*this.height}},{key:"drawTextIntoBuffer",value:function(t){var e=0<arguments.length&&void 0!==t?t:new Y(1,1),n=20;(n="string"==typeof this.size&&this.size.endsWith("px")?parseInt(this.size,10):f(("string"==typeof this.size?parseFloat(this.size):this.size)/e.x,0))<1&&(n=1),this.ctx.font="".concat(this.style," ").concat(this.weight," ").concat(n,"px ").concat(this.family);var i=this.ctx.measureText(this.text).width+.3*n,r=1.15*n;this.canvas.width=Math.max(i,1),this.canvas.height=Math.max(r,1),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font="".concat(this.style," ").concat(this.weight," ").concat(n,"px ").concat(this.family),this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",this.ctx.fillStyle="white";var o=.3*n/2,a=.75*this.canvas.height;this.ctx.fillText(this.text,o,a),this.resizeText(e)}}])&&Ma(e.prototype,n),t}();function Ra(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Fa(t,e,n,i,r,o){var a,s=new lt(e,t),l=new lt(e,n);if("fromVertex"===r)a=o,a=Math.min(a,s.length()/2*.99,l.length()/2*.99);else if("radius"===r){var u=Math.abs(_t(t,e,n))/2;a=o/Math.tan(u),a=Math.min(a,s.length()/2*.99,l.length()/2*.99)}else a=Math.min(s.length(),l.length());return function(t,e,n,i){if(i<1)return[t._dup(),e._dup(),n._dup()];if(1===i)return[t._dup(),n._dup()];var r=t._dup(),o=n._dup(),a=[],s=_t(r,e,o);if(s===Math.PI){a.push(t._dup());for(var l=0;l<i-2;l+=1)a.push(e._dup());return a.push(n._dup()),a}var u=!1;0===s&&(u=!0,s=1e-5);var c=s/Math.abs(s),h=new lt(e,r),f=Math.abs(s/2),d=Math.PI/2,p=Math.PI-f-d,v=h.length(),m=Math.sin(d)/Math.sin(p)*v,y=new Y(e.x+m*Math.cos(f*c+h.angle()),e.y+m*Math.sin(f*c+h.angle())),g=2*p/i*c*-1,w=new lt(y,r),b=w.angle(),x=w.length();if(a.push(r),u)for(var _=h.angle()+Math.PI/2,S=Math.PI/i,O=0;O<=i;O+=1)a.push(new Y(y.x+1e-4*Math.cos(_+S*O),y.y+1e-4*Math.sin(_+S*O)));else for(var k=0;k<i-1;k+=1){var T=b+(k+1)*g;a.push(new Y(y.x+x*Math.cos(T),y.y+x*Math.sin(T)))}return a.push(o),a}(s.pointAtPercent(a/s.length()),e,l.pointAtPercent(a/l.length()),i)}function Da(t,e,n,i,r){var o=4<arguments.length&&void 0!==r&&r,a=new lt(e,t),s=new lt(e,n),l=a.pointAtPercent(i/a.length()),u=s.pointAtPercent(i/s.length());return!1===o&&(i>a.length()&&(l=t._dup()),i>s.length()&&(u=n._dup())),[l,e._dup(),u]}function Ia(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Wa(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function qa(t,e){var n;n=e>t.sum?e%t.sum:e;for(var i=0;i<t.definition.length;i+=1)if(n<=t.cum[i])return[i,t.cum[i]-n];return[0,0]}function Ha(t,e,n,i){for(var r,o,a,s=2<arguments.length&&void 0!==n&&n,l=3<arguments.length&&void 0!==i?i:0,u=[],c=(o=[],a=(r=e).reduce((function(t,e){return o.push(t+e),t+e}),0),{definition:r,sum:a,cum:o}),h=l,f=!1,d=function(t,e){var n=function(t,e,n,i){for(var r=[],o=0,a=Wa(qa(t,i),2),s=a[0],l=a[1],u=new lt(e,n),c=u.length(),h=l,f=s;o<c;){if(s%2==0){var d,p=u.pointAtPercent(o/c);d=o+h<=c?u.pointAtPercent((o+h)/c):n._dup(),o+=h,r.push([p,d])}else o+=h;s=((f=s)+1)%t.definition.length,h=t.definition[s]}return{points:r,continues:c<o&&f%2==0}}(c,t,e,h),i=n.points,r=n.continues;u=f&&null!=i[0]?(u[u.length-1]=[].concat(Ia(u[u.length-1]),Ia(i[0].slice(1))),[].concat(Ia(u),Ia(i.slice(1)))):[].concat(Ia(u),Ia(i)),f=r,h+=nt(t,e)},p=0;p<t.length-1;p+=1)d(t[p],t[p+1]);if(s){d(t[t.length-1],t[0]);var v=Wa(qa(c,l),1)[0];f&&v%2==0&&1<u.length&&(u[0]=[].concat(Ia(u[u.length-1]),Ia(u[0].slice(1))))}return u}function za(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Na(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Va(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"line",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"none",r=[],o=[],a=[[]];return t.forEach((function(t){var s=t[0],l=t.slice(-1)[0];if(e)for(var u=0;u<t.length;u+=1)r.push(t[u].p1._dup()),r.push(t[u].p2._dup());else r.push(l.p1._dup()),r.push(l.p2._dup()),r.push(s.p1._dup()),r.push(s.p1._dup()),r.push(l.p2._dup()),r.push(s.p2._dup());"line"===n?o.push([s.p1._dup(),s.p2._dup(),l.p2._dup(),l.p1._dup()]):"negative"===n?(0===o.length&&o.push([]),o[0].push(s.p1._dup(),s.p2._dup())):"positive"===n&&(0===o.length&&o.push([]),o[0].push(l.p1._dup(),l.p2._dup())),"positive"===i?a[0].push(l.p1._dup(),l.p2._dup()):"negative"===i&&a[0].push(s.p1._dup(),s.p2._dup())})),Array.isArray(n)&&(o=n),Array.isArray(i)&&(a=i),[r,o,a]}function Ga(t,e){var n=t.intersectsWith(e);null!=n.intersect&&(t.setP2(n.intersect._dup()),e.setP1(n.intersect._dup()))}function Ua(t,e,n,i){var r=_t(t.p1,t.p2,e.p2),o=new lt(t.p2,1,t.angle()+r/2+Math.PI/2),a=o.intersectsWith(n);null!=a.intersect&&n.setP2(a.intersect),null!=(a=o.intersectsWith(i)).intersect&&i.setP1(a.intersect)}function Xa(t,e,n,i){var r=n.intersectsWith(e);null!=r.intersect&&n.setP2(r.intersect),null!=(r=i.intersectsWith(t)).intersect&&i.setP1(r.intersect)}function Ya(t,e,n,i){var r=n.intersectsWith(e);null!=r.intersect&&r.intersect.isOnLine(e,8)&&n.setP2(r.intersect),null!=(r=i.intersectsWith(t)).intersect&&r.intersect.isOnLine(t,8)&&i.setP1(r.intersect)}function Qa(t,e,n,i,r,o,a,s,l,u){function c(t,e,n){var i=O[t],r=O[e],o=k[t][n],a=k[e][n],s=xt(i.p1,i.p2,r.p2);0<s&&s<T?"mid"===_?Ua(i,r,o,a):"negative"===_?Xa(i,r,o,a):"positive"===_&&Ua(i,r,o,a):T<=s&&s<=Math.PI/2?"mid"===_?Ga(o,a):"negative"===_?Xa(i,r,o,a):"positive"===_&&Ga(o,a):Math.PI/2<=s&&s<Math.PI?"mid"===_?Ga(o,a):"negative"===_?Ya(i,r,o,a):"positive"===_&&Ga(o,a):s===Math.PI?"negative"!==_&&"positive"!==_||("inside"===d?Ya(i,r,o,a):Ga(o,a)):Math.PI<s&&s<Math.PI/2*3?"mid"===_?(Ga(o,a),Ga(o,a)):"negative"===_?Ga(o,a):"positive"===_&&Ya(i,r,o,a):Math.PI/2*3<=s&&s<=2*Math.PI-T?"mid"===_||"negative"===_?Ga(o,a):"positive"===_&&Xa(i,r,o,a):2*Math.PI-T<s&&s<2*Math.PI?"mid"===_||"negative"===_?Ua(i,r,o,a):"positive"===_&&Xa(i,r,o,a):Math.PI}function h(t,e){var n=O[t],i=O[e],r=k[t].slice(-1)[0],o=k[e].slice(-1)[0],a=k[t][0],s=k[e][0],l=xt(n.p1,n.p2,i.p2);if(y)for(var u=0;u<k[t].length;u+=1)P.push(k[t][u].p2._dup()),P.push(k[e][u].p1._dup());else l<Math.PI?"inside"!==d&&(P.push(r.p2._dup()),P.push(n.p2._dup()),P.push(o.p1._dup())):l>Math.PI&&"inside"!==d&&(P.push(a.p2._dup()),P.push(n.p2._dup()),P.push(s.p1._dup()))}var f=1<arguments.length&&void 0!==e?e:.01,d=2<arguments.length?n:void 0,p=3<arguments.length&&void 0!==i&&i,v=4<arguments.length?r:void 0,m=5<arguments.length&&void 0!==o?o:Math.PI/7,y=6<arguments.length&&void 0!==a&&a,g=7<arguments.length&&void 0!==s?s:2,w=8<arguments.length&&void 0!==l?l:"line",b=9<arguments.length&&void 0!==u?u:"none",x=f,_=function(t,e,n){if("mid"===n||"negative"===n||"positive"===n)return n;for(var i=0,r=e?t.length:t.length-2,o=function(t,e,n){var o=xt(t,e,n);o<Math.PI&&(i+=1),o===Math.PI&&--r},a=1;a<t.length-1;a+=1)o(t[a-1],t[a],t[a+1]);return e&&(o(t[t.length-1],t[0],t[1]),o(t[t.length-2],t[t.length-1],t[0])),r/2<=i?"inside"===n?"negative":"positive":"inside"===n?"positive":"negative"}(t,p,d),S=Na(function(t,e,n,i,r,o,a){for(var s=6<arguments.length&&void 0!==a?a:2,l=[],u=function(t,e){return new lt(t,e)},c=0;c<t.length-1;c+=1)l.push(u(t[c],t[c+1]));n&&l.push(u(t[t.length-1],t[0]));for(var h=[],f=function(t,e,n,a,s){var l=a,u=a,c=Math.PI;if(null!=t){c=xt(t.p1,e.p1,e.p2);var f=_t(t.p1,e.p1,e.p2),d=e.distanceToPoint(t.p1),p=Math.min(d,Math.tan(Math.abs(f))*e.length());c<Math.PI/2?l=Math.min(l,p):c>Math.PI/2*3&&(u=Math.min(u,p))}var v,m=Math.PI;if(null!=n){m=xt(e.p1,e.p2,n.p2);var y=_t(e.p1,e.p2,n.p2),g=e.distanceToPoint(n.p2),w=Math.min(g,Math.tan(Math.abs(y))*e.length());m<Math.PI/2?l=Math.min(l,w):m>Math.PI/2*3&&(u=Math.min(u,w))}v="negative"===r?"auto"===i&&(o||c<Math.PI||m<Math.PI)?e.offset("negative",l):e.offset("negative",a):"positive"===r&&"auto"===i&&(o||c>Math.PI||m>Math.PI)?e.offset("positive",u):e.offset("positive",a),h[s].push(v)},d=e/(s-1),p=0;p<l.length;p+=1){var v=0<p?l[p-1]:null,m=l[p],y=p<l.length-1?l[p+1]:null;if(n&&0===p&&(v=l[l.length-1]),n&&p===l.length-1&&(y=l[0]),h.push([]),"negative"===r||"positive"===r)h[p].push(m._dup());else if(1===s)h[p].push(m._dup());else{var g=m.offset("negative",e/2);h[p].push(g)}for(var w=1;w<s;w+=1)f(v,m,y,"negative"===r||"positive"===r?w*d:-e/2+w*d,p);"negative"===r&&h[p].reverse()}return[l,h]}(t,x,p,v,_,"inside"===d,g),2),O=S[0],k=S[1],T=null==m?0:m,P=[];if("none"!==v)for(var A=0;A<g;A+=1){for(var E=0;E<k.length-1;E+=1)"auto"===v?c(E,E+1,A):0===A&&h(E,E+1);p&&("auto"===v?c(k.length-1,0,A):0===A&&h(k.length-1,0))}var j=Na(Va(k,y,w,b),3),M=j[0],L=j[1],C=j[2];return[[].concat(za(M),P),L,C]}function Ka(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.01,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"mid",o=4<arguments.length?arguments[4]:void 0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.1,s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:10,l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:Math.PI/7,u=8<arguments.length&&void 0!==arguments[8]?arguments[8]:[],c=9<arguments.length&&void 0!==arguments[9]&&arguments[9],h=10<arguments.length&&void 0!==arguments[10]?arguments[10]:2,f=11<arguments.length?arguments[11]:void 0,d=12<arguments.length?arguments[12]:void 0,p=[],v=t;if("auto"===o?(p=v.map((function(t){return t._dup()})),e="auto"):"radius"===o?(p=function(t,e,n,i,r){var o=[];e?o=Fa(t[t.length-1],t[0],t[1],i,n,r):o.push(t[0]);for(var a=1;a<t.length-1;a+=1){var s=Fa(t[a-1],t[a],t[a+1],i,n,r);o=[].concat(Ra(o),Ra(s))}return e?o=[].concat(Ra(o),Ra(Fa(t[t.length-2],t[t.length-1],t[0],i,n,r))):o.push(t[t.length-1]._dup()),o}(v,i,"fromVertex",s,a),e="fill"):(e=o,p=v.map((function(t){return t._dup()}))),1<u.length){var m=Ha(p,u,i,0),y=!1;1===m.length&&(y=i);var g=[],w=[[]],b=[[]];return m.forEach((function(t){var i=Na(Qa(t,n,r,y,e,l,c,h,f,d),3),o=i[0],a=i[1],s=i[2];g=[].concat(za(g),za(o)),w=[[].concat(za(w[0]),za(a[0]))],b=[[].concat(za(b[0]),za(s[0]))]})),[g,w,b]}return Qa(p,n,r,i,e,l,c,h,f,d)}function Za(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.01,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"mid",o=5<arguments.length?arguments[5]:void 0,a=6<arguments.length?arguments[6]:void 0,s=7<arguments.length?arguments[7]:void 0,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:Math.PI/7,u=9<arguments.length&&void 0!==arguments[9]&&arguments[9],c=10<arguments.length&&void 0!==arguments[10]?arguments[10]:1,h=function(t,e,n,i){for(var r=3<arguments.length&&void 0!==i&&i,o=[],a=1;a<t.length-1;a+=1)o.push(Da(t[a-1],t[a],t[a+1],n,r));return e&&(o.push(Da(t[t.length-2],t[t.length-1],t[0],n,r)),o.push(Da(t[t.length-1],t[0],t[1],n,r))),o}(t,n,i,!1),f=[],d=[],p=[];return h.forEach((function(t){var n=Na(Ka(t,e,!1,r,o,a,s,l,[],u,c,"line","none"),3),i=n[0],h=n[1],v=n[2];f=[].concat(za(f),za(i)),d=[].concat(za(d),za(h)),p=[].concat(za(p),za(v))})),[f,d,p]}function $a(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ja(t,e,n,i,r,o){var a=2*Math.PI/i,s=[];if(0===r)return[];for(var l=0;l<r;l+=1)s.push(new Y(t*Math.cos(a*l*o+e)+n.x,t*Math.sin(a*l*o+e)+n.y));return r<i&&s.push(new Y(t*Math.cos(a*r*o+e)+n.x,t*Math.sin(a*r*o+e)+n.y)),s}function ts(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function es(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ns(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function is(t,e){function n(e){var n=t[e];null!=n&&"string"!=typeof n&&(Array.isArray(n)&&"number"!=typeof n[0]?t[e]=function t(e){for(var n=0;n<e.length;n+=1)Array.isArray(e[n])&&"number"!=typeof e[n][0]?e[n]=t(e[n]):e[n]=K(e[n]);return e}(n):t[e]=K(n))}"string"==typeof e?n(e):e.forEach((function(t){return n(t)}))}function rs(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Yt.apply(void 0,[{}].concat(e));if(null!=i.position){var r=K(i.position);null==i.transform&&(i.transform=new pt("processOptions").translate(0,0)),i.transform.updateTranslation(r)}return i}var os=function(){function t(e,n,i,r,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Array.isArray(e)?this.webgl=e:this.webgl=[e],Array.isArray(n)?this.draw2D=n:this.draw2D=[n],this.htmlCanvas=i,this.limits=r,this.animateNextFrame=a,this.spaceTransforms=o}var e,n;return e=t,(n=[{key:"generic",value:function(){for(var t={points:[],border:null,hole:null,drawType:"triangles",color:[1,0,0,1],transform:new pt("generic").standard(),position:null,texture:{src:"",mapTo:new X(-1,-1,2,2),mapFrom:new X(0,0,1,1),repeat:!1,onLoad:this.animateNextFrame}},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[t].concat(n));if(null!=r.position){var o=K(r.position);r.transform.updateTranslation(o)}function a(t){if(null==t||!Array.isArray(t))return null;var e=[];return t.forEach((function(t){Array.isArray(t)&&e.push(t.map((function(t){return K(t)})))})),e}var s=r.points.map((function(t){return K(t)})),l=a(r.border),u=a(r.hole),c=function(t,e,n,i,r,o,a,s,l,u,c,h,f){var d=8<arguments.length&&void 0!==l?l:"",p=9<arguments.length&&void 0!==u?u:new X(-1,-1,2,2),v=10<arguments.length&&void 0!==c?c:new X(0,0,1,1),m=12<arguments.length&&void 0!==f?f:null,y=new Wo(t,e,n,i,r,d,p,v,11<arguments.length&&void 0!==h&&h);d&&(y.onLoad=m);var g=new pt;return g=a instanceof Y?g.translate(a.x,a.y):a._dup(),new Sr(y,g,o,s)}(this.webgl,s,l,u,r.drawType,r.color,r.transform,this.limits,r.texture.src,r.texture.mapTo,r.texture.mapFrom,r.texture.repeat,r.texture.onLoad);return null!=r.pulse&&"function"!=typeof c.pulseDefault&&(c.pulseDefault.scale=r.pulse),c}},{key:"polyline",value:function(){for(var t={width:.01,color:[1,0,0,1],close:!1,widthIs:"mid",cornerStyle:"auto",cornerSize:.01,cornerSides:10,cornersOnly:!1,cornerLength:.1,minAutoCornerAngle:Math.PI/7,dash:[],linePrimitives:!1,lineNum:1,transform:new pt("polyline").standard(),border:"line",hole:"none"},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r,o=rs.apply(void 0,[t].concat(n));is(o,["points","border","hole"]),!1===o.linePrimitives&&(o.lineNum=2);var a=es((r=o.cornersOnly?function(t){return Za(t,o.width,o.close,o.cornerLength,o.widthIs,o.cornerStyle,o.cornerSize,o.cornerSides,o.minAutoCornerAngle,o.linePrimitives,o.lineNum)}:function(t){return Ka(t,o.width,o.close,o.widthIs,o.cornerStyle,o.cornerSize,o.cornerSides,o.minAutoCornerAngle,o.dash,o.linePrimitives,o.lineNum,o.border,o.hole)})(o.points),3),s=a[0],l=a[1],u=a[2],c=this.generic(o,{drawType:o.linePrimitives?"lines":"triangles",points:s,border:Array.isArray(o.border)?o.border:l,holeBorder:Array.isArray(o.hole)?o.hole:u});return c.custom.updatePoints=function(t){var e;(e=c.drawingObject).change.apply(e,ts(r(t)))},null!=o.pulse&&"function"!=typeof c.pulseDefault&&(c.pulseDefault.scale=o.pulse),c}},{key:"polygon",value:function(){for(var t={radius:1,sides:4,direction:1,rotation:0,width:.01,line:{widthIs:"inside"},offset:new Y(0,0),transform:new pt("polygon").standard(),touchableLineOnly:!1},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r,o,a,s,l,u,c,h,f=rs.apply(void 0,[t].concat(n));if(is(f,["offset"]),null!=f.angleToDraw&&(f.sidesToDraw=Math.floor(f.angleToDraw/(2*Math.PI/f.sides))),null==f.sidesToDraw&&(f.sidesToDraw=f.sides),f.fill){var d=(o=f.radius,a=f.rotation,s=f.offset,l=f.sides,u=f.sidesToDraw,c=f.direction,h=[s._dup()].concat($a(Ja(o,a,s,l,u,c))),l===u&&h.push(h[1]._dup()),h);r=this.generic(f,{drawType:"fan",points:d,border:[ts(d.slice(1,-1))]})}else{var p,v=Ja(f.radius,f.rotation,f.offset,f.sides,f.sidesToDraw,f.direction),m="line";1===f.direction&&(m="negative",p="positive"),-1===f.direction&&(m="positive",p="negative"),r=this.polyline(f,f.line,{points:v,close:f.sides===f.sidesToDraw,border:m,hole:p})}return r}},{key:"polygonSweep",value:function(){for(var t={sides:4,fill:!1,transform:new pt("polygonSweep").standard(),line:{linePrimitives:!1,lineNum:2}},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=rs.apply(void 0,[t].concat(n,[{line:{cornerStyle:"auto",cornersOnly:!1}}])),o=this.polygon(r);return o.drawingObject.getPointCountForAngle=function(t){var e=Math.floor(f(t)/f(2*Math.PI)*r.sides);return r.fill?e+2:r.line&&r.line.linePrimitives?e*r.line.lineNum*2:6*e},o}},{key:"fan",value:function(){for(var t={points:[],color:[1,0,0,1],transform:new pt("fan").standard(),position:null},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Object.assign.apply(Object,[{},t].concat(n));if(null!=r.position){var o=K(r.position);r.transform.updateTranslation(o)}var a=to(this.webgl,r.points.map((function(t){return K(t)})),r.color,r.transform,this.limits);return null!=r.pulse&&"function"!=typeof a.pulseDefault&&(a.pulseDefault.scale=r.pulse),null!=r.mods&&r.mods!=={}&&a.setProperties(r.mods),a}},{key:"textGL",value:function(t){return function(t,e,n){var i=Yt({},{position:new Y(0,0),color:[1,0,0,1]},n);null==i.transform&&(i.transform=new pt("Text").translate(0,0)),null!=i.position&&i.transform.updateTranslation(i.position);var r=new Ba(t,i);return new Sr(r,i.transform,i.color,e)}(this.webgl,this.limits,t)}},{key:"text",value:function(t){for(var e,n={text:"",font:null,family:"Times New Roman",style:"italic",size:.2,weight:"200",xAlign:"center",yAlign:"middle",offset:new Y(0,0),color:[1,0,0,1],transform:new pt("text").standard()},i=arguments.length,r=new Array(1<i?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];if(null!=(e=Yt.apply(void 0,"string"==typeof t?[{},n,{text:t}].concat(r):[{},n,t].concat(r))).position){var a=K(e.position);e.transform.updateTranslation(a)}var s=e,l=s.text,u=s.font;null===u&&(u=new Ae(s.family,s.style,s.size,s.weight,s.xAlign,s.yAlign,s.color));var c=new Ee(s.offset,l,u),h=new je(this.draw2D,[c]),f=new Sr(h,s.transform,s.color,this.limits);return null!=e.pulse&&"function"!=typeof f.pulseDefault&&(f.pulseDefault.scale=e.pulse),null!=e.mods&&e.mods!=={}&&f.setProperties(e.mods),f}},{key:"arrow",value:function(){for(var t={width:.5,legWidth:0,height:.5,legHeight:0,color:[1,0,0,1],transform:new pt("arrow").standard(),tip:new Y(0,0),rotation:0},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Object.assign.apply(Object,[{},t].concat(n));if(null!=r.position){var o=K(r.position);r.transform.updateTranslation(o)}var a=new ra(this.webgl,r.width,r.legWidth,r.height,r.legHeight,K(r.tip),r.rotation,r.color,r.transform,this.limits);return null!=r.pulse&&"function"!=typeof a.pulseDefault&&(a.pulseDefault.scale=r.pulse),null!=r.mods&&r.mods!=={}&&a.setProperties(r.mods),a}},{key:"htmlElement",value:function(t,e,n,i,r,o){var a=1<arguments.length&&void 0!==e?e:"id__temp_".concat(Math.round(1e4*Math.random())),s=2<arguments.length&&void 0!==n?n:"",l=3<arguments.length&&void 0!==i?i:new Y(0,0),u=4<arguments.length&&void 0!==r?r:"middle",c=5<arguments.length&&void 0!==o?o:"left",h=document.createElement("div");s&&h&&s.split(" ").forEach((function(t){return h.classList.add(t.trim())})),Array.isArray(t)?t.forEach((function(t){return h.appendChild(t)})):h.appendChild(t),h.style.position="absolute",h.setAttribute("id",a),this.htmlCanvas.appendChild(h);var f=new he(this.htmlCanvas,a,new Y(0,0),u,c);return new Sr(f,(new pt).scale(1,1).translate(l.x,l.y),[1,1,1,1],this.limits)}},{key:"htmlImage",value:function(){for(var t={id:Kt("id__html_image_"),classes:"",position:new Y(0,0),yAlign:"middle",xAlign:"left",src:""},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n)),o=document.createElement("img");o.src=r.src;var a=r.id,s=r.classes,l=r.position,u=r.yAlign,c=r.xAlign,h=this.htmlElement(o,a,s,K(l),u,c);return null!=r.color&&h.setColor(r.color),null!=r.pulse&&"function"!=typeof h.pulseDefault&&(h.pulseDefault.scale=r.pulse),h}},{key:"htmlText",value:function(){for(var t={text:"",id:Kt("id__html_text_"),classes:"",position:new Y(0,0),yAlign:"middle",xAlign:"left"},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n)),o=document.createElement("div");Qr(o,r.text,r.modifiers);var a=r.id,s=r.classes,l=r.position,u=r.yAlign,c=r.xAlign,h=this.htmlElement(o,a,s,K(l),u,c);return null!=r.color&&h.setColor(r.color),null!=r.pulse&&"function"!=typeof h.pulseDefault&&(h.pulseDefault.scale=r.pulse),h}},{key:"lines",value:function(t,e,n,i){var r=1<arguments.length&&void 0!==e?e:1,o=2<arguments.length?n:void 0,a=3<arguments.length&&void 0!==i?i:new pt;return $o(this.webgl,t,r,o,a,this.limits)}},{key:"grid",value:function(){for(var t={bounds:new X(-1,-1,2,2),xStep:.1,yStep:.1,xOffset:0,yOffset:0,numLinesThick:1,color:[1,0,0,1],position:null,transform:new pt("grid").standard()},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));if(null!=r.position){var o=K(r.position);r.transform.updateTranslation(o)}var a=[],s=r.bounds,l=r.xStep,u=r.xOffset,c=r.yStep,f=r.yOffset,d=r.color,p=r.numLinesThick,v=r.transform;if(0!==r.xStep)for(var m=s.left+u;h(m,8)<=s.right;m+=l)a.push([new Y(m,s.top),new Y(m,s.bottom)]);if(0!==c)for(var y=s.bottom+f;h(y,8)<=s.top;y+=c)a.push([new Y(s.left,y),new Y(s.right,y)]);var g=this.lines(a,p,d,v);return null!=r.pulse&&"function"!=typeof g.pulseDefault&&(g.pulseDefault.scale=r.pulse),g}},{key:"horizontalLine",value:function(t,e,n,i,r,o){var a=5<arguments.length&&void 0!==o?o:new pt;return po(this.webgl,t,e,n,i,r,a,this.limits)}},{key:"dashedLine",value:function(){for(var t={start:[0,0],length:1,width:.01,rotation:0,dashStyle:[.1,.1],transform:new pt("dashedLine").scale(1,1).rotate(0).translate(0,0),position:null},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));null!=r.position&&r.transform.updateTranslation(K(r.position));var o=xo(this.webgl,K(r.start),r.length,r.width,r.rotation,r.dashStyle,r.color,r.transform,this.limits);return null!=r.pulse&&"function"!=typeof o.pulseDefault&&(o.pulseDefault.scale=r.pulse),o}},{key:"rectangle",value:function(){for(var t={yAlign:"middle",xAlign:"center",width:1,height:1,lineWidth:.01,corner:{radius:0,sides:1},fill:!1,color:[1,0,0,1],transform:new pt("rectangle").scale(1,1).rotate(0).translate(0,0),position:null},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r,o,a,s,l,u,c,h,f,d,p,v,m,y,g,w,b,x,_,S,O,k,T,P,A,E,j=Yt.apply(void 0,[{},t].concat(n));return null!=j.position&&j.transform.updateTranslation(K(j.position)),"string"!=typeof j.reference&&(j.reference=K(j.reference)),r=j.fill?(g=this.webgl,w=j.xAlign,b=j.yAlign,x=j.width,_=j.height,S=j.corner.radius,O=j.corner.sides,k=j.color,T=j.transform,P=this.limits,A=new Po(g,w,b,x,_,S,O),E=new pt,E=T instanceof Y?E.translate(T.x,T.y):T._dup(),new Sr(A,E,k,P)):(o=this.webgl,a=j.xAlign,s=j.yAlign,l=j.width,u=j.height,c=j.lineWidth,h=j.corner.radius,f=j.corner.sides,d=j.color,p=j.transform,v=this.limits,m=new Co(o,a,s,l,u,c,h,f),y=new pt,y=p instanceof Y?y.translate(p.x,p.y):p._dup(),new Sr(m,y,d,v)),null!=j.pulse&&"function"!=typeof r.pulseDefault&&(r.pulseDefault.scale=j.pulse),r}},{key:"box",value:function(){for(var t={width:1,height:1,fill:!1,lineWidth:.01,color:[1,0,0,1],transform:(new pt).scale(1,1).rotate(0).translate(0,0),position:null},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));null!=r.position&&r.transform.updateTranslation(K(r.position)),"string"!=typeof r.reference&&(r.reference=K(r.reference));var o=function(t,e,n,i,r,o,a,s){var l=new Go(t,e,n,i,r),u=new pt;u=a instanceof Y?u.translate(a.x,a.y):a._dup();var c=new Sr(l,u,o,s);return c.surround=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"diagram",r=[t];if(null!=e&&""!==e&&(r=t.getElements(e)),0!==r.length){for(var o=K(n),a=r[0].getBoundingRect(i),s=1;s<r.length;s+=1){var l=r[s].getBoundingRect(i);l.left<a.left&&(a.left=l.left),l.bottom<a.bottom&&(a.bottom=l.bottom),l.right-a.left>a.width&&(a.width=l.right-a.left),l.top-a.bottom>a.height&&(a.height=l.top-a.bottom)}a.left-=o.x,a.bottom-=o.y,a.height+=2*o.x,a.width+=2*o.y,a.right=a.left+a.width,a.top=a.bottom+a.height,c.drawingObject.updateBox(a.width,a.height),c.setPosition(a.left+a.width/2,a.bottom+a.height/2)}},c}(this.webgl,r.width,r.height,r.lineWidth,r.fill,r.color,r.transform,this.limits);return null!=r.pulse&&"function"!=typeof o.pulseDefault&&(o.pulseDefault.scale=r.pulse),o}},{key:"radialLines",value:function(){for(var t={innerRadius:0,outerRadius:1,width:.05,dAngle:Math.PI/4,angle:2*Math.PI,transform:(new pt).standard()},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));null!=r.position&&r.transform.updateTranslation(K(r.position));var o=so(this.webgl,r.innerRadius,r.outerRadius,r.width,r.dAngle,r.angle,r.color,r.transform,this.limits);return null!=r.pulse&&"function"!=typeof o.pulseDefault&&(o.pulseDefault.scale=r.pulse),o}},{key:"repeatPatternVertex",value:function(){for(var t={element:null,xNum:2,yNum:2,xStep:1,yStep:1,transform:new pt("repeatPattern").standard()},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));null!=r.position&&r.transform.updateTranslation(K(r.position));var o=r.element,a=r.transform,s=r.xNum,l=r.yNum,u=r.xStep,c=r.yStep;if(null==o)return this.collection();var h=o._dup(),f=o.drawingObject;if(f instanceof ye){h.transform=a._dup();for(var d=[],p=f.points,v=0;v<s;v+=1)for(var m=0;m<l;m+=1)for(var y=0;y<p.length;y+=2)d.push(new Y(p[y]+v*u,p[y+1]+m*c));h.drawingObject.changeVertices(d)}return null!=r.pulse&&"function"!=typeof o.pulseDefault&&(h.pulseDefault.scale=r.pulse),h}},{key:"collection",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},n=new pt("collection").scale(1,1).rotate(0).translate(0,0),i=[1,0,0,1],r=null;if(e instanceof Y)n.updateTranslation(e);else if(e instanceof pt)n=e._dup();else{for(var o=arguments.length,a=new Array(1<o?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];var l=Yt.apply(void 0,[e].concat(a));null!=l.transform&&(n=l.transform),null!=l.position&&n.updateTranslation(K(l.position)),null!=l.color&&(i=l.color),null!=l.pulse&&(r=l.pulse)}var u=new Or(n,this.limits);return u.setColor(i),null!=r&&"function"!=typeof u.pulseDefault&&(u.pulseDefault.scale=r),u}},{key:"repeatPattern",value:function(t,e,n,i,r,o){var a,s=5<arguments.length&&void 0!==o?o:new pt;a=s instanceof pt?this.collection({transform:s}):this.collection({transform:(new pt).translate(s)});var l=t.transform.t(),u=t.transform._dup();if(null===l&&(l=new Y(0,0),u=u.translate(0,0)),l)for(var c=0;c<e;c+=1)for(var h=0;h<n;h+=1){var f=t._dup();f.transform=u._dup(),f.transform.updateTranslation(l.x+i*c,l.y+r*h),a.add("xy".concat(c).concat(h),f)}return a}},{key:"repeatPatternVertexLegacy",value:function(t,e,n,i,r,o){var a=5<arguments.length&&void 0!==o?o:new pt,s=t._dup(),l=t.drawingObject;if(l instanceof ye){s.transform=a._dup();for(var u=[],c=l.points,h=0;h<e;h+=1)for(var f=0;f<n;f+=1)for(var d=0;d<c.length;d+=2)u.push(new Y(c[d]+h*i,c[d+1]+f*r));s.drawingObject.changeVertices(u)}return s}},{key:"axes",value:function(){for(var t={width:1,height:1,limits:new X(-1,-1,2,2),yAxisLocation:0,xAxisLocation:0,stepX:.1,stepY:.1,fontSize:.13,showGrid:!0,color:[1,1,1,0],location:new pt,decimalPlaces:1,lineWidth:.01},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=Yt.apply(void 0,[{},t].concat(n));null==r.fontColor&&(r.fontColor=r.color.slice()),null==r.gridColor&&(r.gridColor=r.color.slice());var o=r.width,a=r.lineWidth,s=r.limits,l=r.color,u=r.stepX,c=r.decimalPlaces,f=r.yAxisLocation,d=r.xAxisLocation,p=r.fontSize,v=r.height,m=r.stepY,y=r.location,g=r.showGrid,w=r.gridColor,b=r.fontColor,_=new da("x",0);_.minorTicks.mode="off",_.minorGrid.mode="off",_.majorGrid.mode="off",_.length=o,_.width=a,_.limits={min:s.left,max:s.right},_.color=l.slice(),_.title="",_.majorTicks.start=s.left,_.majorTicks.step=u,_.majorTicks.length=5*a,_.majorTicks.offset=-_.majorTicks.length/2,_.majorTicks.width=2*a,_.majorTicks.labelMode="off",_.majorTicks.color=l.slice(),_.majorTicks.labels=x(_.limits.min,_.limits.max,u).map((function(t){return t.toFixed(c)})).map((function(t){return t===f.toString()&&f===d?"".concat(t,"     "):t})),_.majorTicks.labelOffset=new Y(0,_.majorTicks.offset-.1*p),_.majorTicks.labelsHAlign="center",_.majorTicks.labelsVAlign="top",_.majorTicks.fontColor=b.slice(),_.majorTicks.fontSize=p,_.majorTicks.fontWeight="400";var S=new Ea(this.webgl,this.draw2D,_,(new pt).scale(1,1).rotate(0).translate(0,d-s.bottom*v/2),this.limits),O=new da("x",0);O.minorTicks.mode="off",O.minorGrid.mode="off",O.majorGrid.mode="off",O.length=v,O.width=_.width,O.limits={min:s.bottom,max:s.top},O.color=_.color,O.title="",O.rotation=Math.PI/2,O.majorTicks.step=m,O.majorTicks.start=s.bottom,O.majorTicks.length=_.majorTicks.length,O.majorTicks.offset=-O.majorTicks.length/2,O.majorTicks.width=_.majorTicks.width,O.majorTicks.labelMode="off",O.majorTicks.color=l.slice(),O.majorTicks.labels=x(O.limits.min,O.limits.max,m).map((function(t){return t.toFixed(c)})).map((function(t){return t===d.toString()&&f===d?"":t})),O.majorTicks.labelOffset=new Y(O.majorTicks.offset-.2*p,0),O.majorTicks.labelsHAlign="right",O.majorTicks.labelsVAlign="middle",O.majorTicks.fontColor=_.majorTicks.fontColor,O.majorTicks.fontSize=p,O.majorTicks.fontWeight=_.majorTicks.fontWeight;var k=new Ea(this.webgl,this.draw2D,O,(new pt).scale(1,1).rotate(0).translate(f-s.left*o/2,0),this.limits),T=new pt;T=y instanceof Y?T.translate(y.x,y.y):y._dup();var P=this.collection(T);if(g){var A=this.grid({bounds:new X(0,0,o,v),stepX:h(u*o/s.width,8),stepY:h(m*v/s.height,8),numThickLines:1,color:w,transform:(new pt).scale(1,1).rotate(0).translate(0,0)});P.add("grid",A)}return P.add("y",k),P.add("x",S),null!=r.pulse&&"function"!=typeof P.pulseDefault&&(P.pulseDefault.scale=r.pulse),P}},{key:"parallelMarks",value:function(){for(var t=this,e={width:.01,num:1,length:.1,angle:Math.PI/4,step:.04,rotation:0,color:[1,0,0,1],transform:(new pt).scale(1,1).rotate(0).translate(0,0),position:null},n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{},e].concat(i));null!=o.position&&o.transform.updateTranslation(K(o.position));var a=o.length*Math.cos(o.angle),s=o.length*Math.sin(o.angle),l=Math.abs(o.width*Math.cos(o.angle+Math.PI/2)),u=o.width*Math.sin(o.angle+Math.PI/2),c=[new Y(0,0),new Y(0-a,0-s),new Y(-a-l,u-s),new Y(-Math.abs(o.width/Math.cos(o.angle+Math.PI/2)),0),new Y(-a-l,s-u),new Y(0-a,0+s)],h=this.collection(o.transform);h.setColor(o.color),null!=o.pulse&&"function"!=typeof h.pulseDefault&&(h.pulseDefault.scale=o.pulse);for(var f=-(o.num-1)/2*o.step,d=function(e){var n=c.map((function(t){return new Y(t.x+f+e*o.step,t.y).rotate(o.rotation)}));h.add("".concat(e),t.fan({points:n,color:o.color}))},p=0;p<o.num;p+=1)d(p);return h}},{key:"marks",value:function(){for(var t=this,e={width:.01,num:1,length:.2,angle:Math.PI/2,step:.04,rotation:0,color:[1,0,0,1],transform:(new pt).scale(1,1).rotate(0).translate(0,0),position:null},n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=Yt.apply(void 0,[{},e].concat(i));null!=o.position&&o.transform.updateTranslation(K(o.position));var a=[new Y(o.length/2,o.width/2),new Y(o.length/2,-o.width/2),new Y(-o.length/2,-o.width/2),new Y(-o.length/2,o.width/2)],s=this.collection(o.transform);s.setColor(o.color),null!=o.pulse&&"function"!=typeof s.pulseDefault&&(s.pulseDefault.scale=o.pulse);for(var l=-(o.num-1)/2*o.step,u=function(e){var n=(new pt).rotate(o.angle).translate(l+e*o.step,0).rotate(o.rotation),i=a.map((function(t){return t._dup().transformBy(n.matrix())}));s.add("".concat(e),t.fan({points:i,color:o.color}))},c=0;c<o.num;c+=1)u(c);return s}}])&&ns(e.prototype,n),t}();function as(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var ss=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=Yt({width:0,height:0,ascent:0,descent:0,left:0,right:0,top:0,bottom:0},e);this.copyFrom(n)}var e,n;return e=t,(n=[{key:"copyFrom",value:function(t){null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height),null!=t.ascent&&(this.ascent=t.ascent),null!=t.descent&&(this.descent=t.descent),null!=t.left&&(this.left=t.left),null!=t.right&&(this.right=t.right),null!=t.top&&(this.top=t.top),null!=t.bottom&&(this.bottom=t.bottom)}},{key:"leftOffset",value:function(t){this.left+=t,this.width=this.right-this.left}},{key:"rightOffset",value:function(t){this.right+=t,this.width=this.right-this.left}},{key:"topOffset",value:function(t){this.top+=t,this.ascent+=t,this.height=this.ascent+this.descent}},{key:"bottomOffset",value:function(t){this.bottom+=t,this.descent-=t,this.height=this.ascent+this.descent}},{key:"offset",value:function(t,e,n,i){this.left+=i,this.right+=e,this.top+=t,this.ascent+=t,this.descent-=n,this.bottom+=n,this.width=this.right-this.left,this.height=this.ascent+this.descent}},{key:"growWithSameBaseline",value:function(t){var e=this.bottom+this.descent;t.left<this.left&&(this.left=t.left),t.right>this.right&&(this.right=t.right),t.top>this.top&&(this.top=t.top),t.bottom<this.bottom&&(this.bottom=t.bottom),this.width=this.right-this.left,this.height=this.top-this.bottom,this.ascent=this.top-e,this.descent=e-this.bottom}}])&&as(e.prototype,n),t}();function ls(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function us(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function hs(t,e,n){return e&&cs(t.prototype,e),n&&cs(t,n),t}var fs=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.03,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;us(this,t),this.width=e,this.ascent=n,this.descent=i,this.height=this.ascent+this.descent}return hs(t,[{key:"_dup",value:function(){return new t(this.width,this.ascent,this.descent)}}]),t}(),ds=function(){function t(e){us(this,t),this.content=e,this.ascent=0,this.descent=0,this.width=0,this.location=new Y(0,0),this.height=0,this.fullSize={leftOffset:0,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent}}return hs(t,[{key:"calcSize",value:function(t,e){var n=this.content;if(n instanceof fs&&(this.width=n.width*e,this.height=n.height*e,this.ascent=n.ascent*e,this.descent=n.descent*e,this.location=t._dup(),this.scale=e),n instanceof Or||n instanceof Sr){n.transform.updateTranslation(t.x,t.y),n.transform.updateScale(e,e),n.updateLastDrawTransform(),null!=n.internalSetTransformCallback&&n.internalSetTransformCallback(n.transform);var i=n.getRelativeVertexSpaceBoundingRect();this.location=t._dup(),this.scale=e,this.ascent=i.top*e,this.descent=-i.bottom*e,this.height=i.height*e,this.width=i.width*e}this.fullSize={leftOffset:0,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent}}},{key:"_dup",value:function(e){var n;return(n=this.content instanceof fs?new t(this.content):new t(e?e[this.content.name]:this.content)).ascent=this.ascent,n.descent=this.descent,n.width=this.width,n.location=this.location._dup(),n.height=this.height,n.scale=this.scale,n}},{key:"getAllElements",value:function(){return this.content instanceof fs?[]:[this.content]}},{key:"setPositions",value:function(){var t=this.content;(t instanceof Or||t instanceof Sr)&&(t.transform.updateTranslation(this.location.x,this.location.y),t.transform.updateScale(this.scale,this.scale),t.updateLastDrawTransform())}},{key:"offsetLocation",value:function(t){var e=0<arguments.length&&void 0!==t?t:new Y(0,0);this.location=this.location.add(e)}},{key:"getBounds",value:function(t){return 0<arguments.length&&void 0!==t&&t&&null!=this.fullSize?new ss({left:this.location.x+this.fullSize.leftOffset,right:this.location.x+this.fullSize.leftOffset+this.fullSize.width,top:this.location.y+this.fullSize.ascent,bottom:this.location.y-this.fullSize.descent,width:this.fullSize.width,height:this.fullSize.height,ascent:this.fullSize.ascent,descent:this.fullSize.descent}):new ss({left:this.location.x,right:this.location.x+this.width,top:this.location.y+this.ascent,bottom:this.location.y-this.descent,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent})}}]),t}(),ps=function(){function t(e){us(this,t);var n=[];e.forEach((function(t){null!==t&&n.push(t)})),this.content=n,this.ascent=0,this.descent=0,this.width=0,this.location=new Y(0,0),this.height=0}return hs(t,[{key:"_dup",value:function(e){var n=[];this.content.forEach((function(t){return n.push(t._dup(e))}));var i=new t(n);return Qt(this,i,["content"]),i}},{key:"calcSize",value:function(t,e){var n=0,i=0,r=t._dup(),o=null;this.content.forEach((function(t){t.calcSize(r,e),r.x+=t.width,t.descent>n&&(n=t.descent),t.ascent>i&&(i=t.ascent);var a=t.getBounds(!0);null==o&&(o=new ss).copyFrom(a)})),null===o&&((o=new ss).left=t.x,o.top=t.y,o.bottom=t.y),this.width=r.x-t.x,this.ascent=i,this.descent=n,this.location=t._dup(),this.height=this.descent+this.ascent,this.fullSize={leftOffset:this.location.x-o.left,width:o.width,ascent:o.ascent,descent:o.descent,height:o.height}}},{key:"getAllElements",value:function(){var t=[];return this.content.forEach((function(e){t=[].concat(ls(t),ls(e.getAllElements()))})),t}},{key:"setPositions",value:function(){this.content.forEach((function(t){t.setPositions()}))}},{key:"offsetLocation",value:function(t){var e=0<arguments.length&&void 0!==t?t:new Y(0,0);this.location=this.location.add(e),this.content.forEach((function(t){t.offsetLocation(e)}))}},{key:"getBounds",value:function(t){return 0<arguments.length&&void 0!==t&&t&&null!=this.fullSize?new ss({left:this.location.x+this.fullSize.leftOffset,right:this.location.x+this.fullSize.leftOffset+this.fullSize.width,top:this.location.y+this.fullSize.ascent,bottom:this.location.y-this.fullSize.descent,width:this.fullSize.width,height:this.fullSize.height,ascent:this.fullSize.ascent,descent:this.fullSize.descent}):new ss({left:this.location.x,right:this.location.x+this.width,top:this.location.y+this.ascent,bottom:this.location.y-this.descent,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent})}}]),t}();function vs(t){return(vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ms(t){return(ms=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ys(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function gs(t,e){return(gs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ws=function(){var t,e;function n(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(i=function(t,e){return!e||"object"!==vs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ms(n).call(this,t))).glPrimitive="strip"===e?i.gl[0].TRIANGLE_STRIP:"fan"===e?i.gl[0].TRIANGLE_FAN:i.gl[0].TRIANGLES,i.points=[],i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gs(t,e)}(n,ye),t=n,(e=[{key:"updatePoints",value:function(t,e,n,i){var r=this,o=3<arguments.length&&void 0!==i&&i;this.points=[],t.forEach((function(t){r.points.push(t.x),r.points.push(t.y)})),this.border[0]=[new Y(0,0),new Y(e,0),new Y(e,n),new Y(0,n)],o?this.setupBuffer():this.resetBuffer()}}])&&ys(t.prototype,e),n}();function bs(t){return(bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xs(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ss(t){return(Ss=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Os(t,e){return(Os=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ks=function(){function t(e,n,i,r,o,a){var s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var l,u=new ws(e,a);return l=i instanceof pt?i:new pt("Symbol").scale(1,1).translate(0,0),(s=function(t,e){return!e||"object"!==bs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Ss(t).call(this,u,l,n,r))).custom.options=o,"dynamic"===s.custom.options.draw&&(s.custom.scale=new Y(1,1),s.internalSetTransformCallback=function(){var t=s.getScale();if(s.custom.scale.isNotEqualTo(t,8)){var e=xs(s.getPoints(s.custom.options,t.x,t.y),3),n=e[0],i=e[1],r=e[2];s.drawingObject.updatePoints(n,i,r),s.custom.scale=t}}),s.custom.setSize=function(t,e,n){var i=s.transform._dup();if("static"===s.custom.options.draw){var r,a=0,l=0;if("first"===s.custom.options.staticHeight||"first"===s.custom.options.staticWidth){var u=xs(s.getPoints(o,e,n),3);r=u[0],a=u[1],l=u[2]}else if(null!=s.custom.options.staticHeight||null!=s.custom.options.staticWidth){var c=xs(s.getPoints(o,s.custom.options.staticWidth,s.custom.options.staticHeight),3);r=c[0],a=c[1],l=c[2]}s.drawingObject.updatePoints(r,a,l),s.custom.options.staticHeight=l,s.custom.options.staticWidth=a,i.updateScale(a,l)}else{var h=xs(s.getPoints(s.custom.options,e,n),3),f=h[0],d=h[1],p=h[2];s.drawingObject.updatePoints(f,d,p),s.custom.scale=new Y(e,n),i.updateScale(e,n)}i.updateTranslation(t.x,t.y),s.setTransform(i)},s}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Os(t,e)}(t,Sr),e=t,(n=[{key:"getTransform",value:function(){if("static"===this.custom.options.draw){var t=this.transform._dup(),e=t.s();return null!=e&&t.updateScale(e.x/this.custom.options.staticWidth,e.y/this.custom.options.staticHeight),t}var n=this.transform._dup();return n.updateScale(1,1),n}},{key:"getWidth",value:function(t,e){var n;if("static"!==t.draw)return n=t.width,this.getDefaultValues(e,n,t).width;var i=t.staticHeight,r=t.staticWidth;return"first"===i&&(i=e),null==(n=this.getDefaultValues(i,r,t).width)&&(n=e),n/i*e}},{key:"getHeight",value:function(t,e){var n;if("static"!==t.draw)return n=t.height,this.getDefaultValues(n,e,t).height;var i=t.staticWidth,r=t.staticHeight;return"first"===i&&(i=e),null==(n=this.getDefaultValues(r,i,t).height)&&(n=e),n/i*e}},{key:"getBounds",value:function(t,e,n,i,r,o){var a=this.getDefaultValues(r,i,t),s=a.width,l=a.height,u=new ss;return"left"===o?(u.left=e-s,u.bottom=n,u.top=u.bottom+l):"right"===o?(u.left=e,u.bottom=n,u.top=u.bottom+l):("top"===o?(u.bottom=n,u.top=n+l):(u.top=n,u.bottom=n-l),u.left=e+i/2-s/2),u.right=u.left+s,u.width=s,u.height=l,u.ascent=l,u.descent=0,u}},{key:"getPoints",value:function(t,e,n){return[[new Y(0,0),new Y(e,0),new Y(e,n),new Y(0,n)],e,n]}},{key:"getDefaultValues",value:function(){return{}}}])&&_s(e.prototype,n),t}();function Ts(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ps(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function As(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Es(t,e){var n=[];return t.forEach((function(t){var i,r;n.push((r=e,{xPosition:(i=t).xPosition,yPosition:i.yPosition,xAlign:i.xAlign,yAlign:i.yAlign,offset:i.offset._dup(),scale:i.scale,content:i.content._dup(r),inSize:i.inSize,fullContentBounds:i.fullContentBounds}))})),n}function js(t){var e=[];return t.forEach((function(t){e=[].concat(As(e),As(t.content.getAllElements()))})),e}function Ms(t){t.forEach((function(t){t.content.setPositions()}))}function Ls(t,e){t.forEach((function(t){t.content.offsetLocation(e)}))}var Cs=function(){function t(e,n,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.glyphs=i,this.content=e,this.annotations=n,this.options=r}var e,n;return e=t,(n=[{key:"_dup",value:function(t){var e,n,i,r=this.content._dup(t),o=(e=this.glyphs,i={},Object.keys(e).forEach((function(t){if(null!=e[t]){var r=e[t],o={};Qt(r,o,["glyph","annotations"]),o.glyph=r.glyph,o.annotations=Es(r.annotations,n),i[t]=o}})),i),a=Es(this.annotations),s=new this.constructor(r,a,o,this.options);return Qt(this,s,["content","glyphs","annotations"]),s}},{key:"getAllElements",value:function(){return[].concat(As(this.content.getAllElements()),As(js(this.annotations)),As((t=this.glyphs,e=[],Object.keys(t).forEach((function(n){var i=t[n];null!=i&&(e=[].concat(As(e),[i.glyph],As(js(i.annotations))))})),e)));var t,e}},{key:"setPositions",value:function(){var t;this.content.setPositions(),Ms(this.annotations),t=this.glyphs,Object.keys(t).forEach((function(e){if(null!=t[e]){var n=t[e],i=n.glyph.transform._dup();i.updateScale(n.width,n.height),i.updateTranslation(n.location.x,n.location.y),n.glyph.setTransform(i),Ms(n.annotations)}}))}},{key:"offsetLocation",value:function(t){var e,n,i=0<arguments.length&&void 0!==t?t:new Y(0,0);this.location=this.location.add(i),this.content.offsetLocation(i),Ls(this.annotations,i),e=this.glyphs,n=i,Object.keys(e).forEach((function(t){if(null!=e[t]){var i=e[t];i.location=i.location.add(n),Ls(i.annotations,n)}}))}},{key:"calcSize",value:function(t,e){var n=this;this.location=t._dup();var i=t._dup(),r=this.content,o=this.annotations,a=this.options,s=a.inSize,l=a.space,u=a.topSpace,c=a.bottomSpace,h=a.leftSpace,f=a.rightSpace,d=a.contentScale,p=a.useFullBounds,v=a.fullContentBounds,m=new ss,y=new ss,g=new ss;r.calcSize(i._dup(),e*d),g.copyFrom(r.getBounds(v)),m.copyFrom(g),y.copyFrom(g),o.forEach((function(t){t.content.calcSize(i,e*t.scale),n.setAnnotationPosition(g,t,e);var r=t.content.getBounds();m.growWithSameBaseline(r);var o=t.content.getBounds(!0);y.growWithSameBaseline(o)}));var w=Ts(this.setEncompassGlyph(e,g),2),b=w[0],x=w[1];m.growWithSameBaseline(b),y.growWithSameBaseline(x);var _=Ts(this.setVerticalGlyph(e,g,"left"),2),S=_[0],O=_[1];m.growWithSameBaseline(S),y.growWithSameBaseline(O);var k=Ts(this.setVerticalGlyph(e,g,"right"),2),T=k[0],P=k[1];m.growWithSameBaseline(T),y.growWithSameBaseline(P);var A=Ts(this.setHorizontalGlyph(e,g,"top"),2),E=A[0],j=A[1];m.growWithSameBaseline(E),y.growWithSameBaseline(j);var M=Ts(this.setHorizontalGlyph(e,g,"bottom"),2),L=M[0],C=M[1];m.growWithSameBaseline(L),y.growWithSameBaseline(C);var B=0,R=(null!=u?u:l||0)*e,F=(null!=c?c:l||0)*e,D=(null!=h?h:l||0)*e,I=(null!=f?f:l||0)*e;if(m.offset(R,I,-F,-D),y.growWithSameBaseline(m),p&&m.copyFrom(y),s?(this.width=m.width,this.ascent=m.ascent,this.descent=m.descent,this.height=m.height,B=i.x-m.left):(this.width=g.width,this.ascent=g.ascent,this.descent=g.descent,this.height=g.height),this.fullSize={leftOffset:this.location.x-y.left,width:y.width,ascent:y.ascent,descent:y.descent,height:y.height},0!==B&&null!=r){var W=new Y(B,0);r.offsetLocation(W),o.forEach((function(t){t.content.offsetLocation(W)})),Object.keys(this.glyphs).forEach((function(t){var e=n.glyphs[t];null!=e&&(e.location=e.location.add(W),e.glyph.custom.setSize(e.location,e.width,e.height),e.annotations.forEach((function(t){t.content.offsetLocation(W)})))}))}}},{key:"setEncompassGlyph",value:function(t,e){var n=this;if(null==this.glyphs.encompass){var i=new ss;return i.copyFrom(e),[e,i]}var r=this.glyphs.encompass,o=r.leftSpace,a=r.rightSpace,s=r.bottomSpace,l=r.topSpace,u=r.space,c=this.glyphs.encompass,h=null!=u?u:0,f=null!=o?o:h,d=null!=a?a:h,p=null!=l?l:h,v=null!=s?s:h,m=new ss;m.copyFrom(e),m.offset(p*t,d*t,-v*t,-f*t);var y=c.glyph.getBounds(c.glyph.custom.options,m.left,m.bottom,m.width,m.height),g=new ss,w=new ss;return g.copyFrom(m),g.growWithSameBaseline(y),w.copyFrom(g),c.width=y.width,c.height=y.height,c.location=new Y(y.left,y.bottom),c.glyph.custom.setSize(c.location,c.width,c.height),c.annotations.forEach((function(e){e.content.calcSize(c.location,t*e.scale),n.setAnnotationPosition(y,e,t);var i=e.content.getBounds();g.growWithSameBaseline(i);var r=e.content.getBounds(!0);w.growWithSameBaseline(r)})),[g,w]}},{key:"setVerticalGlyph",value:function(t,e,n){var i=this;if(null==this.glyphs[n]){var r=new ss;return r.copyFrom(e),[e,r]}var o=this.glyphs[n],a=o.space,s=o.overhang,l=o.topSpace,u=o.bottomSpace,c=o.minContentHeight,h=o.minContentDescent,f=o.minContentAscent,d=o.descent,p=o.height,v=o.yOffset,m=o.annotationsOverContent,y=this.glyphs[n],g=e.height,w=e.left,b=e.bottom,x=e.descent,_=e.ascent;null!=h&&(x=Math.max(h,x),g=e.ascent+x),null!=f&&(g=(_=Math.max(f,_))+x),null!=c&&(_=-x+Math.max(c,g)),x+=t*(null!=u?u:s),null!=d&&(x=d),g=x+(_+=t*(null!=l?l:s)),null!=p&&(_=(g=p)-x),b=e.bottom-(x-e.descent),"left"===n?w-=a*t:w=e.left+e.width+a*t,null==d&&null==u&&null!=p&&(b=e.bottom+e.height/2-p/2);var S=y.glyph.getBounds(y.glyph.custom.options,w,b+v,null,g,n),O=new ss,k=new ss;O.copyFrom(e),O.growWithSameBaseline(S),k.copyFrom(O);var T=new ss;T.copyFrom(S),y.width=S.width,y.height=S.height,y.location=new Y(S.left,S.bottom),y.glyph.custom.setSize(y.location,y.width,y.height),y.annotations.forEach((function(e){e.content.calcSize(y.location,t*e.scale),i.setAnnotationPosition(S,e,t);var n=e.content.getBounds();O.growWithSameBaseline(n),T.growWithSameBaseline(n);var r=e.content.getBounds(!0);k.growWithSameBaseline(r)}));var P=0;if("left"===n&&T.right>w&&!1===m&&(P=w-T.right),"right"===n&&T.left<w&&!1===m&&(P=w-T.left),0!==P){var A=new Y(P,0);y.location=y.location.add(A),y.glyph.custom.setSize(y.location,y.width,y.height),y.annotations.forEach((function(t){t.content.offsetLocation(A)})),O.left+=P,O.right=Math.max(O.right+P,e.right),k.left+=P,k.right=Math.max(O.right+P,e.right)}return[O,k]}},{key:"setHorizontalGlyph",value:function(t,e,n){var i=this;if(null==this.glyphs[n]){var r=new ss;return r.copyFrom(e),[e,r]}var o=this.glyphs[n],a=o.space,s=o.overhang,l=o.width,u=o.leftSpace,c=o.rightSpace,h=o.xOffset,f=o.annotationsOverContent,d=this.glyphs[n],p=new ss;p.copyFrom(e);var v,m=p.width,y=p.left;null!=s&&(m+=2*s*t,y=p.left-s*t),null!=l&&(m=l*t),null==u&&null==c||(m=(u||0)*t+p.width+(c||0)*t,null!=u&&(y=p.left-u*t)),null==u&&null==c&&null!=l?y=p.left+(p.width-l)/2:null==u&&null!=c&&null!=l&&(y=p.right+c*t-l),v="top"===n?p.top+a*t:p.bottom-a*t;var g=d.glyph.getBounds(d.glyph.custom.options,y+h,v,m,null,n),w=new ss,b=new ss;w.copyFrom(p),w.growWithSameBaseline(g),b.copyFrom(w);var x=new ss;x.copyFrom(g),d.width=g.width,d.height=g.height,d.location=new Y(g.left,g.bottom),d.glyph.custom.setSize(d.location,d.width,d.height),d.annotations.forEach((function(e){e.content.calcSize(d.location,t*e.scale),i.setAnnotationPosition(g,e,t);var n=e.content.getBounds();w.growWithSameBaseline(n),x.growWithSameBaseline(n);var r=e.content.getBounds(!0);b.growWithSameBaseline(r)}));var _=0;if("top"===n&&x.bottom<v&&!1===f&&(_=v-x.bottom),"bottom"===n&&x.top>v&&!1===f&&(_=v-x.top),0!==_){var S=new Y(0,_);d.location=d.location.add(S),d.glyph.custom.setSize(d.location,d.width,d.height),d.annotations.forEach((function(t){t.content.offsetLocation(S)})),w.top+=_,w.bottom+=_,b.top+=_,b.bottom+=_}return[w,b]}},{key:"setAnnotationPosition",value:function(t,e,n){var i=e.xPosition,r=e.yPosition,o=e.xAlign,a=e.yAlign,s=e.offset;s=K(s);var l,u,c=e.content,h=e.fullContentBounds,f=new Y(t.left,t.bottom+t.descent);if(null!=t.annotations&&null!=e.reference){var d=t.annotations[e.reference];null!=d.xPosition&&(i=d.xPosition),null!=d.yPosition&&(r=d.yPosition),null!=d.xAlign&&(o=d.xAlign),null!=d.yAlign&&(a=d.yAlign),null!=d.offset&&(s=s.add(K(d.offset)))}if(l=(l="right"===i?1:"center"===i?.5:"number"==typeof i?i:0)*t.width+f.x,"bottom"===r)u=0;else if("middle"===r)u=.5;else if("top"===r)u=1;else if("number"==typeof r)u=r;else if("string"==typeof r&&"a"===r.slice(-1)[0]){var p=parseFloat(r);u=t.ascent/t.height*p+t.descent/t.height}else u=t.descent/t.height;u=u*t.height+f.y-t.descent;var v=c.getBounds(h);if("center"===o?l-=.5*v.width:"right"===o?l-=v.width:"number"==typeof o&&(l-=v.width*o),"bottom"===a)u+=v.descent;else if("middle"===a)u=u+v.descent-v.height/2;else if("top"===a)u-=v.ascent;else if("string"==typeof a&&"a"===a.slice(-1)[0]){var m=parseFloat(a);u-=v.ascent*m}else"number"==typeof a&&(u+=v.descent-v.height*a);var y=K(s);l+=y.x*n,u+=y.y*n;var g=new Y(l,u).sub(v.left,v.bottom+v.descent);c.offsetLocation(g)}},{key:"getBounds",value:function(t){return 0<arguments.length&&void 0!==t&&t&&null!=this.fullSize?new ss({left:this.location.x+this.fullSize.leftOffset,right:this.location.x+this.fullSize.leftOffset+this.fullSize.width,top:this.location.y+this.fullSize.ascent,bottom:this.location.y-this.fullSize.descent,width:this.fullSize.width,height:this.fullSize.height,ascent:this.fullSize.ascent,descent:this.fullSize.descent}):new ss({left:this.location.x,right:this.location.x+this.width,top:this.location.y+this.ascent,bottom:this.location.y-this.descent,width:this.width,height:this.height,ascent:this.ascent,descent:this.descent})}}])&&Ps(e.prototype,n),t}();function Bs(t){return(Bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rs(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Fs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ds(t){return(Ds=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Is(t,e){return(Is=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ws=function(){function t(e,n,i){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var o=[];Array.isArray(n)?n.forEach((function(t){o.push(null!=t?new ds(t):null)})):o.push(null!=n?new ds(n):null);var a=[];Array.isArray(n)?a=n:a.push(n);var s=[];return Array.isArray(e)?s=e:s.push(e),(r=function(t,e){return!e||"object"!==Bs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Ds(t).call(this,[].concat(o,Rs(s))))).glyphs=a,r.contents=s,r.glyphLocations=o.map((function(){return new Y(0,0)})),r.glyphWidths=o.map((function(){return 1})),r.glyphHeights=o.map((function(){return 1})),r.options=i,r}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Is(t,e)}(t,ps),e=t,(n=[{key:"_dup",value:function(t){var e=this.contents.map((function(e){return null==e?null:e._dup(t)})),n=this.glyphs;if(t){var i=[];this.glyphs.forEach((function(e){null!=e?i.push(t[e.name]):i.push(e)})),n=i}var r=new this.constructor(e,n,this.options);return Qt(this,r,["content","contents","glyphs"]),r}},{key:"getAllElements",value:function(){var t=[];return this.contents.forEach((function(e){null!=e&&(t=[].concat(Rs(t),Rs(e.getAllElements())))})),this.glyphs.forEach((function(e){null!=e&&(t=[].concat(Rs(t),[e]))})),t}},{key:"setPositions",value:function(){var t=this;this.glyphs.forEach((function(e,n){if(null!=e){var i=e.getTransform()._dup();i.updateTranslation(t.glyphLocations[n].x,t.glyphLocations[n].y),i.updateScale(t.glyphWidths[n],t.glyphHeights[n]),e.setTransform(i)}})),this.contents.forEach((function(t){null!=t&&t.setPositions()}))}},{key:"offsetLocation",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:new Y(0,0);this.location=this.location.add(n),this.glyphLocations.forEach((function(t,i){null!=e.glyphs[i]&&(e.glyphLocations[i]=t.add(n))})),this.contents.forEach((function(t){null!=t&&t.offsetLocation(n)}))}},{key:"calcSize",value:function(){}}])&&Fs(e.prototype,n),t}();function qs(t){return(qs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hs(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function zs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ns(t,e){return!e||"object"!==qs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Vs(t){return(Vs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gs(t,e){return(Gs=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Us=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ns(this,Vs(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gs(t,e)}(t,Ws),e=t,(n=[{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),i=Hs(this.glyphs,1)[0],r=Hs(this.contents,2),o=r[0],a=r[1],s=this.options,l=s.scaleModifier,u=s.numeratorSpace,c=s.denominatorSpace,h=s.overhang,f=s.offsetY,d=s.fullContentBounds,p=e*l,v=new ss,m=new ss,y=new ss,g=new ss;null!=o&&(o.calcSize(n._dup(),p),m.copyFrom(o.getBounds(d))),null!=a&&(a.calcSize(n._dup(),p),y.copyFrom(a.getBounds(d))),this.location=t._dup(),v.width=Math.max(m.width,y.width)+2*h*p,null!=i&&(v.height=i.getHeight(i.custom.options,v.width));var w=p*f/l,b=new Y(n.x+(v.width-m.width)/2,n.y+w+v.height+u*p+m.descent),x=new Y(n.x+(v.width-y.width)/2,n.y+w-c*p-y.ascent);null!=o&&o.offsetLocation(b.sub(o.location)),null!=a&&a.offsetLocation(x.sub(a.location)),this.width=v.width,this.descent=n.y-(x.y-y.descent),this.descent<0&&(this.descent=0),this.ascent=b.y+m.ascent-n.y,this.height=this.descent+this.ascent,this.glyphLocations[0]=new Y(this.location.x,this.location.y+w),this.glyphWidths[0]=v.width,this.glyphHeights[0]=v.height,g.copyFrom(v),g.left=this.glyphLocations[0].x,g.bottom=this.glyphLocations[0].y,null!=o&&g.growWithSameBaseline(o.getBounds(!0)),null!=a&&g.growWithSameBaseline(a.getBounds(!0)),i&&i.custom.setSize(this.glyphLocations[0],v.width,v.height),this.fullSize={leftOffset:this.location.x-g.left,width:g.width,ascent:g.ascent,descent:g.descent,height:g.height}}}])&&zs(e.prototype,n),t}();function Xs(t){return(Xs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ys(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Qs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ks(t,e){return!e||"object"!==Xs(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Zs(t){return(Zs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $s(t,e){return($s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Js=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ks(this,Zs(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$s(t,e)}(t,Ws),e=t,(n=[{key:"calcSize",value:function(t,e){this.location=t._dup();for(var n=t._dup(),i=.07*e,r=this.options,o=r.order,a=r.fit,s=r.space,l=r.contentScale,u=r.yAlign,c=r.fullContentBounds,h=Ys(o,2),f=h[0],d=h[1],p=[],v=[],m=0,y=[],g=0;g<f;g+=1){y.push([]),p.push([]),v.push([]);for(var w=0;w<d;w+=1){var b=new ss,x=this.contents[m];null!=x&&(x.calcSize(n._dup(),e*l),b.copyFrom(x.getBounds(c))),y[g].push(x),p[g].push(b),v[g].push(new Y(0,0)),m+=1}}var _=function(t,e,n){for(var i=[],r=[],o=[],a=0,s=0,l=0,u=0;u<t;u+=1){for(var c=0,h=0,f=0;f<e;f+=1){var d=n[u][f];(d.ascent>c||0===f)&&(c=d.ascent),(d.descent>h||0===f)&&(h=d.descent)}(a<c||0===u)&&(a=c),(s<h||0===u)&&(s=h);var p=h+c;(l<p||0===u)&&(l=p),o.push(p),i.push(c),r.push(h)}return{ascents:i,descents:r,heights:o,maxAscent:a,maxDescent:s,maxHeight:l}}(f,d,p),S=Ys(function(t,e,n){for(var i=[],r=0,o=0;o<e;o+=1){for(var a=0,s=0;s<t;s+=1){var l=n[s][o].width;a<l&&(a=l),r<l&&(r=l)}i.push(a)}return[i,r]}(f,d,p),2),O=S[0],k=S[1],T=Math.max(k,_.maxHeight);if("min"!==a){var P;"max"===a?P=new Y(T,T):null==(P=Q(a))&&(P=new Y(0,0));for(var A=0;A<f;A+=1)_.heights[A]=P.y;for(var E=0;E<d;E+=1)O[E]=P.x}for(var j=0,M=0,L=f-1;0<=L;--L){for(var C=M=0;C<d;C+=1){var B=p[L][C],R=M+O[C]/2-B.width/2,F=j+_.heights[L]/2-(B.ascent-B.descent)/2;"baseline"===u&&(F=j+_.descents[L]),M+=O[C]+s.x*e,v[L][C]=new Y(R,F)}j+="baseline"===u?_.descents[L]+_.ascents[L]+s.y*e:_.heights[L]+s.y*e}for(var D=j-s.y*e,I=M-s.x*e,W=new ss,q=0;q<f;q+=1)for(var H=0;H<d;H+=1){v[q][H].x+=n.x,v[q][H].y=n.y-D/2+v[q][H].y+i;var z=y[q][H];null!=z&&(z.offsetLocation(v[q][H].sub(z.location)),0===W.width&&W.copyFrom(z.getBounds(!0)),W.growWithSameBaseline(z.getBounds(!0)))}this.width=I,this.height=D,this.descent=D/2-i,this.ascent=D/2+i,this.fullSize={leftOffset:this.location.x-W.left,width:W.width,ascent:W.ascent,descent:W.descent,height:W.height}}}])&&Qs(e.prototype,n),t}();function tl(t){return(tl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function el(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nl(t,e){return!e||"object"!==tl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function il(t){return(il=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rl(t,e){return(rl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ol=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),nl(this,il(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rl(t,e)}(t,Ws),e=t,(n=[{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),i=this.options,r=i.scaleModifier,o=i.fullContentBounds,a=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(this.contents,1)[0],s=new ss,l=new ss;null!=a&&(a.calcSize(n._dup(),e*r),s.copyFrom(a.getBounds(o)),l.copyFrom(a.getBounds(!0))),this.width=s.width,this.height=s.height,this.descent=s.descent,this.ascent=s.ascent,this.fullSize={leftOffset:this.location.x-l.left,width:l.width,ascent:l.ascent,descent:l.descent,height:l.height}}}])&&el(e.prototype,n),t}();function al(t){return(al="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ll(t,e){return!e||"object"!==al(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ul(t){return(ul=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function cl(t,e){return(cl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var hl=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ll(this,ul(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&cl(t,e)}(t,Ws),e=t,(n=[{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),i=this.options,r=i.width,o=i.descent,a=i.ascent,s=i.xAlign,l=i.yAlign,u=i.fit,c=i.scaleModifier,h=i.fullContentBounds,f=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(this.contents,1)[0],d=new ss,p=new ss,v=new ss;if(null!=f&&(f.calcSize(n._dup(),e*c),d.copyFrom(f.getBounds(h)),p.copyFrom(d)),null!=r&&(p.width=r),null!=o&&(p.descent=o),null!=a&&(p.ascent=a),p.height=p.descent+p.ascent,null!=f){if("width"===u)f.calcSize(n._dup(),p.width/d.width);else if("height"===u)f.calcSize(n._dup(),p.height/d.height);else if("contain"===u){var m=Math.min(p.width/d.width,p.height/d.height);f.calcSize(n._dup(),m)}d.copyFrom(f)}var y=n._dup();"center"===s?y.x=n.x+p.width/2-d.width/2:"right"===s?y.x=n.x+p.width-d.width:"number"==typeof s&&(y.x=n.x+p.width*s),"bottom"===l?y.y=n.y-p.descent+d.descent:"middle"===l?y.y=n.y-p.descent+p.height/2-d.height/2+d.descent:"top"===l?y.y=n.y+p.ascent-d.height+d.descent:"number"==typeof l&&(y.y=n.y-p.descent+p.height*l+d.descent),null!=f&&f.offsetLocation(y.sub(f.location)),null!=f?(v.copyFrom(f.getBounds(!0)),v.growWithSameBaseline(p)):v.copyFrom(p),this.width=p.width,this.height=p.height,this.descent=p.descent,this.ascent=p.ascent,this.fullSize={leftOffset:this.location.x-v.left,width:v.width,ascent:v.ascent,descent:v.descent,height:v.height}}}])&&sl(e.prototype,n),t}();function fl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function dl(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function vl(t,e){return"string"!=typeof e?e:t instanceof Or?t&&"_".concat(e)in t?t["_".concat(e)]:null:t&&e in t?t[e]:null}var ml=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.elements=e,this.phrases={},this.fullLineHeight=null,this.addElementFromKey=n,this.getExistingOrAddSymbol=i}var e,n;return e=t,(n=[{key:"stringToElement",value:function(t){if(t.startsWith("space")){var e=parseFloat(t.replace(/space[_]*/,""))||.03;return new ds(new fs(e))}if(t.startsWith(" ")){var n=.03*t.length;return new ds(new fs(n))}var i=vl(this.elements,t);if(i)return new ds(i);if(t in this.phrases)return this.parseContent(this.phrases[t]);var r=this.addElementFromKey(t,{});return null!=r?new ds(r):null}},{key:"parseContent",value:function(t){var e=this;if(null==t)return null;if("number"==typeof t)return null;if(t instanceof ps)return t;if(t instanceof Cs)return t;if("string"==typeof t)return this.stringToElement(t);if(Array.isArray(t)){var n=[];return t.forEach((function(t){var i=e.parseContent(t);Array.isArray(i)?n=[].concat(dl(n),dl(i)):n.push(i)})),n}var i=fl(Object.entries(t)[0],2),r=i[0],o=i[1],a=this.eqnMethod(r,o);if(null!=a)return a;var s=this.addElementFromKey(r,o);return new ds(s)}},{key:"contentToElement",value:function(t){if(t instanceof ps)return t._dup();if(t instanceof Or||t instanceof Sr)return new ps([new ds(t)]);var e=this.parseContent(t);return Array.isArray(e)||(e=[e]),new ps(e)}},{key:"eqnMethod",value:function(t,e){return"frac"===t?this.frac(e):"strike"===t?this.strike(e):"box"===t?this.box(e):"root"===t?this.root(e):"brac"===t?this.brac(e):"sub"===t?this.sub(e):"sup"===t?this.sup(e):"supSub"===t?this.supSub(e):"topBar"===t?this.topBar(e):"bottomBar"===t?this.bottomBar(e):"annotate"===t?this.annotate(e):"bottomComment"===t?this.bottomComment(e):"topComment"===t?this.topComment(e):"bar"===t?this.bar(e):"topStrike"===t?this.topStrike(e):"bottomStrike"===t?this.bottomStrike(e):"pad"===t?this.pad(e):"int"===t?this.int(e):"sumOf"===t||"prodOf"===t?this.sumProd(e):"matrix"===t?this.matrix(e):"scale"===t?this.scale(e):"container"===t?this.container(e):null}},{key:"container",value:function(t){var e,n,i,r,o,a,s,l,u;if(Array.isArray(t)){var c=fl(t,9);e=c[0],r=c[1],a=c[2],o=c[3],s=c[4],l=c[5],i=c[6],n=c[7],u=c[8]}else e=t.content,r=t.width,a=t.descent,o=t.ascent,s=t.xAlign,l=t.yAlign,i=t.fit,n=t.scale,u=t.fullContentBounds;var h=Yt({scaleModifier:1,fit:null,width:null,ascent:null,descent:null,xAlign:"center",yAlign:"baseline",fullContentBounds:!1},{scaleModifier:n,fit:i,width:r,ascent:o,descent:a,xAlign:s,yAlign:l,fullContentBounds:u});return new hl([this.contentToElement(e)],[],h)}},{key:"brac",value:function(t){var e,n,i,r,o,a,s,l,u,c,h,f,d,p;if(Array.isArray(t)){var v=fl(t,14);n=v[0],e=v[1],i=v[2],f=v[3],r=v[4],o=v[5],a=v[6],s=v[7],l=v[8],u=v[9],h=v[10],c=v[11],p=v[12],d=v[13]}else n=t.left,e=t.content,i=t.right,f=t.inSize,r=t.insideSpace,o=t.outsideSpace,a=t.topSpace,s=t.bottomSpace,l=t.minContentHeight,u=t.minContentDescent,h=t.height,c=t.descent,p=t.fullContentBounds,d=t.useFullBounds;var m=Yt({},{insideSpace:.03,outsideSpace:.03,topSpace:.05,bottomSpace:.05,minContentHeight:null,minContentDescent:null,descent:null,height:null,inSize:!0,useFullBounds:!1,fullContentBounds:!1},{insideSpace:r,outsideSpace:o,topSpace:a,bottomSpace:s,minContentHeight:l,minContentDescent:u,descent:c,height:h,inSize:f,useFullBounds:d,fullContentBounds:p}),y={};return n&&(y.left={symbol:n,space:m.insideSpace,topSpace:m.topSpace,bottomSpace:m.bottomSpace,minContentHeight:m.minContentHeight,minContentDescent:m.minContentDescent,descent:m.descent,height:m.height}),i&&(y.right={symbol:i,space:m.insideSpace,topSpace:m.topSpace,bottomSpace:m.bottomSpace,minContentHeight:m.minContentHeight,minContentDescent:m.minContentDescent,descent:m.descent,height:m.height}),this.annotate({content:e,glyphs:y,inSize:m.inSize,leftSpace:m.outsideSpace,rightSpace:m.outsideSpace,useFullBounds:m.useFullBounds,fullContentBounds:m.fullContentBounds})}},{key:"bar",value:function(t,e){var n,i,r,o,a,s,l,u,c,h,f,d,p,v,m,y,g,w=1<arguments.length&&void 0!==e?e:{};if(Array.isArray(t)){var b=fl(t,17);n=b[0],i=b[1],f=b[2],o=b[3],a=b[4],s=b[5],l=b[6],u=b[7],c=b[8],h=b[9],r=b[10],d=b[11],p=b[12],v=b[13],m=b[14],y=b[15],g=b[16]}else n=t.content,i=t.symbol,f=t.inSize,o=t.space,a=t.overhang,s=t.length,l=t.left,u=t.right,c=t.top,h=t.bottom,r=t.side,d=t.minContentHeight,p=t.minContentDescent,v=t.minContentAscent,m=t.descent,y=t.fullContentBounds,g=t.useFullBounds;var x=Yt({},{inSize:!0,space:.03,overhang:0,length:null,left:null,right:null,top:null,bottom:null,side:"top",minContentHeight:null,minContentDescent:null,minContentAscent:null,descent:null,fullContentBounds:!1,useFullBounds:!1},{side:r,space:o,overhang:a,length:s,left:l,right:u,top:c,bottom:h,inSize:f,minContentHeight:d,minContentDescent:p,minContentAscent:v,descent:m,fullContentBounds:y,useFullBounds:g},w),_={};return"top"===x.side&&(_.top={symbol:i,space:x.space,overhang:x.overhang,leftSpace:x.left,rightSpace:x.right,width:x.length}),"bottom"===x.side&&(_.bottom={symbol:i,space:x.space,overhang:x.overhang,leftSpace:x.left,rightSpace:x.right,width:x.length}),"left"===x.side&&(_.left={symbol:i,space:x.space,overhang:x.overhang,topSpace:x.top,bottomSpace:x.bottom,height:x.length,minContentHeight:x.minContentHeight,minContentDescent:x.minContentDescent,minContentAscent:x.minContentAscent,descent:x.descent}),"right"===x.side&&(_.right={symbol:i,space:x.space,overhang:x.overhang,topSpace:x.top,bottomSpace:x.bottom,height:x.length,minContentHeight:x.minContentHeight,minContentDescent:x.minContentDescent,minContentAscent:x.minContentAscent,descent:x.descent}),this.annotate({content:n,glyphs:_,inSize:x.inSize,fullContentBounds:x.fullContentBounds,useFullBounds:x.useFullBounds})}},{key:"annotate",value:function(t){var e=this,n={inSize:!0,useFullBounds:!1,fullContentBounds:!1,space:0,contentScale:1,encompass:{space:0},left:{space:0,overhang:0,yOffset:0,annotationsOverContent:!1},right:{space:0,overhang:0,yOffset:0,annotationsOverContent:!1},top:{space:0,overhang:0,xOffset:0,annotationsOverContent:!1},bottom:{space:0,overhang:0,xOffset:0,annotationsOverContent:!1}},i=t.content,r=t.annotation,o=t.annotations,a=t.glyphs,s={xPosition:"center",yPosition:"top",xAlign:"center",yAlign:"bottom",offset:new Y(0,0),scale:1,inSize:!0,fullContentBounds:!1},l=[];function u(t){if(null==t||!Array.isArray(t))return[];var n=[];return t.forEach((function(t){var i,r;n.push(((r=Yt({},s,i=t)).content=e.contentToElement(i.content),r))})),n}function c(t){if(null!=a){var i=a[t];if(null!=i){f[t]={};var r=i.annotations;null!=i.annotation&&(r=[i.annotation]);var o=u(r);f[t]=Yt({},n[t],i),f[t].annotations=o,f[t].glyph=e.getExistingOrAddSymbol(i.symbol||"")}}}null!=r?l.push(r):null!=o&&(l=o);var h=u(l),f={};c("encompass"),c("left"),c("right"),c("top"),c("bottom");var d=Yt(n,t);return new Cs(this.contentToElement(i),h,f,d)}},{key:"scale",value:function(t){var e,n,i;if(Array.isArray(t)){var r=fl(t,3);e=r[0],n=r[1],i=r[2]}else e=t.content,n=t.scale,i=t.fullContentBounds;var o=Yt({scaleModifier:1,fullContentBounds:!1},{scaleModifier:n,fullContentBounds:i});return new ol([this.contentToElement(e)],[],o)}},{key:"frac",value:function(t){var e,n,i,r,o,a,s,l,u;if(Array.isArray(t)){var c=fl(t,9);e=c[0],i=c[1],n=c[2],r=c[3],a=c[4],s=c[5],o=c[6],l=c[7],u=c[8]}else e=t.numerator,i=t.symbol,n=t.denominator,r=t.scale,a=t.numeratorSpace,s=t.denominatorSpace,o=t.overhang,l=t.offsetY,u=t.fullContentBounds;var h=Yt({scaleModifier:1,numeratorSpace:.05,denominatorSpace:.05,offsetY:.07,overhang:.05,fullContentBounds:!1},{scaleModifier:r,overhang:o,numeratorSpace:a,denominatorSpace:s,offsetY:l,fullContentBounds:u});return new Us([this.contentToElement(e),this.contentToElement(n)],this.getExistingOrAddSymbol(i),h)}},{key:"root",value:function(t){var e,n,i,r,o,a,s,l,u,c,h,f,d=!0;if(Array.isArray(t)){var p=fl(t,13);i=p[0],e=p[1],d=p[2],r=p[3],a=p[4],l=p[5],s=p[6],o=p[7],n=p[8],c=p[9],u=p[10],h=p[11],f=p[12]}else i=t.symbol,e=t.content,d=t.inSize,r=t.space,a=t.topSpace,l=t.rightSpace,s=t.bottomSpace,o=t.leftSpace,n=t.root,c=t.rootOffset,u=t.rootScale,h=t.fullContentBounds,f=t.useFullBounds;var v=Yt({space:.02,rootScale:.6,rootOffset:[0,.06],inSize:!0,fullContentBounds:!1,useFullBounds:!1},{leftSpace:o,topSpace:a,bottomSpace:s,rightSpace:l,space:r,rootScale:u,rootOffset:c,inSize:d,fullContentBounds:h,useFullBounds:f});v.rootOffset=K(v.rootOffset);var m=[];return null!=n&&m.push({content:n,offset:v.rootOffset,scale:v.rootScale,reference:"root"}),this.annotate({content:e,inSize:v.inSize,useFullBounds:v.useFullBounds,fullContentBounds:v.fullContentBounds,glyphs:{encompass:{symbol:i,annotations:m,space:v.space,leftSpace:v.leftSpace,rightSpace:v.rightSpace,topSpace:v.topSpace,bottomSpace:v.bottomSpace}}})}},{key:"supSub",value:function(t){var e,n,i=null,r=null,o=null,a=null,s=null;if(Array.isArray(t)){var l=fl(t,7);e=l[0],i=l[1],r=l[2],o=l[3],s=l[4],a=l[5],n=l[6]}else e=t.content,i=t.superscript,r=t.subscript,o=t.scale,s=t.superscriptOffset,a=t.subscriptOffset,n=t.inSize;var u=Yt({scale:.5,subscriptOffset:[0,0],superscriptOffset:[0,0],inSize:!0},{superscript:i,subscript:r,scale:o,subscriptOffset:a,superscriptOffset:s,inSize:n}),c=[];return null!=i&&c.push({content:u.superscript,xPosition:"right",yPosition:"0.7a",xAlign:"left",yAlign:"baseline",offset:u.superscriptOffset,scale:u.scale}),null!=r&&c.push({content:u.subscript,xPosition:"right",yPosition:"baseline",xAlign:"left",yAlign:"0.7a",offset:u.subscriptOffset,scale:u.scale}),this.annotate({content:e,annotations:c,inSize:u.inSize})}},{key:"sup",value:function(t){var e,n,i,r,o;if(Array.isArray(t)){var a=fl(t,5);e=a[0],n=a[1],i=a[2],r=a[3],o=a[4]}else e=t.content,n=t.superscript,i=t.scale,r=t.offset,o=t.inSize;return this.supSub({content:e,superscript:n,superscriptOffset:r,inSize:o,scale:i})}},{key:"sub",value:function(t){var e,n,i,r,o;if(Array.isArray(t)){var a=fl(t,5);e=a[0],n=a[1],i=a[2],r=a[3],o=a[4]}else e=t.content,n=t.subscript,i=t.scale,r=t.offset,o=t.inSize;return this.supSub({content:e,subscript:n,subscriptOffset:r,inSize:o,scale:i})}},{key:"box",value:function(t){var e,n,i,r,o,a,s,l,u,c;if(Array.isArray(t)){var h=fl(t,10);e=h[0],n=h[1],i=h[2],r=h[3],o=h[4],l=h[5],a=h[6],s=h[7],u=h[8],c=h[9]}else e=t.content,n=t.symbol,i=t.inSize,r=t.space,o=t.topSpace,l=t.rightSpace,a=t.bottomSpace,s=t.leftSpace,u=t.fullContentBounds,c=t.useFullBounds;var f=Yt({inSize:!1,space:0,topSpace:null,bottomSpace:null,leftSpace:null,rightSpace:null,fullContentBounds:!1,useFullBounds:!1},{content:e,symbol:n,inSize:i,space:r,topSpace:o,rightSpace:l,bottomSpace:a,leftSpace:s,fullContentBounds:u,useFullBounds:c});return this.annotate({content:e,inSize:f.inSize,fullContentBounds:f.fullContentBounds,useFullBounds:f.useFullBounds,glyphs:{encompass:{symbol:n,space:f.space,leftSpace:f.leftSpace,rightSpace:f.rightSpace,topSpace:f.topSpace,bottomSpace:f.bottomSpace}}})}},{key:"pad",value:function(t){var e,n,i,r,o;if(Array.isArray(t)){var a=fl(t,5);e=a[0],n=a[1],i=a[2],r=a[3],o=a[4]}else e=t.content,n=t.top,i=t.right,r=t.bottom,o=t.left;var s=Yt({top:0,left:0,right:0,bottom:0},{top:n,right:i,bottom:r,left:o});return this.annotate({content:e,topSpace:s.top,bottomSpace:s.bottom,rightSpace:s.right,leftSpace:s.left})}},{key:"topBar",value:function(t){return this.bar(t,{side:"top"})}},{key:"bottomBar",value:function(t){return this.bar(t,{side:"bottom"})}},{key:"matrix",value:function(t){var e,n,i,r,o,a,s,l,u,c,h=this;if(Array.isArray(t)){var f=fl(t,10);r=f[0],n=f[1],e=f[2],i=f[3],s=f[4],o=f[5],a=f[6],l=f[7],u=f[8],c=f[9]}else r=t.order,n=t.left,e=t.content,i=t.right,s=t.scale,o=t.fit,a=t.space,l=t.yAlign,u=t.brac,c=t.fullContentBounds;var d=Yt({},{contentScale:.7,fit:"min",space:[.05,.05],yAlign:"baseline",brac:{},fullContentBounds:!1},{space:a,fit:o,order:r,contentScale:s,brac:u,yAlign:l,fullContentBounds:c}),p=[];null!=e&&(p=e.map((function(t){return h.contentToElement(t)}))),null!=d.order&&d.order[0]*d.order[1]===p.length||(d.order=[1,p.length]),null!=d.space&&(d.space=K(d.space));var v=new Js(p,[],d);return null!=n&&null!=i?this.brac(Yt({},d.brac,{content:v,left:n,right:i})):v}},{key:"int",value:function(t){var e,n,i,r,o,a,s,l,u,c,h,f,d,p,v,m,y,g,w,b,x,_,S,O,k,T,P,A={inSize:!0,space:.05,topSpace:.1,bottomSpace:.1,height:null,yOffset:0,contentScale:1,fromScale:.5,toScale:.5,fromOffset:[0,0],toOffset:[.04,0],limitsPosition:"side",limitsAroundContent:!0,fromXPosition:.5,fromYPosition:"bottom",fromXAlign:"left",fromYAlign:"middle",toXPosition:"right",toYPosition:"top",toXAlign:"left",toYAlign:"middle",fullBoundsContent:!1,useFullBounds:!1};if(Array.isArray(t)){var E=fl(t,27);n=E[0],e=E[1],u=E[2],c=E[3],l=E[4],i=E[5],r=E[6],o=E[7],a=E[8],s=E[9],h=E[10],f=E[11],d=E[12],p=E[13],v=E[14],m=E[15],y=E[16],g=E[17],w=E[18],b=E[19],x=E[20],_=E[21],S=E[22],O=E[23],k=E[24],T=E[25],P=E[26]}else e=t.content,n=t.symbol,u=t.from,c=t.to,l=t.inSize,i=t.space,r=t.topSpace,o=t.bottomSpace,a=t.height,s=t.yOffset,h=t.scale,f=t.fromScale,d=t.toScale,p=t.fromOffset,v=t.toOffset,m=t.limitsPosition,y=t.limitsAroundContent,g=t.fromXPosition,w=t.fromYPosition,b=t.fromXAlign,x=t.fromYAlign,_=t.toXPosition,S=t.toYPosition,O=t.toXAlign,k=t.toYAlign,T=t.fullBoundsContent,P=t.useFullBounds;"topBottom"===m&&(A.fromXPosition=.1,A.fromYPosition="bottom",A.fromXAlign="center",A.fromYAlign="top",A.toXPosition=.9,A.toYPosition="top",A.toXAlign="center",A.toYAlign="bottom",A.fromOffset=[0,-.04],A.toOffset=[0,.04]),"topBottomCenter"===m&&(A.fromXPosition="center",A.fromYPosition="bottom",A.fromXAlign="center",A.fromYAlign="top",A.toXPosition="center",A.toYPosition="top",A.toXAlign="center",A.toYAlign="bottom",A.fromOffset=[0,-.04],A.toOffset=[0,.04]);var j=Yt({},A,{space:i,topSpace:r,bottomSpace:o,height:a,yOffset:s,inSize:l,contentScale:h,fromScale:f,toScale:d,fromOffset:p,toOffset:v,limitsPosition:m,limitsAroundContent:y,fromXPosition:g,fromYPosition:w,fromXAlign:b,fromYAlign:x,toXPosition:_,toYPosition:S,toXAlign:O,toYAlign:k,fullBoundsContent:T,useFullBounds:P});j.fromOffset=K(j.fromOffset),j.toOffset=K(j.toOffset);var M=[{content:c,xPosition:j.toXPosition,yPosition:j.toYPosition,xAlign:j.toXAlign,yAlign:j.toYAlign,offset:j.toOffset,scale:j.toScale},{content:u,xPosition:j.fromXPosition,yPosition:j.fromYPosition,xAlign:j.fromXAlign,yAlign:j.fromYAlign,offset:j.fromOffset,scale:j.fromScale}];return this.annotate({content:e,inSize:j.inSize,contentScale:j.contentScale,fullBoundsContent:j.fullBoundsContent,useFullBounds:j.useFullBounds,glyphs:{left:{symbol:n,space:j.space,topSpace:j.topSpace,bottomSpace:j.bottomSpace,height:j.height,yOffset:j.yOffset,annotationsOverContent:j.limitsAroundContent,annotations:M}}})}},{key:"sumOf",value:function(t){return this.sumProd(t)}},{key:"prodOf",value:function(t){return this.sumProd(t)}},{key:"sumProd",value:function(t){var e,n,i,r,o,a,s,l,u,c,h,f,d,p,v,m,y,g,w;if(Array.isArray(t)){var b=fl(t,19);n=b[0],e=b[1],u=b[2],c=b[3],l=b[4],i=b[5],r=b[6],o=b[7],a=b[8],s=b[9],h=b[10],f=b[11],d=b[12],p=b[13],v=b[14],m=b[15],y=b[16],g=b[17],w=b[18]}else n=t.symbol,e=t.content,u=t.from,c=t.to,l=t.inSize,i=t.space,r=t.topSpace,o=t.bottomSpace,a=t.height,s=t.yOffset,h=t.scale,f=t.fromScale,d=t.toScale,p=t.fromSpace,v=t.toSpace,m=t.fromOffset,y=t.toOffset,g=t.fullBoundsContent,w=t.useFullBounds;var x=Yt({},{inSize:!0,space:.05,topSpace:.07,bottomSpace:.07,height:null,yOffset:0,contentScale:1,fromScale:.5,toScale:.5,fromSpace:.04,toSpace:.04,fromOffset:[0,0],toOffset:[0,0],fullBoundsContent:!1,useFullBounds:!1},{space:i,topSpace:r,bottomSpace:o,height:a,yOffset:s,inSize:l,contentScale:h,fromScale:f,toScale:d,fromSpace:p,toSpace:v,fromOffset:m,toOffset:y,fullBoundsContent:g,useFullBounds:w}),_=[{content:c,xPosition:"center",yPosition:"top",xAlign:"center",yAlign:"bottom",offset:K(x.toOffset).add(0,x.toSpace),scale:x.toScale},{content:u,xPosition:"center",yPosition:"bottom",xAlign:"center",yAlign:"top",offset:K(x.fromOffset).add(0,-x.fromSpace),scale:x.fromScale}];return this.annotate({content:e,contentScale:x.contentScale,fullBoundsContent:x.fullBoundsContent,useFullBounds:x.useFullBounds,glyphs:{left:{symbol:n,annotations:_,space:i,topSpace:x.topSpace,bottomSpace:x.bottomSpace,yOffset:x.yOffset,height:x.height}},inSize:x.inSize})}},{key:"processComment",value:function(t){var e,n,i,r,o,a,s,l,u;if(Array.isArray(t)){var c=fl(t,9);e=c[0],n=c[1],i=c[2],r=c[3],o=c[4],a=c[5],s=c[6],l=c[7],u=c[8]}else e=t.content,n=t.comment,i=t.symbol,r=t.contentSpace,o=t.commentSpace,a=t.scale,s=t.inSize,l=t.fullContentBounds,u=t.useFullBounds;var h=Yt({contentSpace:.03,commentSpace:.03,scale:.6,inSize:!0,fullContentBounds:!1,useFullBounds:!1},{contentSpace:r,commentSpace:o,scale:a,inSize:s,useFullBounds:u,fullContentBounds:l});return[e,n,i,h.contentSpace,h.commentSpace,h.scale,h.inSize,h.fullContentBounds,h.useFullBounds]}},{key:"topComment",value:function(){var t=fl(this.processComment.apply(this,arguments),9),e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=[{content:n,xPosition:"center",yPosition:"top",xAlign:"center",yAlign:"bottom",scale:a,offset:[0,o]}];return""===i||null==i?this.annotate({content:e,annotations:c,inSize:s}):this.annotate({content:e,fullContentBounds:l,useFullBounds:u,glyphs:{top:{symbol:i,annotations:c,space:r}},inSize:s})}},{key:"bottomComment",value:function(){var t=fl(this.processComment.apply(this,arguments),9),e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=[{content:n,xPosition:"center",yPosition:"bottom",xAlign:"center",yAlign:"top",scale:a,offset:[0,-o]}];return""===i||null==i?this.annotate({content:e,annotations:c,inSize:s}):this.annotate({content:e,fullContentBounds:l,useFullBounds:u,glyphs:{bottom:{symbol:i,annotations:c,space:r}},inSize:s})}},{key:"strike",value:function(t){var e,n,i,r,o,a,s,l,u,c,h={inSize:!1,space:.02,topSpace:null,bottomSpace:null,leftSpace:null,rightSpace:null,fullContentBounds:!1,useFullBounds:!1};if(Array.isArray(t)){var f=fl(t,10);e=f[0],n=f[1],i=f[2],r=f[3],o=f[4],l=f[5],a=f[6],s=f[7],u=f[8],c=f[9]}else e=t.content,n=t.symbol,i=t.inSize,r=t.space,o=t.topSpace,l=t.rightSpace,a=t.bottomSpace,s=t.leftSpace,u=t.fullContentBounds,c=t.useFullBounds;var d=this.getExistingOrAddSymbol(n);null!=d&&"horizontal"===d.custom.options.style&&(h.space=0,h.leftSpace=.02,h.rightSpace=.02);var p=Yt(h,{content:e,symbol:n,inSize:i,space:r,topSpace:o,rightSpace:l,bottomSpace:a,leftSpace:s,fullContentBounds:u,useFullBounds:c});return this.annotate({content:e,inSize:p.inSize,fullContentBounds:p.fullContentBounds,useFullBounds:p.useFullBounds,glyphs:{encompass:{symbol:n,topSpace:p.topSpace,bottomSpace:p.bottomSpace,leftSpace:p.leftSpace,rightSpace:p.rightSpace,space:p.space}}})}},{key:"processStrike",value:function(t){var e,n,i,r,o,a,s;if(Array.isArray(t)){var l=fl(t,7);e=l[0],i=l[1],n=l[2],s=l[3],a=l[4],o=l[5],r=l[6]}else e=t.content,n=t.comment,i=t.symbol,s=t.inSize,a=t.space,o=t.scale,r=t.commentSpace;var u=Yt({space:0,scale:.5,commentSpace:.1,inSize:!0},{inSize:s,commentSpace:r,scale:o,space:a});return[e,i,n,u.inSize,u.commentSpace,u.scale,u.space]}},{key:"topStrike",value:function(){var t=fl(this.processStrike.apply(this,arguments),7),e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=[{content:i,xPosition:"center",yPosition:"top",xAlign:"center",yAlign:"bottom",offset:[0,o],scale:a}];return this.annotate({content:e,inSize:r,glyphs:{encompass:{symbol:n,space:s,annotations:l}}})}},{key:"bottomStrike",value:function(){var t=fl(this.processStrike.apply(this,arguments),7),e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=[{content:i,xPosition:"center",yPosition:"bottom",xAlign:"center",yAlign:"top",offset:[0,-o],scale:a}];return this.annotate({content:e,inSize:r,glyphs:{encompass:{symbol:n,space:s,annotations:l}}})}}])&&pl(e.prototype,n),t}();function yl(t){return(yl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function wl(t,e,n){return(wl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bl(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function bl(t){return(bl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xl(t,e){return(xl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _l=function(){function t(e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(t,e){return!e||"object"!==yl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,bl(t).call(this,[]))).elements=e,i.collectionMethods=n,i.description=null,i.modifiers={},i.elementMods={},i.translation={},i.subForm="",i}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xl(t,e)}(t,ps),e=t,(n=[{key:"getNamedElements",value:function(){var t={};return this.collectionMethods.getAllElements().forEach((function(e){t[e.name]=e})),t}},{key:"_dup",value:function(e,n){var i=0<arguments.length&&void 0!==e?e:this.elements,r=1<arguments.length&&void 0!==n?n:this.collectionMethods,o=new t(i,r),a={};r.getAllElements().forEach((function(t){a[t.name]=t}));var s=[];return this.content.forEach((function(t){s.push(t._dup(a))})),o.content=s,Qt(this,o,["content","collectionMethods","form","elements"]),o}},{key:"createEq",value:function(t){var e=this,n=[];t.forEach((function(t){if("string"==typeof t)if(t.startsWith("space")){var i=parseFloat(t.replace(/space[_]*/,""))||.03;n.push(new ds(new fs(i)))}else if(t.startsWith(" ")){var r=.03*t.length;n.push(new ds(new fs(r)))}else{var o=vl(e.elements,t);o&&n.push(new ds(o))}else n.push(t._dup());e.content=n}))}},{key:"arrange",value:function(e,n,i,r){var o=0<arguments.length&&void 0!==e?e:1,a=1<arguments.length&&void 0!==n?n:"left",s=2<arguments.length&&void 0!==i?i:"baseline",l=3<arguments.length&&void 0!==r?r:new Y(0,0),u=this.collectionMethods.getAllElements().filter((function(t){return t.isShown}));this.collectionMethods.hideAll(),this.collectionMethods.show(),wl(bl(t.prototype),"calcSize",this).call(this,new Y(0,0),o);var c=new Y(0,0);if(l instanceof Sr||l instanceof Or){var h=l.transform.t();null!=h&&(c=h._dup())}else c=new Y(-l.x,-l.y);var f=this.width,d=this.height,p=this.ascent,v=this.descent,m=this.location._dup();if(l instanceof Sr||l instanceof Or){var y=l.transform.t(),g=l.transform.s();if(null!=y&&null!=g){var w=l.getBoundingRect("vertex");f=w.width*g.x,d=w.height*g.y,p=w.top*g.y-y.y,v=y.y-w.bottom*g.y,m=y._dup()}}if("right"===a)c.x+=f;else if("center"===a)c.x+=f/2;else if("number"==typeof a)c.x+=a*f;else if(null!=a&&"o"===a.slice(-1)[0]){var b=parseFloat(a);c.x+=b}if("top"===s)c.y+=m.y+p;else if("bottom"===s)c.y+=m.y-v;else if("middle"===s)c.y+=m.y-v+d/2;else if("number"==typeof s)c.y+=m.y-v+s*d;else if(null!=s&&"o"===s.slice(-1)[0]){var x=parseFloat(s);c.y+=m.y+x}var _=new Y(0,0).sub(c);0===_.x&&0===_.y||(this.offsetLocation(_),this.setPositions()),this.collectionMethods.showOnly(u)}},{key:"dissolveElements",value:function(t,e,n,i,r){var o=1<arguments.length&&void 0!==e?e:"in",a=2<arguments.length&&void 0!==n?n:.01,s=3<arguments.length&&void 0!==i?i:1,l=4<arguments.length&&void 0!==r?r:null;if(0===t.length&&l)l(!1);else{var u=t.length,c=0,h=function(t){(c+=1)===u&&l&&l(t)};t.forEach((function(t){t.animations.addTo("Equation Color").opacity({dissolve:o,onFinish:h,duration:s,delay:a,completeOnCancel:!0}).start()}))}}},{key:"getElementsToShowAndHide",value:function(){var t=this.collectionMethods.getAllElements().filter((function(t){return t.isShown})),e=this.getAllElements(),n=t.filter((function(t){return-1===e.indexOf(t)}));return{show:e.filter((function(e){return-1===t.indexOf(e)})),hide:n}}},{key:"render",value:function(){this.hideShow(),this.setPositions()}},{key:"showHide",value:function(t,e,n,i){var r=0<arguments.length&&void 0!==t?t:0,o=1<arguments.length&&void 0!==e?e:0,a=2<arguments.length&&void 0!==n?n:null;3<arguments.length&&void 0!==i&&!i||this.collectionMethods.stop(),this.collectionMethods.show();var s=this.getElementsToShowAndHide(),l=s.show,u=s.hide;0===r?l.forEach((function(t){t.showAll()})):this.dissolveElements(l,"in",.01,r,null),0===o?u.forEach((function(t){return t.hide()})):this.dissolveElements(u,"out",r,o,a)}},{key:"hideShow",value:function(t,e,n,i){var r=0<arguments.length&&void 0!==t?t:0,o=1<arguments.length&&void 0!==e?e:0,a=2<arguments.length&&void 0!==n?n:null;3<arguments.length&&void 0!==i&&!i||this.collectionMethods.stop(),this.collectionMethods.show();var s=this.getElementsToShowAndHide(),l=s.show,u=s.hide;0===o?u.forEach((function(t){return t.hide()})):this.dissolveElements(u,"out",.01,o,null),0===r?(l.forEach((function(t){t.showAll()})),null!=a&&a()):this.dissolveElements(l,"in",o,r,a)}},{key:"allHideShow",value:function(t,e,n,i,r){var o=this,a=0<arguments.length&&void 0!==t?t:0,s=1<arguments.length&&void 0!==e?e:.5,l=2<arguments.length&&void 0!==n?n:.5,u=3<arguments.length&&void 0!==i?i:.5,c=4<arguments.length&&void 0!==r?r:null;this.collectionMethods.stop();var h=this.collectionMethods.getAllElements().filter((function(t){return t.isShown})),f=this.getAllElements(),d=f.filter((function(t){return!t.isShown})),p=f.filter((function(t){return t.isShown})),v=a;if(0!==f.length||0!==h.length||null==c){var m=function(){o.setPositions()};0===f.length&&(m=function(t){o.setPositions(),null!=c&&c(t)}),0<h.length?(this.dissolveElements(h,"out",a,s,m),v+=s):this.setPositions(),this.applyElementMods();var y=f.length,g=0,w=function(t){(g+=1)===y-1&&c&&c(t)};d.forEach((function(t){t.animations.addTo("Equation Color").dissolveIn({duration:u,onFinish:w,delay:v+l}).start()})),p.forEach((function(t){t.animations.addTo("Equation Color").dissolveIn({duration:u,onFinish:w,delay:l}).start()}))}else c(!1)}},{key:"applyElementMods",value:function(){var t=this;Object.keys(this.elementMods).forEach((function(e){var n=t.elementMods[e],i=n.element,r=n.mods;null!=i&&null!=r&&(i.setProperties(r),null!=r.color&&i.setColor(r.color),null!=r.opacity&&i.setOpacity(r.opacity))}))}},{key:"animatePositionsTo",value:function(t,e,n,i,r,o,a){var s=4<arguments.length&&void 0!==r?r:null,l=5<arguments.length&&void 0!==o?o:null,u=6<arguments.length&&void 0!==a&&a,c=this.collectionMethods.getAllElements();this.collectionMethods.stop();var h=this.getAllElements();h.forEach((function(t){.001===t.opacity&&t.hide(),t.setOpacity(1)}));var f=c.filter((function(t){return t.isShown})),d=f.filter((function(t){return-1===h.indexOf(t)})),p=h.filter((function(t){return-1===f.indexOf(t)})),v=this.collectionMethods.getElementTransforms();this.setPositions();var m=this.collectionMethods.getElementTransforms(),y=[],g=[],w=[];Object.keys(m).forEach((function(t){var e=v[t],n=m[t];e.isEqualTo(n)||(y.push(t),g.push(e),w.push(n))}));var b,x={};p.forEach((function(t){x[t.name]=t.transform._dup()})),b=null===n?kt(g,w,0,new Y(.35,.35),2*Math.PI/6,new Y(.4,.4)):n,this.collectionMethods.setElementTransforms(v),this.collectionMethods.setElementTransforms(x);var _=t,S=null,O=null,k=null;u?0===y.length&&0===p.length?k=s:0===y.length?O=s:S=s:0===y.length&&0===p.length?k=s:0===p.length?S=s:O=s,0<d.length?(this.dissolveElements(d,"out",t,e,k),_+=e):null!=k&&k(),this.applyElementMods();var T={};T="fromPrev"===l&&null!=this.fromPrev?Yt({},this.translation,this.fromPrev):"fromNext"===l&&null!=this.fromNext?Yt({},this.translation,this.fromNext):Yt({},this.translation),Object.keys(T).forEach((function(t){var e=T[t],n=e.element,i=e.style,r=e.direction,o=e.mag;n&&(null!=i&&(n.animations.options.translation.style=i),null!=r&&(n.animations.options.translation.direction=r),null!=o&&(n.animations.options.translation.magnitude=o))})),u&&0<p.length&&(this.dissolveElements(p,"in",_,i,O),_+=i+.001);var P=this.collectionMethods.animateToTransforms(m,b,_,0,S);return 0<P&&(_=P),u||0<p.length&&(this.dissolveElements(p,"in",_,i,O),_+=i+.001),_}}])&&gl(e.prototype,n),t}();function Sl(t){return(Sl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ol(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function kl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Tl(t,e){return!e||"object"!==Sl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Pl(t){return(Pl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Al(t,e){return(Al=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var El=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Tl(this,Pl(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Al(t,e)}(t,ks),e=t,(n=[{key:"getPoints",value:function(t,e,n){var i,r,o,a,s,l=t.side;if("left"===l||"right"===l){var u=Ol(this.getLeftPoints(t,e,n),4);i=u[0],r=u[1],o=u[2],a=u[3]}else{var c=Ol(this.getLeftPoints(t,n,e),4);i=c[0],r=c[1],o=c[2],a=c[3]}s="right"===l?(new pt).scale(-1,1).translate(o,0):"top"===l?(new pt).translate(0,-a/2).rotate(-Math.PI/2).translate(a/2,o):"bottom"===l?(new pt).translate(0,-a/2).rotate(Math.PI/2).translate(a/2,0):new pt;var h=i.map((function(t){return t.transformBy(s.m())})),f=r.map((function(t){return t.transformBy(s.m())})),d=[];return h.forEach((function(t,e){var n=f[e];d.push(t),d.push(n)})),"top"===l||"bottom"===l?[d,a,o]:[d,o,a]}},{key:"getLeftPoints",value:function(t,e,n){for(var i=t.sides,r=this.getVerticalDefaultValues(n,e,t),o=r.lineWidth,a=r.width,s=r.tipWidth,l=a-o,u=(Math.pow(l,2)+Math.pow(n/2,2))/(2*l),c=a-s,h=(Math.pow(c,2)+Math.pow(n/2,2))/(2*c),f=Math.asin(n/2/u),d=2*f/i,p=Math.asin(n/2/h),v=2*p/i,m=[],y=[],g=0;g<i+1;g+=1)m.push(gt(u,f-d*g+Math.PI).add(u+o,n/2)),y.push(gt(h,p-v*g+Math.PI).add(h,n/2));return[y,m,m[0].x,n]}},{key:"getDefaultValues",value:function(t,e,n){var i={};if("left"===n.side||"right"===n.side)(i=this.getVerticalDefaultValues(t,e,n)).height=t;else{var r=(i=this.getVerticalDefaultValues(e,t,n)).width;i.width=e,i.height=r}return i}},{key:"getVerticalDefaultValues",value:function(t,e,n){var i={};return null==e&&null==n.width&&(i.width=97570.78+-97570.775041292/(1+Math.pow(t/2399858,.9383909))),null!=e&&(i.width=e),null!=n.width&&(i.width=n.width),null==n.lineWidth?i.lineWidth=.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041)):i.lineWidth=n.lineWidth,null==n.tipWidth?i.tipWidth=i.lineWidth/3:i.tipWidth=n.tipWidth,i}}])&&kl(e.prototype,n),t}();function jl(t){return(jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ml(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ll(t,e){return!e||"object"!==jl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Cl(t){return(Cl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bl(t,e){return(Bl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Rl=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ll(this,Cl(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bl(t,e)}(t,ks),e=t,(n=[{key:"getPoints",value:function(t,e,n){var i=t.fill,r=this.getDefaultValues(n,e,t),o=r.lineWidth,a=r.width,s=r.height;return[i?[new Y(0,0),new Y(a,0),new Y(0,s),new Y(a,s)]:[new Y(0,0),new Y(o,o),new Y(0,s),new Y(o,s-o),new Y(a,s),new Y(a-o,s-o),new Y(a,0),new Y(a-o,o),new Y(0,0),new Y(o,o)],a,s]}},{key:"getBounds",value:function(t,e,n,i,r){var o=this.getDefaultValues(r,i,t),a=o.lineWidth,s=o.width,l=o.height,u=new ss;if("static"===t.draw){var c=t.staticWidth,h=t.staticHeight;"first"===c&&(c=s+2*a),"first"===h&&(h=l+2*a),null==c&&(c=1),null==h&&(h=1);var f=a/h,d=a/c;u.width=s/(1-2*d),u.height=l/(1-2*f);var p=u.width*d,v=u.height*f;u.left=e-p,u.right=u.left+u.width,u.bottom=n-v,u.top=u.bottom+u.height,u.ascent=u.height,u.descent=0}else u.left=e+i/2-s/2-a,u.bottom=n+r/2-l/2-a,u.width=s+2*a,u.height=l+2*a,u.right=u.left+u.width,u.top=u.bottom+u.height,u.descent=0,u.ascent=u.height;return u}},{key:"getDefaultValues",value:function(t,e,n){var i={};return null!=n.lineWidth&&"number"==typeof n.lineWidth?i.lineWidth=n.lineWidth:i.lineWidth=.01,!0===n.fill&&(i.lineWidth=0),null!=n.height&&"number"==typeof n.height?i.height=n.height:i.height=null!=t?t:1,null!=n.width&&"number"==typeof n.width?i.width=n.width:i.width=null!=e?e:1,i}},{key:"surround",value:function(t,e,n,i){var r=2<arguments.length&&void 0!==n?n:0,o=3<arguments.length&&void 0!==i?i:"local",a=[t];if(null!=e&&0!==e.length&&(a=t.getElements(e)),0!==a.length){var s,l=K(r);(s=t instanceof Or?t.getBoundingRect(o,e):t.getBoundingRect(o)).left-=l.x,s.bottom-=l.y,s.width+=2*l.x,s.height+=2*l.y,s.right=s.left+s.width,s.top=s.bottom+s.height,this.custom.setSize(new Y(s.left,s.bottom),s.width,s.height)}}}])&&Ml(e.prototype,n),t}();function Fl(t){return(Fl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Il(t,e){return!e||"object"!==Fl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Wl(t){return(Wl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ql(t,e){return(ql=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Hl=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Il(this,Wl(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ql(t,e)}(t,El),e=t,(n=[{key:"getLeftPoints",value:function(t,e,n){for(var i=t.sides,r=this.getVerticalDefaultValues(n,e,t),o=r.lineWidth,a=r.width,s=r.tipWidth,l=a/2+o/2,u=l-s,c=l-o,h=(Math.pow(c,2)+Math.pow(u,2))/(2*c),f=[],d=[],p=Math.PI/2/i,v=Math.asin(u/h)/i,m=[],y=[],g=0;g<i+1;g+=1){var w=g*p,b=g*v;y.push(new Y(l*Math.cos(w),l*Math.sin(w))),m.push(new Y(h*Math.cos(b)-h+l-o,h*Math.sin(b)))}for(var x=(new pt).scale(-1,1).translate(a,n-l).m(),_=0;_<i+1;_+=1)f.push(y[i-_].transformBy(x)),d.push(m[i-_].transformBy(x));x=(new pt).scale(1,-1).translate(0,n/2-s/2+l).m();for(var S=0;S<i+1;S+=1)f.push(m[S].transformBy(x)),d.push(y[S].transformBy(x));x=(new pt).translate(0,n/2+s/2-l).m();for(var O=0;O<i+1;O+=1)f.push(m[i-O].transformBy(x)),d.push(y[i-O].transformBy(x));x=(new pt).scale(-1,-1).translate(a,l).m();for(var k=0;k<i+1;k+=1)f.push(y[k].transformBy(x)),d.push(m[k].transformBy(x));return[f,d,a,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var i={};return null==e&&null==n.width&&(i.width=97570.78+-97570.775041292/(1+Math.pow(t/2399858,.9383909))),null!=e&&(i.width=e),null!=n.width&&(i.width=n.width),null==n.lineWidth?i.lineWidth=.8*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):i.lineWidth=n.lineWidth,null==n.tipWidth?i.tipWidth=i.lineWidth/3:i.tipWidth=n.tipWidth,i}}])&&Dl(e.prototype,n),t}();function zl(t){return(zl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nl(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Vl(t,e){return!e||"object"!==zl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Gl(t){return(Gl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ul(t,e){return(Ul=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Xl=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Vl(this,Gl(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ul(t,e)}(t,El),e=t,(n=[{key:"getLeftPoints",value:function(t,e,n){var i=t.sides,r=t.radius,o=this.getVerticalDefaultValues(n,e,t),a=o.lineWidth,s=o.width,l=o.tipWidth;if(0===r)return[[new Y(s,0),new Y(0,0),new Y(0,n),new Y(s,n)],[new Y(s,l),new Y(a,l),new Y(a,n-l),new Y(s,n-l)],s,n];for(var u=Math.min(r,s,n/2),c=u,h=u-a,f=[new Y(s,0)],d=[new Y(s,a)],p=new Y(c,c),v=new Y(c,n-c),m=0;m<=i;m+=1){var y=Math.PI/2/i*m;f.push(gt(c,Math.PI/2*3-y).add(p)),d.push(gt(h,Math.PI/2*3-y).add(p))}for(var g=0;g<=i;g+=1){var w=Math.PI/2/i*g;f.push(gt(c,Math.PI-w).add(v)),d.push(gt(h,Math.PI-w).add(v))}return f.push(new Y(s,n)),d.push(new Y(s,n-a)),[f,d,s,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var i={};return null==e&&null==n.width&&(i.width=.8*(97570.78+-97570.775041292/(1+Math.pow(t/2399858,.9383909)))),null!=e&&(i.width=e),null!=n.width&&(i.width=n.width),null==n.lineWidth?i.lineWidth=.8*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):i.lineWidth=n.lineWidth,null==n.tipWidth?i.tipWidth=.7*i.lineWidth:i.tipWidth=n.tipWidth,i}}])&&Nl(e.prototype,n),t}();function Yl(t){return(Yl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ql(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Kl(t,e){return!e||"object"!==Yl(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Zl(t){return(Zl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $l(t,e){return($l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Jl=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Kl(this,Zl(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$l(t,e)}(t,El),e=t,(n=[{key:"getLeftPoints",value:function(t,e,n){var i=this.getVerticalDefaultValues(n,e,t),r=i.lineWidth,o=i.width,a=new lt(new Y(0,0),new Y(o,n/2)),s=Math.acos(r/a.distance),l=Math.PI/2-s,u=a.ang+l,c=o-n/2/Math.tan(u);return[[new Y(o-c,0),new Y(0,n/2),new Y(o-c,n)],[new Y(o,0),new Y(c,n/2),new Y(o,n)],o,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var i={};return null==e&&null==n.width&&(i.width=97570.78+-97570.775041292/(1+Math.pow(t/2399858,.9383909))),null!=e&&(i.width=e),null!=n.width&&(i.width=n.width),null==n.lineWidth?i.lineWidth=.7*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):i.lineWidth=n.lineWidth,i}}])&&Ql(e.prototype,n),t}();function tu(t){return(tu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eu(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nu(t,e){return!e||"object"!==tu(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function iu(t){return(iu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ru(t,e){return(ru=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ou=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),nu(this,iu(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ru(t,e)}(t,El),e=t,(n=[{key:"getLeftPoints",value:function(t,e,n){var i=this.getVerticalDefaultValues(n,e,t),r=i.lineWidth,o=i.width;return[[new Y(0,0),new Y(0,n)],[new Y(r,0),new Y(r,n)],o,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var i={};return null==n.lineWidth?i.lineWidth=.8*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):i.lineWidth=n.lineWidth,i.width=i.lineWidth,i}}])&&eu(e.prototype,n),t}();function au(t){return(au="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function su(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function lu(t,e){return!e||"object"!==au(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function uu(t){return(uu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function cu(t,e){return(cu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var hu=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),lu(this,uu(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&cu(t,e)}(t,ks),e=t,(n=[{key:"getPoints",value:function(t,e,n){var i=t.sides,r=this.getDefaultValues(n,e,t),o=r.lineWidth,a=r.width,s=Math.PI/2*.9,l=Math.PI/2*.95,u=.431*a,c=n/2-o,h=.176*n,f=.153*n,d=h/Math.tan(s),p=f/Math.tan(l),v=o,m=2*o,y=3*o,g=.6*o,w=new lt(new Y(0,0),new Y(u,c)),b=v/Math.sin(w.ang),x=new lt(new Y(b,0),n,w.ang),_=new lt(new Y(0,n),new Y(u,c)),S=-y/Math.sin(_.ang),O=new lt(new Y(S,n),n,_.ang),k=x.intersectsWith(O).intersect,T=new Y(a,h),P=new Y(a-g,h),A=new Y(a-d,0),E=new Y(P.x-(h-m)/Math.tan(s),m),j=new Y(0,0),M=new Y(v/Math.sin(w.ang)+m/Math.tan(w.ang),m),L=new Y(u,c),C=k,B=new Y(0,n),R=new Y(-y/Math.sin(_.ang)-v/Math.tan(_.ang),n-v),F=new Y(a-p,n),D=new Y(a,n-f),I=new Y(a-g,n-f),W=new Y(I.x-(f-v)/Math.tan(l),n-v),q=Tt(P,E,new Y(E.x-(h-m),m),i),H=[];q.forEach((function(t){H.push(A),H.push(t)}));var z=W,N=Tt(new Y(z.x-f+v,n-v),z,I,i),V=[];return N.forEach((function(t){V.push(F),V.push(t)})),[[T,P].concat(H,[j,M,L,C,B,R],V,[D,I]),a,n]}},{key:"getDefaultValues",value:function(t,e,n){var i={lineWidth:.88*t/(25*t+15),width:.88*t,height:t};return null!=n.lineWidth&&(i.lineWidth=n.lineWidth),null!=n.width&&(i.width=n.width),i}}])&&su(e.prototype,n),t}();function fu(t){return(fu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function du(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pu(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function vu(t,e){return!e||"object"!==fu(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function mu(t){return(mu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yu(t,e){return(yu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var gu=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),vu(this,mu(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yu(t,e)}(t,ks),e=t,(n=[{key:"getPoints",value:function(t,e,n){var i=t.serif,r=t.sides,o=this.getDefaultValues(n,e,t),a=o.lineWidth,s=o.width,l=r;"false"===i&&(l=2);var u=1.2*a,c=3*a,h=a/2,f=.9*c,d=new Y(0,0),p=new Y(c+2*f,0),v=new Y(d.x,h),m=new Y(p.x,h),y=new Y(f,v.y),g=new Y(f+c,y.y),w=new Y(y.x,n-h),b=new Y(g.x,n-h),x=new Y(v.x,n-h),_=new Y(v.x,n),S=new Y(m.x,n),O=v,k=y,T=new Y(y.x,y.y+f),P=m,A=g,E=new Y(g.x,y.y+f),j=Tt(O,k,T,l),M=Tt(P,A,E,l),L=[];j.forEach((function(t,e){L.push(t),L.push(M[e])}));var C=Tt(new Y(w.x,w.y-f),w,x,l),B=[];C.forEach((function(t){B.push(t),B.push(new Y(b.x,t.y))}));for(var R=[d,p].concat(L,B,[_,S]),F=[],D=R.length-1;0<D;D-=2)F.push(new Y(s-R[D-1].x,R[D-1].y)),F.push(new Y(s-R[D].x,R[D].y));var I=[new Y(f+c,n),new Y(f+c,n-u),new Y(s-f-c,n),new Y(s-f-c,n-u)];return[[].concat(du(R),I,F),s,n]}},{key:"getDefaultValues",value:function(t,e,n){var i={lineWidth:n.lineWidth||1,width:e||1,height:t};return null==n.lineWidth&&null!=e?i.lineWidth=e/7/3:null==n.lineWidth&&null==e?(i.lineWidth=12902.65+-12902.648946996/(1+Math.pow(t/573148,.9938213)),i.width=1704804+-1704803.997815697/(1+Math.pow(t/2234236,.9967453))):null!=n.lineWidth&&null==e&&(i.width=7*n.lineWidth*3),i}}])&&pu(e.prototype,n),t}();function wu(t){return(wu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bu(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function xu(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _u(t,e){return!e||"object"!==wu(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Su(t){return(Su=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ou(t,e){return(Ou=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ku=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),_u(this,Su(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ou(t,e)}(t,ks),e=t,(n=[{key:"getPoints",value:function(t,e,n){var i=t.sides,r=t.serif,o=t.num,a=t.type,s=t.serifSides,l=t.lineIntegralSides,u=this.getDefaultValues(n,e,t),c=u.lineWidth,h=u.width,f=u.tipWidth,d=h-(o-1)*c*3,p=n,v=.7*c,m=d;r&&(m=d-2*v);var y,g,w=x(-m/2,m/2,m/i),b=.99999999999*n,_=-Math.log(n/b-1)/d/2,S=0,O=[];w.forEach((function(t,e){var i=1/(1+Math.exp(-_*t)),r=p*_*i*(1-i),o=Math.atan(r),a=i*p,s=(c/2-f/2)*Math.pow(Math.cos((a-n/2)/n*Math.PI),2)+f/2,l=s*Math.cos(o+Math.PI/2),u=s*Math.sin(o+Math.PI/2),h=new Y(t+l+d/2,a+u),v=new Y(t-l+d/2,a-u);0<e&&(O.push(y._dup()),O.push(g._dup()),O.push(v._dup()),O.push(y._dup()),O.push(v._dup()),O.push(h._dup())),y=h,g=v,0===e&&(S=o)}));var k=[];if(!1===r)k=O;else{for(var T=s,P=new Y(O[1].x+v*Math.cos(S+Math.PI/2),O[1].y+v*Math.sin(S+Math.PI/2)),A=new Y(O[O.length-1].x+v*Math.cos(S-Math.PI/2),O[O.length-1].y+v*Math.sin(S-Math.PI/2)),E=[],j=[],M=2*Math.PI/Math.max(T,3),L=new Y(0,0),C=new Y(0,0),B=0;B<T+1;B+=1){var R=new Y(P.x+v*Math.cos(M*B),P.y+v*Math.sin(M*B)),F=new Y(A.x+v*Math.cos(M*B),A.y+v*Math.sin(M*B));0<B&&(E.push(O[1]._dup()),E.push(L._dup()),E.push(R._dup()),j.push(O[O.length-2]._dup()),j.push(C._dup()),j.push(F._dup())),L=R,C=F}k=[].concat(E,O,j)}for(var D=k.length,I=1;I<o;I+=1)for(var W=0;W<D;W+=1)k.push(k[W].add(3*c*I,0));if("line"===a){var q=this.getLineIntegralPoints(c,o,h,n,l);k=[].concat(bu(k),bu(q))}return[k,h,n]}},{key:"getLineIntegralPoints",value:function(t,e,n,i,r){for(var o=6*t,a=Math.max(o,2*(3*t+(e-1)*t*3/2)),s=new Y(n/2,i/2),l=2*Math.PI/r,u=new Y(0,0),c=new Y(0,0),h=t/2,f=[],d=0;d<r+1;d+=1){var p=d*l,v=new Y((a/2-h/2)*Math.cos(p),(o/2-h/2)*Math.sin(p)).add(s),m=new Y((a/2+h/2)*Math.cos(p),(o/2+h/2)*Math.sin(p)).add(s);0<d&&(f.push(u._dup()),f.push(c._dup()),f.push(v._dup()),f.push(u._dup()),f.push(v._dup()),f.push(m._dup())),u=m,c=v}return f}},{key:"getDefaultValues",value:function(t,e,n){var i=607.73+-607.7295779198/(1+Math.pow(t/5368595,.6370402)),r={lineWidth:i,width:12277.16+-12277.156262281/(1+Math.pow(t/36507180,.6193363))+(n.num-1)*i*3,tipWidth:.01033455+-.010329798066/(1+Math.pow(t/.2588074,2.024942)),height:t};return null!=e&&(r.width=e),null!=n.lineWidth&&(r.lineWidth=n.lineWidth),null!=n.tipWidth?r.tipWidth=n.tipWidth:r.tipWidth=r.lineWidth/3,r}}])&&xu(e.prototype,n),t}();function Tu(t){return(Tu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pu(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Au(t,e){return!e||"object"!==Tu(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Eu(t){return(Eu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ju(t,e){return(ju=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Mu=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Au(this,Eu(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ju(t,e)}(t,El),e=t,(n=[{key:"getLeftPoints",value:function(t,e,n){var i=t.direction,r=this.getVerticalDefaultValues(n,e,t),o=r.lineWidth,a=r.arrowWidth,s=r.arrowHeight,l=new Y(a/2+o/2,0),u=new Y(a/2-o/2,0),c=new Y(l.x,n-s),h=new Y(u.x,c.y),f=new Y(a,c.y),d=new Y(0,c.y),p=new Y(a/2,n),v=[u._dup(),h._dup(),d._dup(),p._dup()],m=[l._dup(),c._dup(),f._dup(),p._dup()];if("down"===i||"left"===i){var y=(new pt).scale(1,-1).translate(0,n).m();v=v.map((function(t){return t.transformBy(y)})),m=m.map((function(t){return t.transformBy(y)}))}return[v,m,a,n]}},{key:"getVerticalDefaultValues",value:function(t,e,n){var i={};return null==n.lineWidth?i.lineWidth=.8*(.2933614+-.2932195822/(1+Math.pow(t/39.01413,.618041))):i.lineWidth=n.lineWidth,null==n.arrowWidth?i.arrowWidth=3*i.lineWidth:i.arrowWidth=n.arrowWidth,null==n.arrowHeight?i.arrowHeight=3*i.lineWidth:i.arrowHeight=n.arrowHeight,i.width=i.arrowWidth,i}}])&&Pu(e.prototype,n),t}();function Lu(t){return(Lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cu(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Bu(t,e){return!e||"object"!==Lu(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Ru(t){return(Ru=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fu(t,e){return(Fu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Du=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Bu(this,Ru(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fu(t,e)}(t,ks),e=t,(n=[{key:"getPoints",value:function(t,e,n){var i=this.getDefaultValues(n,e,t),r=i.lineWidth,o=i.width,a=i.height;return[[new Y(0,0),new Y(0,r),new Y(o,0),new Y(o,r)],o,a]}},{key:"getDefaultValues",value:function(t,e,n){var i={};return null!=n.lineWidth?i.lineWidth=n.lineWidth:i.lineWidth=.01,i.height=i.lineWidth,i.width=null!=e?e:1,i}}])&&Cu(e.prototype,n),t}();function Iu(t){return(Iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wu(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function qu(t,e){return!e||"object"!==Iu(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Hu(t){return(Hu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function zu(t,e){return(zu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Nu=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),qu(this,Hu(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zu(t,e)}(t,ks),e=t,(n=[{key:"getPoints",value:function(t,e,n){var i=t.style,r=this.getDefaultValues(n,e,t),o=r.lineWidth,a=r.width,s=r.height,l=Math.atan2(s,a),u=Math.PI/2-l,c=o*Math.cos(u),h=o*Math.sin(u),f=new Y(0,h),d=new Y(c,0),p=new Y(0,s-h),v=new Y(c,s),m=new Y(a-c,s),y=new Y(a,s-h),g=new Y(a-c,0),w=new Y(a,h),b=new Y(0,s/2-o/2),x=new Y(0,s/2+o/2),_=new Y(a,s/2-o/2),S=new Y(a,s/2+o/2);return["forward"===i?[f,d,y,f,y,m]:"back"===i?[p,v,w,p,w,g]:"cross"===i?[f,d,y,f,y,m,p,v,w,p,w,g]:[b,_,S,b,S,x],a,s]}},{key:"getBounds",value:function(t,e,n,i,r){var o=this.getDefaultValues(r,i,t),a=o.width,s=o.height,l=new ss;return l.left=e,l.bottom=n,l.width=a,l.height=s,l.right=l.left+l.width,l.top=l.bottom+l.height,l.descent=0,l.ascent=l.height,l}},{key:"getDefaultValues",value:function(t,e,n){var i={};return null!=n.lineWidth&&"number"==typeof n.lineWidth?i.lineWidth=n.lineWidth:i.lineWidth=.015,null!=n.height&&"number"==typeof n.height?i.height=n.height:i.height=null!=t?t:1,null!=n.width&&"number"==typeof n.width?i.width=n.width:i.width=null!=e?e:1,i}}])&&Wu(e.prototype,n),t}();function Vu(t){return(Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gu(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Uu(t,e){return!e||"object"!==Vu(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Xu(t){return(Xu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Yu(t,e){return(Yu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Qu=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Uu(this,Xu(t).apply(this,arguments))}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yu(t,e)}(t,ks),e=t,(n=[{key:"getPoints",value:function(t,e,n){var i=this.getDefaultValues(n,e,t),r=i.lineWidth,o=i.startWidth,a=i.tickWidth,s=i.tickHeight,l=i.downWidth,u=i.startHeight,c=i.lineWidth2,h=i.height,f=i.width,d=new Y(0,u-s),p=new Y(a,u),v=new Y(l+a,0),m=new Y(o,h-r),y=new Y(f,h-r),g=new lt(d,p),w=new lt(p,v),b=new lt(v,m),x=new lt(m,y),_=g.offset("top",r),S=w.offset("top",c),O=b.offset("top",r),k=x.offset("top",r),T=_.p1._dup(),P=_.intersectsWith(S).intersect,A=S.intersectsWith(O).intersect,E=O.intersectsWith(k).intersect,j=y.add(0,r);return[[d,T,p,P,v,A,m,E,y,j],e,n]}},{key:"getBounds",value:function(t,e,n,i,r){var o=this.getHeightFromContentHeight(r,t),a=this.getDefaultValues(o,i,t),s=a.width,l=a.startWidth,u=a.lineWidth,c=a.startHeight,h=a.downWidth,f=a.tickWidth,d=a.lineWidth2,p=new ss;if("static"===t.draw){var v=t.staticWidth,m=t.staticHeight;"first"===v&&(v=s+l),"first"===m&&(m=o+u),null==v&&(v=1),null==m&&(m=1);var y=u/m,g=l/v,w=c/m;p.width=s/(1-g),p.height=o/(1-y);var b=p.width*g,x=p.height*w,_=p.height*y;p.left=e-b,p.right=p.left+p.width,p.bottom=n,p.top=p.bottom+p.height,p.ascent=p.height,p.descent=0,p.annotations={root:{xPosition:"left",yPosition:"bottom",xAlign:"right",yAlign:"bottom",offset:new Y(.5*b,x+2*_)}}}else p.left=e+i/2-s/2-l,p.bottom=n,p.width=s+l,p.height=o,p.right=p.left+p.width,p.top=p.bottom+p.height,p.descent=0,p.ascent=p.height,p.annotations={root:{xPosition:"left",yPosition:"bottom",xAlign:"right",yAlign:"bottom",offset:new Y(h+f,c+d)}};return p}},{key:"getHeightFromContentHeight",value:function(t,e){return(null!=t?t:1)+(null!=e.lineWidth&&"number"==typeof e.lineWidth?e.lineWidth:.01)}},{key:"getDefaultValues",value:function(t,e,n){var i={};return null!=n.lineWidth&&"number"==typeof n.lineWidth?i.lineWidth=n.lineWidth:i.lineWidth=.01,null!=n.lineWidth2&&"number"==typeof n.lineWidth2?i.lineWidth2=n.lineWidth2:i.lineWidth2=2*i.lineWidth,null!=n.height&&"number"==typeof n.height?i.height=n.height:i.height=null!=t?t:1,null!=n.startHeight&&"number"==typeof n.startHeight?(i.startHeight=n.startHeight,n.proportionalToHeight&&(i.startHeight=n.startHeight*i.height)):i.startHeight=i.height/3,null!=n.maxStartHeight&&n.maxStartHeight<i.startHeight&&(i.startHeight=n.maxStartHeight),null!=n.tickHeight&&"number"==typeof n.tickHeight?(i.tickHeight=n.tickHeight,n.proportionalToHeight&&(i.tickHeight=n.tickHeight*i.startHeight)):i.tickHeight=.1*i.startHeight,null!=n.startWidth&&"number"==typeof n.startWidth?(i.startWidth=n.startWidth,n.proportionalToHeight&&(i.startWidth=n.startWidth*i.height)):i.startWidth=i.startHeight/2,null!=n.maxStartWidth&&n.maxStartWidth<i.startWidth&&(i.startWidth=n.maxStartWidth),null!=n.tickWidth&&"number"==typeof n.tickWidth?(i.tickWidth=n.tickWidth,n.proportionalToHeight&&(i.tickWidth=n.tickWidth*i.startWidth)):i.tickWidth=i.startWidth/5,null!=n.downWidth&&"number"==typeof n.downWidth?(i.downWidth=n.downWidth,n.proportionalToHeight&&(i.downWidth=n.downWidth*i.startWidth)):i.downWidth=i.startWidth/5*2,null!=n.width&&"number"==typeof n.width?i.width=n.width:i.width=null!=e?e:1,i}}])&&Gu(e.prototype,n),t}();function Ku(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Zu=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.shapes=e,this.defaultColor=n}var e,n;return e=t,(n=[{key:"get",value:function(t,e){return"vinculum"===t?this.vinculum(e):"strike"===t?this.strike(e):"bracket"===t?this.bracket(e):"squareBracket"===t?this.squareBracket(e):"brace"===t?this.brace(e):"bar"===t?this.bar(e):"box"===t?this.box(e):"angleBracket"===t?this.angleBracket(e):"radical"===t?this.radical(e):"sum"===t?this.sum(e):"prod"===t?this.product(e):"int"===t?this.integral(e):"arrow"===t?this.arrow(e):null}},{key:"vinculum",value:function(t){var e=Yt({color:this.defaultColor,lineWidth:null,staticHeight:null,draw:"dynamic",staticWidth:"first"},t);return new Du(this.shapes.webgl,e.color,new pt("VinculumSymbol").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"box",value:function(t){var e=Yt({color:this.defaultColor,fill:!1,width:null,height:null,lineWidth:.01,draw:"dynamic",staticHeight:"first",staticWidth:"first"},t);return new Rl(this.shapes.webgl,e.color,new pt("Box").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"arrow",value:function(t){var e=Yt({color:this.defaultColor,direction:"right",lineWidth:.01,arrowWidth:.03,arrowHeight:.04,staticHeight:"first",draw:"static",staticWidth:null},t);return"left"===e.direction||"right"===e.direction?e.side="top":e.side="left",new Mu(this.shapes.webgl,e.color,new pt("ArrowSymbol").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"sum",value:function(t){var e=Yt({color:this.defaultColor,lineWidth:null,sides:5,staticHeight:"first",draw:"static",staticWidth:null},t);return new hu(this.shapes.webgl,e.color,new pt("sum").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"product",value:function(t){var e=Yt({color:this.defaultColor,lineWidth:null,sides:5,staticHeight:"first",draw:"static",staticWidth:null},t);return new gu(this.shapes.webgl,e.color,new pt("Sum").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"integral",value:function(t){var e=Yt({color:this.defaultColor,lineWidth:null,width:null,tipWidth:null,sides:30,serif:!0,staticHeight:"first",draw:"static",staticWidth:null,num:1,type:"generic",serifSides:10,lineIntegralSides:20},t);return new ku(this.shapes.webgl,e.color,new pt("Integral").scale(1,1).translate(0,0),this.shapes.limits,e,"triangles")}},{key:"radical",value:function(t){var e={color:this.defaultColor,lineWidth:.01,staticSize:null,startHeight:.5,startWidth:.5,maxStartWidth:.15,maxStartHeight:.15,proportionalToHeight:!0,draw:"dynamic",staticHeight:"first",staticWidth:"first"};null!=t.proportionalToHeight&&!1===t.proportionalToHeight&&(e.startHeight=.15,e.startWidth=.15);var n=Yt(e,t);return new Qu(this.shapes.webgl,n.color,new pt("bracket").scale(1,1).translate(0,0),this.shapes.limits,n,"strip")}},{key:"strike",value:function(t){var e=Yt({style:"cross",color:this.defaultColor,lineWidth:null,draw:"dynamic",staticHeight:"first",width:null,height:null,staticWidth:"first"},t);return new Nu(this.shapes.webgl,e.color,new pt("bracket").scale(1,1).translate(0,0),this.shapes.limits,e,"triangles")}},{key:"bracket",value:function(t){var e=Yt({side:"left",color:this.defaultColor,lineWidth:null,sides:10,draw:"dynamic",staticHeight:"first",width:null,tipWidth:null,staticWidth:null},t);return new El(this.shapes.webgl,e.color,new pt("bracket").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"angleBracket",value:function(t){var e=Yt({side:"left",lineWidth:null,width:null,color:this.defaultColor,draw:"dynamic",staticHeight:"first"},t);return new Jl(this.shapes.webgl,e.color,new pt("bar").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"brace",value:function(t){var e=Yt({side:"left",color:this.defaultColor,lineWidth:null,sides:10,draw:"dynamic",staticHeight:"first",width:null,tipWidth:null,staticWidth:null},t);return new Hl(this.shapes.webgl,e.color,new pt("brace").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"bar",value:function(t){var e=Yt({side:"left",lineWidth:.01,color:this.defaultColor,draw:"dynamic",staticHeight:"first"},t);return new ou(this.shapes.webgl,e.color,new pt("bar").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}},{key:"squareBracket",value:function(t){var e=Yt({side:"left",lineWidth:null,color:this.defaultColor,width:null,draw:"dynamic",staticHeight:"first",radius:0,sides:5,tipWidth:null},t);return new Xl(this.shapes.webgl,e.color,new pt("bar").scale(1,1).translate(0,0),this.shapes.limits,e,"strip")}}])&&Ku(e.prototype,n),t}();function $u(t){return($u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ju(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function tc(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ec(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function nc(t,e,n){return(nc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ic(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function ic(t){return(ic=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rc(t,e){return(rc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var oc=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=i.color;null==r&&(r=[.5,.5,.5,1]);var o,a,s=Yt({},{color:r,fontMath:new Ae("Times New Roman","normal",.2,"200","left","alphabetic",r),position:new Y(0,0),scale:.7,defaultFormAlignment:{fixTo:new Y(0,0),xAlign:"left",yAlign:"baseline"},elements:{},forms:{},formSeries:{},formRestart:null},i);return s.position=Q(s.position,new Y(0,0)),s.defaultFormAlignment.fixTo=Q(s.defaultFormAlignment.fixTo,s.defaultFormAlignment.fixTo),null!=s.formRestart&&null!=s.formRestart.pulse&&(s.formRestart.pulse=Yt({},{scale:1.1,duration:1},s.formRestart.pulse)),o=this,(n=!(a=ic(t).call(this,new pt("Equation").scale(1,1).rotate(0).translate(0,0),e.limits))||"object"!==$u(a)&&"function"!=typeof a?ec(o):a).shapes=e,n.setColor(s.color),n.eqn={forms:{},currentForm:"",currentSubForm:"",subFormPriority:["base"],formSeries:{base:[]},currentFormSeries:[],currentFormSeriesName:"",scale:s.scale,defaultFormAlignment:s.defaultFormAlignment,functions:new ml(n.elements,n.addElementFromKey.bind(ec(n)),n.getExistingOrAddSymbol.bind(ec(n))),symbols:new Zu(n.shapes,n.color),fontMath:s.fontMath,isAnimating:!1,descriptionElement:null,descriptionPosition:new Y(0,0),formRestart:s.formRestart},n.setPosition(s.position),null!=s.elements&&n.addElements(s.elements),null!=s.forms&&n.addForms(s.forms),null!=s.formSeries&&(Array.isArray(s.formSeries)?(n.eqn.formSeries={base:s.formSeries},n.eqn.currentFormSeries=n.eqn.formSeries.base,n.eqn.currentFormSeriesName="base"):(n.eqn.formSeries=s.formSeries,null!=s.defaultFormSeries?n.setFormSeries(s.defaultFormSeries):n.setFormSeries(Object.keys(n.eqn.formSeries)[0]))),n}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rc(t,e)}(t,Or),e=t,(n=[{key:"setFormSeries",value:function(t){null!=this.eqn.formSeries[t]&&(this.eqn.currentFormSeries=this.eqn.formSeries[t],this.eqn.currentFormSeriesName=t)}},{key:"getFormSeries",value:function(){return this.eqn.currentFormSeriesName}},{key:"makeTextElem",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:"";null!=t.text&&(n=t.text);var i,r,o,a=this.eqn.fontMath;null!=t.style?i=t.style:n.match(/[A-Z,a-z,\u03B8]/)&&(i="italic"),null!=t.weight&&(r=t.weight),null!=t.scale&&(o=.2*t.scale),null!=t.size&&(o=t.size),null==i&&null==r&&null==o||(a=new Ae("Times New Roman",i||"normal",o||.2,r||"200","left","alphabetic",this.color)),null!=t.font&&(a=t.font);var s=this.shapes.text(n,{position:new Y(0,0),font:a});return null!=t.color?s.setColor(t.color):s.setColor(s.drawingObject.text[0].font.color),s}},{key:"getTextFromKey",value:function(t){return t.replace(/^_*/,"").replace(/_.*/,"")}},{key:"getExistingOrAddSymbol",value:function(t){if("string"==typeof t)return this.getExistingOrAddSymbolFromKey(t,{});var e=Ju(Object.entries(t)[0],2),n=e[0],i=e[1];return this.getExistingOrAddSymbolFromKey(n,i)}},{key:"getExistingOrAddSymbolFromKey",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{},i=this.getElement(t);if(null!=i)return i;var r=t.replace(/^_*/,""),o=this.eqn.symbols.get(r,n);if(null!=o)return o.setColor(this.color),this.add(t,o),o;var a=r.match(/_[^_]*$/);return null!=a&&null!=(o=this.eqn.symbols.get(a[0].replace(/_/,""),n))?(o.setColor(this.color),this.add(t.replace(/_[^_]*$/,""),o),o):null}},{key:"addElementFromKey",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{},i=this.getExistingOrAddSymbolFromKey(t,n);if(null!=i)return i;var r=t.replace(/^_*/,"").replace(/_.*/,"");return i=this.makeTextElem(Yt({text:r},n)),this.add(t,i),i}},{key:"makeSymbolElem",value:function(t){var e=this.eqn.symbols.get(t.symbol,t);return null==e&&(e=this.makeTextElem({text:"Symbol ".concat(t.symbol," not valid")})),null==t.color&&e.setColor(this.color),e}},{key:"addElements",value:function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n];if("string"==typeof i)n.startsWith("space")&&n.startsWith(" ")||e.add(n,e.makeTextElem({text:i}));else if(i instanceof Sr)e.add(n,i);else if(i instanceof Or)e.add(n,i);else{var r;null!=(r=null!=i.symbol&&"string"==typeof i.symbol?e.makeSymbolElem(i):e.makeTextElem(i,e.getTextFromKey(n)))&&(null!=i.mods&&r.setProperties(i.mods),e.add(n,r))}}));var n=this.makeTextElem({text:"gh"}),i=this.createForm({elem:n});i.content=[this.eqn.functions.contentToElement(n)],i.arrange(this.eqn.scale,"left","baseline",new Y(0,0)),this.eqn.functions.fullLineHeight=i,this.setFirstTransform(this.transform)}},{key:"addDescriptionElement",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:null,i=1<arguments.length&&void 0!==e?e:new Y(0,0);this.eqn.descriptionElement=n,this.eqn.descriptionPosition=i,this.eqn.descriptionElement&&this.eqn.descriptionElement.setPosition(this.getPosition("diagram").add(i))}},{key:"setPosition",value:function(e,n){var i=1<arguments.length&&void 0!==n?n:0;nc(ic(t.prototype),"setPosition",this).call(this,e,i);var r=this.getPosition("diagram");null!=this.eqn.descriptionElement&&this.eqn.descriptionElement.setPosition(r.add(this.eqn.descriptionPosition))}},{key:"addPhrases",value:function(t){var e=this;Object.keys(t).forEach((function(n){var i=t[n];e.eqn.functions.phrases[n]=i}))}},{key:"addForms",value:function(t){function e(t){return"string"==typeof t}function n(t){return Array.isArray(t)}function i(t){if(!e(t)&&!n(t)&&null!=t&&"object"===$u(t)){var i=Object.keys(t);if(1===i.length&&i[0]in a.eqn.functions)return 1}}function r(t){return t instanceof ps||t instanceof Cs}function o(t,e){var n=[a.eqn.functions.contentToElement(e.content)],i=e.subForm,r=e.elementMods,o=e.duration,s=e.alignment,l=e.scale,u=e.description,c=e.modifiers,h=e.fromPrev,f=e.fromNext,d={subForm:i,elementMods:r,duration:o,translation:e.translation,alignment:s,scale:l,description:u,modifiers:c,fromPrev:h,fromNext:f};a.addForm(t,n,d)}var a=this;Object.keys(t).forEach((function(s){var l,u,c,h,f=t[s];e(f)||n(f)||i(f)||r(f)?(u=s,c=f,h=[a.eqn.functions.contentToElement(c)],a.addForm(u,h)):e(l=f)||n(l)||i(l)||r(l)||null==l||"object"!==$u(l)||null==l.content?Object.entries(f).forEach((function(t){var a=Ju(t,2),l=a[0],u=a[1];e(u)||n(u)||i(u)||r(u)?o(s,{content:u,subForm:l}):o(s,Yt(u,{subForm:l}))})):o(s,f)}))}},{key:"checkFixTo",value:function(t){if("string"!=typeof t)return t instanceof Sr||t instanceof Or||t instanceof Y?t:new Y(0,0);var e=vl(this,t);return null!=e?e:new Y(0,0)}},{key:"createForm",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.elements;return new _l(e,{getAllElements:this.getAllElements.bind(this),hideAll:this.hideAll.bind(this),show:this.show.bind(this),showOnly:this.showOnly.bind(this),stop:this.stop.bind(this),getElementTransforms:this.getElementTransforms.bind(this),setElementTransforms:this.setElementTransforms.bind(this),animateToTransforms:this.animateToTransforms.bind(this)})}},{key:"addForm",value:function(t,e,n){var i=this,r=2<arguments.length&&void 0!==n?n:{};t in this.eqn.forms||(this.eqn.forms[t]={});var o={subForm:"base",elementMods:{},duration:void 0,description:"",modifiers:{},scale:this.eqn.scale,alignment:this.eqn.defaultFormAlignment,translation:{},fromNext:void 0,fromPrev:void 0},a=o;r&&(a=Yt({},o,r));var s=a.subForm,l=a.description,u=a.modifiers,c=a.duration;this.eqn.forms[t].name=t;var h=this.eqn.forms[t];h[s]=this.createForm(),h[s].description=l,h[s].modifiers=u,h[s].name=t,h[s].subForm=s,h[s].duration=c,h[s].elementMods={},Object.keys(a.elementMods).forEach((function(t){var e=a.elementMods[t],n=vl(i,t);null!=n&&(h[s].elementMods[t]={element:n,mods:e})})),h[s].translation={},Object.keys(a.translation).forEach((function(t){var e,n,r,o=a.translation[t],l=vl(i,t);if(Array.isArray(o)){var u=Ju(o,3);n=u[0],e=u[1],r=u[2]}else n=o.style,e=o.direction,r=o.mag;null!=l&&(h[s].translation[t]={element:l,style:n,direction:e,mag:r})}));var f=a.fromPrev;null!=f&&(h[s].fromPrev={},void 0!==f.duration&&(h[s].fromPrev.duration=f.duration),h[s].fromPrev.translation={},null!=f.translation&&Object.keys(f.translation).forEach((function(t){var e,n,r,o=f.translation[t],a=vl(i,t);if(Array.isArray(o)){var l=Ju(o,3);n=l[0],e=l[1],r=l[2]}else n=o.style,e=o.direction,r=o.mag;null!=a&&(h[s].fromPrev.translation[t]={element:a,style:n,direction:e,mag:r})})));var d=a.fromNext;if(null!=d&&(h[s].fromNext={},void 0!==d.duration&&(h[s].fromNext.duration=d.duration),h[s].fromNext.translation={},null!=d.translation&&Object.keys(d.translation).forEach((function(t){var e,n,r,o=d.translation[t],a=vl(i,t);if(Array.isArray(o)){var l=Ju(o,3);n=l[0],e=l[1],r=l[2]}else n=o.style,e=o.direction,r=o.mag;null!=a&&(h[s].fromNext.translation[t]={element:a,style:n,direction:e,mag:r})}))),a.alignment.fixTo=this.checkFixTo(a.alignment.fixTo),h[s].content=e,h[s].arrange(a.scale,a.alignment.xAlign,a.alignment.yAlign,a.alignment.fixTo),void 0===this.eqn.forms[t].base){var p=Yt({},a);p.subForm="base",this.addForm(t,e,p)}""===this.eqn.currentForm&&(this.eqn.currentForm=t),""===this.eqn.currentSubForm&&(this.eqn.currentSubForm="base")}},{key:"getCurrentForm",value:function(){return null==this.eqn.forms[this.eqn.currentForm]||null==this.eqn.forms[this.eqn.currentForm][this.eqn.currentSubForm]?null:this.eqn.forms[this.eqn.currentForm][this.eqn.currentSubForm]}},{key:"render",value:function(t){var e=!(0<arguments.length&&void 0!==t)||t,n=this.getCurrentForm();null!=n&&(n.setPositions(),n.showHide(0,0,null,e),this.show(),n.applyElementMods())}},{key:"setCurrentForm",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:"base";"string"==typeof t?(this.eqn.currentForm="",this.eqn.currentSubForm="",t in this.eqn.forms&&(this.eqn.currentForm=t,n in this.eqn.forms[t]&&(this.eqn.currentSubForm=n))):(this.eqn.currentForm=t.name,this.eqn.currentSubForm=t.subForm)}},{key:"showForm",value:function(t,e,n){var i=1<arguments.length&&void 0!==e?e:null,r=!(2<arguments.length&&void 0!==n)||n;this.show();var o=t;"string"==typeof t&&(o=this.getForm(t,i)),o&&(this.setCurrentForm(o),this.render(r))}},{key:"getForm",value:function(t,e){var n=this;if(t instanceof _l)return t;if(t in this.eqn.forms){var i=e;if(null==i){var r=this.eqn.subFormPriority.filter((function(e){return e in n.eqn.forms[t]}));r.length&&(i=r[0])}if(null!=i)return this.eqn.forms[t][i]}return null}},{key:"goToForm",value:function(e){var n,i=this,r=Yt({duration:null,prioritizeFormDuration:!0,delay:0,fromWhere:null,animate:"dissolve",callback:null,ifAnimating:{skipToTarget:!0,cancelGoTo:!0}},0<arguments.length&&void 0!==e?e:{});if(this.eqn.isAnimating){if(r.ifAnimating.skipToTarget){this.stop(!0,!0);var o=this.getCurrentForm();null!=o&&this.showForm(o)}else this.stop(!0,!1);if(this.eqn.isAnimating=!1,r.ifAnimating.cancelGoTo)return}if(null!=r.name)n=this.eqn.forms[r.name];else if(null!=r.index)n=this.eqn.forms[this.eqn.currentFormSeries[r.index]];else if(0<this.eqn.currentFormSeries.length){var a=0,s=this.getCurrentForm();null!=s&&(a=this.eqn.currentFormSeries.indexOf(s.name))<0&&(a=0);var l=a+1;l===this.eqn.currentFormSeries.length&&(l=0),n=this.eqn.forms[this.eqn.currentFormSeries[l]]}if(null!=n){var u=null,c=null,h=this.eqn.subFormPriority.filter((function(t){return t in n}));if(h.length&&(c=h[0]),null!=c){u=n[c];var f=r.duration;if(r.prioritizeFormDuration&&("fromPrev"===r.fromWhere&&null!=u.fromPrev&&void 0!==u.fromPrev.duration?f=u.fromPrev.duration:"fromNext"===r.fromWhere&&null!=u.fromNext&&void 0!==u.fromNext.duration?f=u.fromNext.duration:void 0!==u.duration&&(f=u.duration)),null!=f&&0<f&&"dissolve"===r.animate?(null==r.dissolveOutTime&&(r.dissolveOutTime=.4*f),null==r.dissolveInTime&&(r.dissolveInTime=.4*f),null==r.blankTime&&(r.blankTime=.2*f)):(null==r.dissolveOutTime&&(r.dissolveOutTime=.4),null==r.dissolveInTime&&(r.dissolveInTime=.4),null==r.blankTime&&(r.blankTime=.2)),0===f)this.showForm(u),null!=r.callback&&r.callback();else{this.eqn.isAnimating=!0;var d=function(){i.eqn.isAnimating=!1,null!=r.callback&&r.callback()};if("move"===r.animate)u.animatePositionsTo(r.delay,r.dissolveOutTime,f,r.dissolveInTime,d,r.fromWhere,!1);else if("dissolveInThenMove"===r.animate)u.animatePositionsTo(r.delay,r.dissolveOutTime,f,r.dissolveInTime,d,r.fromWhere,!0);else if("moveFrom"===r.animate&&null!=this.eqn.formRestart&&null!=this.eqn.formRestart.moveFrom){var p=this.eqn.formRestart.moveFrom,v=this.getPosition(),m=this.getPosition();p instanceof t&&p.showForm(u.name),m=p instanceof Or?p.getPosition():K(this.eqn.formRestart.moveFrom),this.animations.new().dissolveOut({duration:r.dissolveOutTime}).position({target:m,duration:0}).trigger({callback:function(){i.showForm(u.name,c,!1)},duration:.01}).position({target:v,duration:f}).whenFinished(d).start()}else if("pulse"===r.animate&&null!=this.eqn.formRestart&&null!=this.eqn.formRestart.pulse){var y=this.eqn.formRestart.pulse;u.allHideShow(r.delay,r.dissolveOutTime,r.blankTime,r.dissolveInTime,(function(){i.pulseScaleNow(y.duration,y.scale,0,d),null!=y.element&&y.element instanceof t&&y.element.getCurrentForm().name===u.name&&y.element.pulseScaleNow(y.duration,y.scale)}))}else u.allHideShow(r.delay,r.dissolveOutTime,r.blankTime,r.dissolveInTime,d);this.setCurrentForm(u)}}}}},{key:"getFormIndex",value:function(t){var e=this.getForm(t),n=-1;return null!=e&&(n=this.eqn.currentFormSeries.indexOf(e.name)),n}},{key:"prevForm",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:null,i=1<arguments.length&&void 0!==e?e:0,r=this.getCurrentForm();if(null!=r){var o=this.getFormIndex(r);-1<o&&(--o<0&&(o=this.eqn.currentFormSeries.length-1),this.goToForm({index:o,duration:n,delay:i,fromWhere:"fromNext"}))}}},{key:"nextForm",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:null,i=1<arguments.length&&void 0!==e?e:0,r="move",o=this.getCurrentForm();if(null!=o){var a=this.getFormIndex(o);if(-1<a){if((a+=1)>this.eqn.currentFormSeries.length-1){a=0;var s=this.eqn.formRestart;r=null!=s&&null!=s.moveFrom?"moveFrom":null!=s&&null!=s.pulse?"pulse":"dissolve"}this.goToForm({index:a,duration:n,delay:i,fromWhere:"fromPrev",animate:r})}}}},{key:"replayCurrentForm",value:function(t){if(this.eqn.isAnimating){this.stop(!0,!0),this.eqn.isAnimating=!1;var e=this.getCurrentForm();null!=e&&this.showForm(e)}else this.stop(),this.eqn.isAnimating=!1,this.prevForm(0),this.nextForm(t,.5)}},{key:"animateToForm",value:function(t,e,n,i){var r=1<arguments.length&&void 0!==e?e:null,o=2<arguments.length&&void 0!==n?n:0,a=3<arguments.length&&void 0!==i?i:null;this.stop();var s=this.getForm(t);null!=s&&s.animatePositionsTo(o,.4,r,.4,a),this.setCurrentForm(t)}},{key:"changeDescription",value:function(t,e,n,i){var r=1<arguments.length&&void 0!==e?e:"",o=2<arguments.length&&void 0!==n?n:{},a=3<arguments.length&&void 0!==i?i:"base",s=this.getForm(t,a);null!=s&&(s.description="".concat(r),s.modifiers=o)}},{key:"getDescription",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:"base",i=this.getForm(t,n);return null!=i&&null!=i.description?Xr(i.description,i.modifiers):""}}])&&tc(e.prototype,n),t}();function ac(t){return(ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sc(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function lc(t){return(lc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function uc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cc(t,e){return(cc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function hc(t,e,n,i,r,o){var a,s=4<arguments.length&&void 0!==r&&r,l=5<arguments.length&&void 0!==o?o:"",u=n;if(null!=u&&null!=(a=t.getCurrentForm()))if(null!=a.description){var c=!s;n&&(s?(n.innerHTML=Xr("".concat(l).concat(a.description),a.modifiers),Yr(a.modifiers)):n.innerHTML=Xr("".concat(l).concat(a.description),a.modifiers,"",c))}else null!=u&&(u.innerHTML="")}function fc(t){t&&t.classList.remove("figureone__eqn_nav__not_touchable")}function dc(t){t&&t.classList.add("figureone__eqn_nav__not_touchable")}function pc(t,e){var n="",i="";1<arguments.length&&void 0!==e&&e&&(n="NEXT: ",i="PREV: ");var r=t.eqn.getCurrentForm();if(null!=r){var o=t.eqn.getFormIndex(r);if(0===o?(dc(t.refresh),dc(t.prev),dc(t.prevDescription),dc(t.description)):(fc(t.refresh),fc(t.prev),fc(t.prevDescription),fc(t.description)),1<t.eqn.eqn.currentFormSeries.length)fc(t.next),fc(t.nextDescription),"1Button"===t.navType&&fc(t.description);else if(dc(t.next),dc(t.nextDescription),"1Button"===t.navType){var a=t.next;a&&(a.classList.remove("figureone__eqn_nav__next_form"),a.classList.remove("figureone__eqn_nav__reset"),a.classList.remove("interactive_top_right"))}var s=o+1;if(s>t.eqn.eqn.currentFormSeries.length-1){if(t.nextDescription&&(t.nextDescription.innerHTML="RESTART from begining"),"1Button"===t.navType&&1<t.eqn.eqn.currentFormSeries.length){var l=t.next;l&&(l.classList.add("figureone__eqn_nav__reset"),l.classList.remove("figureone__eqn_nav__next_form"))}}else if(hc(t.eqn,r.subForm,t.nextDescription,s,!1,n),"1Button"===t.navType&&1<t.eqn.eqn.currentFormSeries.length){var u=t.next;u&&(u.classList.add("figureone__eqn_nav__next_form"),u.classList.remove("figureone__eqn_nav__reset"))}hc(t.eqn,r.subForm,t.description,o,!0);var c=o-1;0<=c?hc(t.eqn,r.subForm,t.prevDescription,c,!1,i):t.prevDescription&&(t.prevDescription.innerHTML="")}}var vc=function(){function t(e,n){var i,r,o,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(i=!(o=lc(t).call(this,new pt("Eqn Nav").scale(1,1).translate(0,0),e.limits))||"object"!==ac(o)&&"function"!=typeof o?uc(r):o).shapes=e,i.prev=null,i.next=null,i.refresh=null,i.description=null,i.nextDescription=null,i.prevDescription=null,i.table=null,i.prevGroup=null,i.currentGroup=null,i.nextGroup=null,i.animateNextFrame=n;var s=Yt({},{offset:new Y(0,0),navType:"twoLine",navTypeOptions:{forceTwoLines:!1,arrows:!1},xAlign:"center",yAlign:"middle",interactive:!0,id:Kt("id_figureone__equation_navigator_")},a);null!=(i.options=s).equation&&i.connectToEquation(s.equation,s.interactive),i.navType=s.navType;var l,u,c,h,f,d,p,v,m,y,g,w,b,x,_,S,O,k,T,P,A,E,j,M=null;if("3Line"===i.navType&&(l=i.clickPrev.bind(uc(i)),u=i.clickRefresh.bind(uc(i)),c=i.clickNext.bind(uc(i)),h=s.navTypeOptions,f=document.createElement("table"),d=document.createElement("tr"),p=document.createElement("tr"),v=document.createElement("tr"),m=document.createElement("td"),y=document.createElement("td"),g=document.createElement("td"),w=document.createElement("td"),b=document.createElement("td"),x=document.createElement("td"),d.appendChild(m),d.appendChild(w),v.appendChild(g),v.appendChild(x),p.appendChild(y),p.appendChild(b),f.appendChild(d),f.appendChild(p),f.appendChild(v),f.classList.add("figureone__eqn_nav__table"),d.classList.add("figureone__eqn_nav__3line__prevRow"),p.classList.add("figureone__eqn_nav__3line__currentRow"),v.classList.add("figureone__eqn_nav__3line__nextRow"),m.classList.add("figureone__eqn_nav__3line__prevRow__button"),y.classList.add("figureone__eqn_nav__3line__currentRow__button"),g.classList.add("figureone__eqn_nav__3line__nextRow__button"),w.classList.add("figureone__eqn_nav__3line__prevRow__description"),b.classList.add("figureone__eqn_nav__3line__currentRow__description"),b.classList.add("figureone__eqn_nav__description"),x.classList.add("figureone__eqn_nav__3line__nextRow__description"),Yt({},{forceTwoLines:!1,arrows:!1},h).forceTwoLines&&(d.classList.add("figureone__eqn_nav__3line__prev_twoLines"),p.classList.add("figureone__eqn_nav__3line__current_twoLines"),v.classList.add("figureone__eqn_nav__3line__next_twoLines")),d.onclick=l,p.onclick=u,v.onclick=c,g.innerHTML="Next",m.innerHTML="Prev",y.innerHTML="Refresh",M={table:f,prevGroup:d,currentGroup:p,nextGroup:v,prev:m,refresh:y,next:g,prevDescription:w,description:b,nextDescription:x}),"description"===i.navType&&(_=i.clickNext.bind(uc(i)),S=document.createElement("table"),O=document.createElement("tr"),k=document.createElement("td"),O.appendChild(k),S.appendChild(O),S.classList.add("figureone__eqn_nav__table"),O.classList.add("figureone__eqn_nav__description_only__currentRow"),k.classList.add("figureone__eqn_nav__description_only__currentRow__description"),k.classList.add("figureone__eqn_nav__description"),O.onclick=_,M={table:S,currentGroup:O,description:k}),"1Line"===i.navType&&(M=function(t,e,n,i){var r=document.createElement("table"),o=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),l=document.createElement("td");o.appendChild(a),o.appendChild(l),o.appendChild(s),r.appendChild(o),r.classList.add("figureone__eqn_nav__table"),o.classList.add("figureone__eqn_nav__1line__currentRow"),a.classList.add("figureone__eqn_nav__1line__prev__button"),s.classList.add("figureone__eqn_nav__1line__next__button"),l.classList.add("figureone__eqn_nav__1line__currentRow__description"),l.classList.add("figureone__eqn_nav__description");var u=Yt({},{forceTwoLines:!1,arrows:!1},i);if(u.forceTwoLines&&o.classList.add("figureone__eqn_nav__1line__current_twoLines"),a.onclick=t,l.onclick=e,s.onclick=n,u.arrows){var c=document.createElement("div");c.classList.add("figureone__eqn_nav__arrow_right"),s.appendChild(c);var h=document.createElement("div");h.classList.add("figureone__eqn_nav__arrow_left"),a.appendChild(h)}else s.innerHTML="Next",a.innerHTML="Prev";return{table:r,currentGroup:o,prev:a,next:s,description:l}}(i.clickPrev.bind(uc(i)),i.clickRefresh.bind(uc(i)),i.clickNext.bind(uc(i)),s.navTypeOptions)),"1Button"===i.navType&&(T=i.clickNext.bind(uc(i)),P=document.createElement("table"),A=document.createElement("tr"),E=document.createElement("td"),j=document.createElement("td"),A.appendChild(E),A.appendChild(j),P.appendChild(A),P.classList.add("figureone__eqn_nav__table"),A.classList.add("figureone__eqn_nav__1button__currentRow"),E.classList.add("figureone__eqn_nav__1button__button"),j.classList.add("figureone__eqn_nav__1line__currentRow__description"),j.classList.add("figureone__eqn_nav__description"),E.classList.add("interactive_top_right"),E.onclick=T,j.onclick=T,E.classList.add("figureone__eqn_nav__next_form"),M={table:P,currentGroup:A,next:E,description:j}),"2Line"===i.navType&&(M=function(t,e,n,i){var r=document.createElement("table"),o=document.createElement("tr"),a=document.createElement("tr"),s=document.createElement("tr"),l=document.createElement("td"),u=document.createElement("td"),c=document.createElement("tr"),h=document.createElement("td"),f=document.createElement("td");s.appendChild(h),c.appendChild(f),a.appendChild(s),a.appendChild(c),o.appendChild(l),o.appendChild(a),o.appendChild(u),r.appendChild(o),r.classList.add("figureone__eqn_nav__table"),s.classList.add("figureone__eqn_nav__2lines__currentRow"),c.classList.add("figureone__eqn_nav__2lines__nextRow"),l.classList.add("figureone__eqn_nav__2lines__prev__button"),u.classList.add("figureone__eqn_nav__2lines__next__button"),h.classList.add("figureone__eqn_nav__2lines__currentRow__description"),h.classList.add("figureone__eqn_nav__description"),f.classList.add("figureone__eqn_nav__2lines__nextRow__description");var d=Yt({},{forceTwoLines:!1,arrows:!1},i);if(-1<d.forceTwoLines&&s.classList.add("figureone__eqn_nav__2lines__current_twoLines"),l.onclick=t,h.onclick=e,u.onclick=n,f.onclick=n,d.arrows){var p=document.createElement("div");p.classList.add("figureone__eqn_nav__arrow_right"),u.appendChild(p);var v=document.createElement("div");v.classList.add("figureone__eqn_nav__arrow_left"),l.appendChild(v)}else u.innerHTML="Next",l.innerHTML="Prev";return{table:r,currentGroup:s,nextGroup:c,prev:l,next:u,nextDescription:f,description:h}}(i.clickPrev.bind(uc(i)),i.clickRefresh.bind(uc(i)),i.clickNext.bind(uc(i)),s.navTypeOptions)),null!=M){var L=Q(s.offset,new Y(0,0));Object.assign(uc(i),M);var C=i.shapes.htmlElement(M.table,"".concat(s.id,"_table"),"",L,s.yAlign,s.xAlign);i.add("table",C)}return i}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&cc(t,e)}(t,Or),e=t,(n=[{key:"connectToEquation",value:function(t,e){this.eqn=t,e&&(this.eqn.onClick=this.clickNext.bind(this),this.eqn.hasTouchableElements=!0,this.eqn.isTouchable=!0,this.eqn.touchInBoundingRect=!0)}},{key:"clickNext",value:function(){this.eqn.nextForm(1.5),this.updateButtons(),this.animateNextFrame()}},{key:"clickPrev",value:function(){this.eqn.prevForm(1.5),this.updateButtons(),this.animateNextFrame()}},{key:"clickRefresh",value:function(){var t=this.eqn.getCurrentForm();null!=t&&0<this.eqn.getFormIndex(t)&&(this.eqn.replayCurrentForm(1.5),this.animateNextFrame()),this.updateButtons()}},{key:"updateButtons",value:function(){"equationOnly"!==this.navType&&("description"===this.navType?function(t){var e=t.eqn.getCurrentForm();if(null!=e){var n=t.eqn.getFormIndex(e);fc(t.description),hc(t.eqn,e.subForm,t.description,n,!0)}}(this):"2Line"===this.navType?pc(this,!0):pc(this))}},{key:"showForm",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:null;this.show(),this.eqn.showForm(t,n),this._table&&(this._table.show(),this.updateButtons())}}])&&sc(e.prototype,n),t}();function mc(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var yc=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.webgl=e.webgl,this.draw2D=e.draw2D,this.limits=e.limits,this.shapes=e,this.animateNextFrame=n}var e,n;return e=t,(n=[{key:"equation",value:function(t){return new oc(this.shapes,t)}},{key:"addEquation",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:{},r=new oc(this.shapes,i);return t.add(e,r),r}},{key:"addNavigator",value:function(t,e,n){var i=e,r=Yt({},n);if(null==r.equation){var o=this.addEquation(t,"".concat(e,"Eqn"),n);r.equation=o,i="".concat(e,"Nav")}else if(!(r.equation instanceof oc)){var a,s,l,u,c;if(Array.isArray(r.equation)){var h=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(r.equation,7);a=h[1],s=h[3],l=h[4],u=h[6]}else a=r.equation.name,s=r.equation.options,l=r.equation.mods,u=r.equation.scenario;c=Array.isArray(s)?this.addEquation.apply(this,[t,a].concat(function(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(s))):this.addEquation(t,a,s),null!=l&&l!=={}&&c.setProperties(l),null!=u&&u in c.scenarios&&c.setScenario(u),r.equation=c}var f=new vc(this.shapes,this.animateNextFrame,r);return t.add(i,f),f}}])&&mc(e.prototype,n),t}();function gc(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var wc=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i,r={label:"",color:[0,0,1,1],scale:.7,position:new Y(0,0),form:"0",formType:"base",xAlign:"center",yAlign:"middle"},o=Object.assign({},r,n),a=o.label,s=o.color,l=o.scale,u=o.position,c=o.form,h=o.formType,f=o.yAlign,d=o.xAlign;if("string"==typeof a)(i=e.equation({elements:{base:a},color:s,defaultFormAlignment:{fixTo:new Y(0,0),xAlign:d,yAlign:f},scale:l,forms:{base:["base"]},position:u})).setCurrentForm("base");else if(a instanceof oc)i=a;else if(Array.isArray(a)){var p={},v={};a.forEach((function(t,e){p["_".concat(e)]=t,v[e]=[t]})),(i=e.equation({elements:p,forms:v,color:s,position:u,defaultFormAlignment:{fixTo:new Y(0,0),xAlign:d,yAlign:f},scale:l})).setCurrentForm(c,h)}else{var m={color:s};i=e.equation(Yt(m,a))}this.eqn=i}var e,n;return e=t,(n=[{key:"setText",value:function(t){var e=this.eqn.getCurrentForm();if(null!=e){var n=Object.keys(e.elements)[0],i=e.elements[n].drawingObject;null!=i&&i.setText(t),e.arrange(this.eqn.eqn.scale,this.eqn.eqn.defaultFormAlignment.xAlign,this.eqn.eqn.defaultFormAlignment.yAlign,this.eqn.eqn.defaultFormAlignment.fixTo)}}},{key:"getText",value:function(){var t="",e=this.eqn.getCurrentForm();if(null!=e){var n=Object.keys(e.elements)[0],i=e.elements[n].drawingObject;null!=i&&(t=i.text[0].text)}return t}},{key:"updateRotation",value:function(t,e,n,i){var r=2<arguments.length&&void 0!==n?n:0,o=3<arguments.length&&void 0!==i?i:0;if(0!==r){var a=0,s=0,l=this.eqn.getCurrentForm();null!=l&&(a=l.width/2+.04,s=l.height/2+.04);var u=a+r,c=s+r,h=u*c/Math.sqrt(Math.pow(c*Math.cos(t-o),2)+Math.pow(u*Math.sin(t-o),2));this.eqn.setPosition(e.add(gt(h,o)))}else this.eqn.setPosition(e);this.eqn.transform.updateRotation(t)}}])&&gc(e.prototype,n),t}();function bc(t,e,n){return(bc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Tc(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function xc(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _c(t,e,n){return e&&xc(t.prototype,e),n&&xc(t,n),t}function Sc(t){return(Sc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Oc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kc(t,e){return!e||"object"!==Sc(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Tc(t){return(Tc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Pc(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}var Ac=function(){function t(e,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"top",s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"left",l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"horizontal",u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:.5,c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:.7,h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:1;return Oc(this,t),(o=kc(this,Tc(t).call(this,e,{label:n,color:i,scale:c}))).offset=r,o.location=a,o.subLocation=s,o.orientation=l,o.linePosition=u,o.precision=h,o}return Pc(t,wc),t}();function Ec(t,e,n,i,r,o,a,s){var l=t.horizontalLine(i,e,n,0,r,(new pt).scale(1,1).translate(0,0));if(o&&(l=t.dashedLine({position:i,length:o.maxLength,width:n,rotation:0,dashStyle:o.style,color:r,transform:(new pt).scale(1,1).translate(0,0)})),a){var u=s?16:8;"number"==typeof a&&(u=a),function(t){for(var e=0;e<t.drawingObject.border[0].length;e+=1)t.drawingObject.border[0][e].y*=u}(l)}return l}var jc=function(){function t(e,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};Oc(this,t);var s={position:new Y(0,0),length:1,angle:0,width:.01,vertexSpaceStart:"start",color:[0,0,1,1],showLine:!0,largerTouchBorder:!0,offset:0,dashStyle:null,mods:{},pulse:{line:6,label:2,arrow:3,collection:1}},l=Object.assign({},s,a),u=l.dashStyle;if(u){var c=l.length;null!=l.p1&&null!=l.p2&&(l.p1=K(l.p1),l.p2=K(l.p2),c=nt(l.p1,l.p2)),u=Object.assign({},{maxLength:c,dashStyle:[.1]},a.dashStyle)}if((o=kc(this,Tc(t).call(this,new pt("Line").scale(1,1).rotate(0).translate(0,0),e.limits))).setColor(l.color),o.shapes=e,o.equation=n,o.largerTouchBorder=l.largerTouchBorder,o.isTouchDevice=i,o.animateNextFrame=r,o.dashStyle=u,o.offset=l.offset,o.width=l.width,o.position=K(l.position),o.length=l.length,o.angle=l.angle,o.transform.updateTranslation(o.position),o.transform.updateRotation(o.angle),o.vertexSpaceLength=1,o.vertexSpaceStart=new Y(0,0),"end"===l.vertexSpaceStart?o.vertexSpaceStart=new Y(-1,0):"center"===l.vertexSpaceStart?o.vertexSpaceStart=new Y(-.5,0):"number"==typeof l.vertexSpaceStart?o.vertexSpaceStart=new Y(-l.vertexSpaceStart,0):l.vertexSpaceStart instanceof Y&&(o.vertexSpaceStart=l.vertexSpaceStart),o.multiMove={vertexSpaceMidLength:0,bounds:new X(-1,-1,2,2)},o._midLine=null,o._line=null,l.showLine){var h=Ec(o.shapes,o.vertexSpaceLength,o.width,o.vertexSpaceStart,l.color,o.dashStyle,l.largerTouchBorder,i);o.add("line",h)}o.arrow1=null,o.arrow2=null,o._arrow1=null,o._arrow2=null,o.label=null,o._label=null,o.showRealLength=!1,o.setLength(o.length),null!=l.p1&&null!=l.p2&&o.setEndPoints(l.p1,l.p2);var f={width:4*o.width,height:4*o.width};if(l.arrowStart){var d=Object.assign({},f,l.arrowStart);o.addArrowStart(d.height,d.width)}if(l.arrowEnd){var p=Object.assign({},f,l.arrowEnd);o.addArrowEnd(p.height,p.width)}if(l.arrows){var v={};"object"===Sc(l.arrows)&&(v=l.arrows);var m=Object.assign({},f,v);o.addArrows(m.height,m.width)}var y={text:null,offset:0,location:"top",subLocation:"left",orientation:"horizontal",linePosition:.5,scale:.7,color:l.color,precision:1};if(l.label){var g=Object.assign({},y,l.label);null===g.text&&(g.text="",o.showRealLength=!0),o.addLabel(g.text,g.offset,g.location,g.subLocation,g.orientation,g.linePosition,g.scale,g.color,g.precision)}var w={type:"rotation",middleLengthPercent:.22,translationBounds:o.diagramLimits};if(l.move){var b=Yt({},w,l.move);o.setMovable(!0,b.type,b.middleLengthPercent,b.translationBounds)}return o.pulseDefaultSettings={line:l.pulse.line||1,label:l.pulse.label||1,arrow:l.pulse.arrow||1,collection:l.pulse.collection||1},o.pulseDefault=function(t){o.pulseWidth({line:o.pulseDefaultSettings.line,label:o.pulseDefaultSettings.label,arrow:o.pulseDefaultSettings.arrow,done:t}),1!==o.pulseDefaultSettings.collection&&o.pulseScaleNow(1,o.pulseDefaultSettings.collection)},null!=l.mods&&l.mods!=={}&&o.setProperties(l.mods),o}return Pc(t,Or),_c(t,[{key:"calculateFromP1LengthAngle",value:function(t,e,n){var i=(new pt).scale(e,1).rotate(n),r=this.vertexSpaceStart.transformBy(i.matrix());return{length:e,angle:n,position:t.sub(r)}}},{key:"calculateFromP1P2",value:function(t,e){var n=new lt(t,e),i=n.length(),r=n.angle(),o=(new pt).scale(i,1).rotate(r),a=this.vertexSpaceStart.transformBy(o.matrix());return{length:i,angle:r,position:t.sub(a)}}}]),_c(t,[{key:"pulseWidth",value:function(t){var e=Yt({line:3,label:1.5,arrow:2,done:null},0<arguments.length&&void 0!==t?t:{}),n=e.done,i=this._line;if(null!=i){i.stopPulsing();var r=i.pulseSettings.transformMethod,o=i.pulseSettings.callback;i.pulseSettings.callback=function(){i.pulseSettings.transformMethod=r,i.pulseSettings.callback=o},i.pulseSettings.transformMethod=function(t){return(new pt).scale(1,t)},i.pulseScaleNow(1,e.line,0,n),n=null}var a=this._arrow1,s=this._arrow2;null!=a&&(a.pulseScaleNow(1,e.arrow,0,n),n=null),null!=s&&(s.pulseScaleNow(1,e.arrow,0,n),n=null);var l=this._label;null!=l&&(l.pulseScaleNow(1,e.label,0,n),n=null),null!=n&&n(),this.animateNextFrame()}},{key:"addArrow",value:function(t,e,n){var i=1<arguments.length&&void 0!==e?e:4*this.width,r=2<arguments.length&&void 0!==n?n:i,o=Math.PI/2;2===t&&(o=Math.PI/2*3);var a=this.shapes.arrow({width:r,legWidth:0,height:i,legHeight:0,color:this.color,transform:(new pt).translate(this.vertexSpaceStart.x,0),tip:new Y(0,0),rotation:o});this["arrow".concat(t)]={height:i},this.add("arrow".concat(t),a),this.setLength(this.currentLength)}},{key:"addArrows",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,i=1<arguments.length&&void 0!==e?e:n;this.addArrow1(n,i),this.addArrow2(n,i)}},{key:"addArrow1",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,i=1<arguments.length&&void 0!==e?e:n;this.addArrow(1,n,i)}},{key:"addArrow2",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,i=1<arguments.length&&void 0!==e?e:n;this.addArrow(2,n,i)}},{key:"addArrowStart",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,i=1<arguments.length&&void 0!==e?e:n;this.addArrow1(n,i)}},{key:"addArrowEnd",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:4*this.width,i=1<arguments.length&&void 0!==e?e:n;this.addArrow2(n,i)}},{key:"setMovable",value:function(e,n,i,r){var o=!(0<arguments.length&&void 0!==e)||e,a=1<arguments.length&&void 0!==n?n:this.move.type,s=2<arguments.length&&void 0!==i?i:.333,l=3<arguments.length&&void 0!==r?r:this.diagramLimits;o?"translation"===a||"rotation"===a||"scale"===a||"scaleX"===a||"scaleY"===a?(this.move.type=a,bc(Tc(t.prototype),"setMovable",this).call(this,!0),this.hasTouchableElements=!0,null!=this._line&&(this._line.isTouchable=!0,this._line.isMovable=!1),this._midLine&&(this._midLine.isMovable=!1),this.multiMove.bounds=l):this.setMultiMovable(s,l):(this.isMovable=!1,this.isTouchable=!1,null!=this._line&&(this._line.isTouchable=!1,this._line.isMovable=!1))}},{key:"setMultiMovable",value:function(t,e){this.multiMove.vertexSpaceMidLength=t*this.vertexSpaceLength;var n=new Y(this.vertexSpaceStart.x+this.vertexSpaceLength/2-this.multiMove.vertexSpaceMidLength/2,0),i=Ec(this.shapes,this.multiMove.vertexSpaceMidLength,this.width,n,this.color,null,this.largerTouchBorder,this.isTouchDevice);i.isTouchable=!0,i.move.type="translation",i.move.element=this,i.isMovable=!0,i.move.canBeMovedAfterLosingTouch=!0,this.add("midLine",i),this._line&&(this._line.isTouchable=!0,this._line.move.type="rotation",(this._line.move.element=this)._line.isMovable=!0,this._line.move.canBeMovedAfterLosingTouch=!0),this.hasTouchableElements=!0,this.isTouchable=!1,this.isMovable=!1,this.multiMove.bounds=e,this.setLength(this.currentLength)}},{key:"updateMoveTransform",value:function(t){var e=(0<arguments.length&&void 0!==t?t:this.transform._dup()).r(),n=this.multiMove.bounds;if(null!=e){var i=Math.abs(this.currentLength/2*Math.cos(e)),r=Math.abs(this.currentLength/2*Math.sin(e));this.move.maxTransform.updateTranslation(n.right-i,n.top-r),this.move.minTransform.updateTranslation(n.left+i,n.bottom+r),e>2*Math.PI&&this.transform.updateRotation(e-2*Math.PI),e<0&&this.transform.updateRotation(e+2*Math.PI)}}},{key:"addLabel",value:function(t,e,n,i,r,o,a,s,l){var u=2<arguments.length&&void 0!==n?n:"top",c=3<arguments.length&&void 0!==i?i:"left",h=4<arguments.length&&void 0!==r?r:"horizontal",f=5<arguments.length&&void 0!==o?o:.5,d=6<arguments.length&&void 0!==a?a:.7,p=7<arguments.length&&void 0!==s?s:this.color,v=8<arguments.length&&void 0!==l?l:1;this.label=new Ac(this.equation,t,p,e,u,c,h,f,d,v),null!=this.label&&this.add("label",this.label.eqn),this.updateLabel()}},{key:"getLength",value:function(){return this.length}},{key:"getAngle",value:function(t){return"deg"===(0<arguments.length&&void 0!==t?t:"rad")?180*this.angle/Math.PI:this.angle}},{key:"setLabel",value:function(t){this.showRealLength=!1,null!=this.label&&this.label.setText(t),this.updateLabel()}},{key:"getLabel",value:function(){return null!=this.label?this.label.getText():""}},{key:"setLabelToRealLength",value:function(){this.showRealLength=!0,this.updateLabel()}},{key:"updateLabel",value:function(t){var e=0<arguments.length&&void 0!==t?t:0,n=this.label;if(null!=n){var i=ot(this.transform.r()||0),r=0;this.showRealLength&&this._label&&n.setText(h(this.currentLength,2).toFixed(n.precision));var o=new Y(this.vertexSpaceStart.x*this.currentLength+n.linePosition*this.currentLength,0),a=Math.PI/2,s=n.offset;if("end1"===n.location||"end2"===n.location)"end1"===n.location&&(o.x=this.vertexSpaceStart.x*this.currentLength-n.offset,a=-Math.PI),"end2"===n.location&&(o.x=this.vertexSpaceStart.x*this.currentLength+this.currentLength+n.offset,a=0);else{var l=Math.cos(i)<0?-Math.PI/2:Math.PI/2,u=-l,c=0<Math.sin(i)?Math.PI/2:-Math.PI/2,f=-c;"top"===n.location&&(a=l),"bottom"===n.location&&(a=u),"right"===n.location&&(a=f),"left"===n.location&&(a=c),0!==h(Math.sin(i),4)||"left"!==n.location&&"right"!==n.location||("top"===n.subLocation&&(a=l),"bottom"===n.subLocation&&(a=u)),0!==h(Math.cos(i),4)||"top"!==n.location&&"bottom"!==n.location||("right"===n.subLocation&&(a=f),"left"===n.subLocation&&(a=c)),"inside"===n.location&&(a=-Math.PI/2),"outside"===n.location&&(a=Math.PI/2)}"horizontal"===n.orientation&&(r=-i),"baseToLine"===n.orientation&&o.y<0&&(r=Math.PI),"baseAway"===n.orientation&&0<o.y&&(r=Math.PI),"baseUpright"===n.orientation&&Math.cos(i)<0&&(r=Math.PI),n.updateRotation(r-e,o,s,a)}}},{key:"setLength",value:function(t){var e=this.vertexSpaceStart.x*t,n=t,i=n,r=0;this.arrow1&&this._arrow1&&(i-=this.arrow1.height,r=this.arrow1.height,this._arrow1.setPosition(e)),this.arrow2&&this._arrow2&&(i-=this.arrow2.height,this._arrow2.setPosition(e+n,0));var o=this._line;if(o)if(this.dashStyle)o.lengthToDraw=i,o.setPosition(e+r-this.vertexSpaceStart.x,0);else{o.transform.updateScale(i,1);var a=e+r-this.vertexSpaceStart.x*i;o.setPosition(a,0)}var s=this._midLine;s&&s.transform.updateScale(t,1),this.length=t,this.updateLineGeometry(),this.currentLength=t,this.updateLabel()}},{key:"updateLineGeometry",value:function(){var t=this.transform.t(),e=this.transform.r();if(null!=t&&null!=e){this.position=t,this.angle=e;var n=this.vertexSpaceStart.transformBy((new pt).scale(this.length).rotate(this.angle).translate(this.position).m()),i=new lt(n,this.length,this.angle);this.p1=i.getPoint(1),this.p2=i.getPoint(2),this.line=i}}},{key:"setLineDimensions",value:function(){var t=gt(this.offset,this.angle+Math.PI/2);this.transform.updateTranslation(this.position.add(t)),this.transform.updateRotation(this.angle),this.setLength(this.length),this.updateLabel()}},{key:"setEndPoints",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:this.offset;this.offset=i;var r=this.calculateFromP1P2(K(t),K(e)),o=r.length,a=r.angle,s=r.position;this.angle=a,this.length=o,this.position=s,this.setLineDimensions()}},{key:"animateLengthTo",value:function(t,e,n,i,r,o){var a=this,s=0<arguments.length&&void 0!==t?t:1,l=1<arguments.length&&void 0!==e?e:1,u=!(2<arguments.length&&void 0!==n)||n,c=3<arguments.length&&void 0!==i?i:null,h=4<arguments.length&&void 0!==r?r:null;5<arguments.length&&void 0!==o&&!o||this.stop();var f=this.currentLength,d=s-this.currentLength;this.animations.new("Line Length").custom({callback:function(t){a.setLength(f+d*t),null!=h&&h(t,f+d*t)},duration:l}).whenFinished((function(){u&&a.setLength(f+d),"function"==typeof c&&c&&c()})).start(),this.animateNextFrame()}},{key:"grow",value:function(t,e,n,i,r){var o=0<arguments.length&&void 0!==t?t:0,a=1<arguments.length&&void 0!==e?e:1,s=!(2<arguments.length&&void 0!==n)||n,l=3<arguments.length&&void 0!==i?i:null,u=4<arguments.length&&void 0!==r?r:null;this.stop();var c=this.currentLength;this.setLength(o),this.animateLengthTo(c,a,s,l,u)}},{key:"showLineOnly",value:function(){this.show(),this._line&&this._line.show(),this._arrow1&&this._arrow1.show(),this._arrow2&&this._arrow2.show(),this._label&&this._label.hideAll()}},{key:"getP1",value:function(){var t=this.transform.matrix();return this.p1.transformBy(t)}},{key:"getP2",value:function(){var t=this.transform.matrix();return this.p2.transformBy(t)}}]),t}();function Mc(t,e,n){return(Mc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Dc(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Lc(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Cc(t,e,n){return e&&Lc(t.prototype,e),n&&Lc(t,n),t}function Bc(t){return(Bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fc(t,e){return!e||"object"!==Bc(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Dc(t){return(Dc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ic(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}var Wc=function(){function t(e,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,l=6<arguments.length&&void 0!==arguments[6]&&arguments[6],u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"degrees",c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0,h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:null,f=10<arguments.length&&void 0!==arguments[10]?arguments[10]:null,d=11<arguments.length&&void 0!==arguments[11]?arguments[11]:"horizontal",p=12<arguments.length&&void 0!==arguments[12]?arguments[12]:.7;return Rc(this,t),(o=Fc(this,Dc(t).call(this,e,{label:n,color:i,scale:p}))).radius=r,o.curvePosition=a,o.curveOffset=s,o.showRealAngle=l,o.units=u,o.orientation=d,o.precision=c,o.autoHide=h,o.autoHideMax=f,o}return Ic(t,wc),t}(),qc=function(){function t(e,n,i,r){var o,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};Rc(this,t);var s={position:new Y(0,0),rotation:0,angle:1,color:[0,1,0,1],direction:1,autoRightAngle:!1,rightAngleRange:.001,curve:null,sides:null,sideStart:null,sideStop:null,arrows:null,arrow1:null,arrow2:null,label:null,p1:null,p2:null,p3:null,pulse:{curve:1,label:1,arrow:1,side:1,collection:1.8},mods:{}},l=Yt({},s,a);if((o=Fc(this,Dc(t).call(this,new pt("Line").scale(1,1).rotate(0).translate(0,0),e.limits))).setColor(l.color),o.shapes=e,o.equation=n,o.largerTouchBorder=l.largerTouchBorder,o.isTouchDevice=i,o.animateNextFrame=r,o.nextPosition=K(l.position),o.nextRotation=l.rotation,o.direction=l.direction,o.angle=l.angle,o.lastLabelRotationOffset=0,o.autoRightAngle=l.autoRightAngle,o.rightAngleRange=l.rightAngleRange,null!=l.p1&&null!=l.p2&&null!=l.p3){var u=o.calculateFromP1P2P3(K(l.p1),K(l.p2),K(l.p3),o.direction),c=u.position,h=u.rotation,f=u.angle;o.angle=f,o.nextRotation=h,o.nextPosition=K(c)}o.setNextPositionAndRotation(),o.side1=null,o.side2=null,o.arrow1=null,o.arrow2=null,o.curve=null,o.label=null,o._curve=null,l.curve&&o.addCurve(l.curve),(l.arrow1||l.arrows)&&o.addArrow(1,Yt({},l.arrow1,l.arrows)),(l.arrow2||l.arrows)&&o.addArrow(2,Yt({},l.arrow2,l.arrows)),l.label&&o.addLabel(l.label);var d=.5;o.curve&&(d=2*o.curve.radius);var p=.01;o.curve&&(p=o.curve.width);var v={length:d,width:p,color:o.color};if(l.side1){var m=Yt({},v,l.side1);o.addSide(1,m.length,m.width,m.color)}if(l.side2){var y=Yt({},v,l.side2);o.addSide(2,y.length,y.width,y.color)}if(l.sides){var g={};"object"===Bc(l.sides)&&(g=l.sides);var w=Yt({},v,g);o.addSide(1,w.length,w.width,w.color),o.addSide(2,w.length,w.width,w.color)}return"number"==typeof l.pulse?o.pulseDefaultSettings={curve:s.pulse.curve,label:s.pulse.label,arrow:s.pulse.arrow,side:s.pulse.side,collection:l.pulse}:o.pulseDefaultSettings={curve:l.pulse.curve||1,label:l.pulse.label||1,arrow:l.pulse.arrow||1,side:l.pulse.side||1,collection:l.pulse.collection||1},o.pulseDefault=function(t){var e=t,n=o.pulseDefaultSettings;if("number"==typeof n.curve)1!==n.curve&&null!=o._curve&&(o._curve.pulseScaleNow(1,n.curve,0,e),e=null);else if(null!=o._curve&&null!=n.curve){var i=Yt({width:2,num:5},n.curve);o._curve.pulseThickNow(1,i.width,i.num,e),e=null}1!==n.label&&null!=o._label&&(o._label.pulseScaleNow(1,n.label,0,e),e=null),1!==n.arrow&&(null!=o._arrow1&&(o._arrow1.pulseScaleNow(1,n.arrow,0,e),e=null),null!=o._arrow2&&(o._arrow2.pulseScaleNow(1,n.arrow,0,e),e=null)),1!==n.side&&(null!=o._side1&&(o._side1.pulseScaleNow(1,n.side,0,e),e=null),null!=o._side2&&(o._side2.pulseScaleNow(1,n.side,0,e),e=null)),1!==n.collection&&o.pulseScaleNow(1,n.collection,0,e)},o.update(),null!=l.mods&&l.mods!=={}&&o.setProperties(l.mods),o}return Ic(t,Or),Cc(t,[{key:"calculateFromP1P2P3",value:function(t,e,n,i){var r=3<arguments.length&&void 0!==i?i:1,o=e._dup(),a=xt(t,e,n);return 1===r?{position:o,rotation:new lt(e,t).angle(),angle:a}:{position:o,rotation:new lt(e,t).angle(),angle:U(2*Math.PI-a,"0to360")}}}]),Cc(t,[{key:"setNextPositionAndRotation",value:function(){null!=this.nextPosition&&this.transform.updateTranslation(this.nextPosition),null!=this.nextRotation&&this.transform.updateRotation(this.nextRotation),this.nextPosition=null,this.nextRotation=null}},{key:"setAngle",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};null!=e.position&&(this.nextPosition=K(e.position)),null!=e.rotation&&(this.nextRotation=e.rotation),null!=e.angle&&(this.angle=e.angle);var n=e.p1,i=e.p2,r=e.p3;if(null!=n&&null!=i&&null!=r){var o=this.calculateFromP1P2P3(K(n),K(i),K(r),this.direction),a=o.position,s=o.rotation,l=o.angle;this.angle=l,this.nextRotation=s,this.nextPosition=K(a)}null!=e.rotationOffset?this.update(e.rotationOffset):this.update()}},{key:"addSide",value:function(t,e,n,i){var r=1<arguments.length&&void 0!==e?e:null,o=2<arguments.length&&void 0!==n?n:null,a=3<arguments.length&&void 0!==i?i:this.color,s=this.shapes.horizontalLine(new Y(0,0),1,o,0,a,(new pt).scale(1,1).rotate(0));this["side".concat(t)]={length:r,width:o},this.add("side".concat(t),s)}},{key:"addLabel",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},n={text:null,radius:.4,curvePosition:.5,curveOffset:0,showRealAngle:!1,units:"degrees",precision:0,orientation:"horizontal",autoHide:null,autoHideMax:null,scale:.7,color:this.color};this.curve&&(n.radius=this.curve.radius);var i=Yt({},n,e);null===i.text&&(i.text="",i.showRealAngle=!0),this.label=new Wc(this.equation,i.text,i.color,i.radius,i.curvePosition,i.curveOffset,i.showRealAngle,i.units,i.precision,i.autoHide,i.autoHideMax,i.orientation,i.scale),null!=this.label&&this.add("label",this.label.eqn)}},{key:"addCurve",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:{},n=Object.assign({},{width:.01,sides:50,radius:.5,num:1,step:0,autoHideMin:null,autoHideMax:null},e),i=0;i<n.num;i+=1){var r=this.shapes.polygonSweep({sides:n.sides,radius:n.radius+i*n.step,width:n.width,color:this.color,fill:!1,transform:new pt("AngleCurve").rotate(0)});this.curve=n;var o="curve";0<i&&(o="".concat(o).concat(i)),this.add(o,r)}if(this.autoRightAngle){var a=this.shapes.collection(),s=.707*n.radius;a.add("line1",this.shapes.horizontalLine(new Y(s,0),s+n.width/2,n.width,Math.PI/2,this.color)),a.add("line2",this.shapes.horizontalLine(new Y(0,s),s-n.width/2,n.width,0,this.color)),this.add("curveRight",a)}}},{key:"change",value:function(t){null!=this._curve&&null!=t.radius&&this._curve.drawingObject.update({radius:t.radius}),null!=this.label&&(null!=t.curveRadius&&(this.label.radius=t.curveRadius),null!=t.curvePosition&&(this.label.curvePosition=t.curvePosition),null!=t.curveOffset&&(this.label.curveOffset=t.curveOffset))}},{key:"addArrow",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{},i=.04;this.curve&&(i=4*this.curve.width);var r=.1;this.curve&&(r=this.curve.radius);var o={};null!=n&&(o=n);var a=Yt({},{width:i,height:i,radius:r,autoHide:!0,curveOverlap:.3},o),s=a.width,l=a.height,u=Math.PI/2;2===t&&(u=Math.PI/2*3);var c=this.shapes.arrowLegacy(s,0,l,0,this.color,(new pt).rotate(0).translate(0,0),new Y(0,0),u);this["arrow".concat(t)]=a,this.add("arrow".concat(t),c),this.update()}},{key:"updateCurve",value:function(t,e,n,i){var r=this.curve;if(r)for(var o=0;o<r.num;o+=1){var a="_curve";0<o&&(a="_curve".concat(o));var s=this[a];if(s)if(i)if(s.show(),0===o){var l=0;this.curve&&(l=t%(2*Math.PI/this.curve.sides)),s.angleToDraw=t,s.transform.updateRotation(n+l/2)}else{var u=0;this.curve&&(u=e%(2*Math.PI/this.curve.sides)),s.angleToDraw=e,s.transform.updateRotation(u/2)}else s.hide()}}},{key:"update",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,n=this._arrow1,i=this.arrow1,r=this._arrow2,o=this.arrow2,a=!1,s=!1,l=0,u=this.angle,c=this.angle,h=0,f=0;if(i&&this.arrow1&&(u-=h=i.height/i.radius*(1-this.arrow1.curveOverlap),c-=i.height/i.radius),o&&this.arrow2&&(u-=f=o.height/o.radius*(1-this.arrow2.curveOverlap),c-=o.height/o.radius),c<0&&(i&&i.autoHide&&(a=!0,c+=i.height/i.radius,u+=h),o&&o.autoHide&&(s=!0,c+=o.height/o.radius,u+=f)),n&&i)if(a)n.hide();else{n.show(),n.transform.updateTranslation(i.radius,0);var d=i.height/i.radius;n.transform.updateRotation(Math.PI/2+d),l=h}if(r&&o)if(s)r.hide();else{r.show(),r.transform.updateTranslation(gt(o.radius,this.angle));var p=o.height/o.radius;r.transform.updateRotation(this.angle+Math.PI/2-p)}null!=e&&(this.lastLabelRotationOffset=e),this.setNextPositionAndRotation();var v=this._curve,m=this.curve,y=this._curveRight;null!=v&&null!=m&&(null!=m.autoHideMin&&this.angle<m.autoHideMin||null!=m.autoHideMax&&this.angle>m.autoHideMax?(null!=y&&y.hide(),v.hide(),null!=n&&n.hide(),null!=r&&r.hide()):this.autoRightAngle&&this.angle>=Math.PI/2-this.rightAngleRange/2&&this.angle<=Math.PI/2+this.rightAngleRange/2?(null!=y&&y.showAll(),v.hide(),null!=n&&n.hide(),null!=r&&r.hide()):(null!=y&&y.hide(),null!=n&&!1===a&&n.show(),null!=r&&!1===s&&r.show(),u=Math.max(u,0),this.updateCurve(u,this.angle,l,!0))),this.updateLabel();var g=this._side1,w=this.side1;g&&w&&g.transform.updateScale(w.length,1);var b=this._side2,x=this.side2;b&&x&&(b.transform.updateRotation(this.angle),b.transform.updateScale(x.length,1))}},{key:"checkLabelForRightAngle",value:function(){if(!1!==this.autoRightAngle){var t=this.label,e=!1;if(null!=t&&90===parseFloat(t.getText())&&(e=!0),!1!==e){var n=this._curveRight,i=this._curve,r=this._arrow1,o=this._arrow2;null!=n&&n.showAll(),null!=i&&i.hide(),null!=r&&r.hide(),null!=o&&o.hide()}}}},{key:"getAngle",value:function(t){return"deg"===(0<arguments.length&&void 0!==t?t:"rad")?180*this.angle/Math.PI:this.angle}},{key:"setLabel",value:function(t){var e=this.label;null!=e&&(e.setText(t),e.showRealAngle=!1),this.updateLabel()}},{key:"getLabel",value:function(){return null!=this.label?this.label.getText():""}},{key:"setLabelToRealAngle",value:function(){var t=this.label;null!=t&&(t.showRealAngle=!0),this.updateLabel()}},{key:"updateLabel",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;null!=e&&(this.lastLabelRotationOffset=e);var n=this._label,i=this.label;if(n&&i)if(null!=i.autoHide&&i.autoHide>this.angle||null!=i.autoHideMax&&this.angle>i.autoHideMax)n.hide();else{if(n.show(),i.showRealAngle){var r=h(this.angle,i.precision).toFixed(i.precision);if("degrees"===i.units){var o=h(180*this.angle/Math.PI,i.precision);360===o&&(o=0),r=o.toFixed(i.precision),r="".concat(r,"")}i.setText(r)}var a=gt(i.radius,this.angle*i.curvePosition+i.curveOffset);"horizontal"===i.orientation&&i.updateRotation(-this.getRotation()-this.lastLabelRotationOffset,a,i.radius/5,this.angle*i.curvePosition+i.curveOffset),"tangent"===i.orientation&&i.updateRotation(this.angle*i.curvePosition+i.curveOffset-Math.PI/2,a,i.radius/50,this.angle*i.curvePosition+i.curveOffset)}}},{key:"showAll",value:function(){Mc(Dc(t.prototype),"showAll",this).call(this),this.update()}}]),t}();function Hc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function zc(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Nc(t,e){return!e||"object"!==Uc(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Vc(t){return(Vc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gc(t,e){return(Gc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Uc(t){return(Uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xc(t,e){if(Array.isArray(t)){if(e===t.length)return t;for(var n=[],i=0;i<e;i+=1)n.push(t[i%t.length]);return n}var r=[],o=[];if("object"===Uc(t)&&null!=t&&null!=t.label&&null!=t.label.text&&Array.isArray(t.label.text)){o=t.label.text.slice();for(var a=0;a<e;a+=1){var s={label:{text:o[a%o.length]}};r.push(Yt({},t,s))}return r}for(var l=0;l<e;l+=1)r.push(t);return r}var Yc=function(){function t(e,n,i,r,o){var a,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var l={position:null,color:[0,1,0,1],points:[new Y(1,0),new Y(0,0),new Y(0,1)],close:!1,showLine:!0,width:.01,reverse:!1,transform:new pt("PolyLine").scale(1,1).rotate(0).translate(0,0),makeValid:null};null!=s.makeValid&&null!=s.makeValid.shape&&"triangle"===s.makeValid.shape&&(l.makeValid={shape:"triangle",hide:{minAngle:null,maxAngle:null,minSide:null}});var u={showLine:!1,offset:0,width:.01,color:null==s.color?[0,1,0,1]:s.color},c={color:null==s.color?[0,1,0,1]:s.color,curve:{},autoRightAngle:!0},h={sides:20,radius:.1,color:null==s.color?[0,1,0,1]:s.color,fill:!0,isMovable:!1,boundary:"diagram",touchRadiusInBoundary:!1};null!=s.side&&(l.side=u,null!=s.side.label&&(l.side.label={offset:.1,text:null,location:"outside",subLocation:"top",orientation:"horizontal",linePosition:.5,scale:.7})),null!=s.angle&&(l.angle=c,null!=s.angle.label&&(l.angle.label={text:null})),null!=s.pad&&(l.pad=h);var f=Yt({},l,s);if(Array.isArray(s.side)&&(f.side=s.side.map((function(t){return Yt({},l.side,t)}))),Array.isArray(s.angle)&&(f.angle=s.angle.map((function(t){return Yt({},l.angle,t)}))),(a=Nc(this,Vc(t).call(this,f.transform,e.limits))).setColor(f.color),a.shapes=e,a.equation=n,a.objects=i,a.largerTouchBorder=f.largerTouchBorder,a.isTouchDevice=r,a.animateNextFrame=o,(a.updatePointsCallback=null)!=f.position&&a.transform.updateTranslation(K(f.position)),a.position=a.getPosition(),a.close=f.close,a.options=f,a.reverse=f.reverse,a.makeValid=f.makeValid,a.points=f.points.map((function(t){return K(t)})),f.pad)for(var d=f.pad,p=a.points.length,v=Xc(d,p),m=function(t){var n="pad".concat(t),i=Yt({},{transform:(new pt).translate(a.points[t])},v[t]),r=a.shapes.polygon(i);if(v[t].isMovable){if(r.isMovable=!0,r.isTouchable=!0,null!=v[t].touchRadius){var o=v[t].touchRadius/v[t].radius;r.increaseBorderSize(o)}var s=v[t].boundary;if("diagram"===s)s=e.limits._dup();else if(Array.isArray(s)){var l=Hc(s,4),u=l[0],c=l[1],h=l[2],f=l[3];s=new X(u,c,h,f)}if(!1===v[t].touchRadiusInBoundary&&null!=v[t].touchRadius){var d=v[t].touchRadius-v[t].radius;s=new X(s.left-d,s.bottom-d,s.width+2*d,s.height+2*d)}r.setMoveBoundaryToDiagram(s),r.setTransformCallback=function(t){var e=parseInt(r.name.slice(3),10),n=t.t();null!=n&&(a.points[e]=n._dup(),a.updatePoints(a.points))}}a.add(n,r)},y=0;y<p;y+=1)m(y);if(f.angle){var g=f.angle,w=a.points.length;!1===f.close&&(w-=2);var b=Xc(g,w),x=0;!1===f.close&&(x=1);for(var _=x;_<w+x;_+=1){var S=_+1,O=_-1;_===w-1&&f.close&&(S=0),0===_&&f.close&&(O=w-1);var k="angle".concat(_);if(a.reverse){var T=O;O=S,S=T}var P=Yt({},{p1:a.points[O],p2:a.points[_],p3:a.points[S]},b[_-x]),A=a.objects.angle(P);a.add(k,A)}}if(f.showLine){var E=a.shapes.polyline({points:a.points,width:s.width,close:s.close,widthIs:s.widthIs,cornerStyle:s.cornerStyle,cornerSize:s.cornerSize,cornerSides:s.cornerSides,minAutoCornerAngle:s.minAutoCornerAngle,dash:s.dash,color:s.color,pulse:s.pulse});a.add("line",E)}if(f.side){var j=f.side,M=a.points.length-1;f.close&&(M+=1);for(var L=Xc(j,M),C=0;C<M;C+=1){var B=C+1;C===M-1&&f.close&&(B=0);var R="side".concat(C).concat(B),F=Yt({},{p1:a.points[C],p2:a.points[B]},L[C]);a.reverse&&(F=Yt({},{p1:a.points[B],p2:a.points[C]},L[C]));var D=a.objects.line(F);a.add(R,D)}}return a}var e,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gc(t,e)}(t,Or),e=t,(n=[{key:"updateSideLabels",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;if(null!=this.options.side){var n=this.points.length-1;this.close&&(n+=1);for(var i=0;i<n;i+=1){var r=i+1;i===n-1&&this.close&&(r=0);var o="side".concat(i).concat(r);if(null!=this.elements[o]){var a=!this.elements[o].isShown;this.elements[o].updateLabel(e),a&&this.elements[o].hide()}}}}},{key:"updateAngleLabels",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;if(null!=this.options.angle){var n=this.points.length;!1===this.close&&(n-=2);var i=0;!1===this.close&&(i=1);for(var r=i;r<n+i;r+=1){var o="angle".concat(r);if(null!=this.elements[o]){var a=!this.elements[o].isShown;this.elements[o].updateLabel(e),a&&this.elements[o].hide()}}}}},{key:"updatePoints",value:function(t,e){var n=1<arguments.length&&void 0!==e&&e,i=t.map((function(t){return K(t)}));null!=this._line&&this._line.custom.updatePoints(i);var r=this.points.length;if(this.options.pad)for(var o=0;o<r;o+=1){var a="pad".concat(o);this.elements[a]&&this.elements[a].transform.updateTranslation(i[o])}if(null!=this.options.side){r=this.points.length-1,this.close&&(r+=1);for(var s=0;s<r;s+=1){var l=s+1;s===r-1&&this.close&&(l=0);var u="side".concat(s).concat(l);if(null!=this.elements[u]){var c=!this.elements[u].isShown;this.reverse?this.elements[u].setEndPoints(i[l],i[s]):this.elements[u].setEndPoints(i[s],i[l]),c&&this.elements[u].hide()}}}if(null!=this.options.angle){r=this.points.length,!1===this.close&&(r-=2);var h=0;!1===this.close&&(h=1);for(var f=h;f<r+h;f+=1){var d=f+1,p=f-1;f===r-1&&this.close&&(d=0),0===f&&this.close&&(p=r-1);var v="angle".concat(f);if(null!=this.elements[v]){var m=!this.elements[v].isShown;if(this.reverse){var y=p;p=d,d=y}this.elements[v].setAngle({p1:i[p],p2:i[f],p3:i[d]}),m&&this.elements[v].hide()}}}this.points=i,null==this.makeValid||"triangle"!==this.makeValid.shape||n||this.makeValidTriangle(),null==this.updatePointsCallback||n||this.updatePointsCallback()}},{key:"updateRotation",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n=0,i=this["_angle".concat(n)];null!=i;)i.update(this.getRotation()+e),i=this["_angle".concat(n+=1)];for(var r=this["_side".concat(n=0).concat(n+1)];null!=r;)r.updateLabel(this.getRotation()+e),r=this["_side".concat(n+=1).concat(n+1)];null!=(r=this["_side".concat(n,0)])&&r.updateLabel(this.getRotation()+e)}},{key:"reversePoints",value:function(t){for(var e=!(0<arguments.length&&void 0!==t)||t,n=[],i=0;i<this.points.length;i+=1)n.push(this.points[this.points.length-1-i]);this.updatePoints(n,e)}},{key:"setPositionWithoutMoving",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,i=new Y(0,0);"number"==typeof t?(i.x=t,i.y=n):i=t;var r=this.getPosition().sub(i);this.setPosition(i);var o=this.points.map((function(t){return t.add(r)}));this.updatePoints(o)}},{key:"setRotationWithoutMoving",value:function(t){var e=this.getRotation()-t,n=(new pt).rotate(e).m();this.setRotation(t);var i=this.points.map((function(t){return t.transformBy(n)}));this.updatePoints(i)}},{key:"setScaleWithoutMoving",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,i=new Y(0,0);"number"==typeof t?(i.x=t,i.y=n):i=t;var r=this.getScale(),o=new Y(r.x/i.x,r.y/i.y),a=(new pt).scale(o).m();this.setScale(i);var s=this.points.map((function(t){return t.transformBy(a)}));this.updatePoints(s)}},{key:"setShow",value:function(t,e){for(var n=0;n<this.drawOrder.length;n+=1){var i=this.elements[this.drawOrder[n]];i.name.startsWith(t)&&(e?i.showAll():i.hide())}}},{key:"hideAngles",value:function(){this.setShow("angle",!1)}},{key:"hideSides",value:function(){this.setShow("side",!1)}},{key:"showAngles",value:function(){this.setShow("angle",!0)}},{key:"showSides",value:function(){this.setShow("side",!0)}},{key:"updateLabels",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.getRotation();this.updateAngleLabels(e),this.updateSideLabels(e)}},{key:"makeValidTriangle",value:function(){var t=this._angle0,e=this._angle1,n=this._angle2,i=this._side01,r=this._side12,o=this._side20,a=t.label.precision,s=i.label.precision,l=180*U(t.getAngle(),"0to360")/Math.PI,u=180*U(e.getAngle(),"0to360")/Math.PI,c=180*U(n.getAngle(),"0to360")/Math.PI,h=f(l,a),d=f(u,a),p=f(c,a),v=f(i.getLength(),s),m=f(r.getLength(),s),y=f(o.getLength(),s);90<h&&90<d&&90<p&&(this.reverse=!this.reverse,this.updatePoints(this.points,!1),h=f(180*U(t.getAngle(),"0to360")/Math.PI,a),d=f(180*U(e.getAngle(),"0to360")/Math.PI,a),p=f(180*U(n.getAngle(),"0to360")/Math.PI,a)),180<h&&(h=360-t),180<d&&(d=360-e),180<p&&(p=360-n);var g=h+d+p,w=g-180,b=[f(l,a+1),f(u,a+1),f(c,a+1)].map((function(t){return t-Math.floor(t*Math.pow(10,a))/Math.pow(10,a)})),x=[h,d,p],_=0;if(180<g?_=b.reduce((function(t,e,n,i){return e>i[t]?n:t}),0):g<180&&(_=b.reduce((function(t,e,n,i){return e<i[t]?n:t}),1)),x[_]-=w,h=x[0],d=x[1],p=x[2],t.setLabel("".concat(h.toFixed(a),"")),e.setLabel("".concat(d.toFixed(a),"")),n.setLabel("".concat(p.toFixed(a),"")),t.checkLabelForRightAngle(),e.checkLabelForRightAngle(),n.checkLabelForRightAngle(),null!=this.makeValid){var S=this.makeValid.hide.minSide,O=this.makeValid.hide,k=O.minAngle,T=O.maxAngle,P=!1;null!=k&&(h<(k*=180/Math.PI)||d<k||p<k)&&(P=!0),null!=T&&((T*=180/Math.PI)<h||T<d||T<p)&&(P=!0),null!=S&&(v<S||m<S||y<S)&&(P=!0),P&&this.hideAngles()}if((i.isShown||r.isShown||o.isShown)&&0<h&&h<180&&0<d&&d<180&&0<p&&p<180){var A=1/Math.pow(10,s);60===h&&60===d&&60===p?y=m=v:h===d?v===(y=m)&&(f(i.getLength(),s+1)<v?v-=A:v+=A):h===p?y===(v=m)&&(f(o.getLength(),s+1)<y?y-=A:y+=A):d===p&&m===(y=v)&&(f(r.getLength(),s+1)<m?m-=A:m+=A)}i.setLabel("".concat(v.toFixed(s))),r.setLabel("".concat(m.toFixed(s))),o.setLabel("".concat(y.toFixed(s)))}}])&&zc(e.prototype,n),t}();function Qc(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Kc=function(){function t(e,n,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.webgl=e.webgl,this.draw2D=e.draw2D,this.limits=e.limits,this.shapes=e,this.isTouchDevice=i,this.animateNextFrame=r,this.equation=n}var e,n;return e=t,(n=[{key:"line",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Yt.apply(void 0,[{}].concat(e));return new jc(this.shapes,this.equation,this.isTouchDevice,this.animateNextFrame,i)}},{key:"angle",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Yt.apply(void 0,[{}].concat(e));return new qc(this.shapes,this.equation,this.isTouchDevice,this.animateNextFrame,i)}},{key:"label",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Yt.apply(void 0,[{}].concat(e));return new wc(this.equation,i)}},{key:"polyline",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Yt.apply(void 0,[{}].concat(e));return new Yc(this.shapes,this.equation,this,this.isTouchDevice,this.animateNextFrame,i)}}])&&Qc(e.prototype,n),t}();var Zc=function t(e,n,i,r,o,a){function s(t,e){return e[0]in t?1===e.length?t[e[0]]:s(t[e[0]],e.slice(1)):null}Array.isArray(o)&&o.forEach((function(o,l){if(null==o)throw Error("Add elements index ".concat(l," does not exist in layout"));var u,c=o.name,h=o.path,f=o.options,d=o[a],p=o.method,v=o.mods,m=o.scenario;if(u=null==h||""===h?r:r.getElement(h),null==c||""===c)throw new Error("Diagram addElement ERROR  at index ".concat(l," in collection ").concat(r.name,": missing name property in ").concat(o));if(null==p||""===p)throw new Error("Diagram addElement ERROR  at index ".concat(l," in collection ").concat(r.name,": missing method property in ").concat(o));if(!(u instanceof Or))throw new Error("Diagram addElement ERROR at index ".concat(l," in collection ").concat(r.name,": missing or incorrect path property in ").concat(o));var y=p.split("/"),g=function(t){var r={collection:e.collection.bind(e),polyline:i.polyline.bind(i),polygon:e.polygon.bind(e),arrow:e.arrow.bind(e),fan:e.fan.bind(e),text:e.text.bind(e),textGL:e.textGL.bind(e),textHTML:e.htmlText.bind(e),htmlImage:e.htmlImage.bind(e),axes:e.axes.bind(e),radialLines:e.radialLines.bind(e),rectangle:e.rectangle.bind(e),grid:e.grid.bind(e),dashedLine:e.dashedLine.bind(e),parallelMarks:e.parallelMarks.bind(e),marks:e.marks.bind(e),box:e.box.bind(e),line:i.line.bind(i),angle:i.angle.bind(i),addEquation:n.addEquation.bind(n),equation:n.equation.bind(n),addNavigator:n.addNavigator.bind(n)};if(t in r)return r[t];var o={shapes:e,objects:i,equation:n},a=t.split("."),l=s(o,a);return null==l?null:l=l.bind(s(o,a.slice(0,-1)))}(p);if("function"==typeof g){if("function"!=typeof g)throw new Error("Layout addElement at index ".concat(l," in collection ").concat(r.name,": incorrect method property"));var w;if(y.slice(-1)[0].startsWith("add")){if(null==(w=g(u,c,f)))return}else{if(null==(w=Array.isArray(f)?g.apply(void 0,function(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(f)):g(f)))return;u instanceof Or&&u.add(c,w)}null!=v&&v!=={}&&w.setProperties(v),null!=m&&m in w.scenarios&&w.setScenario(m),"_".concat(c)in r&&null!=d&&d!=={}&&t(e,n,i,r["_".concat(c)],d,a)}}))};function $c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Jc=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n={htmlId:"figureOneContainer",limits:new X(-1,-1,2,2),fontScale:1};this.scrolled=!1;var i=Yt({},n,e),r=i.htmlId,o=i.limits;if("string"==typeof(this.htmlId=r)){var a=document.getElementById(r);if(a instanceof HTMLElement){for(var s=(this.container=a).children,l=0;l<s.length;l+=1){var u=s[l];u instanceof HTMLCanvasElement&&u.classList.contains("figureone__gl")&&(this.canvasLow=u),u instanceof HTMLCanvasElement&&u.classList.contains("figureone__gl__offscreen")&&(this.canvasOffscreen=u),u instanceof HTMLCanvasElement&&u.classList.contains("figureone__text")&&(this.textCanvasLow=u),u instanceof HTMLCanvasElement&&u.classList.contains("figureone__text__offscreen")&&(this.textCanvasOffscreen=u),u.classList.contains("figureone__html")&&(this.htmlCanvas=u)}null==this.canvasLow&&(this.canvasLow=document.createElement("canvas"),this.canvasLow.classList.add("figureone__gl","figureone__canvas"),a.appendChild(this.canvasLow)),null==this.textCanvasLow&&(this.textCanvasLow=document.createElement("canvas"),this.textCanvasLow.classList.add("figureone__text","figureone__canvas"),a.appendChild(this.textCanvasLow)),null==this.htmlCanvas&&(this.htmlCanvas=document.createElement("div"),this.htmlCanvas.classList.add("figureone__html","figureone__canvas"),a.appendChild(this.htmlCanvas));var c=document.createElement("style");c.type="text/css",a.classList.add("figureone__container"),c.innerHTML="\n          .figureone__container {\n            position: relative;\n            pointer-events: none;\n          }\n          .figureone__canvas {\n            width: 100%;\n            height: 100%;\n            position: absolute;\n          }\n          .figureone__html {\n            pointer-events: auto;\n          }\n        ",document.getElementsByTagName("head")[0].appendChild(c),this.backgroundColor=[1,1,1,1];var h=new Ct(this.canvasLow,this.backgroundColor);if(this.webglLow=h,this.canvasOffscreen){var f=new Ct(this.canvasOffscreen,this.backgroundColor);this.webglOffscreen=f}if(this.draw2DLow=new we(this.textCanvasLow),this.textCanvasOffscreen){var d=new we(this.textCanvasOffscreen);this.draw2DOffscreen=d}}}if(null!=i.gestureCanvas){var p=document.getElementById(i.gestureCanvas);null!=p&&(this.gestureCanvas=p)}null==this.gestureCanvas&&(this.gestureCanvas=this.htmlCanvas),this instanceof t&&(this.gesture=new Ar(this)),this.fontScale=i.fontScale,this.updateLimits(o),this.drawQueued=!1,this.lastDrawTime=0,this.inTransition=!1,this.beingMovedElements=[],this.beingTouchedElements=[],this.moveTopElementOnly=!0,this.globalAnimation=new Tr,this.shapesLow=this.getShapes(),this.shapes=this.shapesLow,this.primitive=this.shapes,this.equationLow=this.getEquations(),this.equation=this.equationLow,this.objectsLow=this.getObjects(),this.objects=this.objectsLow,this.createDiagramElements(),""===this.elements.name&&(this.elements.name="diagramRoot"),window.addEventListener("resize",this.resize.bind(this)),this.sizeHtmlText(),this.initialize(),this.isTouchDevice=Zt(),this.animateNextFrame(!0,"first frame"),i.elements&&(this.elements=new i.elements(this),this.elements.diagramLimits=this.limits),this.waitForFrames=0,this.scrollingFast=!1,this.scrollTimeoutId=null,this.drawTimeoutId=null,this.oldScroll=window.pageYOffset,this.drawAnimationFrames=0}var e,n;return e=t,(n=[{key:"scrollEvent",value:function(){this.scrolled=!0,this.animateNextFrame(!1,"scroll event")}},{key:"enableScrolling",value:function(){document.addEventListener("scroll",this.scrollEvent.bind(this),!1)}},{key:"disableScrolling",value:function(){document.removeEventListener("scroll",this.scrollEvent.bind(this),!1)}},{key:"addElements",value:function(t,e,n){var i=1<arguments.length&&void 0!==e?e:this.elements,r=2<arguments.length&&void 0!==n?n:"addElements";Zc(this.shapes,this.equation,this.objects,i,t,r)}},{key:"addElement",value:function(t,e,n){var i=1<arguments.length&&void 0!==e?e:this.elements,r=2<arguments.length&&void 0!==n?n:"addElements";Zc(this.shapes,this.equation,this.objects,i,[t],r)}},{key:"getElement",value:function(t){return this.elements.getElement(t)}},{key:"setTouchable",value:function(t){var e=!(0<arguments.length&&void 0!==t)||t;this.elements.hasTouchableElements=!!e}},{key:"getShapes",value:function(){var t=[this.webglLow];this.webglOffscreen&&t.push(this.webglOffscreen);var e=[this.draw2DLow];return this.draw2DOffscreen&&e.push(this.draw2DOffscreen),new os(t,e,this.htmlCanvas,this.limits,this.spaceTransforms,this.animateNextFrame.bind(this,!0,"getShapes"))}},{key:"getEquations",value:function(){var t=this.shapesLow;return new yc(t,this.animateNextFrame.bind(this,!0,"equations"))}},{key:"getObjects",value:function(){var t=this.shapesLow,e=this.equationLow;return new Kc(t,e,this.isTouchDevice,this.animateNextFrame.bind(this,!0,"objects"))}},{key:"sizeHtmlText",value:function(){var t=this.container.getBoundingClientRect(),e=t.width/35,n=document.getElementById("".concat(this.htmlId,"_measure"));if(null!=n){n.style.fontSize="".concat(e,"px");var i=(n.clientWidth+1)/t.width;e=t.width<500?Math.floor(.84/i*e*1e4)/1e4:Math.floor(.85/i*e*1e4)/1e4}this.htmlCanvas.style.fontSize="".concat(e,"px")}},{key:"destroy",value:function(){this.gesture.destroy(),this.webglLow.gl.getExtension("WEBGL_lose_context").loseContext()}},{key:"setSpaceTransforms",value:function(){var t={x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},e={x:{bottomLeft:this.limits.left,width:this.limits.width},y:{bottomLeft:this.limits.bottom,height:this.limits.height}},n=this.canvasLow.getBoundingClientRect(),i={x:{bottomLeft:0,width:n.width},y:{bottomLeft:n.height,height:-n.height}};this.spaceTransforms={diagramToGL:vt(e,t,"Diagram"),glToDiagram:vt(t,e),pixelToDiagram:vt(i,e),diagramToPixel:vt(e,i),pixelToGL:vt(i,t),glToPixel:vt(t,i),diagramToCSSPercent:vt(e,{x:{bottomLeft:0,width:1},y:{bottomLeft:1,height:-1}})}}},{key:"initialize",value:function(){this.setFirstTransform(),this.animateNextFrame()}},{key:"setFirstTransform",value:function(){this.elements.setFirstTransform(this.spaceTransforms.diagramToGL)}},{key:"updateLimits",value:function(t){this.limits=t._dup(),this.setSpaceTransforms()}},{key:"renderAllElementsToTiedCanvases",value:function(t){var e=this,n=0<arguments.length&&void 0!==t&&t;if(null!=this.canvasOffscreen){var i=!1;Object.keys(this.elements.elements).forEach((function(t){var r=e.elements.elements[t];r.isShown&&(!1===r.isRenderedAsImage||n)&&null!=r.tieToHTML.element&&(r.isRenderedAsImage=!0,e.renderElementToTiedCanvas(t),i=!0)})),i&&(this.drawQueued=!0,this.clearContext(),this.draw2DLow.ctx.clearRect(0,0,this.textCanvasLow.width,this.textCanvasLow.height),this.draw(-1))}}},{key:"renderElementToTiedCanvas",value:function(t){var e=this,n={};Object.keys(this.elements.elements).forEach((function(t){var i=e.elements.elements[t];n[t]=i.isShown})),Object.keys(this.elements.elements).forEach((function(t){e.elements.elements[t].hide()}));var i=this.elements.elements[t];i.show();var r=i.getPosition(),o=i.getScale(),a=document.getElementById(i.tieToHTML.element);a instanceof HTMLElement&&(this.canvasOffscreen.style.width="".concat(a.clientWidth,"px"),this.canvasOffscreen.style.height="".concat(a.clientHeight,"px"),this.textCanvasOffscreen.style.width="".concat(a.clientWidth,"px"),this.textCanvasOffscreen.style.height="".concat(a.clientHeight,"px"),this.webglOffscreen.resize(),this.draw2DOffscreen.resize()),i.updateHTMLElementTie(this.canvasOffscreen);var s=i.getScale();i.setPosition(0-s.x*(i.tieToHTML.window.left+i.tieToHTML.window.width/2),0-s.y*(i.tieToHTML.window.bottom+i.tieToHTML.window.height/2)),i.isRenderedAsImage=!1,i.stop(!0,!0),this.renderToCanvas(i.tieToHTML.element),i.isRenderedAsImage=!0,i.setPosition(r),i.setScale(o),Object.keys(this.elements.elements).forEach((function(t){var i=e.elements.elements[t];!0===n[t]?i.show():i.hide()}))}},{key:"renderToCanvas",value:function(t){var e=0<arguments.length&&void 0!==t?t:"",n=e;if("string"==typeof e&&(n=document.getElementById(e)),n instanceof HTMLElement){this.drawQueued=!0,this.draw(-1,1);var i=document.getElementById("".concat(e,"_webgl"));i instanceof HTMLImageElement&&(i.src=this.webglOffscreen.gl.canvas.toDataURL("image/png",.5),i.style.display="block");var r=document.getElementById("".concat(e,"_2d"));r instanceof HTMLImageElement&&(r.src=this.draw2DOffscreen.canvas.toDataURL("image/png",.5),r.style.display="block"),this.clearContext(1)}}},{key:"unrenderAll",value:function(){for(var t=0;t<this.elements.drawOrder.length;t+=1)this.elements.elements[this.elements.drawOrder[t]].unrender()}},{key:"resize",value:function(t){var e=0<arguments.length&&void 0!==t&&t;this.webglLow.resize(),this.draw2DLow.resize(),this.setSpaceTransforms(),null!=this.elements&&this.elements.updateLimits(this.limits,this.spaceTransforms),this.sizeHtmlText(),e?this.elements.resize():this.elements.resize(this.canvasLow),this.oldWidth!==this.canvasLow.clientWidth&&(this.renderAllElementsToTiedCanvases(),this.oldWidth=this.canvasLow.clientWidth),this.animateNextFrame(!0,"resize"),this.drawAnimationFrames=2}},{key:"updateHTMLElementTie",value:function(){null!=this.elements&&this.elements.updateHTMLElementTie(this.canvasLow)}},{key:"touchDownHandler",value:function(t){if(this.inTransition)return!1;var e=this.clientToPixel(t).transformBy(this.spaceTransforms.pixelToGL.matrix());this.beingTouchedElements=this.elements.getTouched(e),this.moveTopElementOnly?0<this.beingTouchedElements.length&&this.beingTouchedElements[0].click():this.beingTouchedElements.forEach((function(t){return t.click()})),this.beingMovedElements=[];for(var n=0;n<this.beingTouchedElements.length;n+=1){var i=this.beingTouchedElements[n];i.isMovable&&(this.beingMovedElements.push(i),i.startBeingMoved())}return 0<this.beingMovedElements.length&&this.animateNextFrame(!0,"touch down handler"),0<this.beingTouchedElements.length}},{key:"touchUpHandler",value:function(){for(var t=0;t<this.beingMovedElements.length;t+=1){var e=this.beingMovedElements[t];e.state.isBeingMoved&&(e.stopBeingMoved(),e.startMovingFreely())}this.beingMovedElements=[],this.beingTouchedElements=[]}},{key:"rotateElement",value:function(t,e,n){var i=t.getPosition("diagram");null==i&&(i=new Y(0,0));var r=i.transformBy(this.spaceTransforms.diagramToPixel.matrix()),o=this.clientToPixel(e),a=this.clientToPixel(n),s=Math.atan2(a.y-r.y,a.x-r.x),l=-rt(Math.atan2(o.y-r.y,o.x-r.x),s),u=t.transform._dup(),c=u.r();null==c&&(c=0);var h=c-l;u.updateRotation(h),t.moved(u._dup())}},{key:"translateElement",value:function(t,e,n){var i=this.clientToPixel(e),r=this.clientToPixel(n),o=i.transformBy(this.spaceTransforms.pixelToDiagram.matrix()),a=r.transformBy(this.spaceTransforms.pixelToDiagram.matrix()),s=t.diagramSpaceToVertexSpaceTransformMatrix(),l=a.transformBy(s),u=o.transformBy(s),c=l.sub(u),h=t.transform._dup(),f=h.t();if(null!=f){var d=f.add(c);h.updateTranslation(d),t.moved(h)}}},{key:"scaleElement",value:function(t,e,n,i){var r=3<arguments.length&&void 0!==i?i:"",o=this.clientToPixel(e),a=this.clientToPixel(n),s=t.getPosition("diagram").transformBy(this.spaceTransforms.diagramToPixel.matrix()),l=o.sub(s).distance(),u=a.sub(s).distance(),c=t.transform.s();if(null!=c){var h=t.transform._dup(),f=c.x*u/l,d=c.y*u/l;"x"===r?h.updateScale(f,1):"y"===r?h.updateScale(1,d):h.updateScale(f,d),t.moved(h)}}},{key:"touchMoveHandler",value:function(t,e){if(this.inTransition)return!1;if(0===this.beingMovedElements.length)return!1;for(var n=this.clientToPixel(t).transformBy(this.spaceTransforms.pixelToGL.matrix()),i=0;i<this.beingMovedElements.length;i+=1){var r=this.beingMovedElements[i];if(r!==this.elements&&(r.isBeingTouched(n)||r.move.canBeMovedAfterLosingTouch)){var o=null==r.move.element?r:r.move.element;!1===o.state.isBeingMoved&&o.startBeingMoved(),-1===this.beingMovedElements.indexOf(o)&&this.beingMovedElements.push(o),"rotation"===r.move.type?this.rotateElement(o,t,e):"scale"===r.move.type?this.scaleElement(o,t,e):"scaleX"===r.move.type?this.scaleElement(o,t,e,"x"):"scaleY"===r.move.type?this.scaleElement(o,t,e,"y"):this.translateElement(o,t,e)}this.moveTopElementOnly&&(i=this.beingMovedElements.length)}return this.animateNextFrame(!0,"touch move handler"),!0}},{key:"stop",value:function(t,e){var n=!(0<arguments.length&&void 0!==t)||t,i=1<arguments.length&&void 0!==e&&e;this.elements.stop(n,i)}},{key:"createDiagramElements",value:function(){this.elements=this.primitive.collection(),this.elements.diagramLimits=this.limits}},{key:"add",value:function(t,e){this.elements.add(t,e)}},{key:"setElementsToCollection",value:function(t){this.elements=t,this.setFirstTransform()}},{key:"clearContext",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;0===e?(this.webglLow.gl.clearColor(0,0,0,0),this.webglLow.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT)):(this.webglOffscreen.gl.clearColor(0,0,0,0),this.webglOffscreen.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT)),this.elements.clear(e)}},{key:"drawNow",value:function(t){var e=0<arguments.length&&void 0!==t?t:-1;this.drawQueued=!0,this.draw(e)}},{key:"draw",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0,i=t;-1===t&&(i=this.lastDrawTime),this.lastDrawTime=i,!0===this.scrolled&&(this.scrolled=!1,Math.abs(window.pageYOffset-this.oldScroll)>this.webglLow.gl.canvas.clientHeight/4&&(this.renderAllElementsToTiedCanvases(),this.scrollingFast=!0,this.scrollTimeoutId&&(clearTimeout(this.scrollTimeoutId),this.scrollTimeoutId=null),this.scrollTimeoutId=setTimeout(this.centerDrawingLens.bind(this,!0),100))),!1!==this.drawQueued&&(this.drawQueued=!1,this.clearContext(n),this.elements.draw(this.spaceTransforms.diagramToGL,i,n),this.elements.isMoving()&&this.animateNextFrame(!0,"is moving"),0<this.drawAnimationFrames&&(--this.drawAnimationFrames,this.animateNextFrame(!0,"queued frames")))}},{key:"centerDrawingLens",value:function(t){0<arguments.length&&void 0!==t&&t&&(this.scrollingFast=!1);var e=window.innerHeight||0;null!=document.documentElement&&(e=Math.max(document.documentElement.clientHeight,window.innerHeight||0));var n=window.pageYOffset+e/2-this.webglLow.gl.canvas.clientHeight/2;n<0&&(n=0);var i="".concat(n,"px");this.webglLow.gl.canvas.style.top!==i&&(this.webglLow.gl.canvas.style.top="".concat(n,"px"),this.draw2DLow.canvas.style.top="".concat(n,"px"),this.updateHTMLElementTie()),this.oldScroll=window.pageYOffset}},{key:"animateNextFrame",value:function(t,e){var n=!(0<arguments.length&&void 0!==t)||t,i=1<arguments.length&&void 0!==e?e:"";this.fromWhere=i,this.drawQueued||(n&&(this.drawQueued=!0),this.globalAnimation.queueNextFrame(this.draw.bind(this)))}},{key:"isAnimating",value:function(){return this.elements.isMoving()}},{key:"clientToPixel",value:function(t){var e=this.canvasLow.getBoundingClientRect();return new Y(t.x-e.left,t.y-e.top)}}])&&$c(e.prototype,n),t}();function th(t){return(th="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eh(t,e){return!e||"object"!==th(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function nh(t,e,n){return(nh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ih(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function ih(t){return(ih=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rh(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function oh(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ah(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function sh(t,e,n){return e&&ah(t.prototype,e),n&&ah(t,n),t}var lh=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";oh(this,t),this.id=e,Array.isArray(n)?this.classes=n:0<n.length?this.classes=n.split(" "):this.classes=[]}return sh(t,[{key:"render",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:0,i=1<arguments.length&&void 0!==e?e:"";return function(t,e,n,i){var r=" ".repeat(3<arguments.length&&void 0!==i?i:0),o=t?' id="'.concat(t,'"'):"",a=e?" ".concat(e.join(" ")):"",s="".concat(r,"<div").concat(o,' class="equation_element').concat(a,'">\n');return(s+="".concat(n,"\n"))+"".concat(r,"</div>")}(this.id,this.classes,i,n)}}]),t}(),uh=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return oh(this,t),(n=eh(this,ih(t).call(this,i,r))).classes.push("equation_text"),n.text=e,n}return rh(t,lh),sh(t,[{key:"render",value:function(e){var n=0<arguments.length&&void 0!==e?e:0;return nh(ih(t.prototype),"render",this).call(this,n,"".concat(" ".repeat(n+2)).concat(this.text))}}]),t}(),ch=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];oh(this,t),n=eh(this,ih(t).call(this,i,r));var o=[];return e.forEach((function(t){null!==t&&o.push(t)})),n.content=o,n}return rh(t,lh),sh(t,[{key:"render",value:function(e){var n=0<arguments.length&&void 0!==e?e:0;return nh(ih(t.prototype),"render",this).call(this,n,this.content.map((function(t){return t.render(n+2)})).join("\n"))}}]),t}(),hh=function(){function t(e,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return oh(this,t),(i=eh(this,ih(t).call(this,r,o))).classes.push("fraction"),i.numerator=e,i.denominator=n,i}return rh(t,lh),sh(t,[{key:"render",value:function(e){var n=0<arguments.length&&void 0!==e?e:0,i=" ".repeat(n+2),r="";return r+="".concat(i,'<div class="numerator">\n'),r+=this.numerator.render(n+4),r+="\n".concat(i,"</div>\n"),r+="".concat(i,'<div class="fraction_line"> </div>\n'),r+="".concat(i,'<div class="denominator">\n'),r+=this.denominator.render(n+4),r+="\n".concat(i,"</div>"),nh(ih(t.prototype),"render",this).call(this,n,r)}}]),t}(),fh=function(){function t(e,n,i){var r,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"";return oh(this,t),(r=eh(this,ih(t).call(this,o,a))).classes.push("supersub"),r.superscript=n,r.subscript=i,r.content=e,r}return rh(t,lh),sh(t,[{key:"render",value:function(e){var n=0<arguments.length&&void 0!==e?e:0,i=" ".repeat(n+2),r="";return r+="".concat(i,'<div class="supsub_content element">\n'),r+=this.content.render(n+2),r+="\n".concat(i,"</div>\n"),r+="".concat(i,'<div class="super_sub element">\n'),r+="".concat(i,'<div class="super_sub_super superscript_text element">\n'),null!==this.superscript&&(r+=this.superscript.render(n+4)),r+="\n".concat(i,"</div>\n"),r+="".concat(i,'<div class="super_sub_sub subscript_text element">\n'),null!==this.subscript&&(r+=this.subscript.render(n+4)),r+="\n".concat(i,"</div>"),r+="\n".concat(i,"</div>\n"),nh(ih(t.prototype),"render",this).call(this,n,r)}}]),t}(),dh=function(){function t(e,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";oh(this,t);var a=(i=eh(this,ih(t).call(this,e,null,n,r,o))).classes.indexOf("supersub");return-1<a&&i.classes.splice(a,1),i.classes.push("subscript"),i}return rh(t,fh),t}(),ph=function(){function t(e,n){var i,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";oh(this,t);var a=(i=eh(this,ih(t).call(this,e,n,null,r,o))).classes.indexOf("supersub");return-1<a&&i.classes.splice(a,1),i.classes.push("superscript"),i}return rh(t,fh),t}(),vh=function(){function t(e){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return oh(this,t),(n=eh(this,ih(t).call(this,i,r))).content=e,n}return rh(t,lh),sh(t,[{key:"render",value:function(e){var n=0<arguments.length&&void 0!==e?e:0,i=" ".repeat(n+2),r="";return r+="".concat(i,'<div class="square_root element">\n'),r+="".concat(i,'  <div class="equation_element radical element">\n'),r+="".concat(i,"    &radic;\n"),r+="".concat(i,"  </div>\n"),r+=this.content.render(n+4),r+="\n".concat(i,"</div>"),nh(ih(t.prototype),"render",this).call(this,n,r)}}]),t}();function mh(t){if(t instanceof ch)return t;if(t instanceof uh||t instanceof lh)return new ch([t]);if("string"==typeof t)return new ch([new uh(t)]);var e=[];return t.forEach((function(t){"string"==typeof t?e.push(new uh(t)):e.push(t)})),new ch(e)}var yh={tools:{math:i,g2:r,color:a,css:c,html:l,misc:o,lines:u},Diagram:Jc,DiagramElement:_r,DiagramElementCollection:Or,DiagramElementPrimitive:Sr,DrawContext2D:we,WebGLInstance:Ct,DrawingObject:oe,VertexObject:ye,TextObject:je,DiagramText:Ee,DiagramFont:Ae,HTMLObject:he,DiagramObjectAngle:qc,DiagramObjectLine:jc,DiagramObjectPolyLine:Yc,EqnNavigator:vc,EquationLabel:wc,EquationForm:_l,Equation:oc,HTMLEquation:function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return oh(this,t),eh(this,ih(t).call(this,[],e,n))}return rh(t,ch),sh(t,[{key:"createEq",value:function(t){var e=this,n=[];t.forEach((function(t){"string"==typeof t?n.push(new uh(t)):n.push(t),e.content=n}))}},{key:"htmlElement",value:function(){var t=document.createElement("div");return t.setAttribute("id",this.id),t.innerHTML=this.render(),this.classes.forEach((function(e){e&&t.classList.add(e)})),t}},{key:"el",value:function(t,e,n){return new uh(t,1<arguments.length&&void 0!==e?e:"",2<arguments.length&&void 0!==n?n:[])}},{key:"supsub",value:function(t,e,n,i,r){var o=3<arguments.length&&void 0!==i?i:"",a=4<arguments.length&&void 0!==r?r:[];return new fh(mh(t),mh(e),mh(n),o,a)}},{key:"sub",value:function(t,e,n,i){var r=2<arguments.length&&void 0!==n?n:"",o=3<arguments.length&&void 0!==i?i:[];return new dh(mh(t),mh(e),r,o)}},{key:"sup",value:function(t,e,n,i){var r=2<arguments.length&&void 0!==n?n:"",o=3<arguments.length&&void 0!==i?i:[];return new ph(mh(t),mh(e),r,o)}},{key:"frac",value:function(t,e,n,i){var r=2<arguments.length&&void 0!==n?n:"",o=3<arguments.length&&void 0!==i?i:[];return new hh(mh(t),mh(e),r,o)}},{key:"sqrt",value:function(t,e,n){var i=1<arguments.length&&void 0!==e?e:"",r=2<arguments.length&&void 0!==n?n:[];return new vh(mh(t),i,r)}}]),t}(),Point:Y,Line:lt,Rect:X,Transform:pt,TransformLimit:dt,Translation:ht,Scale:ft,Rotation:ct,parsePoint:K};e.default=yh}],t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(i,r,function(t){return e[t]}.bind(null,r));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},t.p="",t(t.s=0).default;function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var e,n}));